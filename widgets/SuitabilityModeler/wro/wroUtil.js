// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define(["dojo/_base/lang","dojo/_base/array","dojo/Deferred","esri/layers/RasterFunction"],function(n,g,k,h){return{serverSideRasterFunctionName:"WeightedOverlay_7_1_9_colormap",applyItemDataRenderingRule:function(a,c,b){var d;try{this.isServerSideWRORule(b)?(d=new h,d.functionName=b.renderingRule.rasterFunction||b.renderingRule.functionName,d.arguments=b.renderingRule.rasterFunctionArguments||b.renderingRule.arguments,d.variableName=b.renderingRule.variableName,a.setRenderingRule(d,!1)):b&&b.renderingRule&&
c.supportsClientSideWRO&&(d=new h(b.renderingRule),a.setRenderingRule(d,!1))}catch(e){console.error(e)}},hasServerSideWROFunction:function(a){var c=this.serverSideRasterFunctionName;return a&&(this.isServerSideWRORule(a)||a.rasterFunctionInfos&&g.some(a.rasterFunctionInfos,function(a){if(a&&a.name===c)return!0}))?!0:!1},isServerSideWRORule:function(a){var c=this.serverSideRasterFunctionName;return a&&a.renderingRule&&a.renderingRule.rasterFunction&&a.renderingRule.rasterFunction===c||a&&a.renderingRule&&
a.renderingRule.functionName&&a.renderingRule.functionName===c?!0:!1},makeItemData:function(a,c){a=a.designModelView.weightedOverlayService.modelToImageServiceLayer(c,{modelTitle:"New Model"});c={};n.mixin(c,a);delete c.id;delete c.url;delete c.opacity;delete c.title;return c},newWROInfo:function(){return{isGETen3:!1,isWROLayer:!1,isWROModel:!1,hasServerSideWROFunction:!1,supportsClientSideWRO:!1}},validateWROLayer:function(a,c,b,d,e){var f=new k,h="Title Url Description InputRanges OutputValues NoDataRanges RangeLabels NoDataRangeLabels".split(" "),
l=!1;b.isGETen3=10.3<=c.version;b.hasServerSideWROFunction=this.hasServerSideWROFunction(c);if(b.isGETen3){c.allowRasterFunction||d.push(a.wro.validation.notAllowRasterFunction);var m=[];c.fields&&(m=c.fields);g.forEach(h,function(b){g.some(m,function(a){return b===a.name})||d.push(a.wro.validation.missingFieldPattern.replace("{field}",b))});0<d.length&&!e&&(l=!1);l?c.getKeyProperties().then(function(c){"undefined"!==typeof c&&null!==c&&c.IsWeightedOverlay?b.supportsClientSideWRO=!0:d.push(a.wro.validation.notIsWeightedOverlayProp);
f.resolve()},function(a){f.reject(a)}):(0===d.length&&(b.supportsClientSideWRO=!0),f.resolve())}else b.hasServerSideWROFunction||d.push(a.wro.validation.notAWroService),f.resolve();return f},waitForLayer:function(a,c){var b=new k,d=[];if(a.loaded)return b.resolve(a),b;if(a.loadError)return b.reject(a.loadError),b;var e=function(){g.forEach(d,function(a){a.remove()})};d.push(a.on("load",function(a){e();b.resolve(a.layer)}));d.push(a.on("error",function(a){e();a=a.error;try{a.message&&-1!==a.message.indexOf("Unable to complete")?
(console.warn("layerAccessError",a),b.reject(Error(c.wro.validation.inaccessible))):b.reject(a)}catch(p){b.reject(a)}}));return b}}});