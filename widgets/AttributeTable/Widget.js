// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"dijit/layout/TabContainer":function(){define(["dojo/_base/lang","dojo/_base/declare","./_TabContainerBase","./TabController","./ScrollingTabController"],function(n,e,q,r,l){return e("dijit.layout.TabContainer",q,{useMenu:!0,useSlider:!0,controllerWidget:"",_makeController:function(e){var g=this.baseClass+"-tabs"+(this.doLayout?"":" dijitTabNoLayout");return new ("string"==typeof this.controllerWidget?n.getObject(this.controllerWidget):this.controllerWidget)({id:this.id+"_tablist",
ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,tabPosition:this.tabPosition,doLayout:this.doLayout,containerId:this.id,"class":g,nested:this.nested,useMenu:this.useMenu,useSlider:this.useSlider,tabStripClass:this.tabStrip?this.baseClass+(this.tabStrip?"":"No")+"Strip":null},e)},postMixInProperties:function(){this.inherited(arguments);this.controllerWidget||(this.controllerWidget="top"!=this.tabPosition&&"bottom"!=this.tabPosition||this.nested?r:l)}})})},"dijit/layout/_TabContainerBase":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style ./StackContainer ./utils ../_TemplatedMixin dojo/text!./templates/TabContainer.html".split(" "),
function(n,e,q,r,l,k,g,t){return n("dijit.layout._TabContainerBase",[l,g],{tabPosition:"top",baseClass:"dijitTabContainer",tabStrip:!1,nested:!1,templateString:t,postMixInProperties:function(){this.baseClass+=this.tabPosition.charAt(0).toUpperCase()+this.tabPosition.substr(1).replace(/-.*/,"");this.srcNodeRef&&r.set(this.srcNodeRef,"visibility","hidden");this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.tablist=this._makeController(this.tablistNode);this.doLayout||
e.add(this.domNode,"dijitTabContainerNoLayout");this.nested?(e.add(this.domNode,"dijitTabContainerNested"),e.add(this.tablist.containerNode,"dijitTabContainerTabListNested"),e.add(this.tablistSpacer,"dijitTabContainerSpacerNested"),e.add(this.containerNode,"dijitTabPaneWrapperNested")):e.add(this.domNode,"tabStrip-"+(this.tabStrip?"enabled":"disabled"))},_setupChild:function(g){e.add(g.domNode,"dijitTabPane");this.inherited(arguments)},removeChild:function(g){e.remove(g.domNode,"dijitTabPane");this.inherited(arguments)},
startup:function(){this._started||(this.tablist.startup(),this.inherited(arguments))},layout:function(){if(this._contentBox&&"undefined"!=typeof this._contentBox.l){var e=this.selectedChildWidget;if(this.doLayout){var g=this.tabPosition.replace(/-h/,"");this.tablist.region=g;g=[this.tablist,{domNode:this.tablistSpacer,region:g},{domNode:this.containerNode,region:"center"}];k.layoutChildren(this.domNode,this._contentBox,g);this._containerContentBox=k.marginBox2contentBox(this.containerNode,g[2]);e&&
e.resize&&e.resize(this._containerContentBox)}else{if(this.tablist.resize){g=this.tablist.domNode.style;g.width="0";var l=q.getContentBox(this.domNode).w;g.width="";this.tablist.resize({w:l})}e&&e.resize&&e.resize()}}},destroy:function(e){this.tablist&&this.tablist.destroy(e);this.inherited(arguments)}})})},"dijit/layout/StackContainer":function(){define("dojo/_base/array dojo/cookie dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/has dojo/_base/lang dojo/on dojo/ready dojo/topic dojo/when ../registry ../_WidgetBase ./_LayoutWidget".split(" "),
function(n,e,q,r,l,k,g,t,z,u,v,d,a,m){k("dijit-legacy-requires")&&z(0,function(){require(["dijit/layout/StackController"])});q=q("dijit.layout.StackContainer",m,{doLayout:!0,persist:!1,baseClass:"dijitStackContainer",buildRendering:function(){this.inherited(arguments);r.add(this.domNode,"dijitLayoutContainer")},postCreate:function(){this.inherited(arguments);this.own(t(this.domNode,"keydown",g.hitch(this,"_onKeyDown")))},startup:function(){if(!this._started){var b=this.getChildren();n.forEach(b,this._setupChild,
this);this.persist?this.selectedChildWidget=d.byId(e(this.id+"_selectedChild")):n.some(b,function(c){c.selected&&(this.selectedChildWidget=c);return c.selected},this);var a=this.selectedChildWidget;!a&&b[0]&&(a=this.selectedChildWidget=b[0],a.selected=!0);u.publish(this.id+"-startup",{children:b,selected:a,textDir:this.textDir});this.inherited(arguments)}},resize:function(){if(!this._hasBeenShown){this._hasBeenShown=!0;var b=this.selectedChildWidget;b&&this._showChild(b)}this.inherited(arguments)},
_setupChild:function(b){var a=b.domNode,c=l.place("\x3cdiv role\x3d'tabpanel' class\x3d'"+this.baseClass+"ChildWrapper dijitHidden'\x3e",b.domNode,"replace"),h=b["aria-label"]||b.title||b.label;h&&c.setAttribute("aria-label",h);l.place(a,c);b._wrapper=c;this.inherited(arguments);"none"==a.style.display&&(a.style.display="block");b.domNode.removeAttribute("title")},addChild:function(b,a){this.inherited(arguments);this._started&&(u.publish(this.id+"-addChild",b,a),this.layout(),this.selectedChildWidget||
this.selectChild(b))},removeChild:function(b){var a=n.indexOf(this.getChildren(),b);this.inherited(arguments);l.destroy(b._wrapper);delete b._wrapper;this._started&&u.publish(this.id+"-removeChild",b);if(!this._descendantsBeingDestroyed){if(this.selectedChildWidget===b&&(this.selectedChildWidget=void 0,this._started)){var c=this.getChildren();c.length&&this.selectChild(c[Math.max(a-1,0)])}this._started&&this.layout()}},selectChild:function(b,a){var c;b=d.byId(b);this.selectedChildWidget!=b&&(c=this._transition(b,
this.selectedChildWidget,a),this._set("selectedChildWidget",b),u.publish(this.id+"-selectChild",b,this._focused),this.persist&&e(this.id+"_selectedChild",this.selectedChildWidget.id));return v(c||!0)},_transition:function(b,a){a&&this._hideChild(a);a=this._showChild(b);b.resize&&(this.doLayout?b.resize(this._containerContentBox||this._contentBox):b.resize());return a},_adjacent:function(b){var a=this.getChildren(),c=n.indexOf(a,this.selectedChildWidget),c=c+(b?1:a.length-1);return a[c%a.length]},
forward:function(){return this.selectChild(this._adjacent(!0),!0)},back:function(){return this.selectChild(this._adjacent(!1),!0)},_onKeyDown:function(b){u.publish(this.id+"-containerKeyDown",{e:b,page:this})},layout:function(){var b=this.selectedChildWidget;b&&b.resize&&(this.doLayout?b.resize(this._containerContentBox||this._contentBox):b.resize())},_showChild:function(b){var a=this.getChildren();b.isFirstChild=b==a[0];b.isLastChild=b==a[a.length-1];b._set("selected",!0);b._wrapper&&r.replace(b._wrapper,
"dijitVisible","dijitHidden");return b._onShow&&b._onShow()||!0},_hideChild:function(b){b._set("selected",!1);b._wrapper&&r.replace(b._wrapper,"dijitHidden","dijitVisible");b.onHide&&b.onHide()},closeChild:function(b){if(!b.onClose||b.onClose(this,b))this.removeChild(b),b.destroyRecursive()},destroyDescendants:function(b){this._descendantsBeingDestroyed=!0;this.selectedChildWidget=void 0;n.forEach(this.getChildren(),function(a){b||this.removeChild(a);a.destroyRecursive(b)},this);this._descendantsBeingDestroyed=
!1}});q.ChildWidgetProperties={selected:!1,disabled:!1,closable:!1,iconClass:"dijitNoIcon",showTitle:!0};g.extend(a,q.ChildWidgetProperties);return q})},"dijit/layout/TabController":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/has dojo/i18n dojo/_base/lang ./StackController ../registry ../Menu ../MenuItem dojo/text!./templates/_TabButton.html dojo/i18n!../nls/common".split(" "),function(n,e,q,r,l,k,g,t,z,u,v,d){d=n("dijit.layout._TabButton"+(l("dojo-bidi")?"_NoBidi":
""),t.StackButton,{baseClass:"dijitTab",cssStateNodes:{closeNode:"dijitTabCloseButton"},templateString:d,_setNameAttr:"focusNode",scrollOnFocus:!1,buildRendering:function(){this.inherited(arguments);e.setSelectable(this.containerNode,!1)},startup:function(){this.inherited(arguments);var a=this.domNode;this.defer(function(){a.className=a.className},1)},_setCloseButtonAttr:function(a){this._set("closeButton",a);r.toggle(this.domNode,"dijitClosable",a);this.closeNode.style.display=a?"":"none";a&&(a=
k.getLocalization("dijit","common"),this.closeNode&&q.set(this.closeNode,"title",a.itemClose))},_setDisabledAttr:function(a){this.inherited(arguments);if(this.closeNode)if(a)q.remove(this.closeNode,"title");else{var d=k.getLocalization("dijit","common");q.set(this.closeNode,"title",d.itemClose)}},_setLabelAttr:function(a){this.inherited(arguments);this.showLabel||this.params.title||(this.iconNode.alt=g.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});l("dojo-bidi")&&(d=n("dijit.layout._TabButton",
d,{_setLabelAttr:function(a){this.inherited(arguments);this.applyTextDir(this.iconNode,this.iconNode.alt)}}));n=n("dijit.layout.TabController",t,{baseClass:"dijitTabController",templateString:"\x3cdiv role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown:onkeydown'\x3e\x3c/div\x3e",tabPosition:"top",buttonWidget:d,buttonWidgetCloseClass:"dijitTabCloseButton",postCreate:function(){this.inherited(arguments);var a=new u({id:this.id+"_Menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,
textDir:this.textDir,targetNodeIds:[this.domNode],selector:function(b){return r.contains(b,"dijitClosable")&&!r.contains(b,"dijitTabDisabled")}});this.own(a);var d=k.getLocalization("dijit","common"),b=this;a.addChild(new v({label:d.itemClose,ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,onClick:function(a){a=z.byNode(this.getParent().currentTarget);b.onCloseButtonClick(a.page)}}))}});n.TabButton=d;return n})},"dijit/layout/StackController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/topic ../focus ../registry ../_Widget ../_TemplatedMixin ../_Container ../form/ToggleButton dojo/touch".split(" "),
function(n,e,q,r,l,k,g,t,z,u,v,d,a,m){r=e("dijit.layout._StackButton",m,{tabIndex:"-1",closeButton:!1,_aria_attr:"aria-selected",buildRendering:function(b){this.inherited(arguments);(this.focusNode||this.domNode).setAttribute("role","tab")}});e=e("dijit.layout.StackController",[v,d,a],{baseClass:"dijitStackController",templateString:"\x3cspan role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown'\x3e\x3c/span\x3e",containerId:"",buttonWidget:r,buttonWidgetCloseClass:"dijitStackCloseButton",pane2button:function(b){return u.byId(this.id+
"_"+b)},postCreate:function(){this.inherited(arguments);this.own(t.subscribe(this.containerId+"-startup",k.hitch(this,"onStartup")),t.subscribe(this.containerId+"-addChild",k.hitch(this,"onAddChild")),t.subscribe(this.containerId+"-removeChild",k.hitch(this,"onRemoveChild")),t.subscribe(this.containerId+"-selectChild",k.hitch(this,"onSelectChild")),t.subscribe(this.containerId+"-containerKeyDown",k.hitch(this,"onContainerKeyDown")));this.containerNode.dojoClick=!0;this.own(g(this.containerNode,"click",
k.hitch(this,function(b){var a=u.getEnclosingWidget(b.target);if(a!=this.containerNode&&!a.disabled&&a.page)for(b=b.target;b!==this.containerNode;b=b.parentNode)if(q.contains(b,this.buttonWidgetCloseClass)){this.onCloseButtonClick(a.page);break}else if(b==a.domNode){this.onButtonClick(a.page);break}})))},onStartup:function(b){this.textDir=b.textDir;n.forEach(b.children,this.onAddChild,this);if(b.selected)this.onSelectChild(b.selected);var a=u.byId(this.containerId).containerNode,c=k.hitch(this,"pane2button");
b={title:"label",showtitle:"showLabel",iconclass:"iconClass",closable:"closeButton",tooltip:"title",disabled:"disabled",textdir:"textdir"};var h=function(b,h){return g(a,"attrmodified-"+b,function(b){var a=c(b.detail&&b.detail.widget&&b.detail.widget.id);a&&a.set(h,b.detail.newValue)})},d;for(d in b)this.own(h(d,b[d]))},destroy:function(b){this.destroyDescendants(b);this.inherited(arguments)},onAddChild:function(b,a){var c=new (k.isString(this.buttonWidget)?k.getObject(this.buttonWidget):this.buttonWidget)({id:this.id+
"_"+b.id,name:this.id+"_"+b.id,label:b.title,disabled:b.disabled,ownerDocument:this.ownerDocument,dir:b.dir,lang:b.lang,textDir:b.textDir||this.textDir,showLabel:b.showTitle,iconClass:b.iconClass,closeButton:b.closable,title:b.tooltip,page:b});this.addChild(c,a);b.controlButton=c;if(!this._currentChild)this.onSelectChild(b);a=b._wrapper.getAttribute("aria-labelledby")?b._wrapper.getAttribute("aria-labelledby")+" "+c.id:c.id;b._wrapper.removeAttribute("aria-label");b._wrapper.setAttribute("aria-labelledby",
a)},onRemoveChild:function(b){this._currentChild===b&&(this._currentChild=null);var a=this.pane2button(b.id);a&&(this.removeChild(a),a.destroy());delete b.controlButton},onSelectChild:function(b){if(b){if(this._currentChild){var a=this.pane2button(this._currentChild.id);a.set("checked",!1);a.focusNode.setAttribute("tabIndex","-1")}a=this.pane2button(b.id);a.set("checked",!0);this._currentChild=b;a.focusNode.setAttribute("tabIndex","0");u.byId(this.containerId)}},onButtonClick:function(a){var b=this.pane2button(a.id);
z.focus(b.focusNode);this._currentChild&&this._currentChild.id===a.id&&b.set("checked",!0);u.byId(this.containerId).selectChild(a)},onCloseButtonClick:function(a){u.byId(this.containerId).closeChild(a);this._currentChild&&(a=this.pane2button(this._currentChild.id))&&z.focus(a.focusNode||a.domNode)},adjacent:function(a){this.isLeftToRight()||this.tabPosition&&!/top|bottom/.test(this.tabPosition)||(a=!a);var b=this.getChildren(),c=n.indexOf(b,this.pane2button(this._currentChild.id)),h=b[c],d;do c=(c+
(a?1:b.length-1))%b.length,d=b[c];while(d.disabled&&d!=h);return d},onkeydown:function(a,d){if(!this.disabled&&!a.altKey&&(d=null,a.ctrlKey||!a._djpage)){switch(a.keyCode){case l.LEFT_ARROW:case l.UP_ARROW:a._djpage||(d=!1);break;case l.PAGE_UP:a.ctrlKey&&(d=!1);break;case l.RIGHT_ARROW:case l.DOWN_ARROW:a._djpage||(d=!0);break;case l.PAGE_DOWN:a.ctrlKey&&(d=!0);break;case l.HOME:for(var c=this.getChildren(),b=0;b<c.length;b++){var e=c[b];if(!e.disabled){this.onButtonClick(e.page);break}}a.stopPropagation();
a.preventDefault();break;case l.END:c=this.getChildren();for(b=c.length-1;0<=b;b--)if(e=c[b],!e.disabled){this.onButtonClick(e.page);break}a.stopPropagation();a.preventDefault();break;case l.DELETE:case 87:this._currentChild.closable&&(a.keyCode==l.DELETE||a.ctrlKey)&&(this.onCloseButtonClick(this._currentChild),a.stopPropagation(),a.preventDefault());break;case l.TAB:a.ctrlKey&&(this.onButtonClick(this.adjacent(!a.shiftKey).page),a.stopPropagation(),a.preventDefault())}null!==d&&(this.onButtonClick(this.adjacent(d).page),
a.stopPropagation(),a.preventDefault())}},onContainerKeyDown:function(a){a.e._djpage=a.page;this.onkeydown(a.e)}});e.StackButton=r;return e})},"dijit/layout/ScrollingTabController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/fx dojo/_base/lang dojo/on dojo/query dojo/sniff ../registry dojo/text!./templates/ScrollingTabController.html dojo/text!./templates/_ScrollingTabControllerButton.html ./TabController ./utils ../_WidgetsInTemplateMixin ../Menu ../MenuItem ../form/Button ../_HasDropDown dojo/NodeList-dom ../a11yclick".split(" "),
function(n,e,q,r,l,k,g,t,z,u,v,d,a,m,b,E,c,h,x,B){d=e("dijit.layout.ScrollingTabController",[m,E],{baseClass:"dijitTabController dijitScrollingTabController",templateString:d,useMenu:!0,useSlider:!0,tabStripClass:"",_minScroll:5,_setClassAttr:{node:"containerNode",type:"class"},buildRendering:function(){this.inherited(arguments);var a=this.domNode;this.scrollNode=this.tablistWrapper;this._initButtons();this.tabStripClass||(this.tabStripClass="dijitTabContainer"+this.tabPosition.charAt(0).toUpperCase()+
this.tabPosition.substr(1).replace(/-.*/,"")+"None",q.add(a,"tabStrip-disabled"));q.add(this.tablistWrapper,this.tabStripClass)},onStartup:function(){this.inherited(arguments);l.set(this.domNode,"visibility","");this._postStartup=!0;this.own(t(this.containerNode,"attrmodified-label, attrmodified-iconclass",g.hitch(this,function(a){this._dim&&this.resize(this._dim)})))},onAddChild:function(a,c){this.inherited(arguments);l.set(this.containerNode,"width",l.get(this.containerNode,"width")+200+"px")},
onRemoveChild:function(a,c){var b=this.pane2button(a.id);this._selectedTab===b.domNode&&(this._selectedTab=null);this.inherited(arguments)},_initButtons:function(){this._btnWidth=0;this._buttons=z("\x3e .tabStripButton",this.domNode).filter(function(a){if(this.useMenu&&a==this._menuBtn.domNode||this.useSlider&&(a==this._rightBtn.domNode||a==this._leftBtn.domNode))return this._btnWidth+=r.getMarginSize(a).w,!0;l.set(a,"display","none");return!1},this)},_getTabsWidth:function(){var a=this.getChildren();
if(a.length){var c=a[this.isLeftToRight()?0:a.length-1].domNode,a=a[this.isLeftToRight()?a.length-1:0].domNode;return a.offsetLeft+a.offsetWidth-c.offsetLeft}return 0},_enableBtn:function(a){var c=this._getTabsWidth();a=a||l.get(this.scrollNode,"width");return 0<c&&a<c},resize:function(a){this._dim=a;this.scrollNode.style.height="auto";var c=this._contentBox=b.marginBox2contentBox(this.domNode,{h:0,w:a.w});c.h=this.scrollNode.offsetHeight;r.setContentSize(this.domNode,c);c=this._enableBtn(this._contentBox.w);
this._buttons.style("display",c?"":"none");this._leftBtn.region="left";this._rightBtn.region="right";this._menuBtn.region=this.isLeftToRight()?"right":"left";b.layoutChildren(this.domNode,this._contentBox,[this._menuBtn,this._leftBtn,this._rightBtn,{domNode:this.scrollNode,region:"center"}]);this._selectedTab&&(this._anim&&"playing"==this._anim.status()&&this._anim.stop(),this.scrollNode.scrollLeft=this._convertToScrollLeft(this._getScrollForSelectedTab()));this._setButtonClass(this._getScroll());
this._postResize=!0;return{h:this._contentBox.h,w:a.w}},_getScroll:function(){return this.isLeftToRight()||8>u("ie")||u("trident")&&u("quirks")||u("webkit")?this.scrollNode.scrollLeft:l.get(this.containerNode,"width")-l.get(this.scrollNode,"width")+(u("trident")||u("edge")?-1:1)*this.scrollNode.scrollLeft},_convertToScrollLeft:function(a){if(this.isLeftToRight()||8>u("ie")||u("trident")&&u("quirks")||u("webkit"))return a;var c=l.get(this.containerNode,"width")-l.get(this.scrollNode,"width");return(u("trident")||
u("edge")?-1:1)*(a-c)},onSelectChild:function(a,c){var b=this.pane2button(a.id);if(b){var d=b.domNode;if(d!=this._selectedTab&&(this._selectedTab=d,this._postResize)){var f=this._getScroll();f>d.offsetLeft||f+l.get(this.scrollNode,"width")<d.offsetLeft+l.get(d,"width")?(d=this.createSmoothScroll(),c&&(d.onEnd=function(){b.focus()}),d.play()):c&&b.focus()}this.inherited(arguments)}},_getScrollBounds:function(){var a=this.getChildren(),c=l.get(this.scrollNode,"width"),b=l.get(this.containerNode,"width")-
c,d=this._getTabsWidth();if(a.length&&d>c)return{min:this.isLeftToRight()?0:a[a.length-1].domNode.offsetLeft,max:this.isLeftToRight()?a[a.length-1].domNode.offsetLeft+a[a.length-1].domNode.offsetWidth-c:b};a=this.isLeftToRight()?0:b;return{min:a,max:a}},_getScrollForSelectedTab:function(){var a=this._selectedTab,c=l.get(this.scrollNode,"width"),b=this._getScrollBounds(),a=a.offsetLeft+l.get(a,"width")/2-c/2;return a=Math.min(Math.max(a,b.min),b.max)},createSmoothScroll:function(a){if(0<arguments.length){var c=
this._getScrollBounds();a=Math.min(Math.max(a,c.min),c.max)}else a=this._getScrollForSelectedTab();this._anim&&"playing"==this._anim.status()&&this._anim.stop();var b=this,d=this.scrollNode,f=new k.Animation({beforeBegin:function(){this.curve&&delete this.curve;var c=d.scrollLeft,h=b._convertToScrollLeft(a);f.curve=new k._Line(c,h)},onAnimate:function(a){d.scrollLeft=a}});this._anim=f;this._setButtonClass(a);return f},_getBtnNode:function(a){for(a=a.target;a&&!q.contains(a,"tabStripButton");)a=a.parentNode;
return a},doSlideRight:function(a){this.doSlide(1,this._getBtnNode(a))},doSlideLeft:function(a){this.doSlide(-1,this._getBtnNode(a))},doSlide:function(a,c){c&&q.contains(c,"dijitTabDisabled")||(a*=.75*l.get(this.scrollNode,"width"),a=this._getScroll()+a,this._setButtonClass(a),this.createSmoothScroll(a).play())},_setButtonClass:function(a){var c=this._getScrollBounds();this._leftBtn.set("disabled",a<=c.min);this._rightBtn.set("disabled",a>=c.max)}});a=e("dijit.layout._ScrollingTabControllerButtonMixin",
null,{baseClass:"dijitTab tabStripButton",templateString:a,tabIndex:"",isFocusable:function(){return!1}});e("dijit.layout._ScrollingTabControllerButton",[x,a]);e("dijit.layout._ScrollingTabControllerMenuButton",[x,B,a],{containerId:"",tabIndex:"-1",isLoaded:function(){return!1},loadDropDown:function(a){this.dropDown=new c({id:this.containerId+"_menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir});var b=v.byId(this.containerId);n.forEach(b.getChildren(),function(a){var c=
new h({id:a.id+"_stcMi",label:a.title,iconClass:a.iconClass,disabled:a.disabled,ownerDocument:this.ownerDocument,dir:a.dir,lang:a.lang,textDir:a.textDir||b.textDir,onClick:function(){b.selectChild(a)}});this.dropDown.addChild(c)},this);a()},closeDropDown:function(a){this.inherited(arguments);this.dropDown&&(this._popupStateNode.removeAttribute("aria-owns"),this.dropDown.destroyRecursive(),delete this.dropDown)}});return d})},"widgets/AttributeTable/_ResourceManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all esri/lang jimu/portalUrlUtils ./table/_FeatureTable jimu/utils ./utils jimu/LayerInfos/LayerInfos".split(" "),
function(n,e,q,r,l,k,g,t,z,u,v){return n(null,{_activeLayerInfoId:null,_activeRelationshipKey:null,nls:null,config:null,map:null,parent:null,_delayedLayerInfos:[],_layerInfosFromMap:[],featureTableSet:{},relationshipsSet:{},relationshipTableSet:{},currentRelationshipKey:null,relationshipInfoMapping:{},constructor:function(d){this.widgetId=d&&d.widgetId;this.map=d&&d.map;this.nls=d&&d.nls;this.parent=d&&d.parent;this._delayedLayerInfos=[];this._layerInfosFromMap=[];this.featureTableSet={};this.relationshipsSet=
{};this.relationshipTableSet={};this.currentRelationshipKey=null;this.relationshipInfoMapping={}},setConfig:function(d){this.config=e.clone(d||{})},setMap:function(d){this.map=d},updateLayerInfoResources:function(d){var a=new r;u.readConfigLayerInfosFromMap(this.map,!1,!0).then(e.hitch(this,function(m){this._layerInfosFromMap=m;this._processDelayedLayerInfos();d&&(0===this.config.layerInfos.length?(m=u.getConfigInfosFromLayerInfos(m),this.config.layerInfos=q.filter(m,function(a){return a.show})):
this.config.layerInfos=q.filter(e.delegate(this.config.layerInfos),e.hitch(this,function(a){var b=this._getLayerInfoById(a.id),c=this.config.syncWithLayers?b.isVisible():a.show;c&&b&&(a.name=b.name||b.title,a.show=c);return c&&b})));a.resolve()}),function(d){a.reject(d)});return a},isEmpty:function(){return this.config&&this.config.layerInfos&&0>=this.config.layerInfos.length},getConfigInfos:function(){return e.clone(this.config.layerInfos)},addLayerInfo:function(d){0===this._layerInfosFromMap.length?
this._delayedLayerInfos.push(d):0<this._layerInfosFromMap.length&&!this._getLayerInfoById(d.id)&&this._layerInfosFromMap.push(d)},addConfigInfo:function(d){this._getConfigInfoById(d.id)||(d=u.getConfigInfoFromLayerInfo(d),this.config.layerInfos.push({id:d.id,name:d.name,layer:{url:d.layer.url,fields:d.layer.fields}}))},removeLayerInfo:function(d){d=this._getLayerInfoById(d);d=this._layerInfosFromMap.indexOf(d);this._layerInfosFromMap.splice(d,1)},removeConfigInfo:function(d){if(e.getObject("config.layerInfos",
!1,this))for(var a=this.config.layerInfos.length,m=0;m<a;m++)if(this.config.layerInfos[m].id===d){this.featureTableSet[d]&&(this.featureTableSet[d].destroy(),delete this.featureTableSet[d]);this.config.layerInfos.splice(m,1);break}},getQueryTable:function(d,a,m,b){var g=new r;this._activeLayerInfoId=d;this.featureTableSet[d]?g.resolve({isSupportQuery:!0,table:this.featureTableSet[d]}):this._getQueryTableInfo(d).then(e.hitch(this,function(c){if(c){var h=c.layerInfo,x=c.layerObject;c=c.tableInfo;if(this.featureTableSet[d])g.resolve({isSupportQuery:c.isSupportQuery,
table:this.featureTableSet[d]});else if(e.getObject("isSupportQuery",!1,c)){var B=this._getConfigInfoById(d);B||(this.addConfigInfo(h),B=this._getConfigInfoById(d));var E=e.getObject("layer.fields",!1,B),x=x&&x.fields,x=u.arcade.appendArcadeExpressionsToFields(x,h);B.layer.fields=this._clipValidFields(E,x);h=new t({widgetId:this.widgetId,map:this.map,matchingMap:a,hideExportButton:m,allowTextSelection:b,layerInfo:h,configedInfo:B,nls:this.nls,parent:this.parent});this.featureTableSet[d]=h;g.resolve({isSupportQuery:c.isSupportQuery,
table:h})}else g.resolve({isSupportQuery:!1})}else g.resolve(null)}),function(a){g.reject(a)});return g},getRelationTable:function(d,a,m,b,g){var c=new r,h=this.relationshipsSet[a];this._activeRelationshipKey=a;if(h){var x=this._getLayerInfoById(d);d=this.getRelationShipInfo(h);this.getQueryTable(d.id,m,b,g).then(e.hitch(this,function(a){if(a&&a.table){var b=a.table;z.isEqual(b.relationship,h)||(b.set("prevRelationship",b.relationship),b.set("relationship",h));b.set("relatedOriginalInfo",x)}c.resolve(a)}),
e.hitch(function(){c.resolve(null)}))}else c.resolve(null);return c},removeRelationTable:function(d){this.relationshipTableSet[d]&&(this.relationshipTableSet[d].destroy(),this.relationshipTableSet[d]=null)},getCurrentTable:function(d){return this.featureTableSet[d]||this.relationshipTableSet[d]},collectRelationShips:function(d,a){this._collectRelationShips(d,d.layerObject,a)},getConfigInfoById:function(d){return this._getConfigInfoById(d)},getLayerInfoById:function(d){return this._getLayerInfoById(d)},
getVisivleLayerInfoIndexById:function(d){return this._getVisivleLayerInfoIndexById(d)},getRelationshipsByInfoId:function(d){var a=[],e;for(e in this.relationshipsSet){var b=this.relationshipsSet[e];b._layerInfoId===d&&a.push(b)}return a},getRelationShipInfo:function(d){var a;if(d)for(var e in this.relationshipInfoMapping)d._relKey===e&&(a=this.relationshipInfoMapping[e]);return a},empty:function(){this._delayedLayerInfos=[];this._layerInfosFromMap=[];this.featureTableSet={};for(var d in this.relationshipsSet)this._removeRelationShipInfo(this.relationshipsSet[d]);
this.relationshipsSet={};this.relationshipTableSet={};this.nls=this.map=this.config=this.currentRelationshipKey=null},_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&(q.forEach(this._delayedLayerInfos,e.hitch(this,function(d){!this._getLayerInfoById(d&&d.id)&&this.map&&this.map.getLayer(d.id)&&this._layerInfosFromMap.push(d)})),this._delayedLayerInfos=[])},_getLayerInfoById:function(d){for(var a=0,e=this._layerInfosFromMap.length;a<e;a++)if(this._layerInfosFromMap[a]&&this._layerInfosFromMap[a].id===
d)return this._layerInfosFromMap[a]},_getVisivleLayerInfoIndexById:function(d){for(var a=-1,e=0,b=this._layerInfosFromMap.length;e<b;e++)if(this._layerInfosFromMap[e]&&this._layerInfosFromMap[e].isShowInMap()&&(a++,this._layerInfosFromMap[e].id===d))return a},_getConfigInfoById:function(d){if(!e.getObject("layerInfos.length",!1,this.config))return null;for(var a=0,m=this.config.layerInfos.length;a<m;a++){var b=this.config.layerInfos[a];if(b&&b.id===d)return b}return null},_getQueryTableInfo:function(d){var a=
new r,m=this._getLayerInfoById(d);if(m){var b=[],g=m.getUrl();b.push(m.getLayerObject());b.push(m.getSupportTableInfo());g&&b.push(m.getRelatedTableInfoArray());l(b).then(e.hitch(this,function(c){if(this._activeLayerInfoId===d&&c){var b=c[0],e=c[1];c=g?c[2]:[];k.isDefined(c)&&k.isDefined(b)&&0<c.length&&this._collectRelationShips(m,b,c);a.resolve({layerInfo:m,layerObject:b,tableInfo:e})}else a.resolve(null)}),function(c){a.reject(c)})}else console.error("no activeLayerInfo!"),a.reject(Error());return a},
_collectRelationShips:function(d,a,m){var b=a.relationships;if(b&&0<b.length&&a&&a.url){var l=a.url.split("/");q.forEach(b,e.hitch(this,function(c){l[l.length-1]=c.relatedTableId;var b=l.join("/"),x=q.filter(m,e.hitch(this,function(a){a=a.getUrl();return k.isDefined(a)&&k.isDefined(b)&&g.removeProtocol(a.toString().toLowerCase())===g.removeProtocol(b.toString().toLowerCase())})),B=d.id+"_"+c.name+"_"+c.id;c._relKey=B;c._layerInfoId=d.id;x&&0<x.length&&this._setRelationShipInfo(c,x[0]);this.relationshipsSet[B]||
(this.relationshipsSet[B]=c,this.relationshipsSet[B].objectIdField=a.objectIdField)}))}},_setRelationShipInfo:function(d,a){d&&"_relKey"in d&&(this.relationshipInfoMapping[d._relKey]=a)},_removeRelationShipInfo:function(d){if(d&&"_relKey"in d)for(var a in this.relationshipInfoMapping)d._relKey===a&&delete this.relationshipInfoMapping[a]},_getLayerInfoLabel:function(d){return d.name||d.title},_getLayerInfoId:function(d){return d&&d.id||""},_clipValidFields:function(d,a){if(!d||!d.length)return a||
[];if(!a||!a.length)return d;for(var m=[],b=[],g=0,c=a.length;g<c;g++){for(var h=a[g],x=0,B=d.length;x<B;x++){var l=d[x];if(l.name===h.name)break}x===B&&b.push(h)}g=0;for(c=d.length;g<c;g++)for(l=d[g],x=0,B=a.length;x<B;x++)if(h=a[x],h.name===l.name){m.push(l);break}m=m.concat(b);0===m.length&&0<d.length&&(d=e.clone(a),q.forEach(d,e.hitch(this,function(a){"esriFieldTypeGeometry"!==a.type&&(a.show=!0,m.push(a))})));return m}})})},"widgets/AttributeTable/table/_FeatureTable":function(){define("dojo/_base/declare dojo/_base/html dijit/_WidgetBase jimu/dijit/Message jimu/dijit/Filter dgrid/OnDemandGrid ../dgrid/Selection dgrid/extensions/ColumnHider dgrid/extensions/ColumnResizer dgrid/extensions/ColumnReorder dgrid/Keyboard dijit/Menu dijit/MenuItem dijit/PopupMenuItem dijit/Toolbar dijit/form/Button dijit/DropDownMenu dijit/form/ToggleButton dijit/form/DropDownButton dojo/Deferred dojo/when dojo/Evented dojo/touch dojo/store/Memory esri/config esri/lang esri/request esri/tasks/RelationParameters esri/tasks/RelationshipQuery esri/layers/FeatureLayer esri/tasks/QueryTask esri/tasks/query esri/tasks/ProjectParameters esri/geometry/Multipoint esri/geometry/geometryEngine esri/geometry/normalizeUtils esri/IdentityManager dojo/_base/lang dojo/on dojo/aspect dojo/_base/array jimu/dijit/LoadingIndicator jimu/dijit/FieldStatistics jimu/dijit/Popup jimu/dijit/CheckBox jimu/SelectionManager jimu/CSVUtils jimu/utils ../utils dojo/query dojo/string dojo/topic dojo/keys dojo/has".split(" "),
function(n,e,q,r,l,k,g,t,z,u,v,d,a,m,b,E,c,h,x,B,N,P,J,F,f,w,H,G,S,T,Q,K,X,Y,Z,aa,ba,p,D,ca,A,U,da,ea,fa,ga,ha,O,L,R,ia,W,I,V){return n([q,P],{baseClass:"jimu-widget-attributetable-feature-table",_defaultFeatureCount:2E3,_defaultBatchCount:25,_batchCount:0,_filterObj:null,_currentDef:null,_requestStatus:"initial",parent:null,map:null,matchingMap:!1,layerInfo:null,configedInfo:null,footerHeight:25,layer:null,loading:null,grid:null,footer:null,selectedRowsLabel:null,selectionRows:null,nls:null,_dblClickResult:null,
actived:!1,showSelected:!1,tableCreated:!1,_relatedQuery:!1,_relatedQueryIds:null,_selectionHandles:null,_selectionResults:null,_normalizedExtent:null,GRID_FAR_OFF_REMOVAL:{DEFAULT:2E3,RESELECTION:Infinity,INFINITY:Infinity},constructor:function(a){a=a||{};this.set("parent",a.parent||null);this.set("map",a.map||null);this.set("matchingMap",!!a.matchingMap);this.set("layerInfo",a.layerInfo||null);this.set("layer",a.layer||null);this.set("configedInfo",a.configedInfo||null);this.set("relatedOriginalInfo",
a.relatedOriginalInfo||null);this.set("relationship",a.relationship||null);this.set("prevRelationship",null);this.set("syncSelection",!!a.syncSelection||!0)},postCreate:function(){this.inherited(arguments);this._relatedQueryIds=[];this.createToolbar();this.loading=new U;this.loading.placeAt(this.domNode);this.selectionManager=ga.getInstance();this._selectionResults=[];this.selectionRows=[];this._normalizedExtent=null;e.setAttr(this.domNode,"data-layerinfoid",p.getObject("layerInfo.id",!1,this));this.get("map")&&
(this.own(D(this.map.root,J.release,p.hitch(this,function(){this._clickMap=!0}))),this.own(D(this.map,"extent-change",p.hitch(this,"_onExtentChange"))));this.own(D(window,"resize",p.hitch(this,this._resize)));this.layerInfo&&this.own(D(this.layerInfo,"filterChanged",p.hitch(this,this._handleFilterChange)))},startup:function(){this.inherited(arguments);this.toolbarHeight=parseInt(e.getStyle(this.toolbar.domNode,"height"),10)||0},setLayerDefinition:function(a){this._layerDefinition=a},getLayerDefinition:function(){return this._getLayerDifinition()},
getFilterableFields:function(){if(this._layerDefinition&&this.configedInfo){var a=p.clone(this._layerDefinition);return this._getFilterableFields(a.fields,this.configedInfo.layer.fields)}return[]},getFilterObj:function(){return this._filterObj},setFilterObj:function(a){this._filterObj=a},showRefreshing:function(a){a?this._toggleLoading(!0):this._toggleLoading(!1)},active:function(){this.actived=!0},deactive:function(){this.actived=!1},cancelThread:function(){"fulfilled"!==this._requestStatus&&this._currentDef&&
(this._currentDef.cancel({canceledBySelf:!0}),this._requestStatus="canceled")},isCanceled:function(){return"canceled"===this._requestStatus},createToolbar:function(){var f=new b({},e.create("div")),y=new c;this.showSelectedRecordsMenuItem=new a({label:this.nls.showSelectedRecords,iconClass:"esriAttributeTableSelectPageImage",onClick:p.hitch(this,this.toggleSelectedRecords)});y.addChild(this.showSelectedRecordsMenuItem);var M=this.layerInfo&&this.layerInfo.layerObject&&this.layerInfo.layerObject.relationships,
w=new d;this.showRelatedRecordsMenuItem=new m({label:this.nls.showRelatedRecords,iconClass:"esriAttributeTableSelectAllImage",popup:w});if(M&&0<M.length){var g=A.map(M,p.hitch(this,function(a){return this.parent&&this.parent.getRelationShipInfo(a)}));A.forEach(M,p.hitch(this,function(c){var b=this.parent&&this.parent.getRelationShipInfo(c),f=0;b&&(A.some(g,function(a){a&&a.name===b.name&&f++;if(1<f)return!1}),w.addChild(new a({label:b.name+(1<f?c&&'\x3cbr\x3e\x3cspan style\x3d"opacity: 0.4"\x3e\x26lpar;'+
c.name+"\x26rpar;\x3c/span\x3e":""),onClick:p.hitch(this,this.onShowRelatedRecordsClick,c)})))}))}y.addChild(this.showRelatedRecordsMenuItem);this.filterMenuItem=new a({label:this.nls.filter,iconClass:"esriAttributeTableFilterImage",onClick:p.hitch(this,this.onFilterMenuItemClick)});y.addChild(this.filterMenuItem);this.toggleColumnsMenuItem=new a({label:this.nls.columns,iconClass:"esriAttributeTableColumnsImage",onClick:p.hitch(this,this.onToggleColumnsClick)});y.addChild(this.toggleColumnsMenuItem);
this.hideExportButton||(this.exportCSVMenuItem=new a({label:this.nls.exportFiles,showLabel:!0,iconClass:"esriAttributeTableExportImage",onClick:p.hitch(this,this.onExportCSVClick)}),y.addChild(this.exportCSVMenuItem));this.selectionMenu=new x({label:this.nls.options,iconClass:"esriAttributeTableOptionsImage",dropDown:y});f.addChild(this.selectionMenu);this.matchingCheckBox=new h({checked:this.matchingMap?!0:!1,showLabel:!0,label:this.nls.filterByExtent,onChange:p.hitch(this,function(a){this.set("matchingMap",
a);this._onMatchingCheckBoxChange(a)})});f.addChild(this.matchingCheckBox);this.zoomButton=new E({label:this.nls.zoomto,iconClass:"esriAttributeTableZoomImage",onClick:p.hitch(this,this.zoomTo)});f.addChild(this.zoomButton);this.clearSelectionButton=new E({label:this.nls.clearSelection,iconClass:"esriAttributeTableClearImage",onClick:p.hitch(this,this.clearSelection,!0,!0)});f.addChild(this.clearSelectionButton);this.refreshButton=new E({label:this.nls.refresh,showLabel:!0,iconClass:"esriAttributeTableRefreshImage",
onClick:p.hitch(this,this.refresh)});f.addChild(this.refreshButton);e.place(f.domNode,this.domNode);this.toolbar=f;this.own(D(this,"data-loaded,row-click,clear-selection",p.hitch(this,"changeToolbarStatus")));this.parent&&W.publish(this.parent.id+"_toolbar_created",{toolbar:this.toolbar,context:this})},startQuery:function(a){this.cancelThread();this._requestStatus="processing";this._toggleLoading();a&&a.length?this.queryByStoreObjectIds=a:(this._relatedQuery=!1,this._relatedQueryIds=[],this.queryByStoreObjectIds=
null);this._currentDef=this._getLayerObject();this._currentDef.then(p.hitch(this,function(c){this.domNode&&(this.layer=c,(c=!this.layerInfo.isTable&&this.matchingMap&&this.map.extent||null)&&c.spatialReference&&c.spatialReference.isWebMercator()?(this._currentDef=aa.normalizeCentralMeridian([c],null,p.hitch(this,function(a){return a[0]}))).then(p.hitch(this,function(c){this._doQuery(c,a);this._normalizedExtent=c}),p.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);this.changeToolbarStatus();
this._toggleLoading(!1)})):this._doQuery(c,a))}),p.hitch(this,function(a){console.error(a);this.changeToolbarStatus();this._toggleLoading(!1)}))},queryRecordsByRelationship:function(a){var c=a&&a.layer,b=a&&a.selectedIds;a&&a.relationship&&(this.set("prevRelationship",this.relationship),this.set("relationship",a.relationship));a&&a.relatedOriginalInfo&&this.set("relatedOriginalInfo",a.relatedOriginalInfo);var f=this.relationship;a=this.prevRelationship;c&&f&&b&&0<b.length&&(!O.isEqual(this._relatedQueryIds,
b)||!O.isEqual(f,a))&&p.getObject("relatedOriginalInfo.layerObject.url",!1,this)?(this._toggleLoading(!0),this._requestStatus="processing",this._relatedQuery=!0,this.matchingCheckBox.set("checked",!1),this.cancelThread(),this._currentDef=this._getLayerObject(),this._currentDef.then(p.hitch(this,function(a){if(this.domNode){this.layer=a;var C=[],d=this.layer;A.forEach(d.fields,function(a){w.isDefined(a.show)&&!0!==a.show&&!("esriFieldTypeOID"===a.type||w.isDefined(d.objectIdField)&&a.name===d.objectIdField)||
L.arcade.isArcadeExpressionField(a)||C.push(a.name)});a=new S;a.objectIds=b;a.outFields=C.length?C:["*"];a.relationshipId=f.id;a.returnGeometry="esriGeometryPoint"===this.layer.geometryType;(this._currentDef=c.queryRelatedFeatures(a,function(a){return a})).then(p.hitch(this,function(a){if(this.domNode){var c={displayFieldName:f.objectIdField,fields:d.fields,features:[],fieldAliases:null},C={},h=function(a){var b=a.attributes[this.layer.objectIdField];C[b]||(C[b]=!0,c.features.push(a))},y;for(y in a){var M=
a[y];A.forEach(M&&M.features,h,this)}e.destroy(this.tipNode);0<c.features.length?(this.grid||(this._removeTable(),e.place(this.loading.domNode,this.domNode)),a=this._getOutFieldsFromLayerInfos(this.layer.objectIdField),this.queryExecute(a,c.features.length,!1,c)):(this.tipNode=e.toDom("\x3cdiv\x3e"+this.nls.noRelatedRecords+"\x3c/div\x3e"),this._removeTable(),e.place(this.tipNode,this.domNode),e.place(this.loading.domNode,this.domNode));this._relatedQueryIds=b;this.emit("data-loaded");this._toggleLoading(!1)}}),
p.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);e.destroy(this.tipNode);this.tipNode=e.toDom("\x3cdiv\x3e"+this.nls.noRelatedRecords+"\x3c/div\x3e");this._removeTable();e.place(this.tipNode,this.domNode);e.place(this.loading.domNode,this.domNode);this._toggleLoading(!1);this.changeToolbarStatus()}))}}),p.hitch(this,function(a){console.error(a);this._toggleLoading(!1);this.changeToolbarStatus()}))):this._toggleLoading(!1)},getSelectedRows:function(){return this.tableCreated?
this.selectionRows:[]},zoomTo:function(){this._zoomToSelected()},toggleSelectedRecords:function(){this._relatedQuery&&!this.showSelected&&0===this.getSelectedRows().length?(this._relatedQuery=!1,this._relatedQueryIds=[],this.layerInfo&&!this.layerInfo.isTable&&this.matchingCheckBox.set("checked",!0),this.startQuery(),this.showSelectedRecordsMenuItem.set("label",this.nls.showSelectedRecords),this.showSelected=!1,this.emit("show-all-records",{layerInfoId:this.layerInfo.id})):this.tableCreated&&(this.showSelected?
(this.showAllSelectedRecords(),this.showSelectedRecordsMenuItem.set("label",this.nls.showSelectedRecords),this.showSelected=!1,this.emit("show-all-records",{layerInfoId:this.layerInfo.id})):(this.showSelectedRecords(),this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords),this.showSelected=!0,this.emit("show-selected-records",{layerInfoId:this.layerInfo.id})))},onShowRelatedRecordsClick:function(a){var c=this.getSelectedRows();0<c.length?this.emit("show-related-records",{layerInfoId:this.layerInfo.id,
objectIds:c,relationshipObj:a}):this._getFeatureIds(this.layer&&this.layer.objectIdField,this.matchingMap&&this._normalizedExtent).then(p.hitch(this,function(c){console.log(c);this.emit("show-related-records",{layerInfoId:this.layerInfo.id,objectIds:c,relationshipObj:a})}))},onFilterMenuItemClick:function(){this.showRefreshing(!0);this.getLayerDefinition().then(p.hitch(this,function(a){if(this.domNode){a=p.clone(a);var c=this.getFilterableFields();a.fields=c;var b=new l({widgetId:this.widgetId,noFilterTip:this.nls.noFilterTip,
style:"width:100%;",featureLayerId:this.layerInfo.id,runtime:!0}),c=this._getFilterPopupSize();this._filterPopup=new ea({titleLabel:this.nls.filter,width:c.w,height:c.h,content:b,autoHeight:!0,buttons:[{label:this.nls.ok,onClick:p.hitch(this,function(){var a=b.toJson();a&&a.expr?(this.setFilterObj(a),this.clearSelection(!1),this.startQuery(),this._filterPopup.close(),this._filterPopup=null,this.emit("apply-filter",{layerInfoId:this.layerInfo.id,expr:a.expr})):new r({message:this.nls.setFilterTip})})},
{label:this.nls.cancel}]});b.startup();e.addClass(this._filterPopup.domNode,"widget-at-filter-popup");c=this.getFilterObj();b.build({url:this.layer.url,partsObj:c,layerDefinition:this.layer||a,featureLayerId:this.layer.id})}}),p.hitch(this,function(a){this.domNode&&console.error(a)})).always(p.hitch(this,function(){this.showRefreshing(!1)}));this.emit("show-filter",{layerInfoId:this.layerInfo.id})},_getFilterPopupSize:function(){var a={w:720,h:485};window.appInfo.isRunInMobile&&(a={w:window.innerWidth,
h:window.innerHeight});return a},_resize:function(){if(this._filterPopup){var a=this._getFilterPopupSize();this._filterPopup.resize(a)}},onToggleColumnsClick:function(){this.toggleColumns();this.emit("toggle-columns",{layerInfoId:this.layerInfo.id})},onExportCSVClick:function(){var a=this._getRichTextFields(),c=this._getExportCSVPopupMessage(a),b=new r({"class":this.baseClass+"-popup",message:c,titleLabel:this.nls.exportFiles,autoHeight:!0,buttons:[{label:this.nls.ok,onClick:p.hitch(this,function(){var f=
c._check;b.domNode&&(b.domNode.className+=" is-loading",(new U).placeAt(b.domNode));this.exportToCSV(null,"undefined"===typeof f||f.checked?null:a).then(function(){b.close()},function(a){console.error("Error exporting CSV for Attribute Table");b.close()})})},{label:this.nls.cancel}]});this.emit("export-csv",{layerInfoId:this.layerInfo.id})},_getExportCSVPopupMessage:function(a){var c=document.createElement("div");c.className="message-wrapper";c.appendChild(document.createTextNode(this.nls.exportMessage));
if(a.length){var b=document.createElement("div");b.className="input-row";var f=new fa({label:this.nls.keepRichTextLabel,checked:!0}),d=document.createElement("a");d.className="hint-button";d.href="#";d.role="button";d.appendChild(document.createTextNode(this.nls.whatsThis));b.appendChild(f.domNode);b.appendChild(d);c.appendChild(b);c._check=f;this.own(D(d,"click",p.hitch(this,function(c){c.preventDefault();c={"class":this.baseClass+"-popup",message:this._getRichTextMessage(a)};window.appInfo.isRunInMobile||
(c.width=500);new r(c)})))}return c},_getRichTextMessage:function(a){if(!a||a.hasOwnProperty("length")&&!a.length)return"";for(var c=document.createElement("div"),b="",f=0,d=a.length;f<d;f++)b+="\x3cmark\x3e"+a[f].fieldName+"\x3c/mark\x3e";a=""+("\x3cp\x3e"+ia.substitute(this.nls.richTextMessage.explanatoryText.line1,{layerName:"\x3cstrong\x3e"+this.layer.name+"\x3c/strong\x3e"})+"\x3c/p\x3e");a=a+('\x3cdiv class\x3d"tags"\x3e'+b+"\x3c/div\x3e")+("\x3cp\x3e"+this.nls.richTextMessage.explanatoryText.line2+
"\x3c/p\x3e\x3cp\x3e"+this.nls.richTextMessage.explanatoryText.line3+"\x3c/p\x3e\x3ch3\x3e"+this.nls.richTextMessage.example.label+'\x3c/h3\x3e\x3cdiv class\x3d"example-block"\x3e\x3cpre\x3e\x3cu\x3eArcGIS\x3c/u\x3e \x3cfont color\x3d"#31aacd"\x3eWeb AppBuilder\x3c/font\x3e\x3c/pre\x3e'+this.nls.richTextMessage.example.scenarios.first+'\x3cpre\x3e\x26ltu\x26gtArcGIS\x26lt/u\x26gt \x26ltfont color\x3d"#31aacd"\x26gtWeb AppBuilder\x26lt/font\x26gt\x3c/pre\x3e'+this.nls.richTextMessage.example.scenarios.second+
"\x3cpre\x3eArcGIS Web AppBuilder\x3c/pre\x3e\x3c/div\x3e");c.innerHTML=a;return c},_getRichTextFields:function(){var a=this.layerInfo&&this.layerInfo.getPopupInfo&&this.layerInfo.getPopupInfo(),a=a&&a.fieldInfos,c=[];if(a)for(var b=0,f=a.length;b<f;b++){var d=a[b];d.stringFieldOption&&"richtext"===d.stringFieldOption&&c.push(d)}return c},onSelectionComplete:function(){var a=this.layer&&this.layer.getSelectedFeatures();a&&(0===a.length?this.clearSelection(!1,0<this._selectionResults.length):this._selectBySelf(a)||
(this.clearSelection(!1),this._updateSelectRowsByFeatures(a)))},onSelectionClear:function(){this.clearSelection(!1,!0);this._setFarOffRemoval(this.GRID_FAR_OFF_REMOVAL.DEFAULT)},changeToolbarStatus:function(){if(this.tableCreated){var a=this.getSelectedRows();this.showSelected?this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords):this.showSelectedRecordsMenuItem.set("label",this.nls.showSelectedRecords);this.tableCreated&&a&&0<a.length&&this.layer&&this.layer.objectIdField?(this.showSelectedRecordsMenuItem.set("disabled",
!1),this.clearSelectionButton.set("disabled",!1)):(this.showSelectedRecordsMenuItem.set("disabled",!0),this.clearSelectionButton.set("disabled",!0));this._relatedQuery&&(this.showSelectedRecordsMenuItem.set("disabled",!1),this.tableCreated&&a&&0===a.length&&this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords));this.showRelatedRecordsMenuItem.set("disabled",!0);if(this.layerInfo&&this.isSupportQueryToServer()&&this.layer&&this.layer.objectIdField){this._relatedDef&&!this._relatedDef.isFulfilled()&&
this._relatedDef.cancel();var c=this.layerInfo.getRelatedTableInfoArray();this._relatedDef=c;c.then(p.hitch(this,function(a){this.domNode&&this.tableCreated&&a&&0<a.length&&this.showRelatedRecordsMenuItem.set("disabled",!1)}))}this.tableCreated&&this.isSupportQueryToServer()&&!this._relatedQuery?this.filterMenuItem.set("disabled",!1):this.filterMenuItem.set("disabled",!0);this.matchingCheckBox.set("disabled",!1);this.tableCreated?this.toggleColumnsMenuItem.set("disabled",!1):this.toggleColumnsMenuItem.set("disabled",
!0);this.hideExportButton||(a&&0<a.length?this.exportCSVMenuItem.set("label",this.nls.exportSelected):this.exportCSVMenuItem.set("label",this.nls.exportAll),this.tableCreated?this.exportCSVMenuItem.set("disabled",!1):this.exportCSVMenuItem.set("disabled",!0));this.layerInfo.isShowInMap()?this.tableCreated&&a&&0<a.length?this.zoomButton.set("disabled",!1):this.zoomButton.set("disabled",!0):this.zoomButton.set("disabled",!0);this.layerInfo.isTable&&(this.matchingCheckBox.set("disabled",!0),this.zoomButton.set("disabled",
!0))}else this._relatedQuery?(this.showSelectedRecordsMenuItem.set("disabled",!1),this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords)):this.showSelectedRecordsMenuItem.set("disabled",!0),this.showRelatedRecordsMenuItem.set("disabled",!0),this.matchingCheckBox.set("disabled",!0),this.filterMenuItem.set("disabled",!0),this.toggleColumnsMenuItem.set("disabled",!0),this.hideExportButton||this.exportCSVMenuItem.set("disabled",!0),this.zoomButton.set("disabled",!0)},showSelectedRecords:function(){if(this.tableCreated){var a=
this.layer.objectIdField,c=this.getSelectedRows();0<c.length&&this.grid&&(this.grid.store instanceof F?this.grid.set("query",p.hitch(this,function(b){return"number"===typeof b&&-1<c.indexOf(b)||-1<c.indexOf(b[a])?!0:!1})):this.grid.set("query",function(){return c}))}},showAllSelectedRecords:function(){if(this.tableCreated&&this.showSelected){this.grid.set("query",{});var a=this.getSelectedRows();this._updateSelectRowsByIds(a)}},clearSelection:function(a,c){this.tableCreated&&(this.grid.clearSelection(),
this.selectionRows=[],a&&this.grid.set("query",{}),c&&(this._selectionResults=[],this.layer&&0<this.layer.getSelectedFeatures().length&&this.selectionManager.clearSelection(this.layer)),this._closePopup(),this.setSelectedNumber(),this.showSelected=!1,this.emit("clear-selection"))},refresh:function(){this.grid&&this.grid.clearSelection();this._relatedQuery||this.startQuery();this.emit("refresh",{layerInfoId:this.layerInfo.id})},exportToCSV:function(a,c){if(!this.layerInfo||!this.layer||!this.tableCreated){var b=
new B;b.reject();return b}return this.getSelectedRowsData().then(p.hitch(this,function(b){var f=this.layer.objectIdField,d=[],h=this.layer.fullExtent.spatialReference.equals(this.map.extent.spatialReference),C=this._hasArcadeExpressionFields(),e=L.getSortbyFields(this.grid,this.layer);if(h||!this.layer.url){var y=A.map(this._getTableSelectedIds(),p.hitch(this,function(a){for(var c=0,d=b.length;c<d;c++)if(b[c]&&b[c][f]===a)return b[c];return{}}))||[];0===y.length&&this.isSelectionMode()&&y.push({});
d=y;0===y.length&&this.grid.store instanceof F&&(d={},e&&e instanceof Array&&(d.sort=A.map(e,function(a){a=a.split(/\ +/);return{attribute:a[0],descending:"DESC"===a[1]}})),d=p.clone(this.grid.store.query({},d)));d.length&&this._appendXY(d)}var y={},m=this.getOutFields(!!d.length);y.datas=d;y.fromClient=!1;y.withGeometry="esriGeometryPoint"===this.layer.geometryType;y.outFields=m;y.formatNumber=!1;y.formatDate=!0;y.formatCodedValue=!0;y.popupInfo=this.layerInfo.getPopupInfo();y.objectIds=!h&&this._getExportObjectIds();
y.outSpatialReference=!h&&p.clone(this.layer.fullExtent.spatialReference);y.richTextFieldsToClear=c;C&&(y.arcadeExpressions={expressionInfos:this.layerInfo.getPopupInfo().expressionInfos,layerDefinition:O.getFeatureLayerDefinition(this.layer)});y.orderByFields=e;if(!y.objectIds||y.objectIds instanceof Array&&0===y.objectIds.length)this.matchingMap&&this.layerInfo&&!this.layerInfo.isTable&&(y.geometry=this._currentExtent),y.start=0,y.num=this.layer.maxRecordCount||1E3,y.filterExpression=this.layerInfo.getFilter&&
this.layerInfo.getFilter();return ha.exportCSVFromFeatureLayer(a||this.configedInfo.name,this.layer,y)}))},toggleColumns:function(){this.tableCreated&&this.grid._toggleColumnHiderMenu()},changeHeight:function(a){this.grid&&0<=a-this.toolbarHeight-this.footerHeight&&e.setStyle(this.grid.domNode,"height",a-this.toolbarHeight-this.footerHeight+"px")},isSupportQueryToServer:function(){var a=this.layer&&"esri.layers.CSVLayer"===this.layer.declaredClass,c=this.layer&&"esri.layers.StreamLayer"===this.layer.declaredClass;
return this.layer&&this.layer.url&&this.configedInfo.layer.url&&!a&&!c},isSupportQueryOnClient:function(){var a=this.layer&&"esri.layers.CSVLayer"===this.layer.declaredClass,c=this.layer&&"esri.layers.StreamLayer"===this.layer.declaredClass;return!(this.layer&&this.layer.url&&this.configedInfo.layer.url)||a||c},destroy:function(){this._destroyed||(this.layer=this.configedInfo=this.layerInfo=null,this._selectionHandles&&A.forEach(this._selectionHandles,function(a){a&&a.remove&&a.remove()}),this._closePopup(),
this._filterPopup&&this._filterPopup.domNode&&(this._filterPopup.close(),this._filterPopup=null),this._dblClickResult=null,this.grid&&this.grid.destroy(),this.prevRelationship=this.relationship=this.nls=this.map=null,this._currentDef&&!this._currentDef.isFulfilled()&&this._currentDef.cancel({canceledBySelf:!0}),this._relatedDef&&!this._relatedDef.isFulfilled()&&this._relatedDef.cancel({canceledBySelf:!0}),this.inherited(arguments))},_selectBySelf:function(a){a=a||[];if(a.length!==this._selectionResults.length)return!1;
var c=this.layer.objectIdField;return A.every(this._selectionResults,function(b){return a.some(function(a){return b.attributes[c]===a.attributes[c]})})},_updateSelectRowsByFeatures:function(a){var c=A.map(a,p.hitch(this,function(a){return a.attributes[this.layer.objectIdField]}));this._updateSelectRowsByIds(c);this._selectionResults=a},_updateSelectRowsByIds:function(a){this.grid&&this.tableCreated&&(this.selectionRows=a,A.forEach(a,p.hitch(this,function(a){this.grid.select(a)})),this.setSelectedNumber(),
this.changeToolbarStatus())},_removeTable:function(){this.grid&&this.grid.domNode&&(this.grid.destroy(),this.grid=null);this.footer&&(e.destroy(this.footer),this.selectedRowsLabel=this.footer=null);this.tableCreated=!1},_onMatchingCheckBoxChange:function(a){this.tableCreated&&!this._relatedQuery&&(this.cancelThread(),this.queryByStoreObjectIds=null,this.startQuery());if("fulfilled"===this._requestStatus&&this.tableCreated&&this._relatedQuery)if(a)this.queryByStoreObjectIds=A.map(this.grid.store.data,
p.hitch(this,function(a){return a[this.layer.objectIdField]})),this.startQuery(this.queryByStoreObjectIds);else{var c=this._relatedQueryIds;this._relatedQueryIds=[];this.queryRecordsByRelationship({layer:this.relatedOriginalInfo.layerObject,selectedIds:c})}a||(this._currentExtent=null)},_closePopup:function(){var a=this.map.infoWindow.getSelectedFeature(),c=a&&this._dblClickResult&&a===this._dblClickResult,a=a&&a._layer===this.layer;this.domNode&&(c||a)&&(this.map.infoWindow.hide(),this._dblClickResult=
null)},_getLayerObject:function(){function a(a){this._selectionHandles&&A.forEach(this._selectionHandles,function(a){a&&a.remove&&a.remove()});this._selectionHandles=[];this._selectionHandles.push(D(a,"selection-complete",p.hitch(this,"onSelectionComplete")));this._selectionHandles.push(D(a,"selection-clear",p.hitch(this,"onSelectionClear")))}return(this._currentDef=this.layerInfo.getLayerObject()).then(p.hitch(this,function(c){var b=new B;"esri.layers.ArcGISImageServiceLayer"===c.declaredClass||
"esri.layers.ArcGISImageServiceVectorLayer"===c.declaredClass?(c=new T(c.url),this.own(D(c,"load",p.hitch(this,function(c){p.hitch(this,a)(c.layer);b.resolve(c.layer)})))):(p.hitch(this,a)(c),b.resolve(c));return b}))},_getLayerDifinition:function(){return this._layerDefinition?N(p.clone(this._layerDefinition)):H({url:this.layer.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(p.hitch(this,function(a){this.setLayerDefinition(a);return this.getLayerDefinition()}))},_getFilterableFields:function(a,
c){return A.filter(a,function(a){return A.some(c,function(c){return a.name===c.name&&(c.show||!w.isDefined(c.show))&&p.mixin(a,c)})})},_getExportObjectIds:function(){var a=this._getTableSelectedIds()||[];if(0===a.length&&this.grid.store instanceof F){var c=this.layer.objectIdField;this.grid.store.query(function(b){a.push(b[c])})}return a},_doQuery:function(a,c){if(this.layer){var b=this.layer.objectIdField;this.isSupportQueryToServer()?this._queryToServer(a,b,c):this.isSupportQueryOnClient()&&this._queryOnClient(a,
b,c)}},_queryOnClient:function(a,c,b){var d={};d.features="esri.layers.StreamLayer"===this.layer.declaredClass?this.layer.getLatestObservations():A.filter(this.layer.graphics,p.hitch(this,function(a){return!a.wabIsTemp}));b&&0<b.length&&(d.features=A.filter(d.features,function(a){return-1<b.indexOf(a.attributes[this.layer.objectIdField])},this));var h=this.layer.fields,e=this.configedInfo.layer.fields;d.fields=e?A.filter(e,p.hitch(this,function(a){w.isDefined(a.show)||(a.show=!0);a.name!==c||"esriFieldTypeOID"!==
a.type&&"esriFieldTypeInteger"!==a.type||(a._pk=!0);for(var b=0,f=h.length;b<f;b++)h[b].name!==a.name||a.type||(a.type=h[b].type);return a.show||a._pk})):A.filter(h,p.hitch(this,function(a){w.isDefined(a.show)||(a.show=!0);a.name!==c||"esriFieldTypeOID"!==a.type&&"esriFieldTypeInteger"!==a.type||(a._pk=!0);return a.show||a._pk}));for(var e=[],C=d.features.length,y=0;y<C;y++)d&&d.features&&d.features[y]&&d.features[y].geometry&&e.push(d.features[y].geometry);a&&f.defaults.geometryService&&0<e.length?
a.spatialReference.equals(e[0].spatialReference)?(d.features=A.filter(d.features,p.hitch(this,function(c){if(c&&c.geometry)return Z.intersects(a,c.geometry)})),this.queryExecute(d.fields,d.features.length,!1,d,a)):(C=new G,C.geometries1=e,C.geometries2=[a],C.relation=G.SPATIAL_REL_INTERSECTION,(this._currentDef=f.defaults.geometryService.relation(C,p.hitch(this,function(a){return a}))).then(p.hitch(this,function(c,b){for(var f=b.length,d=[],h=0;h<f;h++)d.push(c.features[b[h].geometry1Index]);c.features=
d;this.queryExecute(c.fields,c.features.length,!1,c,a)},d),p.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);this.changeToolbarStatus();this._toggleLoading(!1)}))):this.queryExecute(d.fields,d.features.length,!1,d,a)},_queryToServer:function(a,c,b){this._getFeatureCount(a,b).then(p.hitch(this,function(f){if(this.domNode)if(b)this._queryFeatureLayer(a,c,f,!1,b);else{var d=this.layer,h=w.isDefined(d.maxRecordCount)?d.maxRecordCount:1E3;this._batchCount=Math.min(h,this._defaultBatchCount);
if(f<=h||!this.layer.objectIdField)this._queryFeatureLayer(a,c,f,!1);else{var e=this._getOutFieldsFromLayerInfos(c),C={fields:this.layer.fields};this.layer._recordCounts=f;d.advancedQueryCapabilities&&d.advancedQueryCapabilities.supportsPagination?this.queryExecute(e,f,!0,C,a):this._getFeatureIds(c,a).then(p.hitch(this,function(c){this.domNode&&(this.layer._objectIds=c,this.queryExecute(e,f,!0,C,a))}),p.hitch(this,function(a){console.error(a);this.changeToolbarStatus()}))}}}),p.hitch(this,function(a){console.error(a);
this.changeToolbarStatus()}))},_getFeatureCount:function(a,c){var b=new B,f=new Q(this.configedInfo.layer.url),d=new K;d.returnGeometry=!1;d.where=this._getLayerFilterExpression();c&&(d.where+=" AND "+this.layer.objectIdField+" IN ("+c.join()+")");a&&(d.geometry=a);(this._currentDef=f.executeForCount(d,p.hitch(this,function(a){return a}))).then(p.hitch(this,function(a){b.resolve(a)}),p.hitch(this,function(a){a&&"Request canceled"!==a.message&&(console.error(a),console.log("Could not get feature count."));
this._toggleLoading(!1);b.reject(a)}));return b},_queryFeatureLayer:function(a,c,b,f,d){var h=new Q(this.configedInfo.layer.url),e=new K;e.where=this._getLayerFilterExpression();d&&c&&(e.where+=" AND "+c+" IN ("+d.join()+")");var C=this._getOutFieldsFromLayerInfos(c),y=(d=this._hasArcadeExpressionFields())&&this._hasArcadeExpressionWithGeometry();if(0<C.length&&!d){var m=[];A.forEach(C,function(a){m.push(a.name)});e.outFields=m}else e.outFields=["*"];a&&(e.geometry=a,e.spatialRelationship=K.SPATIAL_REL_INTERSECTS);
e.outSpatialReference=p.clone(this.map.spatialReference);e.returnGeometry="esriGeometryPoint"===this.layer.geometryType||y;c&&(e.orderByFields=[c+" ASC"]);(this._currentDef=h.execute(e,p.hitch(this,function(a){return a}))).then(p.hitch(this,function(c){this.queryExecute(C,b,f,c,a)}),p.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);this.changeToolbarStatus();this._toggleLoading(!1)}))},_getFeatureIds:function(a,c){var b=new B,f=new Q(this.configedInfo.layer.url),d=new K;
d.returnGeometry=!1;d.returnIdsOnly=!0;d.where=this._getLayerFilterExpression();if(this.layer._orderByFields||a)d.orderByFields=this.layer._orderByFields||[a+" ASC"];c&&(d.geometry=c);(this._currentDef=f.executeForIds(d,p.hitch(this,function(a){return a}))).then(p.hitch(this,function(a){b.resolve(a)}),p.hitch(this,function(a){a&&"Request canceled"!==a.message&&(console.error(a),console.log("Could not get feature Ids"));b.resolve([])}));return b},queryExecute:function(a,c,b,f,d){var h=[],h=null,C=
{};if(this.domNode){f.fields=this._processExecuteFields(this.layer.fields,a);b?h=L.generateCacheStore(this.layer,c,this._batchCount,this._getLayerFilterExpression(),d):(h=A.map(f.features,p.hitch(this,function(a){var c=p.clone(a.attributes);return p.mixin(c,{geometry:a.geometry})})),h=L.generateMemoryStore(h,this.layer.objectIdField));a=this.layer.typeIdField;var C=this.layer.types,m=p.getObject("advancedQueryCapabilities.supportsOrderBy",!1,this.layer),y=p.getObject("advancedQueryCapabilities.supportsPagination",
!1,this.layer),w=p.getObject("advancedQueryCapabilities.supportsStatistics",!1,this.layer),C=L.generateColumnsFromFields(this.grid&&this.grid.columns,this.layerInfo,f.fields,a,C,m&&y||!b,w,this.layer);this.layer.hasAttachments&&this.layer.objectIdField&&this.configedInfo.showAttachments&&(C.attachmentsColumn=this.formatAttachmentsColumn());b=20+100*f.fields.length<e.getMarginBox(this.domNode).w;this.createTable(C,h,c,b);this._currentExtent=d;c=this.layer.getSelectedFeatures();this.selectionRows&&
0<this.selectionRows.length?this._updateSelectRowsByIds(this.selectionRows):c&&0<c.length?this._updateSelectRowsByFeatures(c):this.grid.clearSelection();this.changeToolbarStatus();this.emit("data-loaded")}},formatAttachmentsColumn:function(){var a={label:this.nls.attachments,className:"attachments-column",hidden:!1,unhidable:!0,field:"at-show-attachments",sortable:!1,_cache:{sortable:!1,statistics:!1}};a.renderCell=p.hitch(this,function(a,c,b){var f=a[this.layer.objectIdField];this.layer.queryAttachmentInfos(f,
p.hitch(this,function(a){var c=A.map(a,p.hitch(this,function(a){var c=a.name&&/\.(png|jpg|jpeg|gif)$/gi.test(a.name)?"image-type":"file-type",b=ba.findCredential(this.layer.url);return'\x3cli class\x3d"'+c+'"\x3e\x3ca class\x3d"jimu-ellipsis" target\x3d"_blank" href\x3d"'+(this.layer.url+"/"+f+"/attachments/"+a.id+(b?"?token\x3d"+b.token:""))+'"\x3e'+a.name+"\x3c/a\x3e\x3c/li\x3e"})),d="";0<a.length&&(d=" "+this.nls.files);d='\x3cdiv class\x3d"attachment-infos"\x3e\x3cdiv class\x3d"show-attachments-div"\x3e\x3cspan class\x3d"show-attachments"\x3e'+
a.length+d+'\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"attachment-popup"\x3e\x3cdiv class\x3d"attachment-popup-header"\x3e\x3cspan\x3e'+c.length+"\x26nbsp;"+this.nls.files+'\x3c/span\x3e\x3cspan class\x3d"close jimu-float-trailing"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul class\x3d"attachment-popup-content"\x3e'+c.join("")+"\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e";d=e.toDom(d);0<a.length&&(a=R(".show-attachments-div",d)[0],e.addClass(a,"has-attachments"));b.appendChild(d);this.own(D(b,"click",p.hitch(this,
function(a){a=a&&a.target;if(e.hasClass(a,"show-attachments-div")||e.hasClass(a,"show-attachments")||e.hasClass(a,"close")){a=this._visibleAttachmentPopup;var f=R(".attachment-popup",b)[0];f&&0<c.length&&e.toggleClass(f,"show");e.hasClass(f,"show")?this._visibleAttachmentPopup=f:this._visibleAttachmentPopup=null;a&&a!==f&&e.toggleClass(a,"show")}})))}),p.hitch(this,function(a){console.error(a)}))});return a},createTable:function(a,c,b,f){if(this.grid)this.grid.set("store",c),this.grid.set("columns",
a),this.grid.refresh();else{var d={},h=new U;e.setStyle(h.domNode,"max-width","100vw");d.columns=a;d.store=c;d.keepScrollPosition=!0;d.farOffRemoval=this.GRID_FAR_OFF_REMOVAL.DEFAULT;V("chrome")||(d.pagingDelay=1E3);d.allowTextSelection=this.allowTextSelection;d.deselectOnRefresh=!1;d.loadingMessage=h.domNode&&h.domNode.outerHTML;this.layer.objectIdField||(d.minRowsPerPage=this.layer.maxRecordCount||1E3,d.maxRowsPerPage=this.layer.maxRecordCount||1E3,d.selectionMode="none");this.grid=new (n([k,g,
t,z,u,v]))(d,e.create("div"));e.place(this.grid.domNode,this.domNode);this.grid.startup();this.tipNode&&e.destroy(this.tipNode);this.own(D(this.ownerDocument,"keydown",p.hitch(this,function(a){this.allowTextSelection&&this.grid&&this.grid.allowTextSelection&&a.shiftKey&&this.grid._setAllowTextSelection(!1)})));this.own(D(this.ownerDocument,"keyup",p.hitch(this,function(){this.allowTextSelection&&this.grid&&!this.grid.allowTextSelection&&this.grid._setAllowTextSelection(!0)})));this.own(D(this.ownerDocument,
"keydown",p.hitch(this,function(a){this.tableCreated&&(a.keyCode===I.SHIFT||(V("mac")?a.keyCode===I.META:a.keyCode===I.CTRL)&&this.isSelectionMode())&&(this._setFarOffRemoval(this.GRID_FAR_OFF_REMOVAL.INFINITY),D.once(this.ownerDocument,"keyup",p.hitch(this,function(a){!this.tableCreated||a.keyCode!==I.SHIFT&&(V("mac")?a.keyCode!==I.META:a.keyCode!==I.CTRL)||(this.isSelectionMode()?this._setFarOffRemoval(this.GRID_FAR_OFF_REMOVAL.RESELECTION):this._setFarOffRemoval(this.GRID_FAR_OFF_REMOVAL.DEFAULT))})))})));
this.layer.objectIdField&&(this.own(D(this.grid,".dgrid-header .dgrid-cell:click",p.hitch(this,this._onHeaderClick))),this.own(D(this.grid,"dgrid-columnstatechange",p.hitch(this,this._onColumnStateChange))),this.own(D(this.grid,".selection-handle-column:click",p.hitch(this,this._onSelectionHandleClick)),D(this.grid,".selection-handle-column:keydown",p.hitch(this,function(a){a.keyCode!==I.ENTER&&a.keyCode!==I.SPACE||this._onSelectionHandleClick()}))),this.own(D(this.grid,".dgrid-row:dblclick",p.hitch(this,
this._onDblclickRow)),D(this.grid,"dgrid-sort",p.hitch(this,function(a){this.emit("sort",a)})),D(this.grid,"dgrid-refresh-complete",p.hitch(this,function(a){this.parent&&W.publish(this.parent.id+"_table_created",{grid:a.grid,context:this})}))),a=this.map.getLayer(this.layer.id),this.syncSelection&&a&&this.own(D(a,"click",p.hitch(this,this._onFeaturelayerClick))))}this.grid.get("sort")[0]||(this.configedInfo&&this.configedInfo.sortField?this.grid.set("sort",this.configedInfo.sortField,this.configedInfo.isDescending):
this.layer.objectIdField&&this.grid.set("sort",this.layer.objectIdField,!1));this.getParent()&&(a=R(".dgrid-scroller",this.grid.domNode)[0],d=R(".dgrid-header",this.grid.domNode)[0],c=e.getComputedStyle(a),d=e.getMarginBox(d),c=parseInt(c.marginTop,10),isFinite(c)&&d&&c<d.h&&e.setStyle(a,"marginTop",d.h+"px"));f?e.addClass(this.domNode,"auto-width"):e.removeClass(this.domNode,"auto-width");this.footer?e.empty(this.footer):this.footer=e.create("div",{id:this.parent.id+"_"+this.id+"_footer","class":this.parent.baseClass+
"-feature-table-footer",tabindex:"-1"},this.domNode);b=e.create("div",{"class":"dgrid-status self-footer",innerHTML:b+"\x26nbsp;"+(this.layerInfo.isTable?this.nls.records:this.nls.features)+"\x26nbsp;"},this.footer);this.selectedRowsLabel=e.create("div",{"class":"dgrid-status self-footer",id:this.id+"_Selected_Rows_Label",innerHTML:"0\x26nbsp;"+this.nls.selected+"\x26nbsp;",style:{display:this.layer.objectIdField?"":"none"}},b,"after");b=e.getStyle(this.domNode,"height");this.changeHeight(b);this._requestStatus=
"fulfilled";this.tableCreated=!0;e.place(this.loading.domNode,this.grid.domNode);this._toggleLoading(!1)},getSelectedRowsData:function(){var a=new B,c=this._getTableSelectedIds()||[];if(!this.grid||!c.length)return a.resolve(null),a;this.grid.store instanceof F?(c=p.clone(this.grid.store.data),a.resolve(c)):this.grid.store.query(c,{_export_count:c.length}).then(p.hitch(this,function(c){c=c&&p.clone(this.grid.store._entityData||this.grid.store.data);a.resolve(c)}));return a},_appendXY:function(a){a&&
"esriGeometryPoint"===this.layer.geometryType&&A.forEach(a,function(a){var c=a.geometry;c&&"point"===c.type&&("x"in a?a._x=c.x:a.x=c.x,"y"in a?a._y=c.y:a.y=c.y);delete a.geometry})},getOutFields:function(a){var c=null,c=this._getOutFieldsFromLayerInfos(this.layer.objectIdField),c=this._processExecuteFields(this.layer.fields,c),c=this._getVisibleFields(c),c=p.clone(c);a&&(a="",a=-1!==c.indexOf("x")?"_x":"x",c.push({name:a,alias:a,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"}),
a=-1!==c.indexOf("y")?"_y":"y",c.push({name:a,alias:a,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"}));return c},setSelectedNumber:function(){if(this.selectedRowsLabel&&this.grid){var a=this.getSelectedRows(),c=0;if(this.grid.store instanceof F){var b=A.map(this.grid.store.data,function(a){return a[this.layer.objectIdField]},this);A.forEach(a,function(a){-1<b.indexOf(a)&&c++})}else c=a.length;this.selectedRowsLabel.innerHTML="\x26nbsp;\x26nbsp;"+c+" "+this.nls.selected+"\x26nbsp;\x26nbsp;"}},
_setSelection:function(a){this._selectionResults=a=a||[];this.selectionManager.setSelection(this.layer,a)},_zoomToExtentByFeatures:function(a){return this.getExtent(a).then(p.hitch(this,function(a){if(a&&this.domNode){var c=null;if("point"===a.type){var b=this.map.getNumLevels(),f=this.map.getLevel(),c=this.map.getMaxZoom();0<b?(f===c?b=f:(b=f+4,b>c&&(b=c)),c=this.map.centerAndZoom(a,b)):c=this.map.centerAndZoom(a,1/Math.pow(2,4)*2)}else c=this.map.setExtent(a.expand(2));return c.then(function(){return a})}}))},
_showMapInfoWindowByFeatures:function(a,c){if(c&&0!==c.length&&this.domNode){var b=this.map.infoWindow,f=this.layerInfo.isPopupEnabled()&&this.layerInfo.getInfoTemplate();if(b&&b.setFeatures&&1===c.length&&f){A.forEach(c,p.hitch(this,function(a){a._layer=this.layerInfo.layerObject;a.setInfoTemplate(f)}));b.setFeatures(c);var d=null,d="point"===a.type?c[0].geometry:a.getCenter();b.show(d,{closetFirst:!0});this._dblClickResult=c[0];this.syncWithMapInfowindow(this._dblClickResult)}}},selectFeatures:function(a,
c){if(c&&0<c.length){if("rowclick"===a||"selectall"===a)this._setSelection(c);else if("zoom"===a||"row-dblclick"===a){var b=O.graphicsExtent(c),f=O.toFeatureSet(c),d=D(this.map,"zoom-end, pan-end",p.hitch(this,function(){d.remove();"row-dblclick"===a&&this.domNode&&this._showMapInfoWindowByFeatures(b,c)}));O.zoomToFeatureSet(this.map,f).then(null,function(a){a&&(console.error(a.message),d&&d.remove())})}this.setSelectedNumber()}else this._popupMessage(this.nls.dataNotAvailable)},syncWithMapInfowindow:function(a){var c=
this.map.infoWindow,b=p.isArray(a)?a:[a];D.once(c,"hide",p.hitch(this,function(){f&&f.remove&&(f.remove(),f=null)}));var f=ca.after(c,"show",p.hitch(this,function(){var a=c.getSelectedFeature(),a=a&&b[0]===a,d=-1;c.features&&(d=c.features.indexOf(b[0]));!a&&-1<d?c.select(d):this.domNode&&!a&&f&&f.remove&&(f.remove(),f=null)}))},getGraphicsFromLocalFeatureLayer:function(a){for(var c=[],b,f,d=a.length,h=this.layer.graphics.length,e=this.layer.objectIdField,m=0;m<d;m++)for(var w=0;w<h;w++)if(b=this.layer.graphics[w].attributes[e]+
"",f=a[m]+"",b===f){c.push(this.layer.graphics[w]);break}return c},getExtent:function(a){var c=new B,b,d,h=a.length;if(1===h&&a[0].geometry&&"point"===a[0].geometry.type)b=a[0].geometry;else if(1!==h||a[0].geometry)for(var e=0;e<h;e++)a[e].geometry?"point"===a[e].geometry.type?(d||(d=new Y(a[e].geometry.spatialReference)),d.addPoint(a[e].geometry),e===h-1&&(b=d.getExtent())):b=b?b.union(a[e].geometry.getExtent()):a[e].geometry.getExtent():console.error("unable to get geometry of the reocord: ",a[e]);
else return c.reject(Error("AttributeTable.getExtent:: extent was not projected.")),c;if(!b||!b.spatialReference)return c.reject(Error("AttributeTable.getExtent:: extent was not projected.")),c;a=this.map.spatialReference;b.spatialReference.equals(a)?c.resolve(b):(d=new X,d.geometries=[b],d.outSR=a,f.defaults.geometryService.project(d,p.hitch(this,function(a){this.domNode&&(a&&a.length?c.resolve(a[0]):c.reject(Error("AttributeTable.getExtent:: extent was not projected.")))}),p.hitch(this,function(a){a||
(a=Error("AttributeTable.getExtent:: extent was not projected."));c.reject(a)})));return c},_onFeaturelayerClick:function(a,c){if(this.actived){var b=p.getObject("graphic",!1,a),f=p.getObject("graphic.attributes",!1,a);f&&b&&b._layer===this.layer&&((b=this.map.infoWindow.getSelectedFeature())&&b._layer===this.layer&&!c&&this.map.infoWindow.hide(),c=f[this.layer.objectIdField],this.showSelected&&this.toggleSelectedRecords(),this._getIndexOfIdInGrid(c).then(p.hitch(this,function(c){-1!==c&&(this.grid.scrollTo({x:0,
y:this.grid.rowHeight*c}),this.map.infoWindow.features&&(c=this.map.infoWindow.features.indexOf(a.graphic),this.map.infoWindow.select(c)),D.once(this.map.infoWindow,"selection-change",p.hitch(this,function(){var c=this.map.infoWindow.getSelectedFeature(),b=p.getObject("_layer",!1,c);c!==a.graphic&&b===this.layer&&this._onFeaturelayerClick({graphic:c},!0)})),this.syncWithMapInfowindow(a.graphic))})))}},_getIndexOfIdInGrid:function(a){var c=new B,b=-1,f=p.getObject("store.objectIds",!1,this.grid),b=
null,b=this.grid.get("sort")[0];if(this._relatedQuery)return c.resolve(-1),c;if(this.grid.store instanceof F)a=this.grid.store.get(a),f=this.grid.store.data,a?b&&b.attribute&&w.isDefined(b.descending)?(f=p.clone(f),b=function(a,c){return function(b,f){return b[a]===f[a]?0:b[a]<f[a]?c?1:-1:c?-1:1}}(b.attribute,b.descending),f.sort(b),f=A.map(f,function(a){return a[this.layer.objectIdField]},this),b=f.indexOf(a[this.layer.objectIdField])):b=f.indexOf(a):b=-1,c.resolve(b);else if(f&&0<f.length)b=f.indexOf(a),
c.resolve(b);else{f=new K;f.returnGeometry=!1;f.where=this._getLayerFilterExpression()+" AND "+this.layer.objectIdField+" \x3c "+a;if(b&&(b.attribute!==this.layer.objectIdField||b.descending))return c.resolve(-1),c;this.matchingMap&&!this._relatedQuery&&this._currentExtent&&(f.geometry=this._currentExtent);(this._currentDef=this.layer.queryCount(f)).then(p.hitch(this,function(a){c.resolve(a)}),p.hitch(this,function(a){c.reject(a)}))}return c},_zoomToSelected:function(){if(this.configedInfo&&this.tableCreated){var a=
this.getSelectedRows();this._goToFeatures(a,"zoom")}},_goToFeatures:function(a,c){if(0!==a.length){var b=this.getGraphicsFromLocalFeatureLayer(a);this.isSupportQueryToServer()&&a.length!==b.length?this._queryFeaturesByIds(a,c):this.selectFeatures(c,b)}},_onDblclickRow:function(a){this.layerInfo&&this.layerInfo.isShowInMap()&&(a=[this.grid.row(a).id],this._goToFeatures(a,"row-dblclick"))},_queryFeaturesByIds:function(a,c){var b=new K;b.objectIds=a;b.returnGeometry=!0;b.outSpatialReference=p.clone(this.map.spatialReference);
b.outFields=["*"];a=this.layer;var f="esri.layers.CSVLayer"===a.declaredClass;a.url&&!f?(new Q(a.url)).execute(b,p.hitch(this,function(a){this.selectFeatures(c,a.features)}),p.hitch(this,this._errorSelectFeatures)):a.selectFeatures(b,T.SELECTION_NEW,p.hitch(this,this.selectFeatures,c),p.hitch(this,this._errorSelectFeatures))},_onHeaderClick:function(a){var c=this.grid.cell(a);this._showColumnMenu(c.column,c,a.target,{x:a.pageX,y:a.pageY})},_showColumnMenu:function(c,b,f,h){var m=p.getObject("_cache",
!1,c);if(m&&(m.sortable||m.statistics)){var w=new d({});e.addClass(w.domNode,"jimu-widget-attributetable-feature-menu");var x=this;if(m.sortable){var g=["iconSortAscending","iconSortDescending"];A.forEach([this.nls.sortAsc,this.nls.sortDes],function(b,f){b=new a({label:b,iconClass:g[f],baseClass:"menuItemClass",onClick:function(){0===f?x.grid.set("sort",c.field,!1):1===f&&x.grid.set("sort",c.field,!0)}});w.addChild(b)})}m.statistics&&(m=new a({label:this.nls.statistics,iconClass:"iconTableStatistics",
baseClass:"menuItemClass",onClick:p.hitch(this,function(){var a={layer:this.layer,filterExpression:this._getLayerFilterExpression(),fieldNames:[c.field]};this.matchingMap&&(a.geometry=this._currentExtent);if(this.showSelected){var b=this._getSelectedIds();a.filterExpression+=" AND "+this.layer.objectIdField+" IN ("+b.join()+")"}else this.queryByStoreObjectIds&&0<this.queryByStoreObjectIds.length&&(a.filterExpression+=" AND "+this.layer.objectIdField+" IN ("+this.queryByStoreObjectIds.join()+")");
this.fieldStatistics=new da;this.fieldStatistics.showContentAsPopup(a)})}),w.addChild(m));m=w.getChildren();w.startup();w._openMyself({target:f,delegatedTarget:b,iframe:null,coords:h});this.own(D(w,"Close",p.hitch(this,function(){var a=this.get("columnMenu");a&&(a.destroyRecursive(),this.set("columnMenu",null))})));this.set("columnMenu",w);1>m.length&&D.emit(w,"Close")}},_onColumnStateChange:function(a){if(a&&a.grid&&a.grid.columns){var c=0,b;for(b in a.grid.columns)a.grid.columns[b].hidden||c++;
20+100*c-1<e.getMarginBox(this.domNode).w?e.addClass(this.domNode,"auto-width"):e.removeClass(this.domNode,"auto-width")}},_onSelectionHandleClick:function(){var a=this._getSelectedIds();this.selectionRows=a;this._closePopup();this.layerInfo.isTable||(0<a.length?this._goToFeatures(a,"rowclick"):this._setSelection([]));this.setSelectedNumber();1===this.getSelectedRows().length&&this._setFarOffRemoval(this.GRID_FAR_OFF_REMOVAL.RESELECTION);this.emit("row-click",{table:this,selectedIds:a})},_onExtentChange:function(a){var c=
p.getObject("delta.x",!1,a),b=p.getObject("delta.y",!1,a);a=this._clickMap&&!a.levelChange?isFinite(c)&&isFinite(b)&&(0<Math.abs(c)||0<Math.abs(b)):!0;this._clickMap=!1;a&&this.matchingMap&&this.actived&&this.layerInfo&&!this.layerInfo.isTable&&this.startQuery(this.queryByStoreObjectIds)},_getLayerFilterExpression:function(){var a=this.layerInfo.getFilter();return a?a:"1\x3d1"},_getOutFieldsFromLayerInfos:function(a){var c=this.configedInfo.layer.fields,b=this.layerInfo.getPopupInfo(),f=b&&b.fieldInfos,
d=[];c&&A.forEach(c,p.hitch(this,function(c){if(!w.isDefined(c.show)&&(c.show=!0,f))for(var b=0,h=f.length;b<h;b++){var e=f[b];e.fieldName===c.name&&(c.show=e.visible)}c.name!==a||"esriFieldTypeOID"!==c.type&&"esriFieldTypeInteger"!==c.type&&c.type||(c._pk=!0);(c.show||c._pk)&&d.push(c)}));return d},_processExecuteFields:function(a,c){if(a&&0<a.length){var b=[];if(!c.length)return a;for(var f=0,d=c.length;f<d;f++)for(var h=0;h<a.length;h++)c[f].name!==a[h].name||c[f].type!==a[h].type&&c[f].type||
(a[h]=p.mixin(a[h],c[f]),b.push(a[h]));return b}return c},_getVisibleFields:function(a){var c=[];if(this.grid&&this.grid.columns){for(var b in this.grid.columns){var f=this.grid.columns[b];f&&f.hidden&&c.push(f.field)}return A.filter(a,function(a){if(0>c.indexOf(a.name))return a})}return a},_getSelectedIds:function(){var a=[],c=this.grid.selection,b;for(b in c)c[b]&&(isFinite(b)?a.push(parseInt(b,10)):a.push(b));return a},_getTableSelectedIds:function(){var a=[],c=this.getSelectedRows();if(this.grid)if(this.grid.store instanceof
F){var b=A.map(this.grid.store.data,function(a){return a[this.layer.objectIdField]},this);A.forEach(c,function(c){-1<b.indexOf(c)&&a.push(parseInt(c,10))})}else a=c;return a},isSelectionMode:function(){var a=this.getSelectedRows();return this.tableCreated&&a&&0<a.length&&this.layer&&this.layer.objectIdField?!0:!1},_errorSelectFeatures:function(a){console.error(a)},_popupMessage:function(a){var c=new r({message:a,buttons:[{label:this.nls.ok,onClick:p.hitch(this,function(){c.close()})}]});this._toggleLoading(!1)},
_hasArcadeExpressionFields:function(){return this.layerInfo.getPopupInfo()&&this.layerInfo.getPopupInfo().expressionInfos&&A.some(this.configedInfo.layer.fields,function(a){return L.arcade.isArcadeExpressionField(a)})},_hasArcadeExpressionWithGeometry:function(){var a=this.layerInfo.getPopupInfo()&&this.layerInfo.getPopupInfo().expressionInfos,c=L.arcade.parseArcadeExpressions(a);return c?A.some(Object.keys(c),function(a){return c[a].usesGeometry}):!1},_toggleLoading:function(a){void 0===a?this.loading.hidden?
this.loading.show():this.loading.hide():a?this.loading.show():this.loading.hide()},_setFarOffRemoval:function(a){this.tableCreated&&!isNaN(a)&&this.grid.set("farOffRemoval",a)},_handleFilterChange:function(){var a=this.layer.getSelectedFeatures(),c=this.layer.objectIdField;if(a&&0<a.length){var b=A.map(a,function(a){return a.attributes[c]}),f=new K;f.where=c+" in ("+b.join(",")+") AND "+this.layerInfo.getFilter();(new Q(this.layer.url)).executeForIds(f).then(p.hitch(this,function(b){A.forEach(a,function(a){b&&
0<=b.indexOf(a.attributes[c])?a.show():a.hide()});this.selectionManager._isLayerNeedDisplayLayer(this.layer)&&this.selectionManager._updateDisplayLayer(this.layer,a,T.SELECTION_NEW)}),p.hitch(this,function(a){console.error(a)}))}}})})},"widgets/AttributeTable/dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect dgrid/List dojo/has!touch?dgrid/util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),function(n,e,q,r,l,
k,g,t,z){function u(a,b){b=a.unselectable=b?"on":"";a=a.getElementsByTagName("*");for(var c=a.length;--c;)"INPUT"!==a[c].tagName&&"TEXTAREA"!==a[c].tagName&&(a[c].unselectable=b)}function v(c,b){var d=c.bodyNode,h=b?"text":21>l("ff")?"-moz-none":"none";a&&"msUserSelect"!==a?d.style[a]=h:l("dom-selectstart")?b||c._selectstartHandle?b&&c._selectstartHandle&&(c._selectstartHandle.remove(),delete c._selectstartHandle):c._selectstartHandle=r(d,"selectstart",function(a){var c=a.target&&a.target.tagName;
"INPUT"!==c&&"TEXTAREA"!==c&&a.preventDefault()}):(u(d,!b),b||c._unselectableHandle)?b&&c._unselectableHandle&&(c._unselectableHandle.remove(),delete c._unselectableHandle):c._unselectableHandle=k.after(c,"renderRow",function(a){u(a,!0);return a})}l.add("dom-comparedocumentposition",function(a,b,d){return!!d.compareDocumentPosition});l.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});l.add("css-user-select",function(a,b,d){a=d.style;b=["Khtml","O",
"ms","Moz","Webkit"];d=b.length;var c="userSelect";do if("undefined"!==typeof a[c])return c;while(d--&&(c=b[d]+"UserSelect"));return!1});l.add("dom-selectstart","undefined"!==typeof document.onselectstart);var d=l("mac")?"metaKey":"ctrlKey",a=l("css-user-select"),m=(g=l("pointer"))&&"MS"===g.slice(0,2),b=g?g+(m?"Down":"down"):"mousedown",E=g?g+(m?"Up":"up"):"mouseup";"WebkitUserSelect"===a&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(a=!1);return e("dgrid.Selection",null,{selectionDelegate:".dgrid-cell.dgrid-cell-padding.dgrid-column-selectionHandle.field-selectionHandle.selection-handle-column",
selectionEvents:b+","+E+",dgrid-cellfocusin",selectionTouchEvents:l("touch")?t.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&
this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!=this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(a){n.deprecated("setSelectionMode(...)",'use set("selectionMode", ...) instead',"dgrid 0.4");this.set("selectionMode",
a)},_setAllowTextSelection:function(a){"undefined"!==typeof a?v(this,a):v(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(a,d){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(d))&&("dgrid-cellfocusin"!==a.type||"mousedown"!==a.parentType)&&(a.type!==E||d==this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=a;if(!a.keyCode||!a.ctrlKey||32==a.keyCode)if(!a.shiftKey&&a.type===b&&this.isSelected(d))this._waitForMouseUp=d;else this[this._selectionHandlerName](a,
d);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,b){a=a.keyCode?a.ctrlKey:a[d];this._lastSelected===b?this.select(b,null,!a||!this.isSelected(b)):(this.clearSelection(),this.select(b),this._lastSelected=b)},_multipleSelectionHandler:function(a,b){var c=this._lastSelected,h=a.keyCode?a.ctrlKey:a[d],e;a.shiftKey||(e=h?null:!0,c=null);this.select(b,c,e);c||(this._lastSelected=b)},_extendedSelectionHandler:function(a,b){(2===a.button?this.isSelected(b):a.keyCode?a.ctrlKey:a[d])||
this.clearSelection(null,!0);this._multipleSelectionHandler(a,b)},_toggleSelectionHandler:function(a,b){this.select(b,null,null)},_initSelectionEvents:function(){var a=this,b=this.contentNode,e=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};l("touch")&&!l("pointer")&&this.selectionTouchEvents?(r(b,t.selector(e,this.selectionTouchEvents),function(c){a._handleSelect(c,this);a._ignoreMouseSelect=this}),r(b,r.selector(e,this.selectionEvents),function(c){a._ignoreMouseSelect!==
this?a._handleSelect(c,this):c.type===E&&(a._ignoreMouseSelect=null)})):r(b,r.selector(e,this.selectionEvents),function(c){a._handleSelect(c,this)});this.addKeyHandler&&this.addKeyHandler(32,function(c){a._handleSelect(c,c.target)});if(this.allowSelectAll)this.on("keydown",function(c){c[d]&&65==c.keyCode&&!/\bdgrid-input\b/.test(c.target.className)&&(c.preventDefault(),a[a.allSelected?"clearSelection":"selectAll"]())});this._setStore&&k.after(this,"_setStore",function(){a._updateDeselectionAspect()});
this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function a(a,c,d){a=c||a&&a[b.idProperty||"id"];if(null!=a&&(c=(a=b.row(a))&&b.selection[a.id]))b[d](a,null,c)}var b=this,d=this.store,e,m;this._removeDeselectSignals&&this._removeDeselectSignals();d&&d.notify?(e=k.before(d,"notify",function(c,b){c||a(c,b,"deselect")}),m=k.after(d,"notify",function(c,b){a(c,b,"select")},!0),this._removeDeselectSignals=function(){e.remove();m.remove()}):(e=k.before(this,"removeRow",function(a,c){c||
(a=this.row(a))&&a.id in this.selection&&this.deselect(a)}),this._removeDeselectSignals=function(){e.remove()})},allowSelect:function(a){return!0},_fireSelectionEvent:function(a){var c=this._selectionEventQueues[a],b=this._selectionTriggerEvent,d;d={bubbles:!0,grid:this};b&&(d.parentType=b.type);d[this._selectionTargetType]=c;this._selectionEventQueues[a]=[];r.emit(this.contentNode,"dgrid-"+a,d)},_fireSelectionEvents:function(){var a=this._selectionEventQueues,b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},
_select:function(a,b,d){var c,e,h;"undefined"===typeof d&&(d=!0);a.element||(a=this.row(a));if(!1===d||this.allowSelect(a))if(c=this.selection,e=!!c[a.id],null===d&&(d=!e),h=a.element,d||this.allSelected?c[a.id]=d:delete this.selection[a.id],h&&(d?z(h,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):z(h,"!dgrid-selected!ui-state-active")),d!==e&&h&&this._selectionEventQueues[(d?"":"de")+"select"].push(a),b)if(b.element||(b=this.row(b)),b){if(b=b.element)for(c=this._determineSelectionDirection(h,
b),c||(b=document.getElementById(b.id),c=this._determineSelectionDirection(h,b));a.element!=b&&(a=this[c](a));)this._select(a,null,d)}else this._lastSelected=h,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},_determineSelectionDirection:l("dom-comparedocumentposition")?function(a,
b){a=b.compareDocumentPosition(a);return a&1?!1:2===a?"down":"up"}:function(a,b){return 1>b.sourceIndex?!1:b.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,b,d){this._select(a,b,d);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var c in this.selection)a!==c&&this._select(c,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=
this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var a=this,b=this.inherited(arguments);q.when(b,function(c){var b=a.selection,
d,e,h;for(d=0;d<c.length;d++)e=a.row(c[d]),(h=e.id in b?b[e.id]:a.allSelected)&&a._select(e,null,h);a._fireSelectionEvents()});return b}})})},"dgrid/extensions/ColumnHider":function(){define("dojo/_base/declare dojo/has dojo/on ../util/misc put-selector/put dojo/i18n!./nls/columnHider xstyle/css!../css/extensions/ColumnHider.css".split(" "),function(n,e,q,r,l,k){var g,t,z=e("ie"),u=z&&e("quirks"),v=8>z||u?"htmlFor":"for";return n("dgrid.extensions.ColumnHider",null,{hiderMenuNode:null,hiderToggleNode:null,
i18nColumnHider:k,_hiderMenuOpened:!1,_columnHiderRules:null,_columnHiderCheckboxes:null,_renderHiderMenuEntries:function(){var d=this.subRows,a=!0,e,b,g,c;delete this._columnHiderFirstCheckbox;g=0;for(e=d.length;g<e;g++)for(c=0,b=d[g].length;c<b;c++)this._renderHiderMenuEntry(d[g][c]),a&&(a=!1,this._columnHiderFirstCheckbox=this._columnHiderCheckboxes[d[g][c].id])},_renderHiderMenuEntry:function(d){var a=d.id,e=r.escapeCssIdentifier(a,"-"),b,g;d.hidden&&(d.hidden=!1,this._hideColumn(a),d.hidden=
!0);d.unhidable||(b=l("div.dgrid-hider-menu-row"),g=this.domNode.id+"-hider-menu-check-"+e,a=this._columnHiderCheckboxes[a]=l(b,"input.dgrid-hider-menu-check.hider-menu-check-"+e+"[type\x3dcheckbox]"),a.id=g,l(b,"label.dgrid-hider-menu-label.hider-menu-label-"+e+"["+v+"\x3d"+g+"]",d.label||d.field||""),l(this.hiderMenuNode,b),d.hidden||(a.checked=!0))},renderHeader:function(){function d(a){a.stopPropagation()}var a=this,e=this.hiderMenuNode,b=this.hiderToggleNode,k;this.inherited(arguments);if(e){for(k in this._columnHiderRules)this._columnHiderRules[k].remove();
e.innerHTML=""}else b=this.hiderToggleNode=l(this.domNode,"button.ui-icon.dgrid-hider-toggle[type\x3dbutton][aria-label\x3d"+this.i18nColumnHider.popupTriggerLabel+"]"),this._listeners.push(q(b,"click",function(c){a._toggleColumnHiderMenu(c)})),e=this.hiderMenuNode=l("div.dgrid-hider-menu[role\x3ddialog][aria-label\x3d"+this.i18nColumnHider.popupLabel+"]"),e.id=this.id+"-hider-menu",this._listeners.push(q(e,"keyup",function(c){27===(c.charCode||c.keyCode)&&(a._toggleColumnHiderMenu(c),b.focus())})),
e.style.display="none",l(this.domNode,e),this._listeners.push(q(e,".dgrid-hider-menu-check:"+(9>z||u?"click":"change"),function(c){a._updateColumnHiddenState(c.target.id.substr(a.id.length+18),!c.target.checked)})),this._listeners.push(q(e,"mousedown",d),q(b,"mousedown",d)),t||(t=q.pausable(document,"mousedown",function(a){g&&g._toggleColumnHiderMenu(a)}),t.pause());this._columnHiderCheckboxes={};this._columnHiderRules={};this._renderHiderMenuEntries()},destroy:function(){this.inherited(arguments);
for(var d in this._columnHiderRules)this._columnHiderRules[d].remove()},left:function(d,a){return this.right(d,-a)},right:function(d,a){d.element||(d=this.cell(d));for(var e=this.inherited(arguments),b=d;e.column.hidden;){e=this.inherited(arguments,[e,0<a?1:-1]);if(b.element===e.element)return d;b=e}return e},isColumnHidden:function(d){return!!this._columnHiderRules[d]},_toggleColumnHiderMenu:function(){var d=this._hiderMenuOpened,a=this.hiderMenuNode,e=this.domNode,b;a.style.display=d?"none":"";
d?a.style.height="":(a.offsetHeight>e.offsetHeight-12&&(a.style.height=e.offsetHeight-12+"px"),(b=this._columnHiderFirstCheckbox)&&b.focus());t[d?"pause":"resume"]();g=d?null:this;this._hiderMenuOpened=!d},_hideColumn:function(d){var a=this,g="#"+r.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-",b;this._columnHiderRules[d]||(this._columnHiderRules[d]=r.addCssRule(g+r.escapeCssIdentifier(d,"-"),"display: none;"),8!==e("ie")&&10!==e("ie")||e("quirks")||(b=r.addCssRule(".dgrid-row-table","display: inline-table;"),
window.setTimeout(function(){b.remove();a.resize()},0)))},_showColumn:function(d){this._columnHiderRules[d]&&(this._columnHiderRules[d].remove(),delete this._columnHiderRules[d])},_updateColumnHiddenState:function(d,a){this[a?"_hideColumn":"_showColumn"](d);this.columns[d].hidden=a;q.emit(this.domNode,"dgrid-columnstatechange",{grid:this,column:this.columns[d],hidden:a,bubbles:!0});this.resize()},toggleColumnHiddenState:function(d,a){"undefined"===typeof a&&(a=!this._columnHiderRules[d]);this._updateColumnHiddenState(d,
a);this._columnHiderCheckboxes[d].checked=!a}})})},"dgrid/extensions/ColumnResizer":function(){define("dojo/_base/declare dojo/on dojo/query dojo/_base/lang dojo/dom dojo/dom-geometry dojo/has ../util/misc put-selector/put dojo/_base/html xstyle/css!../css/extensions/ColumnResizer.css".split(" "),function(n,e,q,r,l,k,g,t,z){function u(a){for(var b=a.length,c=b,d=a[0].length,e=Array(b);b--;)e[b]=Array(d);for(var g={},b=0;b<c;b++)for(var m=e[b],l=a[b],k=0,t=0;k<d;k++){var f=l[t],w;if("undefined"==typeof m[k]){m[k]=
f.id;if(f.rowSpan&&1<f.rowSpan){w=e;for(var H=f.rowSpan,G=b,q=k,n=f.id,r=1;r<H;r++)w[G+r][q]=n}if(0<b&&f.colSpan&&1<f.colSpan)for(w=1;w<f.colSpan;w++)if(m[++k]=f.id,f.rowSpan&&1<f.rowSpan)for(var H=e,G=f.rowSpan,q=b,n=k,r=f.id,u=1;u<G;u++)H[q+u][n]=r;g[f.id]=a[0][k].id;t++}}return g}function v(a,d,c,h,g){if(!(0>=c)){var b=a.columns[d],m;if(b&&(m={grid:a,columnId:d,width:c,bubbles:!0,cancelable:!0},h&&(m.parentType=h),!a._resizedColumns||e.emit(a.headerNode,"dgrid-columnresize",m)))return"auto"===
c?delete b.width:(b.width=c,c+="px"),(h=a._columnSizes[d])?h.set("width",c):h=t.addCssRule("#"+t.escapeCssIdentifier(a.domNode.id)+" .dgrid-column-"+t.escapeCssIdentifier(d,"-"),"width: "+c+";"),a._columnSizes[d]=h,!1!==g&&a.resize(),!0}}var d,a=0,m={create:function(){d=z("div.dgrid-column-resizer")},destroy:function(){z(d,"!");d=null},show:function(a){a=k.position(a.domNode,!0);d.style.top=a.y+"px";d.style.height=a.h+"px";z(document.body,d)},move:function(a){d.style.left=a+"px"},hide:function(){d.parentNode.removeChild(d)}};
return n("dgrid.extensions.ColumnResizer",null,{resizeNode:null,minWidth:40,adjustLastColumn:!0,_resizedColumns:!1,buildRendering:function(){this.inherited(arguments);a++||m.create()},destroy:function(){this.inherited(arguments);for(var b in this._columnSizes)this._columnSizes[b].remove();--a||m.destroy()},resizeColumnWidth:function(a,d){return v(this,a,d)},configStructure:function(){var a=this._oldColumnSizes=r.mixin({},this._columnSizes),d;this._resizedColumns=!1;this._columnSizes={};this.inherited(arguments);
for(d in a)d in this._columnSizes||a[d].remove();delete this._oldColumnSizes},_configColumn:function(a){this.inherited(arguments);var b=a.id,c;"width"in a&&((c=this._oldColumnSizes[b])?c.set("width",a.width+"px"):c=t.addCssRule("#"+t.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+t.escapeCssIdentifier(b,"-"),"width: "+a.width+"px;"),this._columnSizes[b]=c)},renderHeader:function(){this.inherited(arguments);var a=this,d;if(this.columnSets&&this.columnSets.length)for(var c=this.columnSets.length;c--;)d=
r.mixin(d||{},u(this.columnSets[c]));else this.subRows&&1<this.subRows.length&&(d=u(this.subRows));for(var c=q(".dgrid-cell",a.headerNode),h=c.length;h--;){var m=c[h],l=m.columnId,k=a.columns[l],n=m.childNodes;if(k&&!1!==k.resizable){k=z("div.dgrid-resize-header-container");for(m.contents=k;0<n.length;)z(k,n[0]);z(m,k,"div.dgrid-resize-handle.resizeNode-"+t.escapeCssIdentifier(l,"-")).columnId=d&&d[l]||l}}a.mouseMoveListen||(e(a.headerNode,".dgrid-resize-handle:mousedown"+(g("touch")?",.dgrid-resize-handle:touchstart":
""),function(c){a._resizeMouseDown(c,this);a.mouseMoveListen.resume();a.mouseUpListen.resume()}),a._listeners.push(a.mouseMoveListen=e.pausable(document,"mousemove"+(g("touch")?",touchmove":""),t.throttleDelayed(function(c){a._updateResizerPosition(c)}))),a._listeners.push(a.mouseUpListen=e.pausable(document,"mouseup"+(g("touch")?",touchend":""),function(c){a._resizeMouseUp(c);a.mouseMoveListen.pause();a.mouseUpListen.pause()})),a.mouseMoveListen.pause(),a.mouseUpListen.pause())},_resizeMouseDown:function(a,
d){a.preventDefault();l.setSelectable(this.domNode,!1);this._startX=this._getResizeMouseLocation(a);this._targetCell=q(".dgrid-column-"+t.escapeCssIdentifier(d.columnId,"-"),this.headerNode)[0];this._updateResizerPosition(a);m.show(this)},_resizeMouseUp:function(a){var b=this._columnSizes,c,d,e;this.adjustLastColumn&&(e=this.headerNode.clientWidth-1);this._resizedColumns||(c=q(".dgrid-cell",this.headerNode),this.columnSets&&this.columnSets.length?c=c.filter(function(a){return"0"==a.columnId.split("-")[0]&&
!(a.columnId in b)}):this.subRows&&1<this.subRows.length&&(c=c.filter(function(a){return"0"==a.columnId.charAt(0)&&!(a.columnId in b)})),d=c.map(function(a){return a.offsetWidth}),c.forEach(function(a,c){v(this,a.columnId,d[c],null,!1)},this),this._resizedColumns=!0);l.setSelectable(this.domNode,!0);c=this._targetCell;var g=this._getResizeMouseLocation(a)-this._startX,k=c.offsetWidth+g,n=this._getResizedColumnWidths(),r=n.totalWidth,n=n.lastColId,u=q(".dgrid-column-"+t.escapeCssIdentifier(n,"-"),
this.headerNode)[0].offsetWidth;k<this.minWidth&&(k=this.minWidth);v(this,c.columnId,k,a.type)&&c.columnId!=n&&this.adjustLastColumn&&(r+g<e?v(this,n,"auto",a.type):u-g<=this.minWidth&&v(this,n,this.minWidth,a.type));m.hide();delete this._startX;delete this._targetCell},_updateResizerPosition:function(a){if(this._targetCell){a=this._getResizeMouseLocation(a);var b=this._targetCell.offsetWidth,c=a;b+(a-this._startX)<this.minWidth&&(c=this._startX-(b-this.minWidth));m.move(c)}},_getResizeMouseLocation:function(a){var b=
0;a.pageX?b=a.pageX:a.clientX&&(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft);return b},_getResizedColumnWidths:function(){var a=0,d=q((this.columnSets?".dgrid-column-set-cell ":"")+"tr:first-child .dgrid-cell",this.headerNode),c=d.length;if(!c)return{};for(var e=d[c-1].columnId;c--;)a+=d[c].offsetWidth;return{totalWidth:a,lastColId:e}}})})},"dgrid/extensions/ColumnReorder":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/on dojo/query dojo/dnd/Source put-selector/put xstyle/css!../css/extensions/ColumnReorder.css".split(" "),
function(n,e,q,r,l,k,g){function t(d,a){var e=a[2];d=d[e?"columnSets":"subRows"][a[1]];return e?d[a[2]]:d}function z(d,a,e){a[2]?d.columnSets[a[1]][a[2]]=e:d.subRows[a[1]]=e}function u(d,a){return a.slice(("dgrid-"+d+"-").length)}var v=/(\d+)(?:-(\d+))?$/;n=e(k,{copyState:function(){return!1},checkAcceptance:function(d,a){return d==this},_legalMouseDown:function(d){return-1<d.target.className.indexOf("dgrid-resize-handle")?!1:this.inherited(arguments)},onDropInternal:function(d){var a=this.grid,e=
v.exec(u(a.id,d[0].getAttribute("dndType"))),b=e[2]?"columnSets":"subRows",g=t(a,e),c=a.columns;this.inherited(arguments);e&&setTimeout(function(){var h=q.map(d[0].parentNode.childNodes,function(a){return c[a.columnId]});z(a,e,h);h={grid:a,subRow:h,column:c[d[0].columnId],bubbles:!0,cancelable:!0,parentType:"dnd"};h[b]=a[b];r.emit(a.domNode,"dgrid-columnreorder",h)?a.set(b,a[b]):(z(a,e,g),a.renderHeader(),this._sort&&this._sort.length&&this.updateSortArrow(this._sort))},0)}});e=e("dgrid.extensions.ColumnReorder",
null,{columnDndConstructor:n,_initSubRowDnd:function(d,a){var e,b,k,c;b=0;for(k=d.length;b<k;b++)c=d[b],!1!==c.reorderable&&(c=c.headerNode,"TH"!=c.tagName&&(c=c.parentNode),g(c,".dojoDndItem[dndType\x3d"+a+"]"),e||(e=c.parentNode));e&&this._columnDndSources.push(new this.columnDndConstructor(e,{horizontal:!0,grid:this}))},renderHeader:function(){var d="dgrid-"+this.id+"-",a,e;this.inherited(arguments);this._columnDndSources=[];if(this.columnSets)for(e=0,a=this.columnSets.length;e<a;e++)q.forEach(this.columnSets[e],
function(a,g){this._initSubRowDnd(a,d+e+"-"+g)},this);else q.forEach(this.subRows,function(a,e){this._initSubRowDnd(a,d+e)},this)},_destroyColumns:function(){this._columnDndSources&&q.forEach(this._columnDndSources,function(d){d.destroy()});this.inherited(arguments)}});e.ColumnDndSource=n;return e})},"dgrid/Keyboard":function(){define("dojo/_base/declare dojo/aspect dojo/on dojo/_base/lang dojo/has put-selector/put ./util/misc dojo/_base/Deferred dojo/_base/sniff".split(" "),function(n,e,q,r,l,k,
g,t){function z(a){a.preventDefault()}var u={checkbox:1,radio:1,button:1},v=/\bdgrid-cell\b/,d=/\bdgrid-row\b/,a=n("dgrid.Keyboard",null,{pageSkip:10,tabIndex:0,keyMap:null,headerKeyMap:null,postMixInProperties:function(){this.inherited(arguments);this.keyMap||(this.keyMap=r.mixin({},a.defaultKeyMap));this.headerKeyMap||(this.headerKeyMap=r.mixin({},a.defaultHeaderKeyMap))},postCreate:function(){function a(a){var c=a.target;return c.type&&(!u[c.type]||32==a.keyCode)}function c(c){function f(){b._focusedHeaderNode&&
(b._focusedHeaderNode.tabIndex=-1);if(b.showHeader){if(h)for(var a=0,c,d=b.headerNode.getElementsByTagName("th");c=d[a];++a){if(w.test(c.className)){b._focusedHeaderNode=k=c;break}}else b._focusedHeaderNode=k=b.headerNode;k&&(k.tabIndex=b.tabIndex)}}var h=b.cellNavigation,w=h?v:d,m=c===b.headerNode,k=c;m?(f(),e.after(b,"renderHeader",f,!0)):e.after(b,"renderArray",function(a){return t.when(a,function(a){var d=b._focusedNode||k;if(w.test(d.className)&&g.contains(c,d))return a;for(var f=0,e=c.getElementsByTagName("*"),
h;h=e[f];++f)if(w.test(h.className)){d=b._focusedNode=h;break}d.tabIndex=b.tabIndex;return a})});b._listeners.push(q(c,"mousedown",function(c){a(c)||b._focusOnNode(c.target,m,c)}));b._listeners.push(q(c,"keydown",function(c){if(!c.metaKey&&!c.altKey){var d=b[m?"headerKeyMap":"keyMap"][c.keyCode];d&&!a(c)&&d.call(b,c)}}))}this.inherited(arguments);var b=this;this.tabableHeader&&(c(this.headerNode),q(this.headerNode,"dgrid-cellfocusin",function(){b.scrollTo({x:this.scrollLeft})}));c(this.contentNode);
this._debouncedEnsureRowScroll=g.debounce(this._ensureRowScroll,this)},removeRow:function(a){if(!this._focusedNode)return this.inherited(arguments);var c=this,b=document.activeElement===this._focusedNode,d=this[this.cellNavigation?"cell":"row"](this._focusedNode),f=d.row||d,e;a=a.element||a;a===f.element&&((e=this.down(f,!0))&&e.element!==a||(e=this.up(f,!0)),this._removedFocus={active:b,rowId:f.id,columnId:d.column&&d.column.id,siblingId:e&&e.element!==a?e.id:void 0},setTimeout(function(){c._removedFocus&&
c._restoreFocus(f.id)},0),this._focusedNode=null);this.inherited(arguments)},insertRow:function(a){var c=this.inherited(arguments);this._removedFocus&&!this._removedFocus.wait&&this._restoreFocus(c);return c},_restoreFocus:function(a){var c=this._removedFocus,b;if((a=(a=a&&this.row(a))&&a.element&&a.id===c.rowId?a:"undefined"!==typeof c.siblingId&&this.row(c.siblingId))&&a.element){if(!a.element.parentNode.parentNode){c.wait=!0;return}"undefined"!==typeof c.columnId&&(b=this.cell(a,c.columnId))&&
b.element&&(a=b);c.active&&0!==a.element.offsetHeight?this._focusOnNode(a,!1,null):(k(a.element,".dgrid-focus"),a.element.tabIndex=this.tabIndex,this._focusedNode=a.element)}delete this._removedFocus},addKeyHandler:function(a,c,b){return e.after(this[b?"headerKeyMap":"keyMap"],a,c,!0)},_ensureRowScroll:function(a){var c=this.getScrollPosition().y;c>a.offsetTop?this.scrollTo({y:a.offsetTop}):c+this.contentNode.offsetHeight<a.offsetTop+a.offsetHeight&&this.scrollTo({y:a.offsetTop-this.contentNode.offsetHeight+
a.offsetHeight})},_focusOnNode:function(a,c,b){var f="_focused"+(c?"Header":"")+"Node",e=this[f],h=this.cellNavigation?"cell":"row",g=this[h](a),m,w,n,x,t;if(a=g&&g.element){if(this.cellNavigation)for(m=a.getElementsByTagName("input"),t=0,n=m.length;t<n;t++)if(w=m[t],(-1!=w.tabIndex||"_dgridLastValue"in w)&&!w.disabled){8>l("ie")&&(w.style.position="relative");w.focus();8>l("ie")&&(w.style.position="");x=!0;break}null!==b&&(b=r.mixin({grid:this},b),b.type&&(b.parentType=b.type),b.bubbles||(b.bubbles=
!0));e&&(k(e,"!dgrid-focus[!tabIndex]"),8>l("ie")&&(e.style.position=""),b&&(b[h]=this[h](e),q.emit(e,"dgrid-cellfocusout",b)));e=this[f]=a;b&&(b[h]=g);f=this.cellNavigation?v:d;!x&&f.test(a.className)&&(8>l("ie")&&(a.style.position="relative"),a.tabIndex=this.tabIndex,a.focus());k(a,".dgrid-focus");b&&q.emit(e,"dgrid-cellfocusin",b);this.cellNavigation&&(this.columnSets||1<this.subRows.length)&&!c&&this._debouncedEnsureRowScroll(g.row.element)}},focusHeader:function(a){this._focusOnNode(a||this._focusedHeaderNode,
!0)},focus:function(a){(a=a||this._focusedNode)?this._focusOnNode(a,!1):this.contentNode.focus()}}),m=a.moveFocusVertical=function(a,c){var b=this.cellNavigation,d=this[b?"cell":"row"](a),d=b&&d.column.id;c=this.down(this._focusedNode,c,!0);b&&(c=this.cell(c,d));this._focusOnNode(c,!1,a);a.preventDefault()};n=a.moveFocusUp=function(a){m.call(this,a,-1)};var b=a.moveFocusDown=function(a){m.call(this,a,1)},E=a.moveFocusPageUp=function(a){m.call(this,a,-this.pageSkip)},c=a.moveFocusPageDown=function(a){m.call(this,
a,this.pageSkip)},h=a.moveFocusHorizontal=function(a,c){if(this.cellNavigation){var b=!this.row(a);this._focusOnNode(this.right(this["_focused"+(b?"Header":"")+"Node"],c),b,a);a.preventDefault()}},x=a.moveFocusLeft=function(a){h.call(this,a,-1)},B=a.moveFocusRight=function(a){h.call(this,a,1)},N=a.moveHeaderFocusEnd=function(a,c){var b;this.cellNavigation&&(b=this.headerNode.getElementsByTagName("th"),this._focusOnNode(b[c?0:b.length-1],!0,a));a.preventDefault()},P=a.moveHeaderFocusHome=function(a){N.call(this,
a,!0)},J=a.moveFocusEnd=function(a,c){var b=this,d=this.cellNavigation,f=this.contentNode,h=f.scrollTop+(c?0:f.scrollHeight),f=f[c?"firstChild":"lastChild"],g=-1<f.className.indexOf("dgrid-preload"),m=g?f[(c?"next":"previous")+"Sibling"]:f,w=m.offsetTop+(c?0:m.offsetHeight),k;if(g){for(;m&&0>m.className.indexOf("dgrid-row");)m=m[(c?"next":"previous")+"Sibling"];if(!m)return}!g||1>f.offsetHeight?(d&&(m=this.cell(m,this.cell(a).column.id)),this._focusOnNode(m,!1,a)):(l("dom-addeventlistener")||(a=r.mixin({},
a)),k=e.after(this,"renderArray",function(f){k.remove();return t.when(f,function(f){f=f[c?0:f.length-1];d&&(f=b.cell(f,b.cell(a).column.id));b._focusOnNode(f,!1,a)})}));h===w&&a.preventDefault()},F=a.moveFocusHome=function(a){J.call(this,a,!0)};a.defaultKeyMap={32:z,33:E,34:c,35:J,36:F,37:x,38:n,39:B,40:b};a.defaultHeaderKeyMap={32:z,35:N,36:P,37:x,39:B};return a})},"dijit/PopupMenuItem":function(){define("dojo/_base/declare dojo/dom-style dojo/_base/lang dojo/query ./popup ./registry ./MenuItem ./hccss".split(" "),
function(n,e,q,r,l,k,g){return n("dijit.PopupMenuItem",g,{baseClass:"dijitMenuItem dijitPopupMenuItem",_fillContent:function(){if(this.srcNodeRef){var e=r("*",this.srcNodeRef);this.inherited(arguments,[e[0]]);this.dropDownContainer=this.srcNodeRef}},_openPopup:function(e,g){var k=this.popup;l.open(q.delegate(e,{popup:this.popup,around:this.domNode}));g&&k.focus&&k.focus()},_closePopup:function(){l.close(this.popup);this.popup.parentMenu=null},startup:function(){if(!this._started){this.inherited(arguments);
if(!this.popup){var g=r("[widgetId]",this.dropDownContainer)[0];this.popup=k.byNode(g)}this.ownerDocumentBody.appendChild(this.popup.domNode);this.popup.domNode.setAttribute("aria-labelledby",this.containerNode.id);this.popup.startup();this.popup.domNode.style.display="none";this.arrowWrapper&&e.set(this.arrowWrapper,"visibility","");this.focusNode.setAttribute("aria-haspopup","true")}},destroyDescendants:function(e){this.popup&&(this.popup._destroyed||this.popup.destroyRecursive(e),delete this.popup);
this.inherited(arguments)}})})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(n,e,q,r,l,k,g,t){q("dijit-legacy-requires")&&l(0,function(){n(["dijit/ToolbarSeparator"])});return e("dijit.Toolbar",[k,t,g],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},
_onRightArrow:function(){this.focusNext()}})})},"esri/tasks/RelationParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(n,e,q,r,l,k,g){n=n(null,{declaredClass:"esri.tasks.RelationParameters",geometries1:null,geometries2:null,relation:null,relationParam:null,toJson:function(){var e=q.map(this.geometries1,function(d){return d.toJson()}),k=q.map(this.geometries2,function(d){return d.toJson()}),
l={},n=this.geometries1;n&&0<n.length&&(l.geometries1=r.toJson({geometryType:g.getJsonType(n[0]),geometries:e}),e=this.geometries1[0].spatialReference,l.sr=e.wkid?e.wkid:r.toJson(e.toJson()));(e=this.geometries2)&&0<e.length&&(l.geometries2=r.toJson({geometryType:g.getJsonType(e[0]),geometries:k}));this.relation&&(l.relation=this.relation);this.relationParam&&(l.relationParam=this.relationParam);return l}});e.mixin(n,{SPATIAL_REL_CROSS:"esriGeometryRelationCross",SPATIAL_REL_DISJOINT:"esriGeometryRelationDisjoint",
SPATIAL_REL_IN:"esriGeometryRelationIn",SPATIAL_REL_INTERIORINTERSECTION:"esriGeometryRelationInteriorIntersection",SPATIAL_REL_INTERSECTION:"esriGeometryRelationIntersection",SPATIAL_REL_COINCIDENCE:"esriGeometryRelationLineCoincidence",SPATIAL_REL_LINETOUCH:"esriGeometryRelationLineTouch",SPATIAL_REL_OVERLAP:"esriGeometryRelationOverlap",SPATIAL_REL_POINTTOUCH:"esriGeometryRelationPointTouch",SPATIAL_REL_TOUCH:"esriGeometryRelationTouch",SPATIAL_REL_WITHIN:"esriGeometryRelationWithin",SPATIAL_REL_RELATION:"esriGeometryRelationRelation"});
l("extend-esri")&&e.setObject("tasks.RelationParameters",n,k);return n})},"widgets/AttributeTable/utils":function(){define("dojo/_base/lang dojo/_base/array jimu/LayerInfos/LayerInfos dojo/Deferred dojo/promise/all exports dojo/store/Observable dojo/store/Cache dojo/store/Memory esri/lang ./table/FeatureLayerQueryStore jimu/ArcadeUtils jimu/utils esri/graphic dojo/i18n!./nls/strings".split(" "),function(n,e,q,r,l,k,g,t,z,u,v,d,a,m,b){function E(a,b){if(!a||!a.length)return b||[];if(!b||!b.length)return a;
for(var c=[],d=0,e=a.length;d<e;d++)for(var h=a[d],g=0,m=b.length;g<m;g++){var f=b[g];if(f.name===h.name){f.alias!==h.alias&&(h.alias=f.alias);c.push(h);break}}return c}k.readLayerInfosObj=function(a){return q.getInstance(a,a.itemInfo)};k.readLayerInfosFromMap=function(a,b,d){var c=new r;q.getInstance(a,a.itemInfo).then(n.hitch(this,function(a){var h=[];b?a.traversalLayerInfosOfWebmap(function(a){h.push(a)}):a.traversal(function(a){h.push(a)});if(d){var g=[],m=a.getMapNotesLayerInfoArray();e.forEach(m,
function(a){g.push(a.id);a.traversal(function(a){g.push(a.id)})});h=e.filter(h,function(a){return-1===g.indexOf(a.id)})}a=a.getTableInfoArray();h=h.concat(a);c.resolve(h)}),n.hitch(this,function(a){console.error(a);c.reject(a)}));return c.promise};k.generateColumnsFromFields=function(c,d,g,m,l,q,r,t){function f(c){var b=c.name;if(h&&u.isDefined(h.fieldInfos))for(var d=0,f=h.fieldInfos.length;d<f;d++){var e=h.fieldInfos[d];if(e.fieldName===b&&e.format)return e.format}return(c=a.getDefaultPortalFieldInfo(c))&&
c.format?c.format:null}var h=d.getPopupInfo()||d.getPopupInfoFromLayerObject&&d.getPopupInfoFromLayerObject(),x={selectionHandle:{label:"",className:"selection-handle-column",hidden:!1,unhidable:!0,field:null,sortable:!1,_cache:{sortable:!1,statistics:!1},renderCell:function(a,c,d){d.setAttribute("role","button");d.setAttribute("title",b.selectionHandleLabel)}}};e.forEach(g,n.hitch(k,function(b,h,g){h="field"+h;var w=!!b.domain,B="esriFieldTypeDate"===b.type,H=m&&b.name===m,G="esriFieldTypeDouble"===
b.type||"esriFieldTypeSingle"===b.type||"esriFieldTypeInteger"===b.type||"esriFieldTypeSmallInteger"===b.type,z="esriFieldTypeString"===b.type,v=0===b.name.indexOf("expression/"),S=b.alias||b.name,p;p=1===g.length?!1:c&&c[h]?c[h].hidden:b?!b.show&&u.isDefined(b.show):!1;x[h]={label:S,className:h,hidden:p,unhidable:1===g.length?!1:!b.show&&u.isDefined(b.show)&&b._pk,field:b.name,sortable:!1,_cache:{sortable:!!q,statistics:r&&!w&&G}};z?x[h].formatter=n.hitch(k,k.urlFormatter):B?x[h].formatter=n.hitch(k,
k.dateFormatter,f(b)):G&&(x[h].formatter=n.hitch(k,k.numberFormatter,f(b)));w?x[h].get="range"===(b.domain&&b.domain.type)?n.hitch(k,function(a,c,b){return this.getRangeDomainValue(c.name,b)},t,b):n.hitch(k,function(a,c,b){return this.getCodeValue(a,c.name,b)},t,b):H?x[h].get=n.hitch(k,function(a,c,b){return this.getTypeName(b[a.name],c)},b,l):v?(g=this.arcade.getExpressionInfosFromLayerInfo(d),w=a.getFeatureLayerDefinition(t),x[h]._cache.sortable=!1,x[h].get=n.hitch(k,function(a,c,b,d){return this.arcade.getAttributes(d,
a,b)[c.name]||""},g,b,w)):w||B||H||v||(x[h].get=n.hitch(k,function(a,c,b,d,f){var h=null;b&&d&&0<d.length&&(d=(d=e.filter(d,n.hitch(k,function(a){return a.id===f[b]})))&&d[0]||null)&&d.domains&&d.domains[c.name]&&d.domains[c.name].codedValues&&(h=this.getCodeValue(a,c.name,f));return(a=null!==h?h:f[c.name])||isFinite(a)?a:""},t,b,m,l))}));return x};k.getTypeName=function(c,b){return a.fieldFormatter.getTypeName(c,b)};k.getCodeValue=function(c,b,d){return(c=a.getDisplayValueForCodedValueOrSubtype(c,
b,d))&&c.isCodedValueOrSubtype?c.displayValue||"":""};k.getRangeDomainValue=function(a,b){return(a=b[a])?a:""};k.urlFormatter=function(c){return a.fieldFormatter.getFormattedUrl(c)};k.dateFormatter=function(c,b){return a.fieldFormatter.getFormattedDate(b,c)};k.numberFormatter=function(c,b){return a.fieldFormatter.getFormattedNumber(b,c)};k.readLayerObjectsFromMap=function(a,b,d){var c=new r,h=[];this.readLayerInfosFromMap(a,b,d).then(n.hitch(this,function(a){e.forEach(a,n.hitch(this,function(a){h.push(a.getLayerObject())}));
l(h).then(n.hitch(this,function(a){c.resolve(a)}),n.hitch(this,function(a){c.reject(a);console.error(a)}))}),n.hitch(this,function(a){c.reject(a)}));return c.promise};k.readSupportTableInfoFromLayerInfos=function(a){var c=new r,b=[];e.forEach(a,n.hitch(this,function(a){b.push(a.getSupportTableInfo())}));l(b).then(n.hitch(this,function(b){b=n.clone(b);e.forEach(b,function(c,b){c.id=a[b].id});c.resolve(b)}),function(a){c.reject(a)});return c.promise};k.readConfigLayerInfosFromMap=function(a,b,d){var c=
new r,h=[];this.readLayerInfosFromMap(a,b,d).then(n.hitch(this,function(a){var b=[];e.forEach(a,function(a){h.push(a.getSupportTableInfo())});l(h).then(n.hitch(this,function(d){e.forEach(d,n.hitch(this,function(c,d){c.isSupportedLayer&&(a[d].name=a[d].title,b.push(a[d]))}));c.resolve(b)}),n.hitch(this,function(a){c.reject(a)}))}),n.hitch(this,function(a){c.reject(a)}));return c.promise};k.getConfigInfosFromLayerInfos=function(a){return e.map(a,function(a){return k.getConfigInfoFromLayerInfo(a)})};
k.getConfigInfoFromLayerInfo=function(a){var c={};c.name=a.name||a.title;c.id=a.id;c.show=a.isShowInMap();c.layer={url:a.getUrl()};var b=a.getPopupInfo();b&&!b.description&&(c.layer.fields=e.map(b.fieldInfos,function(a){return{name:a.fieldName,alias:a.label,show:a.visible,format:a.format}}),a=n.getObject("layerObject.fields",!1,a),c.layer.fields=E(c.layer.fields,a),e.some(c.layer.fields,function(a){return a.show})||(c.layer.fields&&0<c.layer.fields.length?c.layer.fields[0].show=!0:console.warn("We do not get fields info.")));
return c};k.generateCacheStore=function(a,b,d,e,g){a=new v({layer:a,objectIds:a._objectIds||null,totalCount:b,batchCount:d,where:e||"1\x3d1",spatialFilter:g});b=new z;return new t(a,b,{})};k.generateMemoryStore=function(a,b){return new g(new z({data:a||[],idProperty:b}))};k.merge=function(a,b,d,g){for(var c=e.map(b,function(a){return a[d]}),h=0,m=a.length;h<m;h++){var k=c.indexOf(a[h][d]);-1<k&&g(a[h],b[k])}};k.syncOrderWith=function(a,b,d){function c(a,c){return e.map(a,function(a){return a[c]})}
if(!n.isArray(b)||!d)return a;for(var h=c(a,d),g=[],m=0,k=b.length;m<k;m++){var f=h.indexOf(b[m][d]);-1<f&&(g=g.concat(a.splice(f,1)),h=c(a,d))}return g.concat(a)};k.arcade={};k.arcade.getExpressionInfosFromLayer=function(a,b){a=d.readExprInfo.getArcadeProfilesByType(a,b,"infoTemplate");return 0<a.length&&a[0].expressionInfos?a[0].expressionInfos:[]};k.arcade.getExpressionInfosFromLayerInfo=function(a){return(a=a&&a.getPopupInfo())&&a.expressionInfos||[]};k.arcade.getAttributes=function(a,b,e){var c=
new m(a.geometry,null,a);return d.customExpr.getAttributesFromCustomArcadeExpr(b,c,e)||a};k.arcade.appendArcadeExpressionsToFields=function(a,b){if(a){b=k.arcade.getExpressionInfosFromLayerInfo(b);if(0<b.length){var c=/^expression\//;e.forEach(b,function(b){e.some(a,function(a){if(c.test(a.name))return a=a.name.substr(11),b.name===a})||a.push({name:"expression/"+b.name,alias:b.title,show:!0})})}return a}};k.arcade.isArcadeExpressionField=function(a){return a&&"string"===typeof a.name&&0===a.name.indexOf("expression/")};
k.arcade.parseArcadeExpressions=function(a){return d.InfoTemplate._parseArcadeExpressions(a)};k.getSortbyFields=function(a,b){a=a&&a.get("sort")||[];b=b&&b.objectIdField;0<a.length?a=e.map(a,function(a){return a.attribute+" "+(a.descending?"DESC":"ASC")}):b&&a.push(b+" ASC");return a}})},"dojo/store/Cache":function(){define(["../_base/lang","../when"],function(n,e){var q=function(q,l,k){k=k||{};return n.delegate(q,{query:function(e,n){e=q.query(e,n);e.forEach(function(e){k.isLoaded&&!k.isLoaded(e)||
l.put(e)});return e},queryEngine:q.queryEngine||l.queryEngine,get:function(g,k){return e(l.get(g),function(n){return n||e(q.get(g,k),function(e){e&&l.put(e,{id:g});return e})})},add:function(g,k){return e(q.add(g,k),function(e){l.add(e&&"object"==typeof e?e:g,k);return e})},put:function(g,k){l.remove(k&&k.id||this.getIdentity(g));return e(q.put(g,k),function(e){l.put(e&&"object"==typeof e?e:g,k);return e})},remove:function(g,k){return e(q.remove(g,k),function(e){return l.remove(g,k)})},evict:function(e){return l.remove(e)}})};
n.setObject("dojo.store.Cache",q);return q})},"widgets/AttributeTable/table/FeatureLayerQueryStore":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array esri/tasks/query esri/tasks/QueryTask ./FeatureLayerQueryResult".split(" "),function(n,e,q,r,l,k){return n(null,{queryUrl:"",idProperty:"id",data:null,_entityData:null,constructor:function(e){n.safeMixin(this,e);this.data=[];this._entityData=[];this.layer=e.layer;this.objectIds=e.objectIds;this.where=e.where;this.orderByFields=e.orderByFields;
this.totalCount=e.totalCount;this.batchCount=e.batchCount||25;this.idProperty=this.layer.objectIdField;this.spatialFilter=e.spatialFilter;this.layer&&this.layer.url&&(this.queryTask=new l(this.layer.url))},get:function(e){return this.data[e]},getIdentity:function(e){return e[this.idProperty]},query:function(g,l){var n=new r,t=l&&l.start||0,v=l._export_count||this.batchCount,d=null;"function"===typeof g?d=g(this._entityData):"[object Array]"===Object.prototype.toString.call(g)&&(d=g);this.objectIds?
(d=d?d:this.objectIds,n.objectIds=d.length>=t+this.batchCount?d.slice(t,t+v):d.slice(t)):(d&&0<d.length?n.objectIds=d.length>=t+this.batchCount?d.slice(t,t+v):d.slice(t):(n.start=t,n.num=v,n.where=this.where,n.geometry=this.spatialFilter,n.spatialRelationship=r.SPATIAL_REL_INTERSECTS),(g=l.sort)&&0<g.length&&(g=q.map(g,function(a){return a.attribute+" "+(a.descending?"DESC":"ASC")}),n.orderByFields=g));n.returnGeometry="esriGeometryPoint"===this.layer.geometryType;n.outFields=["*"];var a=this.totalCount;
g=null;g=!n.where;if(!(n.objectIds&&0<n.objectIds.length)&&g)return new k([]);g=this.queryTask?this.queryTask.execute(n):this.layer.queryFeatures(n);g.total=g.then(e.hitch(this,function(d){var b=0,g=this.layer.objectIdField;if(this.objectIds){if(!g)for(b=0;b<d.fields.length;b++)if("esriFieldTypeOID"===d.fields[b].type){g=d.fields[b].name;break}for(var c={},b=0;b<d.features.length;b++)c[d.features[b].attributes[g]]=d.features[b];d.features=q.map(n.objectIds,function(a){return c[a]})}for(b=0;b<d.features.length;b++)if(d.features[b]){var h=
d.features[b];d.features[b]=e.mixin(e.clone(h.attributes),{geometry:h.geometry});this.data[d.features[b][g]]=d.features[b];this._entityData.push(d.features[b])}d=d.features;return a}),function(){console.log("FeatureLayerQueryStore queryFeatures failed.");return 0});return new k(g)}})})},"widgets/AttributeTable/table/FeatureLayerQueryResult":function(){define("esri/main dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/DeferredList dojo/_base/array".split(" "),function(n,e,q,r){var l=function(k){function g(e){k[e]||
(k[e]=function(){var g=arguments;return r.when(k,function(k){Array.prototype.unshift.call(g,k.features||k);return l(q[e].apply(q,g))})})}if(!k)return k;k.then&&(k=e.delegate(k));k.total||(k.total=r.when(k,function(e){return n._isDefined(e.total)?e.total:e.length||0}));g("forEach");g("filter");g("map");g("some");g("every");return k};return l})},"widgets/AttributeTable/a11y/WidgetMixin":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/html dojo/on dojo/aspect dojo/keys dijit/focus dojo/topic dojo/string jimu/utils jimu/LayoutManager".split(" "),
function(n,e,q,r,l,k,g,t,z,u,v,d){return n(null,{_layoutManager:null,_focusedTab:null,focusToDisplay:!1,hasBeenActivated:!1,postCreate:function(){this.inherited(arguments);this._layoutManager=d.getInstance();this.focusToDisplay=!0;this.hasBeenActivated=this.config.initiallyExpand;this.own(l(this.domNode,"keydown",q.hitch(this,function(a){r.hasClass(a.target,this.baseClass)&&a.keyCode===g.ENTER&&(this.focusToDisplay=!1,this.hasBeenActivated=!0,this.showing||(this.widgetManager.activateWidget(this),
this._switchTable()))})));this.own(l(this.domNode,"focus",q.hitch(this,function(){v.isInNavMode()&&this.focusToDisplay&&!this.showing&&(this.widgetManager.activateWidget(this),this._switchTable())})));this.own(l(this.domNode,"blur",q.hitch(this,function(){v.isInNavMode()&&this.focusToDisplay&&this.showing&&(this.hasBeenActivated||this._switchTable());this.focusToDisplay=!0;this.showing||(this.hasBeenActivated=!1)})));this.own(z.subscribe(this.id+"_table_created",q.hitch(this,function(a){this._applyA11y2Grid(a&&
a.grid,a&&a.context)})),z.subscribe(this.id+"_toolbar_created",q.hitch(this,function(a){this._applyA11y2Toolbar(a&&a.toolbar,a&&a.context)})))},applyA11y:function(){this._isOnlyTable()&&r.removeAttr(this.domNode,"tabindex");this.switchBtn&&this.own(l(this.switchBtn,"keydown",q.hitch(this,function(a){a.keyCode===g.ENTER&&(this._switchTable(),this.focusToDisplay=this.showing,this.__focus2WidgetNode())})));this.tabContainer&&this.tabContainer.hasChildren()?this._applyA11y2TabContainer(this.tabContainer):
this.NoTableMessageDiv&&(r.setAttr(this.NoTableMessageDiv,{tabindex:"0"}),v.initFirstFocusNode(this.domNode,this.NoTableMessageDiv),v.initLastFocusNode(this.domNode,this.NoTableMessageDiv),this.own(l(this.NoTableMessageDiv,"keydown",q.hitch(this,function(a){a.keyCode===g.ESCAPE&&this.__escape2WidgetSwitch(a)}))),this._isOnlyTable()&&t.focus(this.NoTableMessageDiv))},_applyA11y2TabContainer:function(a){if(a){var d=this,b=function(b){b&&(e.forEach(a.tablist.getChildren(),function(a){!a.active&&a.closeButton&&
a.id!==b.id&&r.setAttr(a.closeNode,"tabindex",-1)}),r.setAttr(b.closeNode,"tabindex",0))},n=a.tablist.onkeydown;a.tablist.onkeydown=function(a,b){var c=null,h=!1;switch(a.keyCode){case g.LEFT_ARROW:case g.UP_ARROW:a._djpage||(c=!1);break;case g.PAGE_UP:a.ctrlKey&&(c=!1);break;case g.RIGHT_ARROW:case g.DOWN_ARROW:a._djpage||(c=!0);break;case g.PAGE_DOWN:a.ctrlKey&&(c=!0);break;case g.HOME:for(var k=this.getChildren(),m=0;m<k.length;m++){var l=k[m];if(!l.disabled){t.focus(l.focusNode);d._focusedTab=
l;break}}a.stopPropagation();a.preventDefault();break;case g.END:k=this.getChildren();for(m=k.length-1;0<=m;m--)if(l=k[m],!l.disabled){t.focus(l.focusNode);d._focusedTab=l;break}a.stopPropagation();a.preventDefault();break;case g.DELETE:case 87:this._currentChild.closable&&(a.keyCode==g.DELETE||a.ctrlKey)&&(a.stopPropagation(),a.preventDefault());break;case g.ENTER:case g.SPACE:d.tabForwardStep=0;break;case g.ESCAPE:"Close"===a.target.title?d._focusedTab&&t.focus(d._focusedTab.focusNode):d.__escape2WidgetSwitch(a);
a.stopPropagation();a.preventDefault();break;case g.TAB:if(d.isLoading()){a.stopPropagation();a.preventDefault();return}break;default:h=!0}if(null!==c){this.isLeftToRight()||this.tabPosition&&!/top|bottom/.test(this.tabPosition)||(c=!c);var k=this.getChildren(),m=e.indexOf(k,this.pane2button(d._focusedTab?d._focusedTab.page&&d._focusedTab.page.id:this._currentChild.id)),l=k[m],f;do m=(m+(c?1:k.length-1))%k.length,f=k[m];while(f.disabled&&f!==l);d._focusedTab=f;t.focus(d._focusedTab.focusNode);a.stopPropagation();
a.preventDefault()}h&&n.apply(this,arguments)};if(a.hasChildren()){e.forEach(a.getChildren(),q.hitch(this,function(a){a.controlButton.checked||r.setAttr(a.controlButton.focusNode,"aria-selected","false");a.closable&&r.setAttr(a.controlButton.closeNode,"role","button")}));var c=a.tablist.getChildren()[0];this._focusedTab=c;v.initFirstFocusNode(this.domNode,c.focusNode);c.closeNode&&b(c);!this._isOnlyTable()||"LaunchpadTheme"!==this.appConfig.theme.name&&"BillboardTheme"!==this.appConfig.theme.name||
t.focus(c.focusNode)}this.own(k.after(a,"selectChild",function(){var a=q.getObject("controlButton",!1,this.selectedChildWidget);a&&(v.initFirstFocusNode(d.domNode,a.focusNode),a.closeNode&&b(a));d._focusedTab=a}),l(a.tablist,"blur",q.hitch(this,function(){this._focusedTab=null})))}},_applyA11y2Toolbar:function(a,d){a&&(q.mixin(a,{_onLeftArrow:function(){},_onRightArrow:function(){}}),this.own(l(a,"keydown",q.hitch(this,function(b){if(b.keyCode===g.TAB){if(b.shiftKey){if(b.target.id===a._getFirstFocusableChild().id)return}else if(b.target.id===
a._getLastFocusableChild().id)return;b.shiftKey?a.focusPrev():a.focusNext();b.stopPropagation();b.preventDefault()}else b.keyCode===g.ESCAPE&&this.__escape2ActiveTab(b)}))),d&&d.toggleColumnsMenuItem&&this.own(l(d.toggleColumnsMenuItem,"click",q.hitch(this,function(a){v.isInNavMode()&&this.__applyA11y2GridHiderMenu(this._activeTable&&this._activeTable.grid)}))))},_applyA11y2Grid:function(a,d){if(a&&a.hiderToggleNode&&a.hiderMenuNode){var b=a.hiderToggleNode,e=a.hiderMenuNode;v.initLastFocusNode(this.domNode,
b);if(!a._customEvtHandlersInitialized){var c=d.id+"_ScreenReader_Node",h=r.create("div",{"class":"sr-only","aria-live":"assertive",id:c},d.footer,"after");this.own(l(d,"row-click",function(a){v.isInNavMode()&&(h.textContent=a.selectedIds.length+" "+this.nls.selected)}),l(d,"clear-selection",function(){v.isInNavMode()&&(h.textContent="")}),l(a,"keydown",q.hitch(this,function(a){v.isInNavMode()&&a.keyCode===g.ESCAPE&&(h.textContent="",this.__escape2ActiveTab(a))})),t.watch("curNode",q.hitch(this,function(b,
d,e){v.isInNavMode()&&e&&e.classList&&e.classList.contains("dgrid-column-selectionHandle")&&(b=-1,a.selection&&0===Object.keys(a.selection).length&&(b=this.__IndexOfGridRowHandle(e,a),-1<b&&(h.textContent="Row "+b+", Selection Handle.",e.setAttribute("aria-labelledby",c))))})),l(a,"dgrid-select",q.hitch(this,function(b){b=t.curNode;if(v.isInNavMode()&&b&&b.classList&&b.classList.contains("dgrid-column-selectionHandle")){var d=(a.selection&&Object.keys(a.selection)).length,e=-1;0<d&&b&&(e=this.__IndexOfGridRowHandle(b,
a),-1<e&&(h.textContent=1===d?u.substitute(this.nls.rowHeaderColumnTitle,{rowId:e}):u.substitute(this.nls.rowHeaderColumnTitleMultiple,{rowId:e,rowCount:d}),b.setAttribute("aria-labelledby",c)))}})),l(b,"keydown",q.hitch(this,function(b){if(b.keyCode===g.SPACE||b.keyCode===g.ENTER)a._toggleColumnHiderMenu(),this.__applyA11y2GridHiderMenu(a),b.stopPropagation(),b.preventDefault()})),l(e,"keydown",q.hitch(this,function(c){c.keyCode===g.ESCAPE&&(b.focus(),a._hiderMenuOpened&&a._toggleColumnHiderMenu(c),
c.stopPropagation(),c.preventDefault())})));a._customEvtHandlersInitialized=!0}this._focusedTab&&this._focusedTab.checked&&d&&r.setAttr(this._focusedTab.focusNode,"aria-labelledby",this._focusedTab.focusNode.id+" "+this.id+"_"+d.id+"_footer")}},__escape2WidgetSwitch:function(a){this.switchBtn?this.switchBtn.focus():v.isDomFocusable(this.domNode)?this.__focus2WidgetNode():this._controllerDiv&&this._controllerDiv.focus();if(this.closeable&&this._isOnlyTable()&&this.widgetManager){var d;e.some(this._layoutManager&&
this._layoutManager.layoutManager&&this._layoutManager.layoutManager.onScreenWidgetIcons,q.hitch(this,function(a){if(a&&a.widgetConfig&&a.widgetConfig.id===this.id)return d=a,!0}));d?d.domNode.focus():this.widgetManager.closeWidget(this)}a&&(a.stopPropagation(),a.preventDefault())},__focus2WidgetNode:function(){this.domNode.focus()},__escape2ActiveTab:function(a){v.focusFirstFocusNode(this.domNode);a&&(a.stopPropagation(),a.preventDefault())},__applyA11y2GridHiderMenu:function(a){if(a&&a._hiderMenuOpened&&
(a=a.hiderMenuNode,a.children&&0<a.children.length)){var d=a.children[0],b=a.children[a.children.length-1],e=d.querySelector("input");v.initFirstFocusNode(a,d.querySelector("input"));v.initLastFocusNode(a,b.querySelector("input"));e&&e.focus()}},__focusOnActiveTab:function(){setTimeout(q.hitch(this,function(){v.focusFirstFocusNode(this.domNode)}),600)},__IndexOfGridRowHandle:function(a,d){var b;d=d.domNode.querySelectorAll(".dgrid-column-selectionHandle");e.some(d,function(d,c){if(d.isEqualNode(a))return console.log(c),
b=c,!0});return b}})})},"widgets/AttributeTable/_build-generate_module":function(){define(["dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:dijit/layout/templates/TabContainer.html":'\x3cdiv class\x3d"dijitTabContainer"\x3e\r\n\t\x3cdiv class\x3d"dijitTabListWrapper" data-dojo-attach-point\x3d"tablistNode"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"tablistSpacer" class\x3d"dijitTabSpacer ${baseClass}-spacer"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dijitTabPaneWrapper ${baseClass}-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/layout/templates/_TabButton.html":'\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"titleNode,innerDiv,tabContent" class\x3d"dijitTabInner dijitTabContent"\x3e\r\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTabButtonIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3cspan data-dojo-attach-point\x3d\'containerNode,focusNode\' class\x3d\'tabLabel\'\x3e\x3c/span\x3e\r\n\t\x3cspan class\x3d"dijitInline dijitTabCloseButton dijitTabCloseIcon" data-dojo-attach-point\x3d\'closeNode\'\r\n\t\t  role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d\'closeText\' class\x3d\'dijitTabCloseText\'\x3e[x]\x3c/span\r\n\t\t\t\t\x3e\x3c/span\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/layout/templates/ScrollingTabController.html":'\x3cdiv class\x3d"dijitTabListContainer-${tabPosition}" style\x3d"visibility:hidden"\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerMenuButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_menuBtn"\r\n\t\t data-dojo-props\x3d"containerId: \'${containerId}\', iconClass: \'dijitTabStripMenuIcon\',\r\n\t\t\t\t\tdropDownPosition: [\'below-alt\', \'above-alt\']"\r\n\t\t data-dojo-attach-point\x3d"_menuBtn" showLabel\x3d"false" title\x3d""\x3e\x26#9660;\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_leftBtn"\r\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideLeftIcon\', showLabel:false, title:\'\'"\r\n\t\t data-dojo-attach-point\x3d"_leftBtn" data-dojo-attach-event\x3d"onClick: doSlideLeft"\x3e\x26#9664;\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_rightBtn"\r\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideRightIcon\', showLabel:false, title:\'\'"\r\n\t\t data-dojo-attach-point\x3d"_rightBtn" data-dojo-attach-event\x3d"onClick: doSlideRight"\x3e\x26#9654;\x3c/div\x3e\r\n\t\x3cdiv class\x3d\'dijitTabListWrapper\' data-dojo-attach-point\x3d\'tablistWrapper\'\x3e\r\n\t\t\x3cdiv role\x3d\'tablist\' data-dojo-attach-event\x3d\'onkeydown:onkeydown\'\r\n\t\t\t data-dojo-attach-point\x3d\'containerNode\' class\x3d\'nowrapTabStrip\'\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/layout/templates/_ScrollingTabControllerButton.html":'\x3cdiv data-dojo-attach-event\x3d"ondijitclick:_onClick" class\x3d"dijitTabInnerDiv dijitTabContent dijitButtonContents"  data-dojo-attach-point\x3d"focusNode" role\x3d"button"\x3e\r\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitTabStripIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3cspan data-dojo-attach-point\x3d"containerNode,titleNode" class\x3d"dijitButtonText"\x3e\x3c/span\x3e\r\n\x3c/div\x3e',
"url:widgets/AttributeTable/css/style.css":'.jimu-widget-attributetable-main .tabStripButton{height: 24px !important;}.jimu-widget-attributetable,.jimu-widget-attributetable-main{left: 0px; right: 0px; bottom: 0px; background-color: #efefef;}.jimu-widget-attributetable{height: auto;}.jimu-widget-attributetable-main{overflow: hidden; width: 100%; height: 100%;}.jimu-widget-attributetable .jimu-widget-attributetable-main .dijitToolbar {position: relative;}.jimu-widget-attributetable-move{width: 100%; height: 7px; top: 0px; background-color: rgba(0, 0, 0, 0.7);}.jimu-widget-attributetable-move:hover{cursor: n-resize;}.jimu-widget-attributetable-move:hover .jimu-widget-attributetable-thumb{background-color: #fff;}.jimu-widget-attributetable .draging{background-color: gray;}.jimu-widget-attributetable-thumb{background: #B0B0B0 none; height: 1px; width: 19px; margin: 3px auto; position: absolute; left: 0; right: 0;}.jimu-widget-attributetable-indicate-vertical{width: 2px; height: 100%; background-color: black; position: absolute; z-index: 1; opacity: 0;}.jimu-widget-attributetable-indicate-horizontal{width: 100%; height: 2px; background-color: black; position: absolute; z-index: 1; opacity: 0;}.jimu-widget-attributetable-switch{width: 63px; height: 17px; left: 0; right: 0; top: -17px; margin: auto; position: absolute; cursor: pointer; border-radius: 8px 8px 0 0; background-position: center; background-repeat: no-repeat; background-color: rgba(0,0,0,0.7); border: 2px solid rgba(255,255,255,0.8); border-bottom-style: none;}.jimu-widget-attributetable-switch.open{background-image: url(images/arrow_down.svg); border-bottom-left-radius: 0; border-bottom-right-radius: 0;}.jimu-widget-attributetable-switch.open:hover{background-image: url(images/arrow_down_hover.svg);}.jimu-widget-attributetable-switch.close{background-image: url(images/arrow_up.svg)}.jimu-widget-attributetable-switch.close:hover{background-image: url(images/arrow_up_hover.svg);}.jimu-widget-attributetable-arrowImage{width: 30px; height: 30px; left: 48%; top: -30px; position: absolute; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; background-position: center center; background-repeat: no-repeat; cursor: ns-resize; background-color: rgba(0, 0, 0, 0.8);}.dijitTabPaneWrapper .dijitTabContainerTop-container .dijitAlignCenter{height: 100%;}.jimu-widget-attributetable .dijitTabContainerTopChildWrapper,.jimu-widget-attributetable .dijitTabContainerTopChildWrapper .dijitContentPane{height: 100% !important; width: 100% !important; padding: 0;}.jimu-widget-attributetable .dijitToggleButton.dijitToggleButtonChecked .dijitButtonText{color: #518dca;}.jimu-widget-attributetable .esriAttributeTable{width: 100%; height: 100%; position: relative;}.jimu-widget-attributetable .dgrid-header .dgrid-column-selectionHandle.selection-handle-column div.dgrid-resize-header-container{display: none;}.jimu-widget-attributetable .dgrid-column-selectionHandle.selection-handle-column{width: 20px !important; background-color: #eee; padding: 0 !important; border-bottom: 1px solid #ccc !important; cursor: pointer;}.dojoDndSource.dojoDndTarget.dojoDndHorizontal.dojoDndContainer .dgrid-column-selectionHandle.selection-handle-column{pointer-events: none;}.jimu-widget-attributetable .dgrid-cell {border-right: solid 1px #ccc; width: 100px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table.auto-width .dgrid-cell{width: auto;}.jimu-widget-attributetable .dgrid-row .dgrid-cell {border:medium none; padding: 7px 3px; border-right: 1px solid #CCCCCC;}.jimu-rtl .jimu-widget-attributetable .dgrid-rtl-swap .dgrid-header-row {right: 0; left: 17px;}.has-webkit.jimu-rtl .jimu-widget-attributetable .dgrid-rtl-swap .dgrid-header-row {left: 6px;}.dj_edge.jimu-rtl .jimu-widget-attributetable .dgrid-header-row {left: 16px; right: 0;}.dj_edge.jimu-rtl .dgrid-header-scroll,.dj_edge.jimu-rtl .dgrid-hider-toggle {right: auto; left: 0;}.dj_edge.jimu-rtl .dgrid-hider-menu {left: 17px; right: auto;}.jimu-rtl .jimu-widget-attributetable .dgrid-cell {text-align: right; border-left: solid 1px #ccc;}.jimu-widget-attributetable .dgrid-header {overflow: hidden; background-color: #eee;}.jimu-widget-attributetable .dgrid-header.dgrid-scrollbar-width {min-width: 16px;}.jimu-widget-attributetable .dgrid-hider-toggle {z-index: 10000;}.jimu-widget-attributetable .dgrid-header .dgrid-cell:last-child {border-right-color: transparent;}.jimu-widget-attributetable .dgrid-header .dgrid-cell:last-child .dgrid-resize-handle {display: none;}.jimu-rtl .jimu-widget-attributetable .dgrid-header .dgrid-cell:last-child {border-left-color: transparent;}.jimu-widget-attributetable .dgrid-cell a{color: #21759B; text-decoration: none;}.jimu-widget-attributetable .dgrid-cell a:hover, a:active{text-decoration: underline;}.jimu-widget-attributetable .dgrid-row {border: medium none;}.jimu-widget-attributetable .dgrid-row:hover {background-color:#E1F0FB;}.jimu-widget-attributetable .dgrid-row-even{background-color: #FFF;}.jimu-widget-attributetable .dgrid-row-odd {background-color: #F7F8F8;}.jimu-widget-attributetable .ui-state-active {background-color: rgb(0, 255, 255) !important;}.jimu-widget-attributetable .dgrid-status {white-space: pre;}.jimu-widget-attributetable .self-footer {display: inline-block;}.jimu-rtl .dgrid-hider-menu-check{right: 2px; left: auto;}.jimu-rtl .dgrid-hider-menu-label {padding-left: 0; padding-right: 20px;}.jimu-rtl .jimu-widget-attributetable .dgrid-pagination .dgrid-status{float: right !important;}.jimu-rtl .dgrid-pagination .dgrid-navigation,.jimu-rtl .dgrid-pagination .dgrid-page-size{float: left !important;}.esriAttributeTableExportImage{background-image: url("../images/export.png"); width: 13px; height: 13px;}.esriAttributeTableZoomImage{background-image: url("../images/zoom.png"); width: 13px; height: 13px;}.esriAttributeTableSelectAllImage{background-image: url("../images/select.png"); width: 13px; height: 13px;}.esriAttributeTableFilterImage{background-image: url("../images/filter.png"); width: 13px; height: 13px;}.esriAttributeTableSelectPageImage{background-image: url("../images/page.png"); width: 13px; height: 13px;}.esriAttributeTableClearImage{background-image: url("../images/clear.png"); width: 13px; height: 13px;}.esriAttributeTableOptionsImage{background-image: url("../images/more.png"); width: 13px; height: 13px;}.esriAttributeTableRefreshImage{background-image: url("../images/refresh.png"); width: 13px; height: 13px;}.esriAttributeTableSymbolImage{background-image: url("../images/symbol.png"); width: 13px; height: 13px;}.esriAttributeTableCloseImage{background-image: url("../images/close.png"); width: 13px; height: 13px; position: absolute; right: 0; top: -13px;}.esriAttributeTableColumnsImage{background-image: url("../images/columns.png"); width: 13px; height: 13px;}.jimu-rtl .jimu-widget-attributetable .close-button {right: auto; left: 0;}.jimu-widget-attributetable .jimu-loading-indicator {z-index: 100;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table{height: 100%; position: relative;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column{overflow: visible; text-align: center;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos{text-align: center; display: inline-block; position: relative;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div{display: inline-block; color: #24B5CC; cursor: pointer; padding: 2px 10px; height: 20px; border-radius: 10px; line-height: 16px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div.has-attachments:hover,.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div.has-attachments.selected{background: #24B5CC; color: white;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup{display: none; position: absolute; background: #FFFFFF; box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.50); border-radius: 2px; width: 240px; left: -245px; top: 4px; text-align: left;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup{left: auto; right: -245px; text-align: right;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup.show{display: block;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header{background: none; padding-left: 10px; font-size: 14px; color: #000000; font-weight: bold; line-height: 36px;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header{padding-left: 0; padding-right: 10px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header:hover{background: #fff;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header .close {display: inline-block; width: 36px; height: 36px; background: url(\'../images/close.png\') center no-repeat; cursor: pointer;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content{box-sizing: border-box; width: 100%; max-height: 160px; list-style-type: none; margin: 0; padding: 0; overflow-x: hidden; overflow-y: auto; padding-left: 20px;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content{padding-left: 0; padding-right: 20px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li {vertical-align: middle; background-image: url(\'./images/file.png\'); background-repeat: no-repeat; padding-left: 30px; background-size: 20px; background-position: left;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li{padding-left: 0; padding-right: 30px; background-position: right;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li.image-type{background-image: url(\'./images/image.png\');}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li a{display: inline-block; width: 176px; height: 36px; line-height: 36px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li a:hover{cursor: pointer;}.jimu-widget-attributetable-feature-menu .menuItemClass{cursor: pointer;}.jimu-widget-attributetable-feature-menu.dijitMenu{background-color: #fff !important;}.jimu-widget-attributetable-feature-menu.dijitMenu .dijitMenuItemSelected td,.jimu-widget-attributetable-feature-menu.dijitMenu .dijitMenuItemSelected{background-color: #f1f1f1 !important; color: #000!important;}.jimu-widget-attributetable-feature-table-footer {position: absolute; bottom: 4px; background: white; width: 100%;}.widget-at-filter-popup .content-absolute{left: 0; right: 0;}.jimu-widget-attributetable-feature-table-popup p {margin-bottom: 10px;}.jimu-widget-attributetable-feature-table-popup strong {font-family: "Avenir Medium";}.jimu-widget-attributetable-feature-table-popup mark {display: inline-block; color: #596679; background: #f1f1f1; border-bottom: 1px solid #ddd; margin: 5px; padding: 5px; font-size: 12px;}.jimu-widget-attributetable-feature-table-popup pre {padding: 5px; white-space: normal; font-size: 13px; color: #595959; background-color: #f8f8f8; border: 1px solid #efefef; margin: 10px 0 15px;}.jimu-widget-attributetable-feature-table-popup .tags {margin-bottom: 10px;}.jimu-widget-attributetable-feature-table-popup .example-block {margin-top: 10px;}.jimu-widget-attributetable-feature-table-popup .input-row {margin: 20px auto; color: #596679;}.jimu-widget-attributetable-feature-table-popup .input-row \x3e * {vertical-align: top;}.jimu-widget-attributetable-feature-table-popup .input-row a {color: #485566; cursor: pointer; line-height: 16px; margin-left: 10px;}.jimu-rtl .jimu-widget-attributetable-feature-table-popup .input-row a {margin-left: auto; margin-right: 10px;}.jimu-widget-attributetable-feature-table-popup .input-row a.hint-button {font-size: 12px; color: #999;}.jimu-widget-attributetable-feature-table-popup .input-row a.hint-button:hover {color: #595959;}.jimu-widget-attributetable-feature-table-popup.is-loading \x3e *:not(.jimu-loading-indicator) {opacity: .35;}.jimu-widget-attributetable-notable {color: #999; line-height: 1.5; position: absolute; top: 50%; left: 50%; text-align: center; max-width: 400px; transform: translate(-50%, -50%);}.jimu-widget-attributetable-notable.hidden {display: none;}.closed .jimu-widget-attributetable-notable {display: none;}.sr-only {position: absolute; width: 1px; height: 1px; padding: 0; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0;}',
"*now":function(n){n(['dojo/i18n!*preload*widgets/AttributeTable/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dojo/_base/html dijit/_WidgetsInTemplateMixin jimu/BaseWidget dijit/layout/TabContainer dijit/layout/ContentPane jimu/utils jimu/dijit/Message dojo/Deferred dojo/promise/all esri/layers/FeatureLayer esri/lang dojo/_base/lang dojo/on dojo/touch dojo/topic dojo/aspect dojo/_base/array dojo/query jimu/dijit/LoadingIndicator jimu/FilterManager ./_ResourceManager ./utils ./a11y/WidgetMixin".split(" "),function(n,e,q,r,l,k,g,t,z,u,v,d,a,m,b,E,c,h,x,B,N,P,J,F){n=n([r,q,F],{name:"AttributeTable",
baseClass:"jimu-widget-attributetable",normalHeight:0,openHeight:0,arrowDivHeight:null,_relatedDef:null,_resourceManager:null,_activeLayerInfoId:null,_layerTypes:{FEATURELAYER:"FeatureLayerTable",RELATIONSHIPTABLE:"RelationshipTable"},postMixInProperties:function(){this.nls.features=this.nls.features||"features"},postCreate:function(){this.inherited(arguments);g.loadStyleLink("dgrid",apiUrl+"dgrid/css/dgrid.css");this.NoTableMessageDiv=this.AttributeTableDiv=this._loadInfoDef=null;this._delayedLayerInfos=
[];this.layerTabPages=[];this.tabContainer=null;this.moveMode=!1;this.bottomPosition=this.noGridHeight=this.previousDomHeight=this.moveY=0;this.layerTabPagesIndex=-1;this.showing=!1;this.openHeight=this.normalHeight=this._getNormalHeight();this.arrowDivHeight=0;this._dragingHandlers=[];this._activeTable=null;this._activeTableHandles=[];this.filterManager=N.getInstance();this._createUtilitiesUI();this._resourceManager=new P({widgetId:this.id,map:this.map,nls:this.nls,parent:this});this._resourceManager.setConfig(this.config);
this.own(E.subscribe("changeMapPosition",a.hitch(this,this._onMapPositionChange)));J.readLayerInfosObj(this.map).then(a.hitch(this,function(b){this.domNode&&b&&(this.own(m(b,"layerInfosIsShowInMapChanged",a.hitch(this,this.onLayerInfosIsShowInMapChanged))),this.own(b.on("layerInfosChanged",a.hitch(this,this.onLayerInfosChanged))),this.own(b.on("layerInfosFilterChanged",a.hitch(this,this.onLayerInfosFilterChanged))))}))},_createUtilitiesUI:function(){this._createSwitchUI();this._createBarUI()},_createBarUI:function(){this.arrowDiv=
e.create("div");e.addClass(this.arrowDiv,"jimu-widget-attributetable-move");e.create("div",{"class":"jimu-widget-attributetable-thumb"},this.arrowDiv);e.place(this.arrowDiv,this.domNode);if(!this.arrowDivHeight){var c=e.getMarginBox(this.arrowDiv);this.arrowDivHeight=c&&c.h?c.h:7}this.own(m(this.arrowDiv,"mousedown",a.hitch(this,this._onDragStart)));this.own(m(this.arrowDiv,b.press,a.hitch(this,this._onDragStart)))},_isOnlyTable:function(){return this.closeable||!this.isOnScreen},_createSwitchUI:function(){this._isOnlyTable()||
(this.switchBtn=e.create("div",{className:"jimu-widget-attributetable-switch",tabindex:"0",role:"button"},this.domNode),this.own(m(this.switchBtn,"click",a.hitch(this,function(){this._switchTable();this.hasBeenActivated=this.showing;this.focusToDisplay=!this.showing}))))},_processOpenBarUI:function(){this._isOnlyTable()||(e.removeClass(this.switchBtn,"close"),e.addClass(this.switchBtn,"open"),e.setAttr(this.switchBtn,"title",this.nls.closeTableTip),e.setAttr(this.switchBtn,"aria-label",this.nls.closeTableTip))},
_processCloseBarUI:function(){this._isOnlyTable()||(e.removeClass(this.switchBtn,"open"),e.addClass(this.switchBtn,"close"),e.setAttr(this.switchBtn,"title",this.nls.openTableTip),e.setAttr(this.switchBtn,"aria-label",this.nls.openTableTip))},_switchTable:function(){this.showing?this._closeTable():this._openTable()},_openTable:function(){e.removeClass(this.domNode,"closed");this._loadInfoDef?this._loadInfoDef&&this._loadInfoDef.isFulfilled()&&(this.showing=!0,this._processDelayedLayerInfos(),this._activeTable&&
this._activeTable.active()):(this._loadInfoDef=new z,this.own(this._loadInfoDef),this.loading||(this.loading=new B),this.loading.placeAt(this.domNode),this._toggleLoading(!0),this._resourceManager.updateLayerInfoResources(!0).then(a.hitch(this,function(){this.domNode&&(this._init(),this.showRefreshing(!1),this.showing=!0,this._loadInfoDef.resolve())}),a.hitch(this,function(a){console.error(a);this._loadInfoDef.reject(a)})));this._changeHeight(this.openHeight);this._processOpenBarUI();return this._loadInfoDef},
_onCloseBtnClicked:function(){this.showing&&this._isOnlyTable()?this.widgetManager.closeWidget(this):this.showing&&this._closeTable();this._activeTable&&this._activeTable.deactive()},_closeTable:function(){e.addClass(this.domNode,"closed");this._changeHeight(0);this.showRefreshing(!1);this._processCloseBarUI();this._activeTable&&this._activeTable.deactive();this.showing=!1;e.setStyle(this.arrowDiv,"display","none");e.setStyle(this.domNode,"overflow","hidden");setTimeout(a.hitch(this,function(){this.domNode&&
(e.setStyle(this.domNode,"overflow","visible"),e.setStyle(this.arrowDiv,"display","block"))}),10)},_init:function(){this.initDiv();this._changeHeight(this.openHeight);this.resize();this.own(m(window.document,"mouseup",a.hitch(this,this._onDragEnd)));this.own(m(window.document,"mousemove",a.hitch(this,this._onDraging)));this.own(m(window.document,b.move,a.hitch(this,this._onDraging)));this.own(m(window.document,b.release,a.hitch(this,this._onDragEnd)))},_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&
(h.forEach(this._delayedLayerInfos,a.hitch(this,function(a){this._resourceManager.addLayerInfo(a)})),this._delayedLayerInfos=[])},onLayerInfosIsShowInMapChanged:function(b){this._activeTable&&this._activeTable.changeToolbarStatus();this.config.syncWithLayers&&h.forEach(b,a.hitch(this,function(b){if(!b.getSubLayers().length){var c=b.isShowInMap(),d=J.getConfigInfoFromLayerInfo(b),e=this.getExistLayerTabPage(d.id);if(c)if(e)e.closable&&e.set("closable",!1);else{var f=this._resourceManager.getVisivleLayerInfoIndexById(b.id),
c=this._resourceManager.getLayerInfoById(b.id),g={layer:b,closeable:!1,isActive:!1,index:f};c?this._addLayerToTable(g):this._resourceManager.updateLayerInfoResources(!1).then(a.hitch(this,function(){f=this._resourceManager.getVisivleLayerInfoIndexById(b.id);g.index=f;this._addLayerToTable(g)}))}else e&&this.layerTabPageClose(d.id,!0)}}))},onLayerInfosChanged:function(b,c,d){d&&b&&("added"===c?d.getSupportTableInfo().then(a.hitch(this,function(a){a.isSupportedLayer&&this._resourceManager.addLayerInfo(d)})):
"removed"===c&&(b=d.id,this.getExistLayerTabPage(b)&&this.layerTabPageClose(b,!0),this._resourceManager.getLayerInfoById(b)&&this._resourceManager.removeLayerInfo(b),this._resourceManager.getConfigInfoById(b)&&this._resourceManager.removeConfigInfo(b)))},onLayerInfosFilterChanged:function(b){h.some(b,a.hitch(this,function(a){if(this._activeTable&&a.id===this._activeTable.layerInfo.id)return this._activeTable._relatedQuery||this._activeTable.startQuery(),!0}))},destroy:function(){if(!this._destroyed){var b,
c;if(this.layerTabPages&&0<this.layerTabPages.length){b=this.layerTabPages.length;for(c=0;c<b;c++){var e=this.layerTabPages[c].paneId,g=a.getObject("_resourceManager.featureTableSet."+e,!1,this);g&&(g=g.getFilterObj())&&d.isDefined(g.expr)&&this.filterManager.applyWidgetFilter(e,this.id,"");this.layerTabPages[c].destroy()}this.layerTabPages=null}this.tabContainer&&(this.tabContainer.destroy(),this.tabContainer=null);this._activeLayerInfoId=this._loadInfoDef=this.AttributeTableDiv=null;this._resourceManager&&
this._resourceManager.empty();this.inherited(arguments)}},onOpen:function(){!this.showing&&this._isOnlyTable()&&(this._openTable(),this.hasBeenActivated=!0)},onClose:function(){this.showing&&(this._closeTable(),this.hasBeenActivated=!1)},_changeHeight:function(a){e.setStyle(this.domNode,"height",a+"px");this.tabContainer&&this.tabContainer.domNode&&0<=a-this.arrowDivHeight&&e.setStyle(this.tabContainer.domNode,"height",a-this.arrowDivHeight+"px");this._activeTable&&this._activeTable.changeHeight(a-
this.noGridHeight);E.publish("changeMapPosition",{bottom:a+this.bottomPosition});this.publishData({changeMapPosition:{bottom:a+this.bottomPosition}});0!==a&&(this.openHeight=a>=this.arrowDivHeight?a:this.normalHeight)},_onMapPositionChange:function(a){isFinite(a.left)&&"number"===typeof a.left&&(window.isRTL?e.setStyle(this.domNode,"right",parseFloat(a.left)+"px"):e.setStyle(this.domNode,"left",parseFloat(a.left)+"px"));isFinite(a.right)&&"number"===typeof a.right&&(window.isRTL?e.setStyle(this.domNode,
"left",parseFloat(a.right)+"px"):e.setStyle(this.domNode,"right",parseFloat(a.right)+"px"));this.tabContainer&&this.tabContainer.resize()},setPosition:function(b){this.position=b;this._isOnlyTable()?this.bottomPosition=0:this.bottomPosition="bottom"in b?parseInt(b.bottom,10):0;this.domNode.parentNode&&this.domNode.parentNode.id===window.jimuConfig.layoutId||(e.place(this.domNode,window.jimuConfig.layoutId),this.setInitialPosition(b),this.showRefreshing(!1));e.setStyle(this.domNode,"bottom",this.bottomPosition+
"px");this._resourceManager.isEmpty()||setTimeout(a.hitch(this,function(){var a=this._getGridTopSectionHeight(),b=e.getStyle(this.domNode,"height");0<a&&(this.noGridHeight=a);0<b&&this._changeHeight(b)}),20)},_startQueryOnLayerTab:function(b,c){var d=this._resourceManager.getLayerInfoById(b),f=this.getExistLayerTabPage(b);d&&f&&(this.showRefreshing(!0),this._resourceManager.getQueryTable(b,this.config.filterByMapExtent,this.config.hideExportButton,this.config.allowTextSelection).then(a.hitch(this,
function(a){this._activeLayerInfoId===b&&a&&(f=this.getExistLayerTabPage(b),a.isSupportQuery?(a=a.table,a.getParent()!==f&&a.placeAt(f),this.setActiveTable(a,{h:this.openHeight-this.noGridHeight,featureSet:c})):(a=e.toDom("\x3cdiv\x3e"+this.nls.unsupportQueryWarning+"\x3c/div\x3e"),f.set("content",a),this._activeTable&&this._activeTable.changeToolbarStatus()),this.showRefreshing(!1))}),a.hitch(this,function(a){new t({message:a.message||a});this.showRefreshing(!1)})))},_startQueryOnRelationTab:function(b,
c,d,g){var f=this._resourceManager.getLayerInfoById(g),h=this.getExistLayerTabPage(b);f&&f.layerObject&&h&&this._resourceManager.getRelationTable(g,c,!1,this.config.hideExportButton,this.config.allowTextSelection).then(a.hitch(this,function(a){this._activeLayerInfoId===b&&a&&(h=this.getExistLayerTabPage(b),a.isSupportQuery?(a=a.table,a.getParent()!==h&&a.placeAt(h),this.setActiveTable(a,{h:this.openHeight-this.noGridHeight,layer:f.layerObject,selectedIds:d})):(a=e.toDom("\x3cdiv\x3e"+this.nls.unsupportQueryWarning+
"\x3c/div\x3e"),h.set("content",a),this._activeTable&&this._activeTable.changeToolbarStatus()),this.showRefreshing(!1))}))},tabChanged:function(){if(this.tabContainer&&this.tabContainer.selectedChildWidget){0>=this.noGridHeight&&(this.noGridHeight=this._getGridTopSectionHeight()+5);var a=this.tabContainer.selectedChildWidget.params,b=a.layerType,c=a.paneId,d=a.relKey;b===this._layerTypes.FEATURELAYER&&(this._activeLayerInfoId!==c||a.oids||a.featureSet)?(this.setActiveTable(null),delete a.oids,this._activeLayerInfoId=
c,this._startQueryOnLayerTab(c,a.featureSet)):b===this._layerTypes.RELATIONSHIPTABLE&&(this.setActiveTable(null),b=a.oids,a=a.originalInfoId,this._activeLayerInfoId=c,this._startQueryOnRelationTab(c,d,b,a))}},showRefreshing:function(a){this.loading&&this._toggleLoading(a)},_onDragStart:function(a){this.moveMode=!0;this.moveY=a.clientY;this.previousDomHeight=e.getStyle(this.domNode,"height");e.addClass(this.arrowDiv,"draging");this._dragingHandlers=this._dragingHandlers.concat([m(this.ownerDocument,
"dragstart",function(a){a.stopPropagation();a.preventDefault()}),m(this.ownerDocumentBody,"selectstart",function(a){a.stopPropagation();a.preventDefault()})])},_onDraging:function(a){this.moveMode&&125<=a.clientY&&this._changeHeight(this.moveY-a.clientY+this.previousDomHeight)},_onDragEnd:function(){this.moveMode=!1;e.removeClass(this.arrowDiv,"draging");for(var a=this._dragingHandlers.pop();a;)a.remove(),a=this._dragingHandlers.pop()},_getNormalHeight:function(){var a=document.body.clientHeight;
return window.appInfo.isRunInMobile?a/2:a/3},setInitialPosition:function(){var a=e.getStyle(this.domNode,"left"),b=e.getStyle(this.domNode,"right");a||e.setStyle(this.domNode,"left","0px");b||e.setStyle(this.domNode,"right","0px");e.setStyle(this.domNode,"top","auto");e.setStyle(this.domNode,"position","absolute");this._isOnlyTable()||(this.config&&this.config.initiallyExpand?this._openTable():this._closeTable())},_bindActiveTableEvents:function(){var a=this;a._activeTable&&(a._activeTableHandles.push(m(a._activeTable,
"show-related-records",function(b){a._showRelatedRecordsByRelationship(b.layerInfoId,b.objectIds,b.relationshipObj)})),a._activeTableHandles.push(m(a._activeTable,"show-all-records",function(b){a.getExistLayerTabPage(b.layerInfoId).params.layerType=a._layerTypes.FEATURELAYER})),a._activeTableHandles.push(m(a._activeTable,"refresh",function(b){delete a.getExistLayerTabPage(b.layerInfoId).params.featureSet})),a._activeTableHandles.push(m(a._activeTable,"apply-filter",function(b){a.filterManager.applyWidgetFilter(b.layerInfoId,
a.id,b.expr);a._activeTable.startQuery()})))},_unbindActiveTableEvents:function(){for(var a=this._activeTableHandles;0<a.length;){var b=a.pop();b&&b.remove&&b.remove()}},setActiveTable:function(b,c){this._activeTable&&(this._activeTable.cancelThread(),this._activeTable.deactive(),this._unbindActiveTableEvents(),this._activeTable=null);if(b){this._activeTable=b;this._activeTable.active();this._activeTable.changeHeight(c.h);if(!this._activeTable.tableCreated||this._activeTable.tableCreated&&this._activeTable.matchingMap||
this._activeTable.tableCreated&&!this._activeTable.matchingMap&&c.featureSet||c.layer&&c.selectedIds)if(b=a.getObject("featureSet.features.length",!1,c),c.layer&&c.selectedIds)this._activeTable.queryRecordsByRelationship(c);else if(b){var d=c.featureSet.displayFieldName;c=h.map(c.featureSet.features,function(a){return a.attributes[d]});this._activeTable.startQuery(c)}else this._activeTable.startQuery();this._bindActiveTableEvents();this._activeTable.changeToolbarStatus()}},initDiv:function(){this.AttributeTableDiv=
e.create("div",{},this.domNode);e.addClass(this.AttributeTableDiv,"jimu-widget-attributetable-main");var b=e.create("div");e.place(b,this.AttributeTableDiv);this.tabContainer=new l({style:"width: 100%;"},b);e.setStyle(this.tabContainer.domNode,"height",this.normalHeight+"px");this.tabContainer.startup();for(var b=this._resourceManager.getConfigInfos(),d=b.length,h=0;h<d;h++){var m=b[h];if(m.show){var m=a.clone(m),n={};n.paneId=m.id;n.title=m.name;n.name=m.name;n.layerType=this._layerTypes.FEATURELAYER;
n.style="height: 100%; width: 100%; overflow: visible;";m=new k(n);this.layerTabPages[h]=m;this.tabContainer.addChild(m)}}0<d?this.noGridHeight=this._getGridTopSectionHeight()+5:this._toggleNoTableMessage(!0);g.setVerticalCenter(this.tabContainer.domNode);this.tabChanged();this.own(c.after(this.tabContainer,"selectChild",a.hitch(this,this.tabChanged)));this.applyA11y&&this.applyA11y()},getLayerInfoLabel:function(a){return a.name||a.title},getLayerInfoId:function(a){return a&&a.id||""},_getGridTopSectionHeight:function(){var a=
x(".dijitTabPaneWrapper",this.domNode)[0];if(a){var b=e.position(this.domNode).y;return e.position(a).y-b}return 0},_getLayerInfoByIdFromConfigJSON:function(a){var b=h.filter(this.config.layerInfos,function(b){return b.id===a});return b&&0<b.length&&b[0]},_showRelatedRecordsByRelationship:function(a,b,c){var d=this._activeTable;d&&(d=d.layerInfo)&&d.id===a&&d.layerObject&&h.some(d.layerObject.relationships,function(a){return g.isEqual(a,c)})&&this.addNewRelationTab(b,c,d.id,!0,!0)},addNewLayerTab:function(b,
c,d,e,g){var f=this._resourceManager.getLayerInfoById(b);if(f){b=this.getExistLayerTabPage(b);var h={};h.title=this.getLayerInfoLabel(f);h.name=h.title;h.paneId=this.getLayerInfoId(f);h.closable=d;h.layerType=this._layerTypes.FEATURELAYER;h.featureSet=c;b?(a.mixin(b.params,h),this.onOpen()):(this._resourceManager.getConfigInfoById(f.id)||this._resourceManager.addConfigInfo(f),this._resourceManager.getLayerInfoById(f.id)||this._resourceManager.addLayerInfo(f),this.onOpen(),h.style="height: 100%; width: 100%; overflow: visible",
b=new k(h),this.layerTabPages.push(b),b.set("title",h.name),this.own(m(b,"close",a.hitch(this,this.layerTabPageClose,h.paneId,!0))),this.tabContainer.addChild(b,g));e&&(this.tabContainer.selectChild(b),this.__focusOnActiveTab());1===this.layerTabPages.length&&this._toggleNoTableMessage(!1)}},addNewRelationTab:function(b,c,d,e,g){var f=this._resourceManager.getRelationShipInfo(c),h=c&&f;if(h){var f=this.getExistLayerTabPage(f.id),l={};l.oids=b;l.title=h.title||h.name||c.name;l.name=l.title;l.paneId=
h.id;l.relKey=c._relKey;l.originalInfoId=d;l.closable=e;l.layerType=this._layerTypes.RELATIONSHIPTABLE;f?a.mixin(f.params,l):(this._resourceManager.getConfigInfoById(h.id)||this._resourceManager.addConfigInfo(h),this._resourceManager.getLayerInfoById(h.id)||this._resourceManager.addLayerInfo(h),l.style="height: 100%; width: 100%; overflow: visible",f=new k(l),this.layerTabPages.push(f),f.set("title",l.name),this.own(m(f,"close",a.hitch(this,this.layerTabPageClose,l.paneId,!0))),this.tabContainer.addChild(f));
g&&this.tabContainer.selectChild(f)}},onReceiveData:function(b,c,d){d&&"AttributeTable"===d.target&&(this._isOnlyTable()&&"closed"===this.state?console.warn("Please open Attribute Table!"):(d.layer=d.layer||d.layerInfo,d.closeable=!0,d.isActive=!0,this.showing?this._resourceManager.updateLayerInfoResources(!1).then(a.hitch(this,function(){this._addLayerToTable(d)})):this._openTable().then(a.hitch(this,function(){this._resourceManager.getLayerInfoById(d.layer.id)?this._addLayerToTable(d):this._resourceManager.updateLayerInfoResources(!1).then(a.hitch(this,
function(){this._addLayerToTable(d)}))}))))},_addLayerToTable:function(b){var c=null;if(a.getObject("layer.id",!1,b)||a.getObject("layerInfo.id",!1,b)){var d=this._resourceManager.getLayerInfoById(b.layerInfo&&b.layerInfo.id||b.layer&&b.layer.id);d.getLayerObject().then(a.hitch(this,function(e){e?(e.id=b.layer.id,e.loaded?this.addNewLayerTab(d.id,b.featureSet,!!b.closeable,!!b.isActive,b.index):this.own(m(e,"load",a.hitch(this,this.addNewLayerTab,d.id,b.featureSet,!!b.closeable,!!b.isActive,b.index)))):
b.url&&(c=new v(b.url),this.own(m(c,"load",a.hitch(this,this.addNewLayerTab,d.id,b.featureSet,!!b.closeable,!!b.isActive,b.index))))}),a.hitch(this,function(a){new t({message:a.message||a})}))}},getExistLayerTabPage:function(a){for(var b=this.layerTabPages.length,c=0;c<b;c++)if(this.layerTabPages[c]&&this.layerTabPages[c].get("paneId")===a)return this.layerTabPages[c];return null},layerTabPageClose:function(b,c){var e=this.layerTabPages.length;a.getObject("_activeTable.layerInfo.id",!1,this)===b&&
this.setActiveTable(null);for(var f=0;f<e;f++)if(this.layerTabPages[f]&&this.layerTabPages[f].paneId===b){var g=a.getObject("_resourceManager.featureTableSet."+b,!1,this);g&&(g=g.getFilterObj())&&d.isDefined(g.expr)&&this.filterManager.applyWidgetFilter(b,this.id,"");!0===c&&(this.tabContainer.removeChild(this.layerTabPages[f]),this.layerTabPages[f].destroyRecursive());this.layerTabPages&&this.layerTabPages[f]&&this.layerTabPages.splice(f,1);this._resourceManager.removeConfigInfo(b);this._resourceManager.removeLayerInfo(b);
if(1===e){this._activeLayerInfoId=null;this.onClose();this._toggleNoTableMessage(!0);break}else b===this._activeLayerInfoId&&this.tabContainer.selectChild(this.layerTabPages[e-2]);break}},_processRelatedRecordsFromPopup:function(b,c){if(b){var d=[];d.push(b.getLayerObject());d.push(b.getRelatedTableInfoArray());u(d).then(a.hitch(this,function(a){if(a){var d=a[0];this._resourceManager.collectRelationShips(b,a[1]);a=d.relationships;for(var d=0,e=a.length;d<e;d++)this.addNewRelationTab(c,a[d],b.id,!0,
!0)}}))}},showRelatedRecordsFromPopup:function(b,c){this.showing?this._resourceManager.updateLayerInfoResources(!1).then(a.hitch(this,function(){this._processRelatedRecordsFromPopup(b,c)})):this._openTable().then(a.hitch(this,function(){this._resourceManager.getLayerInfoById(b.id)?this._processRelatedRecordsFromPopup(b,c):this._resourceManager.updateLayerInfoResources(!1).then(a.hitch(this,function(){this._processRelatedRecordsFromPopup(b,c)}))}))},getRelationShipInfo:function(a){return this._resourceManager&&
this._resourceManager.getRelationShipInfo(a)},_toggleNoTableMessage:function(a){if(!this.NoTableMessageDiv){var b=this.AttributeTableDiv||this.domNode;this.NoTableMessageDiv=e.create("div",{innerHTML:this.nls.noTablesAvailable+"\x3cbr/\x3e\x3cbr/\x3e"+(this.config.syncWithLayers?this.nls.checkLayerListToSelectLayers:this.nls.checkConfigutationToSelectLayers),className:"jimu-widget-attributetable-notable hidden"});e.place(this.NoTableMessageDiv,b)}e[a?"removeClass":"addClass"](this.NoTableMessageDiv,
"hidden")},_toggleLoading:function(a){void 0===a?this.loading.hidden?this.loading.show():this.loading.hide():a?this.loading.show():this.loading.hide()},isLoading:function(){return this.loading&&!this.loading.hidden||this._activeTable&&this._activeTable.loading&&!this._activeTable.loading.hidden}});n.inPanel=!1;n.hasUIFile=!1;return n});