// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/DataAggregation/js/UI/PageContainer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Evented dojo/query dojo/keys dojo/dom-class dojo/dom-attr dojo/Deferred dojo/_base/xhr dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/PageContainer.html jimu/dijit/ViewStack".split(" "),function(v,c,f,h,n,u,k,x,p,B,t,r,w,b,l,g){return v([w,b,u],{templateString:l,selected:"",tabs:null,average:!1,nls:null,baseClass:"jimu-tab3",
declaredClass:"PageContainer",views:[],_currentIndex:-1,_homeIndex:0,theme:"",styleColor:"",altHomeIndex:0,nextDisabled:!1,_backLabels:[],constructor:function(d){c.mixin(this,d);this.theme=this.appConfig.theme.name;this._darkThemes=["DartTheme","DashboardTheme"];this.own(n.subscribe("appConfigChanged",c.hitch(this,this._onAppConfigChanged)));this.own(n.subscribe("builder/styleChanged",c.hitch(this,this._onBuilderStyleChanged)))},postCreate:function(){this.inherited(arguments);this.displayControllerOnStart||
this.toggleController(!0);this._validateIsDark(this.appConfig)},startup:function(){this.inherited(arguments);this._started=!0;this._initSelf();this.selected?this.selectView(this.selected):0<this.views.length&&this.selectView(this._homeIndex);this._backLabels=[]},_onBuilderStyleChanged:function(d){this.setStyleColor(d.styleColor)},_onAppConfigChanged:function(d,a,e){this.appConfig=d?d:this.appConfig;switch(a){case "themeChange":this._validateIsDark(d);this.emit("theme-change",d,a,e);break;case "layoutChange":this.emit("layout-change",
d,a,e);break;case "styleChange":this._validateIsDark(d);this.emit("style-change",d,a,e);break;case "widgetChange":this.emit("widget-change",d,a,e);break;case "mapChange":this.emit("map-change",d,a,e)}},_validateIsDark:function(d){this._setThemeAndColors(d).then(c.hitch(this,function(){this.updateImageNodes();this._updateViewTheme(this.theme);for(var a=0;a<this.views.length;a++){var d=this.views[a];d.theme=this.theme;d.updateImageNodes()}}))},_setThemeAndColors:function(d){var a=new t;d=d&&d.theme&&
d.theme.name?d:this.appConfig;this.theme=d.theme.name;this._getStyleColor(d.theme.styles[0]).then(c.hitch(this,function(d){this.style=d;this._darkThemes="light"===d.name&&"DashboardTheme"===this.theme?["DartTheme"]:["DartTheme","DashboardTheme"];this.isDarkTheme=-1<this._darkThemes.indexOf(this.theme);this.styleColor=d.styleColor;a.resolve(!0)}));return a},_getStyleColor:function(d){var a=new t,b=d?d:this.appConfig.theme.styles[0];r.get({url:"./themes/"+this.theme+"/manifest.json",handleAs:"json",
load:c.hitch(this,function(d){d=d.styles;for(var e=0;e<d.length;e++){var q=d[e];q.name===b&&a.resolve(q)}})});return a},selectView:function(d,a){!a&&0<d&&(a=this.getSelectedTitle(),(a=this.getViewByTitle(a))&&this._backLabels[this._backLabels.length-1]!==a.label&&d!==a.index&&(this._backLabels.push(a.label),this.backDisabled=!1));this.viewStack.switchView(d);this._updateDomNodes(d);this._currentIndex=d;this.emit("view-changed",d)},showShelter:function(){h.setStyle(this.shelter,"display","block")},
hideShelter:function(){h.setStyle(this.shelter,"display","none")},_initSelf:function(){this.viewStack?this.viewStack._currentView=void 0:this.viewStack=new g(null,this.containerNode);this._initViews()},_initViews:function(){f.forEach(this.views,c.hitch(this,function(d){this.addView(d)}))},_prevView:function(d){d&&"keydown"===d.type&&d.keyCode!==x.ENTER&&d.keyCode!==x.SPACE||this._navView("back-view")},_homeView:function(d){d&&"keydown"===d.type&&d.keyCode!==x.ENTER&&d.keyCode!==x.SPACE||this._navView("home-view")},
_nextView:function(d){d&&"keydown"===d.type&&d.keyCode!==x.ENTER&&d.keyCode!==x.SPACE||this._navView("next-view")},_navView:function(d){var a=this.getSelectedTitle(),b=this.getViewByTitle(a),q="home-view"===d&&b.altHomeIndex?b.altHomeIndex:this._homeIndex,g,l=!1;if("back-view"===d&&0<this._backLabels.length){var A;for(g=this._backLabels.length-1;0<=g&&(!(A=this.getViewByTitle(this._backLabels[g]))||this._backLabels[g]===a);g--)this._backLabels.splice(g,1);g=A.index;l=!0}"next-view"===d&&"undefined"===
typeof b&&0<this._backLabels.length&&(this._currentIndex=(b=this.getViewByTitle(this._backLabels[this._backLabels.length-1]))&&b.index?b.index:this._currentIndex);"undefined"===typeof g&&(g="next-view"===d?b.altNextIndex:"back-view"===d?b.altBackIndex:void 0);var D;"undefined"!==typeof g&&"home-view"!==d?D=this.getViewByIndex(g):"next-view"===d?this._currentIndex<this.viewCount-1&&(D=this.getViewByIndex(this._currentIndex+1)):"back-view"===d?D=this._currentIndex-1<=this._homeIndex?this.getViewByIndex(this._homeIndex):
this.getViewByIndex(this._currentIndex-1):(q!==this._homeIndex&&this._backLabels&&0<this._backLabels.length&&(l=!0),D=this.getViewByIndex(q));D&&(a={currentView:b,navView:D},this.emit(d,a),b.validate?b.validate(d,a).then(c.hitch(this,function(a){a&&this._navigate(D.index,l,b.index,d,D.label)})):this._navigate(D.index,l,b.index,d,D.label))},_navigate:function(b,a,e,q,g){0<e&&"next-view"===q&&this._backLabels[this._backLabels.length-1]!==this.views[e].label&&(this._backLabels.push(this.views[e].label),
this.backDisabled=!1);if(a){for(a=this._backLabels.length-1;0<=a;a--)if(this._backLabels[a]===g){this._backLabels.splice(a,1);break}0===this._backLabels.length&&(this.backDisabled=!0)}this._currentIndex=b;this.selectView(b,!0);this.emit("nav-view",b)},getSelectedIndex:function(){return this._currentIndex},getSelectedTitle:function(){return this.viewStack.getSelectedLabel()},getViewByIndex:function(b){if(this.views.length>b)return this.views[b]},getViewByTitle:function(b){for(var a=0;a<this.views.length;a++){var d=
this.views[a];if(d.label===b)return d}},_updateControlImage:function(b,a){a?(h.addClass(b,"control-disbaled"),B.set(b,"tabindex","-1")):(h.removeClass(b,"control-disbaled"),B.set(b,"tabindex","0"))},_updateControl:function(b,a){a?h.addClass(b,"control-disbaled"):h.removeClass(b,"control-disbaled")},_updateViews:function(){this.viewCount=this.views.length;for(var b=0;b<this.views.length;b++){var a=this.views[b];a.setStyleColor(this.styleColor);"undefined"!==typeof a.index&&a.index!==b&&this.emit("view-index-change",
{oldIndex:a.index,newIndex:b});a.index=b}this.emit("views-updated",this)},addView:function(b){b.pageContainer=this;this._containsView(b.label)||this.views.push(b);this.viewStack.getViewByLabel(b.label)||this.viewStack.addView(b);this._updateViews();this.emit("view-added",b)},removeViewByTitle:function(b){b=this.getViewByTitle(b);this.removeViewByIndex(b.index)},removeView:function(b){this.removeViewByIndex(b.index)},removeViewByIndex:function(b){var a=this.getViewByIndex(b),e=a.label;this.viewStack.removeView(a);
this.views.splice(b,1);this._updateViews();this._backLabels=this._backLabels.filter(function(a){return a!==e});0===this._backLabels.length&&(this.backDisabled=!0);this._navView("next-view");this.emit("view-removed",a)},_clearViews:function(){f.forEach(this.views,c.hitch(this,function(b){this.viewStack.removeView(b)}));this.views=[];this._backLabels=[]},_containsView:function(b){for(var a=0;a<this.views.length;a++)if(this.views[a].label===b)return!0;return!1},setStyleColor:function(b){this.styleColor=
b;f.forEach(this.views,c.hitch(this,function(a){a.styleColor=b}))},updateImageNodes:function(){var b=this.isDarkTheme;this._updateImageNode(b,"bg-back-img","bg-back-img-white");this._updateImageNode(b,"bg-home-img","bg-home-img-white");this._updateImageNode(b,"bg-next-img","bg-next-img-white")},_updateDomNodes:function(b){var a=this.views[b],e=this._homeIndex,d=this.backDisabled?this.backDisabled:b===this._homeIndex?!0:!1;this._updateControl(this.backTd,d);this._updateControlImage(this.backImage,
d);d=b===e?!0:!1;this._updateControl(this.homeTd,d);this._updateControlImage(this.homeImage,d);a=a&&"undefined"!==typeof a.altNextIndex;b=this.nextDisabled?this.nextDisabled:b!==e||this.nextDisabled?a?!1:this.nextDisabled:!1;this._updateControl(this.nextTd,b);this._updateControlImage(this.nextImage,b)},_updateImageNode:function(b,a,e){var d=b?a:e,g=b?e:a;b=k("."+d,this.domNode);f.forEach(b,function(a){p.remove(a,d);p.add(a,g)})},_updateViewTheme:function(b){this.theme=b;f.forEach(this.views,c.hitch(this,
function(a){a.theme=b}))},toggleController:function(b){this.controlTable&&(b?p.contains(this.controlTable,"display-none")||p.add(this.controlTable,"display-none"):p.contains(this.controlTable,"display-none")&&p.remove(this.controlTable,"display-none"))},reset:function(){this._clearViews();this.views=[];this._currentIndex=-1;this._homeIndex=0;this.nextDisabled=!1;this.backDisabled=!0;this.selected="";this._validateIsDark(this.appConfig)}})})},"widgets/DataAggregation/js/UI/Home":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/keys dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/Home.html dojo/on dojo/dom-construct dojo/dom-class dojo/dom-attr ../csvStore ./Addresses ./Coordinates ./FieldMapping esri/lang jimu/dijit/Popup jimu/utils".split(" "),
function(v,c,f,h,n,u,k,x,p,B,t,r,w,b,l,g,d,a,e,q,y){return v([u,k,x,p],{baseClass:"cf-home",declaredClass:"CriticalFacilities.Home",templateString:B,_started:null,label:"Home",parent:null,nls:null,map:null,appConfig:null,config:null,theme:"",styleColor:"",_geocodeSources:null,_fsFields:[],_singleFields:[],_multiFields:[],_childViews:[],singleEnabled:!1,multiEnabled:!1,xyEnabled:!1,disabled:!1,userName:"",fieldMappingView:null,constructor:function(a){c.mixin(this,a);this._initBaseArgs()},_initBaseArgs:function(){this._baseArgs=
{nls:this.nls,map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,theme:this.theme}},postCreate:function(){this.inherited(arguments);this.pageInstructionText&&(this.pageInstruction.innerHTML=this.pageInstructionText);b.set(this.schemaMapInstructions,"aria-label",y.stripHTML(this.pageInstruction.innerHTML));this.own(t(this.uploadLabel,"keydown",c.hitch(this,function(a){a.keyCode!==n.ENTER&&a.keyCode!==n.SPACE||this.fileNode.click()})));this.own(t(this.creditsLink,"keydown",
c.hitch(this,function(a){a.keyCode!==n.ENTER&&a.keyCode!==n.SPACE||this.creditsLinkTag.click()})));this.firstFocusNode=this.schemaMapInstructions;this.lastFocusNode=this.creditsLink},startup:function(){this._started=!0;this.inDrop=!1;if(this.fileNode.disabled=this.disabled)w.add(this.uploadLabel,"disabled"),b.set(this.uploadLabel,"tabindex","-1");this.parent.domNode&&(this.own(t(this.parent.domNode,"dragenter",this.onDragEnter)),this.own(t(this.parent.domNode,"dragover",this.onDragOver)),this.own(t(this.parent.domNode,
"drop",c.hitch(this,this.onDrop))));this.own(t(this.map.container,"dragenter",this.onDragEnter));this.own(t(this.map.container,"dragover",this.onDragOver));this.own(t(this.map.container,"drop",c.hitch(this,this.onDrop)));this.own(t(this.fileNode,"change",c.hitch(this,this.onDrop)))},onShown:function(){},_clearResults:function(a){a||(this.map.infoWindow.hide(),this.inDrop=!1)},setStyleColor:function(a){this.styleColor=a},updateImageNodes:function(){},validate:function(a,b){var e=new h;"next-view"===
a?e.resolve(this._nextView(b)):"back-view"===a?this._backView(b).then(function(a){e.resolve(a)}):this._homeView(b).then(function(a){e.resolve(a)});return e},_nextView:function(a){a.navView.label===this.pageContainer.views[1].label&&this.pageContainer.toggleController(!1);return!0},_backView:function(a){var b=new h;a.navView.label===this.label&&(this.pageContainer.toggleController(!0),b.resolve(!0));return b},_homeView:function(a){var b=new h;a.navView.label===this.label&&(this.pageContainer.toggleController(!0),
b.resolve(!0));return b},_clearMapping:function(){this.parent._locationMappingComplete=!1;this.parent._fieldMappingComplete=!1},onDragEnter:function(a){a.preventDefault()},onDragOver:function(a){a.preventDefault()},onDrop:function(a){if(this.disabled)this.parent._userCanEdit?(a=this.parent._getMessages(),this.parent._showPopup(a)):this.parent.showEditMessage();else if(!this.inDrop){this.inDrop=!0;this.csvStore&&this.csvStore.clear();var b;a.dataTransfer?(a.preventDefault(),b=a.dataTransfer.files):
a.currentTarget&&(b=a.currentTarget.files);b&&0<b.length?(a=b[0],-1!==a.name.indexOf(".csv")?(this.csvStore=new l({file:a,fsFields:this._fsFields,map:this.map,geocodeSources:this._geocodeSources,nls:this.nls,appConfig:this.appConfig,editLayer:this.parent.editLayer,symbol:this.parent._symbol,parent:this.parent}),this.csvStore.handleCsv().then(c.hitch(this,function(a){this._updatePageContainer(a);this.inDrop=!1}),c.hitch(this,function(){this.parent.erroInCSV();this.inDrop=!1}))):this.inDrop=!1):this.inDrop=
!1}},targetLayerUpdated:function(){this.fieldMappingView&&this.csvStore&&(this.csvStore.editLayer=this.parent.editLayer,this.csvStore.symbol=this.parent._symbol,this.csvStore.fsFields=c.clone(this._fsFields),this.csvStore._getDuplicateFields(this.csvStore.fsFields),this.csvStore.handleCsv().then(c.hitch(this,function(a){var b=a.fsFields;a=this._getFields(a,!1);this.fieldMappingView.targetLayerUpdate(b,a)})))},_initCoordinatesView:function(a){return new d(c.mixin({fields:this._getFields(a,!0),xField:"X"===
this.config.xyFields[0].fieldName?this.config.xyFields[0]:this.config.xyFields[1],yField:"Y"===this.config.xyFields[0].fieldName?this.config.xyFields[0]:this.config.xyFields[1],firstField:this.config.xyFields[0].fieldName},this._baseArgs))},_initAddressView:function(a){return new g(c.mixin({singleFields:this._singleFields,multiFields:this._multiFields,fields:this._getFields(a,!1),multiEnabled:this.multiEnabled,singleEnabled:this.singleEnabled},this._baseArgs))},_initFieldMappingView:function(b){return new a(c.mixin({targetFields:b.fsFields,
sourceFields:this._getFields(b,!1)},this._baseArgs))},_getFields:function(a,b){var e=[];f.forEach(a.fields,function(m){var d=a.fieldTypes[m];(b&&d&&(d.supportsInt||d.supportsFloat)||!b)&&e.push({label:m,value:m,type:d})});return e},_updatePageContainer:function(a){this.pageContainer.getViewByTitle("StartPage").csvStore=this.csvStore;if(this.xyEnabled){var b=this._initCoordinatesView(a);this.pageContainer.addView(b)}if(this.singleEnabled||this.multiEnabled)b=this._initAddressView(a),this.pageContainer.addView(b);
this.fieldMappingView=this._initFieldMappingView(a);this.pageContainer.addView(this.fieldMappingView);this.pageContainer._nextView()},verifyClearSettings:function(a){var b=new h;if(a.navView.label===this.label){var e;if(this.parent._locationMappingComplete||this.parent._fieldMappingComplete||this.parent._tempResultsAdded)e=this.nls.warningsAndErrors.settingsCleared;if(e){var m=r.create("div");r.create("div",{className:"cf-warning-icon",style:"float: "+(window.isRTL?"right; margin-left":"left; margin-right")+
": 10px;"},m);var d="padding-"+(window.isRTL?"right":"left")+": 50px;";r.create("div",{innerHTML:e,style:d},m);r.create("div",{innerHTML:this.nls.warningsAndErrors.proceed,style:"padding-top:10px; "+d},m);var C=new q({width:325,autoHeight:!0,content:m,buttons:[{label:this.nls.yes,onClick:c.hitch(this,function(){this._clearMapping();this._clearStore(!0);this.pageContainer.toggleController(!0);C.close();C=null;b.resolve(!0)})},{label:this.nls.no,classNames:["jimu-btn-vacation"],onClick:c.hitch(this,
function(){this.pageContainer.selectView(a.currentView.index);C.close();C=null;b.resolve(!1)})}],onClose:function(){C=null}})}else this.pageContainer.toggleController(!0),this._clearStore(!0),b.resolve(!0)}else b.resolve(!0);return b},_clearStore:function(a){this.csvStore&&this.csvStore.clear();this.map.infoWindow&&this.map.infoWindow.clearFeatures&&this.map.infoWindow.clearFeatures();this.fileForm.reset();a&&(this.parent._initPageContainer(!0),this.inDrop=!1)}})})},"widgets/DataAggregation/js/csvStore":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/DeferredList dojo/Evented dojox/data/CsvStore dojo/store/Observable dojo/store/Memory esri/graphicsUtils esri/geometry/webMercatorUtils esri/geometry/Point esri/layers/FeatureLayer esri/tasks/locator esri/tasks/query esri/SpatialReference esri/dijit/PopupTemplate esri/geometry/geometryEngine esri/tasks/ProjectParameters esri/tasks/GeometryService esri/request jimu/utils moment/moment".split(" "),
function(v,c,f,h,n,u,k,x,p,B,t,r,w,b,l,g,d,a,e,q,y,z,A){return v([u],{file:null,map:null,spatialReference:null,fsFields:[],duplicateTestFields:[],geocodeSources:[],duplicateData:[],data:null,editLayer:null,parent:null,separatorCharacter:null,csvStore:null,storeItems:null,matchedFeatureLayer:null,mappedArrayFields:null,unMatchedFeatureLayer:null,duplicateFeatureLayer:null,addrFieldName:"",xFieldName:"",yFieldName:"",symbol:null,matchFieldPrefix:"MatchField_",_internalFields:[],_removeLocators:[],constructor:function(a){f.mixin(this,
a);this.useAddr=!0;this.objectIdField="ObjectID";this.nls=a.nls;this.minScore=90;this._getDuplicateFields(this.fsFields);this.spatialReference=this.map.spatialReference;this.decimalSeperator=/^1(.+)1$/.exec(z.localizeNumber(1.1))[1].toString()},_getDuplicateFields:function(a){var b=[];c.forEach(a,function(a){a.duplicate&&b.push(a.name)});this.duplicateTestFields=b},handleCsv:function(){var a=new h;if(this.file&&!this.file.data){var b=new FileReader;b.onload=f.hitch(this,function(){this.data=b.result;
this._processCsvData().then(function(b){a.resolve(b)},f.hitch(this,function(b){a.reject(b)}))});b.readAsText(this.file)}return a},_processCsvData:function(){var a=new h;this._convertSources();this._getSeparator();this._getCsvStore().then(function(b){a.resolve(b)},function(b){a.reject(b)});return a},processForm:function(){this._internalFields=["DestinationOID","matchScore","hasDuplicateUpdates","duplicateState"];this._matchFields=[];var a=new h;this._locateData(this.useAddr).then(f.hitch(this,function(b){var m=
[],e=[],d=[],g={},q=0,l=0;0<this._removeLocators.length&&(this._removeLocators.sort(function(a,b){return b-a}),c.forEach(this._removeLocators,f.hitch(this,function(a){this._geocodeSources.splice(a,1)})));for(var A=function(a,b,m,e){var d=a;-1===[null,void 0,""].indexOf(a)&&a.indexOf&&-1<a.indexOf(b)&&(m=m.filter(function(a){return a.keyField===e}))&&m.hasOwnProperty("length")&&1===m.length&&(d=a.toString?a.toString().replace(b,"."):a);return d},y=Object.keys(b),D=0;D<y.length;D++){var k={},z=b[y[D]],
p=this.storeItems[z.csvIndex];c.forEach(this.fsFields,f.hitch(this,function(a){if(this.mappedArrayFields.hasOwnProperty(a.name))if(this.mappedArrayFields[a.name]){var b=this.csvStore.getValue(p,this.mappedArrayFields[a.name]);if(a.domainValues){var m=a.domainValues.filter(f.hitch(this,function(a){return a.label===b}));k[a.name]=m&&0<m.length?m[0].value:b}else k[a.name]="."===this.decimalSeperator||this.useAddr?b:A(b,this.decimalSeperator,this._currentAddressFields,this.mappedArrayFields[a.name])}else k[a.name]=
void 0}));c.forEach(this._currentAddressFields,f.hitch(this,function(a){var b=this.matchFieldPrefix+a.keyField;if("undefined"!==typeof a.value){var m=this.csvStore.getValue(p,a.value);k[b]="."===this.decimalSeperator||this.useAddr?m:A(m,this.decimalSeperator,this._currentAddressFields,a.keyField)}else k[b]=void 0;this._matchFields.push(b)}));z&&z.score>this.minScore?(k.ObjectID=D-q-l,k.matchScore=z.score,m.push({geometry:z.location,attributes:f.clone(k)})):z.isDuplicate?(k.ObjectID=l,k.DestinationOID=
z.featureAttributes[this.editLayer.objectIdField],k.matchScore=100,k.hasDuplicateUpdates=!1,k.duplicateState="no-change",d.push({geometry:z.location,attributes:f.clone(k)}),g[l]=z.featureAttributes,l++):(k.ObjectID=q,k.matchScore=z.score?z.score:0,e.push({geometry:z.location&&z.location.type?z.location:new r(0,0,this.spatialReference),attributes:f.clone(k)}),q++)}this.matchedFeatureLayer=this._initLayer(m,this.file.name.replace(".csv",""));0<d.length&&(this.duplicateFeatureLayer=this._initLayer(d,
this.file.name.replace(".csv","")+"_Duplicate"));0<e.length&&(this.unMatchedFeatureLayer=this._initLayer(e,this.file.name.replace(".csv","")+"_UnMatched"));a.resolve({matchedLayer:this.matchedFeatureLayer,unMatchedLayer:this.unMatchedFeatureLayer,duplicateLayer:this.duplicateFeatureLayer,duplicateLookupList:g})}),function(b){a.reject(b,!0)});return a},_initLayer:function(a,b){a=this._generateFC(a);b=new w(a,{id:b,editable:!0,outFields:["*"]});this._initPopup(b);this.map.addLayers([b]);return b},_initPopup:function(a){var b=
{title:a.id+": {"+this.labelField+"}"},e=[];c.forEach(a.fields,f.hitch(this,function(a){a.name!==this.objectIdField&&-1===this._internalFields.indexOf(a.name)&&-1===this._matchFields.indexOf(a.name)&&e.push({fieldName:a.name,visible:!0})}));b.fieldInfos=e;a.infoTemplate=new d(b)},_findDuplicates:function(){var a=new h;this._getAllLayerFeatures(this.editLayer,this.fsFields).then(f.hitch(this,function(b){this.keys=Object.keys(this.mappedArrayFields);this.oidField=this.editLayer.objectIdField;var m=
[],e=[],d=this.duplicateTestFields;d&&d.hasOwnProperty("length")&&0<d.length&&c.forEach(this.storeItems,f.hitch(this,function(a){var b={compareValues:{},fileId:a._csvId,featureId:-1};c.forEach(d,f.hitch(this,function(m){var d=this.mappedArrayFields[m];"undefined"!==typeof d&&(b.compareValues[m]=this.csvStore.getValue(a,d),-1===e.indexOf(m)&&e.push(m))}));0<Object.keys(b.compareValues).length&&m.push(b)}));var g=[];0<m.length&&c.forEach(m,f.hitch(this,function(a){c.forEach(b,f.hitch(this,function(b){var m=
{};c.forEach(e,f.hitch(this,function(a){var e=b.attributes[a];m[a]=-1===[null,void 0].indexOf(e)&&e.toString?e.toString():e}));if(JSON.stringify(a.compareValues)===JSON.stringify(m)){var d=b.attributes[this.oidField];-1!==a.featureId?(a.hasMultiDuplicates=!0,"undefined"===typeof a.featureIds?(a.featureIds=[a.featureId,d],a.features=[a.feature,b]):(a.featureIds.push(d),a.features.push(b))):(a.featureId=d,a.feature=b,g.push(a))}}))}));a.resolve(g)}));return a},_getAllLayerFeatures:function(a,b){var m=
new h,e=[this.editLayer.objectIdField];c.forEach(b,function(a){a.name&&e.push(a.name)});2>e.length&&(e=b);var d=a.maxRecordCount;b=new l;b.where="1\x3d1";a.queryIds(b).then(function(b){var C=[],g,q;if(b&&0<b.length){g=0;for(q=b.length;g<q;g+=d){var A=new l;A.outFields=e;A.objectIds=b.slice(g,g+d);A.returnGeometry=!0;C.push(a.queryFeatures(A))}(new n(C)).then(f.hitch(this,function(a){if(a){for(var b=[],e=0;e<a.length;e++)a[e][1].features&&b.push.apply(b,a[e][1].features.map(function(a){return{geometry:a.geometry,
attributes:a.attributes}}));m.resolve(b)}}))}else m.resolve([])},function(a){console.error(a);m.resolve({type:"error",message:a})});return m},_locateData:function(b){var e=new h;this._findDuplicates().then(f.hitch(this,function(m){this.duplicateData=m;if(b){var d=f.hitch(this,function(a,b,e){var m=new h,C=this._geocodeSources[b],g=C.locator;g.outSpatialReference=this.spatialReference;var q=[],l=[],A=0,E,y;E=0;y=a.length;for(;E<y;E+=500){var D=a.slice(E,E+500),F=[];(C.singleEnabled||C.multiEnabled)&&
c.forEach(D,f.hitch(this,function(a){var b=a._csvId,m=null,d;a:for(d in this.duplicateData){var g=this.duplicateData[d];if(g.fileId===b){m=f.mixin({},g);delete this.duplicateData[d];break a}}var q={};q.OBJECTID=b;this.useMultiFields?c.forEach(this.multiFields,f.hitch(this,function(b){this._currentAddressFields=this.multiFields;if(b.value!==this.nls.noValue){var e=this.csvStore.getValue(a,b.value);q[b.keyField]=e}else q[b.keyField]=void 0})):this.singleFields[0].value!==this.nls.noValue&&(this._currentAddressFields=
this.singleFields,d=this.csvStore.getValue(a,this.singleFields[0].value),"undefined"===typeof d&&(d=typeof d+b),q[C.singleLineFieldName]=d);d=f.mixin({},q);d=JSON.stringify(d);if(null===m)F.push(q),e[d]={index:A,csvIndex:b,location:{}},A+=1;else if(null!==m){var g=m.feature.geometry,l=m.feature.attributes;if(-1!==[null,void 0].indexOf(g)&&m.features){var E=0;a:for(;E<m.features.length;E++){var y=m.features[E];if(-1===[null,void 0].indexOf(y.geometry)){g=y.geometry;l=y.attributes;break a}}}e[d]={index:-1,
csvIndex:b,isDuplicate:!0,location:f.mixin({},g),featureAttributes:l}}}));this.useMultiFields&&C.multiEnabled||!this.useMultiFields&&C.singleEnabled?l.push(g.addressesToLocations({addresses:F,countryCode:C.countryCode,outFields:["ResultID","Score"]})):(D=new h,D.reject(this.nls.warningsAndErrors.notConfigured,!0),l.push(D))}var k=Object.keys(e);(new n(l)).then(f.hitch(this,function(g){this.minScore=this._geocodeSources[b]?this._geocodeSources[b].minCandidateScore:90;b+=1;var l=this._geocodeSources.length>
b;if(g&&g.length&&g[0].length&&!1===g[0][0])if(1<g[0].length&&console.error(g[0][1]),(this.useMultiFields&&C.multiEnabled||!this.useMultiFields&&C.singleEnabled)&&this.parent.locatorError(this._geocodeSources[b-1].locator.url,!1),this._removeLocators.push(b-1),l)d(this._remainingStoreItems||this.storeItems,b,this._currentFinalResults||{}).then(f.hitch(this,function(a){m.resolve(a)}));else return 1<this._geocodeSources.length?m.resolve(e):m.reject(this.nls.warningsAndErrors.noMoreLocators),m.promise;
else if(g){var A=this.minScore,E=0;c.forEach(g,f.hitch(this,function(b){b=b[1];c.forEach(b,function(a){a.ResultID=a.attributes.ResultID});b=x(new p({data:b,idProperty:"ResultID"})).query({},{sort:[{attribute:"ResultID"}]});c.forEach(b,f.hitch(this,function(b){for(var m in k){var d=k[m];if(e[d]&&e[d].index===E){b.attributes.Score<A?l?(q.push(a[e[d].csvIndex]),delete e[d]):e[d].score=b.attributes.Score:(e[d].location=b.location,e[d].score=b.attributes.Score,delete e[d].index);delete k[m];break}}E+=
1}))}));if(l&&0<q.length)this._remainingStoreItems=q,this._currentFinalResults=e,d(q,b,e).then(f.hitch(this,function(a){m.resolve(a)}));else return m.resolve(e),m.promise}}),f.hitch(this,function(a){console.log(a);b+=1;if(this._geocodeSources.length>b)d(this._remainingStoreItems||this.storeItems,b,this._currentFinalResults||{}).then(f.hitch(this,function(a){m.resolve(a)}));else return 1<this._geocodeSources.length?m.resolve(e):m.reject(this.nls.warningsAndErrors.noMoreLocators),m.promise}));return m});
this._removeLocators=[];d(this.storeItems,0,{}).then(f.hitch(this,function(a){e.resolve(a)}),f.hitch(this,function(a){e.reject(a)}))}else this._currentAddressFields=[{keyField:this.xFieldName,label:this.xFieldName,value:this.xFieldName},{keyField:this.yFieldName,label:this.yFieldName,value:this.yFieldName}],this._xyData({storeItems:this.storeItems,csvStore:this.csvStore,xFieldName:this.xFieldName,yFieldName:this.yFieldName,wkid:this.spatialReference.wkid}).then(f.hitch(this,function(b){if(this.isGeographic&&
!this.map.spatialReference.isWebMercator()&&4326!==this.spatialReference.wkid){var m=[];c.forEach(b,function(a){m.push(a.location)});var d=1<m.length?a.union(m):a.buffer(m[0],100,9001);this._projectPoints(d,m).then(function(a){for(var m=0;m<b.length;m++)b[m].location=a[m];e.resolve(b)})}else e.resolve(b)}),function(a){e.reject(a)})}));return e},_xyData:function(a){var b=new h,e=[],d=a.csvStore;c.forEach(a.storeItems,f.hitch(this,function(b){var m=b._csvId,C=null,g;a:for(g in this.duplicateData){var q=
this.duplicateData[g];if(q.fileId===m){C=f.mixin({},q);delete this.duplicateData[g];break a}}var l={};g=d.getAttributes(b);c.forEach(g,function(a){l[a]=d.getValue(b,a)});g=!1;var A,E;null!==C&&C.feature&&C.feature.geometry?(q=C.feature.geometry,g=!0,E=C.feature.attributes):(C=d.getValue(b,a.xFieldName),A=d.getValue(b,a.yFieldName),"."!==this.decimalSeperator&&(C=-1!==[null,void 0,""].indexOf(C)?void 0:C.toString().replace(this.decimalSeperator,"."),A=-1!==[null,void 0,""].indexOf(A)?void 0:A.toString().replace(this.decimalSeperator,
".")),C=parseFloat(C),A=parseFloat(A),q=this._getGeometry(C,A),A=isNaN(C)||isNaN(A)?0:100);q&&e.push({attributes:l,location:q,csvIndex:m,score:A,isDuplicate:g,featureAttributes:E})}));b.resolve(e);return b},_getGeometry:function(a,b){"undefined"===typeof this.isGeographic&&(this.isGeographic=/(?=^[-]?\d{1,3}\.)^[-]?\d{1,3}\.\d+|(?=^[-]?\d{4,})|^[-]?\d{1,3}/.exec(a)?!0:!1);a=new r(isNaN(a)?0:a,isNaN(b)?0:b);this.isGeographic&&this.spatialReference.isWebMercator()?a=t.geographicToWebMercator(a):a.spatialReference=
this.isGeographic&&4326!==this.spatialReference.wkid?new g(4326):new g({wkid:this.spatialReference.wkid});return a},_projectPoints:function(a,b){var m=new h;this.gsvc=new q(this.appConfig.geometryService);a={url:this.gsvc.url+"/findTransformations",content:{f:"json",inSR:a.spatialReference.wkid,outSR:this.spatialReference.wkid,extentOfInterest:JSON.stringify(a.getExtent().toJson())},handleAs:"json",callbackParamName:"callback"};y(a,{usePost:!1}).then(f.hitch(this,function(a){a=(a=a&&a.transformations?
a.transformations:void 0)&&0<a.length?a[0].wkid:void 0;var d=new e;d.outSR=this.spatialReference;d.geometries=b;d.transformForward=!0;d.transformation=a;this.gsvc.project(d,f.hitch(this,function(a){m.resolve(a)}),function(a){m.reject(a)})}),function(a){m.reject(a)});return m},_generateFC:function(a){var b={layerDefinition:{geometryType:"esriGeometryPoint",spatialReference:this.spatialReference,objectIdField:this.objectIdField,type:"Feature Layer",drawingInfo:{renderer:{type:"simple",symbol:this.symbol}},
fields:[{name:this.objectIdField,alias:this.objectIdField,type:"esriFieldTypeOID"}]},featureSet:{features:a,geometryType:"esriGeometryPoint"}};c.forEach(this.fsFields,f.hitch(this,function(a){b.layerDefinition.fields.push({name:a.name,alias:a.label,type:a.value,editable:!0,domain:null})}));return b},clear:function(){this._removeLayer(this.matchedFeatureLayer);this._removeLayer(this.unMatchedFeatureLayer);this._removeLayer(this.duplicateFeatureLayer);this.storeItems=this.csvStore=this.separatorCharacter=
this.data=this.fsFields=this.file=void 0;this.duplicateData=[];this.mappedArrayFields=this.duplicateFeatureLayer=this.unMatchedFeatureLayer=this.matchedFeatureLayer=void 0;this.useAddr=!0;this.yFieldName=this.xFieldName=this.addrFieldName=""},_removeLayer:function(a){a&&(this.map.removeLayer(a),a.clear())},_getSeparator:function(){var a=this.data.indexOf("\n"),b=f.trim(this.data.substr(0,a)),e=0,d="";c.forEach([",","      ",";","|"],function(a){var m=b.split(a).length;m>e&&(e=m,d=a)});this.separatorCharacter=
d},_getCsvStore:function(){var a=new h;this.csvStore=new k({data:this.data,separator:this.separatorCharacter});this.csvStore.fetch({onComplete:f.hitch(this,function(b){this.storeItems=b;this._fetchFieldsAndUpdateForm(this.storeItems,this.csvStore,this.fsFields).then(function(b){a.resolve(b)})}),onError:f.hitch(this,function(b){a.reject(b)})});return a},_fetchFieldsAndUpdateForm:function(a,b,e){var m=new h,d=b._attributes,g=this.decimalSeperator,q={};c.forEach(d,function(e){c.forEach(a,function(a){var m=
!0,d=!0,C=!0,l=!0,E;q.hasOwnProperty(e)&&(d=q[e].supportsInt,C=q[e].supportsFloat,l=q[e].supportsDate,E=q[e].maxLength,d||C||l||(m=!1));var y=b.getValue(a,e);if(y){a=y.toString().length;var c=A(y);if(m){m=-1!==[null,void 0,""].indexOf(y);if(!m&&(l=l&&c.isValid()))if(c=y)try{l=!isNaN((new Date(c)).getTime())}catch(G){console.error(G),l=!1}else l=-1<[null,void 0,""].indexOf(c)?!0:!1;q[e]={supportsDate:l,supportsInt:m?d:!isNaN(parseInt(y,10))&&parseInt(y,10).toString().length===a&&d};"."!==g&&(y=m?"":
y.toString().replace(g,"."));q[e].supportsFloat=m?C:!isNaN(parseFloat(y))&&parseFloat(y).toString().length===a&&C}d=q[e];d.maxLength=E;"undefined"===typeof d.maxLength?d.maxLength=a:d.maxLength<a&&(d.maxLength=a)}})});m.resolve({fields:d,fieldTypes:q,fsFields:e});return m},_zoomToData:function(a,b){if(a&&0<a.length)try{var e=B.graphicsExtent(a);b?this.map.setExtent(e.expand(1.9),!0):this.map.setExtent(e,!0)}catch(C){console.log(C.message)}},_convertSources:function(){this.geocodeSources&&0<this.geocodeSources.length&&
(this._geocodeSources=c.map(this.geocodeSources,f.hitch(this,function(a){if(a&&a.url&&"locator"===a.type)return{locator:new b(a.url||""),outFields:["ResultID","Score"],singleLineFieldName:a.singleLineFieldName||"",name:z.stripHTML(a.name||""),placeholder:z.stripHTML(a.placeholder||""),countryCode:a.countryCode||"",addressFields:a.addressFields,singleEnabled:a.singleEnabled||!1,multiEnabled:a.multiEnabled||!1,minCandidateScore:a.minCandidateScore||90}})))}})})},"dojox/data/CsvStore":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/xhr dojo/_base/kernel dojo/data/util/filter dojo/data/util/simpleFetch".split(" "),
function(v,c,f,h,n,u){c=c("dojox.data.CsvStore",null,{constructor:function(c){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=!1;c.url&&(this.url=c.url);this._csvData=c.data;c.label?this.label=c.label:""===this.label&&(this.label=void 0);this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._loadInProgress=!1;this._queuedFetches=[];this.identifier=c.identifier;""===this.identifier?
delete this.identifier:this._idMap={};"separator"in c&&(this.separator=c.separator);"urlPreventCache"in c&&(this.urlPreventCache=c.urlPreventCache?!0:!1)},url:"",label:"",identifier:"",separator:",",urlPreventCache:!1,_assertIsItem:function(c){if(!this.isItem(c))throw Error(this.declaredClass+": a function was passed an item argument that was not an item");},_getIndex:function(c){c=this.getIdentity(c);this.identifier&&(c=this._idMap[c]);return c},getValue:function(c,f,p){this._assertIsItem(c);var k=
p;if("string"===typeof f)f=this._attributeIndexes[f],null!=f&&(k=this._dataArray[this._getIndex(c)][f]||p);else throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");return k},getValues:function(c,f){return(c=this.getValue(c,f))?[c]:[]},getAttributes:function(c){this._assertIsItem(c);var f=[];c=this._dataArray[this._getIndex(c)];for(var k=0;k<c.length;k++)""!==c[k]&&f.push(this._attributes[k]);return f},hasAttribute:function(c,f){this._assertIsItem(c);
if("string"===typeof f)return f=this._attributeIndexes[f],c=this._dataArray[this._getIndex(c)],"undefined"!==typeof f&&f<c.length&&""!==c[f];throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");},containsValue:function(c,f,p){var k=void 0;"string"===typeof p&&(k=n.patternToRegExp(p,!1));return this._containsValue(c,f,p,k)},_containsValue:function(c,f,p,h){c=this.getValues(c,f);for(f=0;f<c.length;++f){var k=c[f];if("string"===typeof k&&h)return null!==
k.match(h);if(p===k)return!0}return!1},isItem:function(c){if(c&&c[this._storeProp]===this)if(c=c[this._idProp],this.identifier){if(this._dataArray[this._idMap[c]])return!0}else if(0<=c&&c<this._dataArray.length)return!0;return!1},isItemLoaded:function(c){return this.isItem(c)},loadItem:function(c){},getFeatures:function(){return this._features},getLabel:function(c){if(this.label&&this.isItem(c))return this.getValue(c,this.label)},getLabelAttributes:function(c){return this.label?[this.label]:null},
_fetchItems:function(c,h,p){var k=this,t=function(b,g){var d=null;if(b.query){var a,e,d=[],q=b.queryOptions?b.queryOptions.ignoreCase:!1,l={};for(a in b.query)e=b.query[a],"string"===typeof e&&(l[a]=n.patternToRegExp(e,q));for(q=0;q<g.length;++q){var c=!0,A=g[q];for(a in b.query)e=b.query[a],k._containsValue(A,a,e,l[a])||(c=!1);c&&d.push(A)}}else d=g.slice(0,g.length);h(d,b)};if(this._loadFinished)t(c,this._arrayOfAllItems);else if(""!==this.url)if(this._loadInProgress)this._queuedFetches.push({args:c,
filter:t});else{this._loadInProgress=!0;var r=f.get({url:k.url,handleAs:"text",preventCache:k.urlPreventCache});r.addCallback(function(b){try{k._processData(b),t(c,k._arrayOfAllItems),k._handleQueuedFetches()}catch(g){p(g,c)}});r.addErrback(function(b){k._loadInProgress=!1;if(p)p(b,c);else throw b;});var w=null;c.abort&&(w=c.abort);c.abort=function(){var b=r;b&&-1===b.fired&&(b.cancel(),b=null);w&&w.call(c)}}else if(this._csvData)try{this._processData(this._csvData),this._csvData=null,t(c,this._arrayOfAllItems)}catch(l){p(l,
c)}else{var b=Error(this.declaredClass+": No CSV source data was provided as either URL or String data input.");if(p)p(b,c);else throw b;}},close:function(c){},_getArrayOfArraysFromCsvFileContents:function(c){if(v.isString(c)){var f=/^\s+/g,k=/\s+$/g,h=/""/g,t=[],r=this._splitLines(c);for(c=0;c<r.length;++c){var w=r[c];if(0<w.length){for(var w=w.split(this.separator),b=0;b<w.length;){var l=w[b].replace(f,""),g=l.replace(k,""),d=g.charAt(0),a=g.charAt(g.length-1),e=g.charAt(g.length-2),q=g.charAt(g.length-
3);if(2===g.length&&'""'==g)w[b]="";else if('"'==d&&('"'!=a||'"'==a&&'"'==e&&'"'!=q)){if(b+1===w.length)return;w[b]=l+this.separator+w[b+1];w.splice(b+1,1)}else'"'==d&&'"'==a&&(g=g.slice(1,g.length-1),g=g.replace(h,'"')),w[b]=g,b+=1}t.push(w)}}this._attributes=t.shift();for(c=0;c<this._attributes.length;c++)this._attributeIndexes[this._attributes[c]]=c;this._dataArray=t}},_splitLines:function(c){var f=[],k,h="",t=!1;for(k=0;k<c.length;k++){var r=c.charAt(k);switch(r){case '"':t=!t;h+=r;break;case "\r":t?
h+=r:(f.push(h),h="",k<c.length-1&&"\n"==c.charAt(k+1)&&k++);break;case "\n":t?h+=r:(f.push(h),h="");break;default:h+=r}}""!==h&&f.push(h);return f},_processData:function(c){this._getArrayOfArraysFromCsvFileContents(c);this._arrayOfAllItems=[];if(this.identifier&&void 0===this._attributeIndexes[this.identifier])throw Error(this.declaredClass+": Identity specified is not a column header in the data set.");for(c=0;c<this._dataArray.length;c++){var f=c;this.identifier&&(f=this._dataArray[c][this._attributeIndexes[this.identifier]],
this._idMap[f]=c);this._arrayOfAllItems.push(this._createItemFromIdentity(f))}this._loadFinished=!0;this._loadInProgress=!1},_createItemFromIdentity:function(c){var f={};f[this._storeProp]=this;f[this._idProp]=c;return f},getIdentity:function(c){return this.isItem(c)?c[this._idProp]:null},fetchItemByIdentity:function(c){var k,p=c.scope?c.scope:h.global;if(this._loadFinished)k=this._createItemFromIdentity(c.identity),this.isItem(k)||(k=null),c.onItem&&c.onItem.call(p,k);else{var n=this;if(""!==this.url)this._loadInProgress?
this._queuedFetches.push({args:c}):(this._loadInProgress=!0,k=f.get({url:n.url,handleAs:"text"}),k.addCallback(function(f){try{n._processData(f);var r=n._createItemFromIdentity(c.identity);n.isItem(r)||(r=null);c.onItem&&c.onItem.call(p,r);n._handleQueuedFetches()}catch(w){c.onError&&c.onError.call(p,w)}}),k.addErrback(function(f){this._loadInProgress=!1;c.onError&&c.onError.call(p,f)}));else if(this._csvData)try{n._processData(n._csvData),n._csvData=null,k=n._createItemFromIdentity(c.identity),n.isItem(k)||
(k=null),c.onItem&&c.onItem.call(p,k)}catch(t){c.onError&&c.onError.call(p,t)}}},getIdentityAttributes:function(c){return this.identifier?[this.identifier]:null},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var c=0;c<this._queuedFetches.length;c++){var f=this._queuedFetches[c],h=f.filter,n=f.args;h?h(n,this._arrayOfAllItems):this.fetchItemByIdentity(f.args)}this._queuedFetches=[]}}});v.extend(c,u);return c})},"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),
function(v,c,f,h,n,u,k,x,p,B,t){v=v(B,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(f){this._geocodeHandler=c.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=c.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=c.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},
outSpatialReference:null,setOutSpatialReference:function(c){this.outSpatialReference=c},_geocodeHandler:function(c,f,b,l,g){try{var d=c.candidates,a;f=[];var e,q=d.length,y=c.spatialReference,z;for(e=0;e<q;e++){a=d[e];if(z=a.location)z.spatialReference=y;f[e]=new t(a)}this._successHandler([f],"onAddressToLocationsComplete",b,g)}catch(A){this._errorHandler(A,l,g)}},_geocodeAddressesHandler:function(c,f,b,l,g){try{var d=c.locations;f=[];var a,e=d.length,q=c.spatialReference,y;for(a=0;a<e;a++){if(y=
d[a].location)y.spatialReference=q;f[a]=new t(d[a])}this._successHandler([f],"onAddressesToLocationsComplete",b,g)}catch(z){this._errorHandler(z,l,g)}},addressToLocations:function(f,k,b,l,g){var d,a,e,q,y,z,A,D;f.address&&(l=b,b=k,k=f.outFields,g=f.searchExtent,D=f.countryCode,d=f.magicKey,a=f.distance,A=f.categories,f.location&&this.normalization&&(e=f.location.normalize()),q=f.locationType,y=f.maxLocations,z=f.forStorage,f=f.address);g&&(g=g.shiftCentralMeridian());var m=this.outSpatialReference;
f=this._encode(c.mixin({},this._url.query,f,{f:"json",outSR:m&&n.toJson(m.toJson()),outFields:k&&k.join(",")||null,searchExtent:g&&n.toJson(g.toJson()),category:A&&A.join(",")||null,countryCode:D||null,magicKey:d||null,distance:a||null,location:e||null,locationType:q||null,maxLocations:y||null,forStorage:z||null}));var E=this._geocodeHandler,C=this._errorHandler,F=new h(p._dfdCanceller);F._pendingDfd=x({url:this._url.path+"/findAddressCandidates",content:f,callbackParamName:"callback",load:function(a,
e){E(a,e,b,l,F)},error:function(a){C(a,l,F)}});return F},suggestLocations:function(f){var r;r=new h(p._dfdCanceller);f.hasOwnProperty("location")&&this.normalization&&(f.location=f.location.normalize());f.searchExtent&&(f.searchExtent=f.searchExtent.shiftCentralMeridian());f=this._encode(c.mixin({},this._url.query,{f:"json",text:f.text,maxSuggestions:f.maxSuggestions,searchExtent:f.searchExtent&&n.toJson(f.searchExtent.toJson()),category:f.categories&&f.categories.join(",")||null,countryCode:f.countryCode||
null,location:f.location||null,distance:f.distance||null},{f:"json"}));f=x({url:this._url.path+"/suggest",content:f,callbackParamName:"callback"});r._pendingDfd=f;f.then(c.hitch(this,function(b){b=b.suggestions||[];this.onSuggestLocationsComplete(b);r.resolve(b)}),c.hitch(this,function(b){this._errorHandler(b);r.reject(b)}));return r},addressesToLocations:function(r,k,b){var l=this.outSpatialReference,g=[],d=r.categories,a=r.locationType,e=r.countryCode;f.forEach(r.addresses,function(a,b){g.push({attributes:a})});
r=this._encode(c.mixin({},this._url.query,{category:d&&d.join(",")||null,locationType:a||null,sourceCountry:e||null},{addresses:n.toJson({records:g})},{f:"json",outSR:l&&n.toJson(l.toJson())}));var q=this._geocodeAddressesHandler,y=this._errorHandler,z=new h(p._dfdCanceller);z._pendingDfd=x({url:this._url.path+"/geocodeAddresses",content:r,callbackParamName:"callback",load:function(a,e){q(a,e,k,b,z)},error:function(a){y(a,b,z)}});return z},_reverseGeocodeHandler:function(c,f,b,l,g){try{var d=new t({address:c.address,
location:c.location,score:100});this._successHandler([d],"onLocationToAddressComplete",b,g)}catch(a){this._errorHandler(a,l,g)}},locationToAddress:function(f,k,b,l){f&&this.normalization&&(f=f.normalize());var g=this.outSpatialReference;f=this._encode(c.mixin({},this._url.query,{outSR:g&&n.toJson(g.toJson()),location:f&&n.toJson(f.toJson()),distance:k,f:"json"}));var d=this._reverseGeocodeHandler,a=this._errorHandler,e=new h(p._dfdCanceller);e._pendingDfd=x({url:this._url.path+"/reverseGeocode",content:f,
callbackParamName:"callback",load:function(a,g){d(a,g,b,l,e)},error:function(b){a(b,l,e)}});return e},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}});u("extend-esri")&&c.setObject("tasks.Locator",v,k);return v})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(v,c,f,h,n){v=v(null,{declaredClass:"esri.tasks.AddressCandidate",
constructor:function(f){c.mixin(this,f);this.location=new n(this.location)}});f("extend-esri")&&c.setObject("tasks.AddressCandidate",v,h);return v})},"widgets/DataAggregation/js/UI/Addresses":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/Deferred dojo/on dojo/query dojo/keys dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/Addresses.html jimu/dijit/formSelect dijit/form/RadioButton".split(" "),
function(v,c,f,h,n,u,k,x,p,B,t,r,w,b,l){return v([B,t,r,w],{baseClass:"cf-addresses",declaredClass:"CriticalFacilities.Addresses",templateString:b,_started:null,label:"Addresses",parent:null,nls:null,map:null,appConfig:null,config:null,singleFields:[],multiFields:[],fields:[],useSingle:!0,useMulti:!1,theme:"",styleColor:"",singleEnabled:!1,multiEnabled:!1,constructor:function(b){c.mixin(this,b)},postCreate:function(){this.inherited(arguments);this._initControls()},startup:function(){this._started=
!0;this._updateAltIndexes()},onShown:function(){this.pageContainer.nextDisabled=!1;this.prevResult=this._getResults()},validate:function(b,d){var a=new u;"next-view"===b?a.resolve(this._nextView(d)):"back-view"===b?a.resolve(this._backView(d)):this._homeView(d).then(function(b){a.resolve(b)});return a},_updateAltIndexes:function(){this.pageContainer&&!this._startPageView&&(this._startPageView=this.pageContainer.getViewByTitle("StartPage"),this._locationTypeView=this.pageContainer.getViewByTitle("LocationType"),
this._startPageView&&this._locationTypeView?(this.altNextIndex=this._startPageView.index,this.altBackIndex=this._locationTypeView.index):this._startPageView&&(this.altBackIndex=this.altNextIndex=this._startPageView.index))},_nextView:function(b){if(b.currentView.label===this.label){b=this._getResults();var d=!1;f.forEach(b.fields,function(a){"undefined"!==typeof a.value&&null!==a.value&&""!==a.value&&(d=!0)});this.parent._locationMappingComplete=d;this.emit("location-mapping-update",d)}return!0},
_backView:function(b){if(b.currentView.label===this.label){var d=!1;this._setPreviousResult(this.prevResult?this.prevResult.mappedArrayFields:{});this.prevResult&&(b=this.prevResult,d=!1,f.forEach(b.fields,function(a){"undefined"!==typeof a.value&&null!==a.value&&""!==a.value&&(d=!0)}));this.parent._locationMappingComplete=d;this.emit("location-mapping-update",d)}return!0},_homeView:function(b){var d=new u;this.pageContainer.getViewByTitle("Home").verifyClearSettings(b).then(function(a){d.resolve(a)});
return d},_rdoSingleAddressClick:function(){this.rdoSingleAddress.set("checked",!0)},_rdoSingleAddressChanged:function(b){this.useSingle=b;this._toggleVisibility(this.singleFieldTable,b);this.useSingle&&this.parent.updateFirstLastNode(!1)},_rdoMultiAddressClick:function(){this.rdoMultiAddress.set("checked",!0)},_rdoMultiAddressChanged:function(b){this.useMulti=b;this._toggleVisibility(this.multiFieldTable,b);this.useMulti&&this.parent.updateFirstLastNode(!1)},_toggleVisibility:function(b,d){var a=
d?"display-table-row-group":"display-none";n.contains(b,a)||n.add(b,a);a=d?"display-none":"display-table-row-group";n.contains(b,a)&&n.remove(b,a);d&&(this.lastFocusNode=x(".lastNode",b)[0])},_initControls:function(){this.own(k(this.rdoSingleAddress,"change",c.hitch(this,this._rdoSingleAddressChanged)));this.own(k(this.rdoMultiAddress,"change",c.hitch(this,this._rdoMultiAddressChanged)));var b=this.singleEnabled,d=this.multiEnabled;b&&d?(this.rdoSingleAddress.set("checked",this.useSingle),this._toggleVisibility(this.singleFieldTable,
this.useSingle),this.rdoMultiAddress.set("checked",this.useMulti),this._toggleVisibility(this.multiFieldTable,this.useMulti),this._setFields(this.singleFields,this.fields,this.singleFieldTable),this._setFields(this.multiFields,this.fields,this.multiFieldTable),n.contains(this.singleSubTaskHintTr,"bottom-border-bold")&&n.remove(this.singleSubTaskHintTr,"bottom-border-bold"),n.add(this.singleSubTaskHintTr,"bottom-border")):b?(this.useSingle=!0,this.useMulti=!1,this._setFields(this.singleFields,this.fields,
this.singleFieldTable),this._initTableDisplay([this.multiAddressRow,this.mainInstructionRow,this.singleRadioRow],[this.singleFieldHintTd,this.singleFieldTableRow],[],[this.singleSubTaskHintTd])):d&&(this.useMulti=!0,this.useSingle=!1,this._setFields(this.multiFields,this.fields,this.multiFieldTable),this._initTableDisplay([this.singleAddressRow,this.mainInstructionRow,this.multiRadioRow],[this.multiFieldHintTd,this.multiFieldTableRow],[],[this.multiSubTaskHintTd]))},_initTableDisplay:function(b,d,
a,e){f.forEach(b,c.hitch(this,function(a){this._toggleVisibility(a,!1)}));f.forEach(d,c.hitch(this,function(a){n.add(a,"no-padding")}));f.forEach(a,c.hitch(this,function(a){n.add(a,"pad-bottom-10")}));f.forEach(e,function(a){n.contains(a,"pad-left-20")&&n.remove(a,"pad-left-20");n.add(a,"pad-left-5")})},_setFields:function(b,d,a){var e=0;f.forEach(b,c.hitch(this,function(c,g){var q=h.create("tr",{},a);q.keyField=c.value;q.label=c.label;var A=h.create("td",{className:"field-control-td pad-left-15"},
q);h.create("div",{className:"main-text float-left min-width-80",innerHTML:c.label},A);var A=h.create("td",{className:"field-control-td"},q),y=new l({name:"field"+e,fieldName:c.label,className:"field-control","aria-label":c.label});g===b.length-1&&(n.add(y.domNode,"lastNode"),this.lastFocusNode=y.domNode,this.parent.updateFirstLastNode(!1));var m=[{label:this.nls.warningsAndErrors.noValue,value:this.nls.warningsAndErrors.noValue}],E=this._getDefaultFieldName(d,c);f.forEach(d,function(a){m.push({label:a.label,
value:a.value,selected:a.value===E})});y.addOption(m);y.placeAt(A);y.startup();q.fieldControl=y;e+=1;1<b.length&&n.add(q,"bottom-border")}))},_getDefaultFieldName:function(b,d){d=d.isRecognizedValues;for(var a=0;a<d.length;a++)for(var e=d[a],c=0;c<b.length;c++){var g=b[c];if(g.value.toString().toUpperCase()===e.toString().toUpperCase())return g.value}},setStyleColor:function(b){this.styleColor=b},updateImageNodes:function(){},_getResults:function(){var b=[],d={},a=this.nls.warningsAndErrors.noValue;
f.forEach((this.useSingle?this.singleFieldTable:this.multiFieldTable).rows,function(e){var c=e.fieldControl.get("value"),g=e.label;e=e.keyField;c!==a?(b.push({keyField:e,value:c,label:g}),d[e]=c):(b.push({keyField:e,value:void 0,label:g}),d[e]=void 0)});return{type:this.useSingle?"single":"multi",fields:b,mappedArrayFields:d}},_setPreviousResult:function(b){var d=this.nls.warningsAndErrors.noValue;f.forEach((this.useSingle?this.singleFieldTable:this.multiFieldTable).rows,function(a){var e=d,c=a.keyField;
b.hasOwnProperty(c)&&(e=b[c],void 0===e&&(e=d));a.fieldControl.set("value",e)})}})})},"widgets/DataAggregation/js/UI/Coordinates":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/dom-construct dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/Coordinates.html dojo/_base/array jimu/dijit/formSelect".split(" "),function(v,c,f,h,n,u,k,x,p,B,t){return v([n,u,k,x],{baseClass:"cf-coordinates",declaredClass:"CriticalFacilities.Coordinates",
templateString:p,_started:null,label:"Coordinates",parent:null,nls:null,map:null,appConfig:null,config:null,fields:[],xField:null,yField:null,theme:"",styleColor:"",firstField:"",constructor:function(f){c.mixin(this,f)},postCreate:function(){this.inherited(arguments);this._initUI()},_initUI:function(){"X"===this.firstField?(this._initXField(),this._initYField()):(this._initYField(),this._initXField());this._setFields(this.fields,this.xField,this.yField)},_initXField:function(){var c=this._initSelectTd(this.xField.label+
":");this.lblX=c.label;this.selectX=new t({name:"selectX",style:"min-width: 200px","aria-label":this.xField.label});this.selectX.placeAt(c.select);this.selectX.startup()},_initYField:function(){var c=this._initSelectTd(this.yField.label+":");this.lblY=c.label;this.selectY=new t({name:"selectY",style:"min-width: 200px","aria-label":this.yField.label});this.selectY.placeAt(c.select);this.selectY.startup();this.lastFocusNode=this.selectY.domNode},_initSelectTd:function(c){var f=h.create("tr",{className:"bottom-border"},
this.coordinateTable),b=h.create("td",{className:"field-control-td pad-left-10"},f),b=h.create("div",{className:"main-text float-left"},b);b.innerHTML=c;return{select:h.create("td",{className:"float-right field-control-td"},f),label:b}},startup:function(){this._started=!0;this._updateAltIndexes()},onShown:function(){this.pageContainer.nextDisabled=!1;this.prevResult=this._getResults()},validate:function(c,h){var b=new f;"next-view"===c?b.resolve(this._nextView(h)):"back-view"===c?b.resolve(this._backView(h)):
this._homeView(h).then(function(c){b.resolve(c)});return b},_updateAltIndexes:function(){this.pageContainer&&!this._startPageView&&(this._startPageView=this.pageContainer.getViewByTitle("StartPage"),this._locationTypeView=this.pageContainer.getViewByTitle("LocationType"),this._startPageView&&this._locationTypeView?(this.altNextIndex=this._startPageView.index,this.altBackIndex=this._locationTypeView.index):this._startPageView&&(this.altBackIndex=this.altNextIndex=this._startPageView.index))},_nextView:function(c){c.currentView.label===
this.label&&(c=0<this._getResults().fields.length,this.parent._locationMappingComplete=c,this.emit("location-mapping-update",c));return!0},_backView:function(c){c.currentView.label===this.label&&(c=!1,this._setPreviousResult(this.prevResult?this.prevResult.fields:[]),this.prevResult&&(c=0<this.prevResult.fields.length),this.parent._locationMappingComplete=c,this.emit("location-mapping-update",c));return!0},_homeView:function(c){var h=new f;this.pageContainer.getViewByTitle("Home").verifyClearSettings(c).then(function(b){h.resolve(b)});
return h},_setFields:function(c,f,b){var l=this._getDefaultFieldName(c,f),g=this._getDefaultFieldName(c,b),d=[{label:this.nls.warningsAndErrors.noValue,value:this.nls.warningsAndErrors.noValue}],a=[{label:this.nls.warningsAndErrors.noValue,value:this.nls.warningsAndErrors.noValue}];B.forEach(c,function(b){d.push({label:b.label,value:b.value,selected:l===b.value});a.push({label:b.label,value:b.value,selected:g===b.value})});this.selectX.addOption(d);this.selectY.addOption(a)},_getDefaultFieldName:function(c,
f){f=f.isRecognizedValues;for(var b=0;b<f.length;b++)for(var l=f[b],g=0;g<c.length;g++){var d=c[g];if(d.value.toString().toUpperCase()===l.toString().toUpperCase())return d.value}},setStyleColor:function(c){this.styleColor=c},updateImageNodes:function(){},_getResults:function(){return{type:"xy",fields:this.selectX.value!==this.nls.warningsAndErrors.noValue&&this.selectY.value!==this.nls.warningsAndErrors.noValue?[{targetField:"X",sourceField:this.selectX.value},{targetField:"Y",sourceField:this.selectY.value}]:
[]}},_setPreviousResult:function(c){if(0===c.length){c=this._getDefaultFieldName(this.fields,this.xField);var f=this._getDefaultFieldName(this.fields,this.yField);c=[{targetField:"X",sourceField:c},{targetField:"Y",sourceField:f}]}B.forEach(c,function(b){var c=b.sourceField;void 0===c&&(c=this.nls.warningsAndErrors.noValue);b=b.targetField;"X"===b?this.selectX.set("value",c):"Y"===b&&this.selectY.set("value",c)},this)}})})},"widgets/DataAggregation/js/UI/FieldMapping":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/FieldMapping.html jimu/dijit/SimpleTable jimu/dijit/formSelect".split(" "),
function(v,c,f,h,n,u,k,x,p,B,t,r,w){return v([k,x,p,B],{baseClass:"cf-field-mapping",declaredClass:"CriticalFacilities.FieldMapping",templateString:t,_started:null,label:"FieldMapping",parent:null,nls:null,map:null,appConfig:null,config:null,targetFields:[],sourceFields:[],_fieldsTable:null,theme:"",styleColor:"",constructor:function(b){c.mixin(this,b)},postCreate:function(){this.inherited(arguments);this._initFieldsTable();this._initFields(this.targetFields)},startup:function(){this._started=!0;
this._updateAltIndexes()},targetLayerUpdate:function(b,c){this._fieldsTable.clear();this.parent._fieldMappingComplete=!1;this.emit("field-mapping-update",!1);this.targetFields=b;this.sourceFields=c;this._initFields(this.targetFields)},onShown:function(){this.pageContainer.nextDisabled=!1;this.prevResult=this._getResults()},_updateAltIndexes:function(){this.pageContainer&&!this._startPageView&&(this._startPageView=this.pageContainer.getViewByTitle("StartPage"))&&(this.altBackIndex=this.altNextIndex=
this._startPageView.index)},validate:function(b,c){var g=new u;"next-view"===b?g.resolve(this._nextView(c)):"back-view"===b?g.resolve(this._backView(c)):this._homeView(c).then(function(b){g.resolve(b)});return g},_nextView:function(b){if(b.currentView.label===this.label){var c=this._getResults(),g=!1;b=Object.keys(c.results).map(function(b){return c.results[b]});f.forEach(b,function(b){"undefined"!==typeof b&&null!==b&&""!==b&&(g=!0)});this.parent._fieldMappingComplete=g;this.emit("field-mapping-update",
g,c.results)}return!0},_backView:function(b){if(b.currentView.label===this.label){var c=!1;this._setPreviousResult(this.prevResult?this.prevResult.results:{});if(this.prevResult){var g=this.prevResult;b=Object.keys(g.results).map(function(b){return g.results[b]});f.forEach(b,function(b){"undefined"!==typeof b&&null!==b&&""!==b&&(c=!0)})}this.parent._fieldMappingComplete=c;this.emit("field-mapping-update",c)}return!0},_homeView:function(b){var c=new u;this.pageContainer.getViewByTitle("Home").verifyClearSettings(b).then(function(b){c.resolve(b)});
return c},_initFieldsTable:function(){var b=[{name:"targetField",type:"extension",hidden:!0,create:c.hitch(this,this._createTargetField),setValue:c.hitch(this,this._setTargetFieldValue),getValue:c.hitch(this,this._getTargetFieldValue)},{name:"target",title:this.nls.fieldMapping.targetField,type:"text","class":"task-instruction-row"},{name:"label",title:this.nls.fieldMapping.sourceField,type:"extension",hidden:!1,create:c.hitch(this,this._createSelect),setValue:c.hitch(this,this._setSelectValue),getValue:c.hitch(this,
this._getSelectValue)}];this._fieldsTable=new r({fields:b,selectable:!1,autoHeight:!0,_rowHeight:"LaunchpadTheme"===this.appConfig.theme.name?36:30});this._fieldsTable.placeAt(this.fieldMappingTable);this._fieldsTable.startup()},_setTargetFieldValue:function(b,c){b.targetField=c},_getTargetFieldValue:function(b){return b.targetField},_createSelect:function(b){var c=b.parentNode.cells[0].targetField,g=new w({style:{display:"table",width:"100%",height:"28px"},"aria-label":c.label}),d=this._getSupportedFields(this.sourceFields,
c.type,c.length),a=[{label:this.nls.warningsAndErrors.noValue,value:this.nls.warningsAndErrors.noValue}],e=this._getDefaultFieldName(d,c);f.forEach(d,function(b){a.push({label:b.label,value:b.value,selected:e===b.value})});g.addOption(a);b.fieldsSelect=g;h.place(g.domNode,b);n.add(b,"float-left");n.add(b,"width-all");this.lastFieldSelect=g.domNode},_getSelectValue:function(b){return b.fieldsSelect.get("value")},_setSelectValue:function(b,c){b.fieldsSelect.set("value",c)},_initFields:function(b){f.forEach(b,
c.hitch(this,function(b){this._fieldsTable.addRow({target:b.label,targetField:b})}))},_getSupportedFields:function(b,c,g){return b.filter(function(b){if(b.type){var a=b.type.supportsInt,e=b.type.supportsFloat,d=b.type.supportsDate;b=b.type.maxLength;return"date"!==c&&b>g?!1:"other"===c||"domain"===c?!0:"int"===c||"domainInt"===c?a:"float"===c?e:"date"===c?d:!1}return!1})},_getDefaultFieldName:function(b,c){c=c.isRecognizedValues;for(var g=0;g<c.length;g++)for(var d=c[g],a=0;a<b.length;a++){var e=
b[a];if(e.value.toString().toUpperCase()===d.toString().toUpperCase())return e.value}},setStyleColor:function(b){this.styleColor=b},updateImageNodes:function(){},_getResults:function(){var b=this._fieldsTable.getRows(),c={},g=this.nls.warningsAndErrors.noValue,d=!1,a;f.forEach(b,function(b){var e=b.cells[2].fieldsSelect.getValue();e!==g?(b=b.cells[0].targetField.name,c[b]=e,d||(a=b,d=!0)):c[b.cells[0].targetField.name]=void 0});return{results:c,labelField:a}},_setPreviousResult:function(b){var c=
this._fieldsTable.getRows(),g=this.nls.warningsAndErrors.noValue;f.forEach(c,function(c){var a=g,e=c.cells[0].targetField.name;b.hasOwnProperty(e)&&(a=b[e],void 0===a&&(a=g));c.cells[2].fieldsSelect.set("value",a)})}})})},"widgets/DataAggregation/js/UI/StartPage":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/on dojo/Deferred dojo/keys dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/StartPage.html dojo/dom-class dojo/query esri/lang ./Review jimu/LayerInfos/LayerInfos jimu/utils jimu/dijit/formSelect".split(" "),
function(v,c,f,h,n,u,k,x,p,B,t,r,w,b,l,g,d){return v([k,x,p,B],{baseClass:"cf-startpage",declaredClass:"CriticalFacilities.StartPage",templateString:t,_started:null,label:"StartPage",parent:null,nls:null,map:null,appConfig:null,config:null,theme:"",styleColor:"",state:"mapping",csvStore:null,_syncFields:{},singleEnabled:!1,multiEnabled:!1,xyEnabled:!1,constructor:function(a){c.mixin(this,a)},postCreate:function(){this.inherited(arguments);g.getInstance(this.map,this.map.itemInfo).then(c.hitch(this,
function(a){this.operLayerInfos=a;this.populateTargetLayerSelector();this.own(h(this.targetLayerSelector,"change",c.hitch(this,function(a){this.emit("targetLayerChanged",a)})))}))},startup:function(){this._started=!0;this.pageContainer.backDisabled=0<this.pageContainer._backLabels.length?!1:!0;this.updateImageNodes();this.lastFocusNode=this.fieldMappingRow},populateTargetLayerSelector:function(){var a=this.config.layerSettings,b=[];a&&a.layerInfo&&a.layerInfo.featureLayer&&(a=[a]);for(var c=0;c<a.length;c++){var d;
a[c]&&a[c].layerInfo&&a[c].layerInfo.featureLayer&&(d=this.operLayerInfos.getLayerInfoById(a[c].layerInfo.featureLayer.id));d&&d.layerObject.isEditable()&&b.push({label:d.title,value:d.id})}this.targetLayerSelector.set("options",b);0<b.length&&this.targetLayerSelector.set("value",b[0].value)},onShown:function(){this._initDependencies();this._validateStatus();this.pageContainer.backDisabled=0<this.pageContainer._backLabels.length?!1:!0},setStyleColor:function(a){this.styleColor=a},updateImageNodes:function(){if(this.pageContainer){var a=
this.pageContainer.isDarkTheme,b=a?"next-arrow-img":"next-arrow-img-white",c=a?"next-arrow-img-white":"next-arrow-img",a=w("."+b,this.domNode);f.forEach(a,function(a){r.remove(a,b);r.add(a,c)})}},validate:function(a,b){var c=new n;"next-view"===a?c.resolve(this._nextView(b)):"back-view"===a?c.resolve(this._backView()):"home-view"===a&&this._homeView(b).then(function(a){c.resolve(a)});return c},_nextView:function(a){a.navView.label===this.label&&this.pageContainer.toggleController(!1);if(this.parent._locationMappingComplete&&
this.parent._fieldMappingComplete)return this.nextDisabled=!0,!1;this.pageContainer.backDisabled=!1;return!0},_backView:function(){return 0<this.pageContainer._backLabels.length},_homeView:function(a){var b=new n;this.pageContainer.getViewByTitle("Home").verifyClearSettings(a).then(function(a){b.resolve(a)});return b},_locationMappingClick:function(a){if("keydown"!==a.type||a.keyCode===u.ENTER||a.keyCode===u.SPACE)this._validateStatus(),this._setViewByTitle(this.xyEnabled&&(this.multiEnabled||this.singleEnabled)?
"LocationType":this.xyEnabled?"Coordinates":"Addresses")},_schemaMappingClick:function(a){if("keydown"!==a.type||a.keyCode===u.ENTER||a.keyCode===u.SPACE)this._validateStatus(),this._setViewByTitle("FieldMapping")},_setViewByTitle:function(a){a=this.pageContainer.getViewByTitle(a);this.pageContainer.selectView(a.index)},_initDependencies:function(){if(this.pageContainer&&!this._coordinatesView&&!this._addressView&&!this._fieldMappingView){this.xyEnabled&&(this._coordinatesView=this.pageContainer.getViewByTitle("Coordinates"),
this.own(h(this._coordinatesView,"location-mapping-update",c.hitch(this,function(a){this.parent._locationMappingComplete=a;this._validateStatus()}))));if(this.singleEnabled||this.multiEnabled)this._addressView=this.pageContainer.getViewByTitle("Addresses"),this.own(h(this._addressView,"location-mapping-update",c.hitch(this,function(a){this.parent._locationMappingComplete=a;this._validateStatus()})));this._fieldMappingView=this.pageContainer.getViewByTitle("FieldMapping");this.own(h(this._fieldMappingView,
"field-mapping-update",c.hitch(this,function(a){this.parent._fieldMappingComplete=a;this._validateStatus()})));(this._locationTypeView=this.xyEnabled&&(this.singleEnabled||this.multiEnabled)?this.pageContainer.getViewByTitle("LocationType"):this.xyEnabled?this._coordinatesView:this._addressView)&&!this.parent._locationMappingComplete&&(this.altNextIndex=this._locationTypeView.index)}},_updateDoneStatus:function(a,b){b?(r.remove(a,"jimu-icon jimu-icon-error incomplete-mark"),r.add(a,"done-mark")):
(r.add(a,"jimu-icon jimu-icon-error incomplete-mark"),r.remove(a,"done-mark"))},_validateStatus:function(){this._updateDoneStatus(this.locationMappingComplete,this.parent._locationMappingComplete);this._updateDoneStatus(this.fieldMappingComplete,this.parent._fieldMappingComplete);var a=this.pageContainer.backDisabled=!1;this.parent._locationMappingComplete&&this.parent._fieldMappingComplete&&"mapping"===this.state?(a=!0,this.pageContainer.nextDisabled=!0):!this.parent._locationMappingComplete&&this._locationTypeView?
this.altNextIndex=this._locationTypeView.index:!this.parent._fieldMappingComplete&&this._fieldMappingView&&(this.altNextIndex=this._fieldMappingView.index);a||(this.pageContainer.nextDisabled=!1);this._updateNode(this.addToMapButton,a);this.lastFocusNode=a?this.addToMapButton:this.fieldMappingRow},_updateNode:function(a,b){b?r.contains(a,"display-none")&&r.remove(a,"display-none"):r.contains(a,"display-none")||r.add(a,"display-none")},_addToMapClick:function(a){if("keydown"!==a.type||a.keyCode===
u.ENTER||a.keyCode===u.SPACE){this._updateNode(this.addToMapButton,!1);this._updateNode(this.progressNode,!0);a=this._fieldMappingView._getResults();var b=this._locationTypeView._getResults();this._syncFields=this._checkFields(a.results,b);this._locateFeatures(a,b)}},_checkFields:function(a,b){var c={};b&&b.fields&&f.forEach(b.fields,function(b){var e=b.value?b.value:b.sourceField;b=b.keyField?b.keyField:b.sourceField;if("undefined"!==typeof e&&"undefined"!==typeof b&&!c.hasOwnProperty(e)&&a)for(var d=
Object.keys(a),g=0;g<d.length;g++)if(a[d[g]]===e){c[b]={layerFieldName:d[g]};break}});return c},_locateFeatures:function(a,b){this.csvStore.useMultiFields="multi"===b.type?!0:!1;this.csvStore.mappedArrayFields=a.results;this.csvStore.labelField=a.labelField;if("single"===b.type)this.csvStore.addrFieldName=b.fields[0].keyField,this.csvStore.singleFields=b.fields;else if("multi"===b.type)this.csvStore.multiFields=b.fields;else if("xy"===b.type){this.csvStore.useAddr=!1;var d=b.fields[0];b=b.fields[1];
this.csvStore.xFieldName="X"===d.targetField?d.sourceField:b.sourceField;this.csvStore.yFieldName="Y"===b.targetField?b.sourceField:d.sourceField}this.csvStore.processForm().then(c.hitch(this,function(b){this._addResultView({matchedFeatures:this._formatFeatures(b.matchedLayer,a.labelField),matchedLayer:b.matchedLayer,unMatchedFeatures:this._formatFeatures(b.unMatchedLayer,a.labelField),unMatchedLayer:b.unMatchedLayer,duplicateFeatures:this._formatFeatures(b.duplicateLayer,a.labelField,b.duplicateLookupList),
duplicateLayer:b.duplicateLayer});this.state="review";this._reviewView=this.pageContainer.getViewByTitle("Review");this.pageContainer.nextDisabled=!1;this.pageContainer.backDisabled=!0;this.pageContainer._backLabels=[];this.pageContainer.altHomeIndex=this._reviewView.index;this._updateNode(this.progressNode,!1);this.pageContainer.selectView(this._reviewView.index,!0);this.pageContainer._backLabels=[]}),c.hitch(this,function(a){console.log(a);this._updateNode(this.progressNode,!1);this._updateNode(this.addToMapButton,
!0)}))},_formatFeatures:function(a,b,g){var e=[];if(a){var q=a.objectIdField;this._currentFields=a.fields;f.forEach(a.graphics,c.hitch(this,function(a){var A=[],m;g&&(m=g[a.attributes[q]]);f.forEach(Object.keys(a.attributes),c.hitch(this,function(b){var c=this._currentFields.filter(function(a){return a.name===b}),e=a.attributes[b],C=!1;"."!==this.csvStore.decimalSeperator&&(C=c&&c.hasOwnProperty("length")&&1===c.length&&c[0].hasOwnProperty("type")&&"esriFieldTypeDouble"===c[0].type)&&(e=-1===[null,
void 0,""].indexOf(e)?e.toString().replace(this.csvStore.decimalSeperator,"."):e);c={name:b,label:c&&c.hasOwnProperty("length")&&1===c.length&&c[0].alias?c[0].alias:b,formattedValue:C&&-1===[null,void 0].indexOf(e)?d.localizeNumber(e):e,value:e,needsFormat:C};m&&(c.duplicateFieldInfo={value:m[b]});A.push(c)}));var E=A.filter(function(a){return a.name===b&&a.needsFormat});e.push({label:E&&E.hasOwnProperty("length")&&1===E.length?E[0].formattedValue:a.attributes[b],fieldInfo:A,geometry:a.geometry,address:""})}))}return e},
_addResultView:function(a){var b=new l({nls:this.nls,map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,matchedList:a.matchedFeatures,unMatchedList:a.unMatchedFeatures,duplicateList:a.duplicateFeatures,theme:this.theme,csvStore:this.csvStore,editLayer:this.parent.editLayer,matchedLayer:a.matchedLayer,unMatchedLayer:a.unMatchedLayer,duplicateLayer:a.duplicateLayer,duplicateLookupList:a.duplicateLookupList,_syncFields:this._syncFields});this.pageContainer.addView(b);this._zoomToAllFeatures([a.matchedLayer,
a.unMatchedLayer,a.duplicateLayer])},_zoomToAllFeatures:function(a){var b=[];f.forEach(a,function(a){if(a&&a.graphics)for(var c=0;c<a.graphics.length;c++)b.push(a.graphics[c])});this.csvStore._zoomToData(b)}})})},"widgets/DataAggregation/js/UI/Review":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-class dojo/dom-attr dojo/dom-style dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/Deferred dojo/text!./templates/Review.html dojo/query dojo/on dojo/string dojo/keys ./FeatureList jimu/dijit/Message jimu/CSVUtils esri/toolbars/edit esri/lang esri/graphic".split(" "),
function(v,c,f,h,n,u,k,x,p,B,t,r,w,b,l,g,d,a,e,q,y,z){return v([k,x,p,B],{baseClass:"cf-review",declaredClass:"CriticalFacilities.Review",templateString:r,_started:null,label:"Review",parent:null,nls:null,map:null,appConfig:null,config:null,matchedList:[],unMatchedList:[],duplicateList:[],theme:"",styleColor:"",csvStore:null,editLayer:null,matchedLayer:null,unMatchedLayer:null,duplicateLayer:null,_editToolbar:null,_syncFields:{},_currentIndex:0,constructor:function(a){c.mixin(this,a)},postCreate:function(){this.inherited(arguments);
this._initReviewRows();this._editToolbar=new q(this.map);window.isRTL&&h.add(this.progressNode,"margin-right-15")},startup:function(){this._started=!0;this._initNavPages();this._updateIndexesList();this.updateImageNodes();this.altNextIndex=this.altNextIndexes[this._currentIndex];this._currentIndex=this._currentIndex+1<this.altNextIndexes.length?this._currentIndex+1:0;this.own(b(this.pageContainer,"nav-view",c.hitch(this,this._navView)))},onShown:function(){this.pageContainer.backDisabled=0<this.pageContainer._backLabels.length?
!1:!0},_navView:function(a){a===this.index&&(this._updateIndexesList(),this._currentIndex<this.altNextIndexes.length?(this.altNextIndex=this.altNextIndexes[this._currentIndex],this._currentIndex=this._currentIndex+1<this.altNextIndexes.length?this._currentIndex+1:0):(this._currentIndex=0,this.altNextIndex=this.altNextIndexes[this._currentIndex]))},validate:function(a,b){var c=new t;"next-view"===a?c.resolve(this._nextView()):"back-view"===a?c.resolve(this._backView(b)):this._homeView(b).then(function(a){c.resolve(a)});
return c},_nextView:function(){return!0},_backView:function(a){return 0<this.pageContainer._backLabels.length?!0:a.navView>this.index},_homeView:function(a){var b=new t;this.pageContainer.getViewByTitle("Home").verifyClearSettings(a).then(function(a){b.resolve(a)});return b},_updateIndexesList:function(){this.altNextIndexes=[];0<this.unMatchedList.length&&this.altNextIndexes.push(this._unMatchedListView.index);0<this.duplicateList.length&&this.altNextIndexes.push(this._duplicateListView.index);0<
this.matchedList.length&&this.altNextIndexes.push(this._matchedListView.index)},_initNavPages:function(){this.pageContainer&&(this._addMatchedFeaturesList(),0<this.unMatchedList.length&&this._addUnmatchedFeatureList(),0<this.duplicateList.length&&this._addDuplicateFeatureList());this.pageContainer.selectView(this.index,!0)},_addMatchedFeaturesList:function(){this.matchedFeatureList=this._initFeatureList(this.matchedList,this.matchedLayer,"MatchedFeatures",this.nls.review.reviewMatchedHint,this.nls.review.reviewMatched,
!1);this.pageContainer.addView(this.matchedFeatureList);this._updateNode(this.submitButton,0<this.matchedList.length);this._matchedListView=this.pageContainer.getViewByTitle(this.matchedFeatureList.label);this.own(b(this.matchedFeatureList,"feature-list-updated",c.hitch(this,function(a){this.matchedCount.innerHTML=a;this._initReviewRow(this.matchedList,[this.matchedHintRow,this.matchedControlRow],this.matchedCount,"matched");this._updateNode(this.submitButton,0<this.matchedList.length)})))},_addUnmatchedFeatureList:function(){this.unMatchedFeatureList=
this._initFeatureList(this.unMatchedList,this.unMatchedLayer,"UnMatchedFeatures",this.nls.review.reviewUnMatchedHint,this.nls.review.reviewUnMatched,!1);this.pageContainer.addView(this.unMatchedFeatureList);this._unMatchedListView=this.pageContainer.getViewByTitle(this.unMatchedFeatureList.label);this.own(b(this.unMatchedFeatureList,"feature-list-updated",c.hitch(this,function(a){this.unMatchedCount.innerHTML=a;0===a&&this.pageContainer.removeView(this._unMatchedListView)})))},_addDuplicateFeatureList:function(){var a=
y.substitute({layerName:this.editLayer.name},this.nls.review.reviewDuplicateHint);this.duplicateFeatureList=this._initFeatureList(this.duplicateList,this.duplicateLayer,"DuplicateFeatures",a,this.nls.review.reviewDuplicate,!0);this.pageContainer.addView(this.duplicateFeatureList);this._duplicateListView=this.pageContainer.getViewByTitle(this.duplicateFeatureList.label);this.own(b(this.duplicateFeatureList,"feature-list-updated",c.hitch(this,function(a){this.duplicateCount.innerHTML=a;0===a&&this.pageContainer.removeView(this._duplicateListView)})))},
_initFeatureList:function(a,b,c,e,C,g){return new d({nls:this.nls,map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,hint:e,_title:C,label:c,features:a,theme:this.theme,isDuplicate:g,layer:b,_editToolbar:this._editToolbar,csvStore:this.csvStore,_syncFields:this._syncFields})},_initReviewRows:function(){this._initReviewRow(this.matchedList,[this.matchedHintRow,this.matchedControlRow],this.matchedCount,"matched");this._initReviewRow(this.unMatchedList,[this.unMatchedHintRow,
this.unMatchedControlRow],this.unMatchedCount,"unmatched");this._initReviewRow(this.duplicateList,[this.duplicateHintRow,this.duplicateControlRow],this.duplicateCount,"duplicate")},_initReviewRow:function(a,b,c,d){0<a.length?(f.forEach(b,function(a){h.contains(a,"display-none")&&h.remove(a,"display-none")}),c.innerHTML=a.length,this._createOrUpdateReviewNodeAriaLabel(a.length,d)):f.forEach(b,function(a){h.contains(a,"display-none")||h.add(a,"display-none")})},_createOrUpdateReviewNodeAriaLabel:function(a,
b){var c,d,e;switch(b){case "matched":d=this.nls.review.reviewMatched;e=this.nls.review.reviewMatchedHint;c=this.matchedControlRow;break;case "unmatched":d=this.nls.review.reviewUnMatched;e=this.nls.review.reviewUnMatchedHint;c=this.unMatchedControlRow;break;case "duplicate":d=this.nls.review.reviewDuplicate,e=this.nls.review.reviewDuplicateHint,c=this.duplicateControlRow}a=l.substitute(this.nls.review.reviewLabelWithCount,{totalMatchedFeatures:a,headerString:d,headerStringHint:e});n.set(c,"aria-label",
a)},_updateReviewRows:function(a){this._initReviewRows();(a="unmatched"===a&&this.unMatchedFeatureList?this.unMatchedFeatureList:"duplicate"===a&&this.duplicateFeatureList?this.duplicateFeatureList:void 0)&&a.features&&0===a.features.length&&this.pageContainer.selectView(this.index,!0)},updateImageNodes:function(){var a=this.pageContainer.isDarkTheme,b=a?"next-arrow-img":"next-arrow-img-white",c=a?"next-arrow-img-white":"next-arrow-img",a=w("."+b,this.domNode);f.forEach(a,function(a){h.remove(a,b);
h.add(a,c)})},_download:function(a){if("keydown"!==a.type||a.keyCode===g.ENTER||a.keyCode===g.SPACE)0<this.matchedList.length&&(a=this.csvStore.matchedFeatureLayer.id.replace(".csv",""),this._export(this.csvStore.matchedFeatureLayer,a)),0<this.unMatchedList.length&&(a=this.csvStore.unMatchedFeatureLayer.id.replace(".csv",""),this._export(this.csvStore.unMatchedFeatureLayer,a)),0<this.duplicateList.length&&(a=this.csvStore.duplicateFeatureLayer.id.replace(".csv",""),this._export(this.csvStore.duplicateFeatureLayer,
a))},_export:function(a,b){var c=[];f.forEach(a.graphics,function(a){c.push(a.attributes)});var d={};d.datas=c;d.fromClient=!1;d.withGeometry=!1;d.outFields=a.fields;d.formatDate=!0;d.formatCodedValue=!0;d.formatNumber=!1;e.exportCSVFromFeatureLayer(b,a,d)},_submit:function(b){if("keydown"!==b.type||b.keyCode===g.ENTER||b.keyCode===g.SPACE){this._updateNode(this.submitButton,!1);this._updateNode(this.progressNode,!0);b=this._getFeatures(this.csvStore.matchedFeatureLayer);var d=this._getFeatures(this.csvStore.duplicateFeatureLayer);
this.editLayer.applyEdits(b,d,null,c.hitch(this,function(a,b){this._validateResults(a);this._validateResults(b);this._updateNode(this.progressNode,!1);this._disableUI();this.csvStore._zoomToData(this.editLayer.graphics,!0)}),c.hitch(this,function(){new a({type:"Error",message:this.nls.warningsAndErrors.saveError})}))}},_validateResults:function(b){var c=[],d=[];b&&b.hasOwnProperty("length")&&0<b.length&&(f.forEach(b,function(a){"undefined"!==typeof a.success&&(a.success?c.push(a):d.push(a))}),0<d.length&&
(b=0===c.length?this.nls.review.noFeaturesSaved:y.substitute({num:d.length},this.nls.review.someFeaturesNotSaved),new a({message:b})))},_disableUI:function(){this._updateNode(this.submitButton,!0);h.add(this.submitButton,"control-disbaled");n.set(this.submitButton,"tabindex","-1");h.add(this.reviewRowTable,"control-disbaled");n.set(this.reviewDataRow,"tabindex","-1");n.set(this.matchedControlRow,"tabindex","-1");n.set(this.unMatchedControlRow,"tabindex","-1");n.set(this.duplicateControlRow,"tabindex",
"-1");h.add(this.pageContainer.nextTd,"control-disbaled");n.set(this.pageContainer.nextImage,"tabindex","-1");h.add(this.pageContainer.backTd,"control-disbaled");h.add(this.pageContainer.backImage,"control-disbaled");n.set(this.pageContainer.backImage,"tabindex","-1");this.map.infoWindow&&this.map.infoWindow.clearFeatures&&this.map.infoWindow.clearFeatures();this.parent.updateFirstLastNode(!1)},_getFeatures:function(a){var b=[],d=this.csvStore.objectIdField;a&&a.graphics&&f.forEach(a.graphics,c.hitch(this,
function(a){a.hasOwnProperty("_graphicsLayer")&&delete a._graphicsLayer;a.hasOwnProperty("_layer")&&delete a._layer;var e=a.attributes;this._deleteProp(e,d);e.hasOwnProperty("hasDuplicateUpdates")&&e.hasOwnProperty("duplicateState")?e.hasDuplicateUpdates&&"make-change"===e.duplicateState&&(e.hasOwnProperty("DestinationOID")&&(e[this.editLayer.objectIdField]=e.DestinationOID),this._deleteProp(e,"hasDuplicateUpdates"),this._deleteProp(e,"duplicateState"),this._deleteProp(e,"matchScore"),this._deleteProp(e,
"DestinationOID"),f.forEach(this.csvStore._matchFields,c.hitch(this,function(a){this._deleteProp(e,a)})),b.push(a.toJson?new z(a.toJson()):a)):(this._deleteProp(e,"matchScore"),this._deleteProp(e,"DestinationOID"),b.push(a.toJson?new z(a.toJson()):a))}));return 0<b.length?b:null},_deleteProp:function(a,b){a.hasOwnProperty(b)&&delete a[b]},_navigateHome:function(){var a=this.pageContainer.getViewByTitle("Home");a._clearStore(!0);a._clearMapping();this.pageContainer.toggleController(!0);this.pageContainer.selectView(a.index)},
_updateNode:function(a,b){b?h.contains(a,"display-none")&&h.remove(a,"display-none"):h.contains(a,"display-none")||h.add(a,"display-none")},setStyleColor:function(a){this.styleColor=a},_reviewMatched:function(a){a&&"keydown"===a.type&&a.keyCode!==g.ENTER&&a.keyCode!==g.SPACE||this.pageContainer.selectView(this._matchedListView.index)},_reviewUnMatched:function(a){a&&"keydown"===a.type&&a.keyCode!==g.ENTER&&a.keyCode!==g.SPACE||this.pageContainer.selectView(this._unMatchedListView.index)},_reviewDuplicate:function(a){a&&
"keydown"===a.type&&a.keyCode!==g.ENTER&&a.keyCode!==g.SPACE||this.pageContainer.selectView(this._duplicateListView.index)}})})},"widgets/DataAggregation/js/UI/FeatureList":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/dom-attr dojo/keys dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/FeatureList.html dojo/query dojo/Deferred dojo/on ./Feature".split(" "),function(v,c,f,h,n,u,k,
x,p,B,t,r,w,b,l,g){return v([x,p,B,t],{baseClass:"cf-feature-list",declaredClass:"CriticalFacilities.FeatureList",templateString:r,label:"FeatureList",parent:null,nls:null,map:null,appConfig:null,config:null,features:[],updateFeatures:[],hint:"",theme:"",styleColor:"",type:"",isDuplicate:!1,layer:null,_editToolbar:null,_syncFields:{},_started:!1,constructor:function(b){c.mixin(this,b)},postCreate:function(){this.inherited(arguments);this.pageHint.innerHTML=this.hint;this.pageTitle.innerHTML=this._title;
u.set(this.pageTitle,"aria-label",this._title+" "+this.hint)},onShown:function(){this.pageContainer.nextDisabled=!1;this.pageContainer.backDisabled=!1},startup:function(){this._started=!0;this._initFeatureList(this.features);this._updateAltIndexes();this.updateImageNodes();this.own(l(this,"feature-list-updated",c.hitch(this,this._updateAltIndexes)));this.own(l(this.pageContainer,"view-index-change",c.hitch(this,this._indexChanged)))},validate:function(c,a){var d=new b;"next-view"===c?d.resolve(this._nextView()):
"back-view"===c?d.resolve(this._backView()):this._homeView(a).then(function(a){d.resolve(a)});return d},_nextView:function(){return!0},_backView:function(){return!0},_homeView:function(c){var a=new b;this.pageContainer.getViewByTitle("Home").verifyClearSettings(c).then(function(b){a.resolve(b)});return a},_indexChanged:function(b){this._updateAltIndexes();b.oldIndex===this.altNextIndex&&(this.altNextIndex=b.newIndex)},_updateAltIndexes:function(){this.pageContainer&&!this._reviewView&&(this._reviewView=
this.pageContainer.getViewByTitle("Review"))&&(this.altHomeIndex=this.altBackIndex=this._reviewView.index);if(this.featureListTable&&this.featureListTable.rows){var b=this.featureListTable.rows;if(b.length&&0<b.length){var a=b[0].featureView,b=b[b.length-1].featureView;this.altNextIndex=a.index;this.finalFeatureIndex=b.index;b.altNextIndex=this._reviewView.index;a.altBackIndex=this.index}}},_initFeatureList:function(b){var a=0;this.featureListTable.rows.length!==this.features.length&&f.forEach(b,
c.hitch(this,function(b){this._initRow(b,a);a+=1}))},updateImageNodes:function(){var b=this.pageContainer.isDarkTheme,a=b?"next-arrow-img":"next-arrow-img-white",c=b?"next-arrow-img-white":"next-arrow-img",b=w("."+a,this.domNode);f.forEach(b,function(b){n.remove(b,a);n.add(b,c)})},setStyleColor:function(b){this.styleColor=b},_initFeatureView:function(b,a){b=new g({nls:this.nls,map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,label:a,altBackIndex:this.index,isDuplicate:this.isDuplicate,
feature:b,theme:this.theme,layer:this.layer,_editToolbar:this._editToolbar,csvStore:this.csvStore,_parentFeatureList:this,pageContainer:this.pageContainer,pageHint:this.nls.review.reviewFeatureHint,pageTitle:b.label});this.pageContainer.addView(b);return this.pageContainer.getViewByTitle(a)},_initRow:function(b,a){var e=h.create("tr",{className:"bottom-border feature-list-row",tabindex:0,role:"button","aria-label":b.label,onclick:c.hitch(this,function(a){this.pageContainer.selectView(a.currentTarget.featureView.index)}),
onkeydown:c.hitch(this,function(a){a.keyCode!==k.ENTER&&a.keyCode!==k.SPACE||this.pageContainer.selectView(a.currentTarget.featureView.index)})},this.featureListTable);e.featureView=this._initFeatureView(b,this.label+"_"+a);e.fieldInfo=b.fieldInfo;for(a=0;a<b.fieldInfo.length;a++){var d=b.fieldInfo[a];if(d.name===this.layer.objectIdField){e._featureOID=d.value;break}}a=h.create("td",{className:"pad-10"},e);e.featureView.featureListLabel=h.create("div",{className:"main-text float-left text-left",innerHTML:b.label},
a);b=h.create("td",{className:"width-15"},e);h.create("div",{className:"next-arrow float-right next-arrow-img"},b);this.lastFocusNode=e},removeFeature:function(d,a){for(var e=new b,g=this.featureListTable.rows,f=0;f<g.length;f++){var l=g[f];if(l._featureOID===a){this.pageContainer._backLabelClone=c.clone(this.pageContainer._backLabels);this.pageContainer.removeView(l.featureView);this.featureListTable.deleteRow(f);d=this.features.indexOf(d);-1<d&&this.features.splice(d,1);this.emit("feature-list-updated",
this.features.length);f===this.features.length&&this.pageContainer.selectView(this.altBackIndex);break}}e.resolve("feature-removed");return e},resetFeatureList:function(){if(0<this.featureListTable.rows.length){for(var b=this.featureListTable.rows.length;0<b;b--)this.pageContainer.removeView(this.featureListTable.rows[b-1].featureView),this.featureListTable.deleteRow(b-1);this.altNextIndex=void 0;this._initFeatureList(this.features);this._updateAltIndexes();this.pageContainer._backLabels=this.pageContainer._backLabelClone;
this.updateImageNodes()}},addFeature:function(b){this.features.push(b);this.emit("feature-list-updated",this.features.length)}})})},"widgets/DataAggregation/js/UI/Feature":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/dom-attr dojo/keys dijit/registry dijit/form/ValidationTextBox jimu/dijit/formSelect dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/query dojo/on dijit/form/DateTextBox dojo/text!./templates/Feature.html dojo/Deferred ./FeatureToolbar esri/tasks/query jimu/dijit/Popup jimu/utils esri/lang".split(" "),
function(v,c,f,h,n,u,k,x,p,B,t,r,w,b,l,g,d,a,e,q,y,z,A,D){return v([t,r,w,b],{baseClass:"cf-feature",declaredClass:"CriticalFacilities.Feature",templateString:a,_started:null,label:"Feature",parent:null,nls:null,map:null,appConfig:null,config:null,_featureToolbar:null,fields:[],feature:null,fileAddress:{},isDuplicate:!1,isDuplicateLocated:!1,isUnMatchedLocated:!1,isUnMatched:!1,_useGeomFromFile:!1,_useGeomFromLayer:!0,_useValuesFromFile:!1,_useValuesFromLayer:!0,_featureExpanded:!1,_locationExpanded:!1,
theme:"",styleColor:"black",layer:null,_changedFileAttributeRows:[],_changedLayerAttributeRows:[],_changedAddressRows:[],_editToolbar:null,_featureQuery:null,_skipFields:[],csvStore:null,constructor:function(a){c.mixin(this,a)},postCreate:function(){this.inherited(arguments);this.pageHintDiv.innerHTML=this.pageHint;this.pageTitleDiv.innerHTML=this.pageTitle;u.set(this.featureTitleTable,"aria-label",this.pageTitle+" "+this.pageHint);this._initUnMatched();this._initToolbar(this.featureToolbar);this._updateAltIndexes();
this.lastFocusNode=this.locationTr},_initUnMatched:function(){if((this.isUnMatched=-1!==this.label.indexOf("UnMatchedFeatures"))&&this.feature.fieldInfo&&this.feature.fieldInfo.length)for(var a=0;a<this.feature.fieldInfo.length;a++){var b=this.feature.fieldInfo[a];"matchScore"===b.name&&(this.isUnMatchedLocated=0!==b.value)}},_updateAltIndexes:function(){if(this.pageContainer){var a=this.pageContainer.getViewByTitle("Review");a&&(this.altHomeIndex=a.index)}},_initSkipFields:function(a){this._skipFields=
["DestinationOID","matchScore","hasDuplicateUpdates","duplicateState",this.layer.objectIdField];f.forEach(a,c.hitch(this,function(a){-1<a.name.indexOf(this.csvStore.matchFieldPrefix)&&this._skipFields.push(a.name)}))},startup:function(){var a=this.feature.fieldInfo;this._initSkipFields(a);this._initRows(a,this.featureControlTable);this.isDuplicate?this._initDuplicateReview(a):this._initStandardReview();this._getFeature().then(c.hitch(this,function(a){this._feature=a;this._featureToolbar._panToAndSelectFeature(a);
!this.isDuplicate&&this._feature&&this._feature.geometry&&this._toggleEditControls(!1)}));this._getEditFeature().then(c.hitch(this,function(a){this._editFeature=a;this.isDuplicate&&this._editFeature&&this._editFeature.geometry&&this._toggleLocationControls(!0)}));this.onShown()},onShown:function(){this._isReviewed=!0;this._showView();this._featureToolbar._panToAndSelectFeature(this.isDuplicate&&this._useGeomFromLayer?this._editFeature:this._feature);this.isShowing=!0;this.pageContainer.nextDisabled=
!1;this.pageContainer.backDisabled=!1;!this.isDuplicate&&this._feature&&this._feature.geometry&&this._toggleEditControls(!1);this.isDuplicate&&this._useGeomFromFile&&"make-change"===this._duplicateFlag.fromSelect.value&&this._toggleEditControls(!1)},onHidden:function(){this.isShowing=!1},validate:function(a,b){var c=new e;"next-view"===a?c.resolve(this._nextView()):"back-view"===a?c.resolve(this._backView()):this._homeView(b).then(function(a){c.resolve(a)});return c},_nextView:function(){return!0},
_backView:function(){return!0},_homeView:function(a){var b=new e;this.pageContainer.getViewByTitle("Home").verifyClearSettings(a).then(function(a){b.resolve(a)});return b},_showView:function(){n.remove(this.featureTitleTable,"display-none");n.remove(this.featureTable,"display-none");n.remove(this.featureToggleTable,"display-none");n.remove(this.locationSyncTable,"display-none");n.remove(this.locationControlTable,"display-none");n.remove(this.locationControlToggleTable,"display-none");n.remove(this.featureToolbarTable,
"display-none");this.isDuplicate&&n.remove(this.reviewText,"display-none");this._updateInfoRows()},_getFeature:function(){var a=new e,b=this.layer.objectIdField,d=this.feature.fieldInfo.filter(function(a){return a.name===b});this._featureQuery=new y;this._featureQuery.objectIds=[d[0].value];this.layer.queryFeatures(this._featureQuery).then(c.hitch(this,function(b){a.resolve(b.features[0])}));return a},_getEditFeature:function(){var a=new e,b=this.feature.fieldInfo.filter(function(a){return"DestinationOID"===
a.name});b&&0<b.length?(this._editQuery=new y,this._editQuery.objectIds=[b[0].value],this.parent.editLayer.queryFeatures(this._editQuery).then(c.hitch(this,function(b){a.resolve(b.features[0])}))):a.resolve();return a},_initStandardReview:function(){this._useValuesFromFile=!0;this._useValuesFromLayer=!1},_initDuplicateReview:function(a){this._initDuplicateSelect();this._initDuplicateReviewRows(a);n.add(this.featureToolbar,"display-none")},_initDuplicateSelect:function(){var a=new B({"aria-label":this.nls.review.item,
style:{display:"table","min-width":"100px",height:"28px"},options:[{label:this.nls.review.duplicateAction,value:"no-change",selected:!0},{label:this.nls.review.duplicateModify,value:"make-change"},{label:this.nls.review.duplicateSave,value:"not-duplicate"}],onChange:c.hitch(this,this._updateDuplicateUI)});this._duplicateFlag.fromSelect=a;h.place(a.domNode,this._duplicateFlag);a.startup();this._toggleEditControls(!0)},_updateDuplicateUI:function(a){this._updateDuplicateAttributes(a,null);"make-change"===
a?n.remove(this.featureToolbar,"display-none"):n.add(this.featureToolbar,"display-none");this._toggleEditControls("make-change"===a?!1:!0);"not-duplicate"===a&&this._showShouldLocateFeaturePopup().then(c.hitch(this,function(b){b?(this.resetAddressValues(this._featureToolbar._originalValues,a),this._featureToolbar._locateFeature(!0).then(c.hitch(this,function(){var a=new z({titleLabel:this.nls.review.featureLocated,width:400,autoHeight:!0,content:h.create("div",{innerHTML:this.nls.warningsAndErrors.itemMoveMatch,
style:"padding-bottom: 10px;"}),buttons:[{label:this.nls.ok,onClick:c.hitch(this,c.hitch(this,function(){a.close();a=null}))}],onClose:c.hitch(this,function(){a=null;this._featureToolbar._save({},!0)})})}))):this._duplicateFlag.fromSelect.set("value","no-change")}));this._updateLocationPanelLastNode()},_updateDuplicateAttributes:function(a,b){this._feature.attributes.duplicateState=null!==a?a:this._feature.attributes.duplicateState;this._feature.attributes.hasDuplicateUpdates=null!==b?b:this._feature.attributes.hasDuplicateUpdates},
_showShouldLocateFeaturePopup:function(){var a=new e,b=h.create("div");h.create("div",{innerHTML:this.nls.warningsAndErrors.itemWillBeLocated,style:"padding-bottom: 10px;"},b);h.create("div",{innerHTML:this.nls.warningsAndErrors.proceed},b);var d=new z({titleLabel:this.nls.review.locateFeature,width:400,autoHeight:!0,content:b,buttons:[{label:this.nls.yes,onClick:c.hitch(this,function(){d.close();d=null;a.resolve(!0)})},{label:this.nls.no,onClick:c.hitch(this,function(){d.close();d=null;a.resolve(!1)})}],
onClose:function(){d=null}});return a},_initDuplicateReviewRows:function(a){var b=h.create("tr",{className:"bottom-border",isHeaderRow:!0},this.reviewTable);h.create("td",{className:"text-left"},b);var e=h.create("td",{className:"text-left"},b);h.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.target},e);b=h.create("td",{className:"text-left"},b);h.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.source},
b);f.forEach(a,c.hitch(this,function(a){if(-1===this._skipFields.indexOf(a.name)){var b=h.create("tr",{className:"bottom-border",isLabelRow:!0,isControlRow:!0},this.reviewTable);b.fieldName=a.name;b.parent=this;var c=h.create("td",{className:"field-control-td text-left"},b);h.create("div",{className:"main-text float-left",innerHTML:a.label},c);this._initLabel(b,a.duplicateFieldInfo.value,!1,!1);this._initLabel(b,a.value,!0,!1)}}))},_initToolbar:function(a){this._featureToolbar=new q({nls:this.nls,
map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,feature:this.feature,theme:this.theme,layer:this.layer,featureView:this,_editToolbar:this._editToolbar,csvStore:this.csvStore,_stageLayer:this.csvStore.matchedFeatureLayer,styleColor:this.styleColor,pageContainer:this.pageContainer});this._featureToolbar.placeAt(a);this._featureToolbar.startup()},_initRows:function(a,b){if(this.isDuplicate){this._initSelectRow(this.nls.review.use,this.locationControlTable,this._useGeomChanged,
"geom");this._initSelectRow(this.nls.review.use,this.featureControlTable,this._useValuesChanged,"values");var e=h.create("tr",{className:"bottom-border",isHeaderRow:!0},b);h.create("td",{className:"text-left"},e);var d=h.create("td",{className:"text-left"},e);h.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.target},d);e=h.create("td",{className:"text-left"},e);h.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.source},
e)}(this._syncEnabled=0<Object.keys(this._parentFeatureList._syncFields).length)?this._syncFields=this._parentFeatureList._syncFields:n.add(this.syncFields,"display-none");var m=0;f.forEach(a,c.hitch(this,function(a){if(-1===this._skipFields.indexOf(a.name)){var c=h.create("tr",{className:"bottom-border",isRadioRow:!1,isEditRow:!0,rowIndex:m},b);c.fieldName=a.name;c.parent=this;var e=h.create("td",{className:"field-control-td text-left field-row-width pad-left-5"},c);h.create("div",{className:"main-text float-left",
innerHTML:a.label},e);this.isDuplicate&&this._initValidationBox(a.label,c,a.duplicateFieldInfo.value,!1,!1);this._initValidationBox(a.label,c,a.value,!0,!1);m+=1}}));this.addressFields=this.csvStore.useMultiFields?this.csvStore.multiFields:this.csvStore.useAddr?this.csvStore.singleFields:this.getXYFields();f.forEach(this.addressFields,c.hitch(this,function(a){var b=h.create("tr",{className:"bottom-border",isRadioRow:!1,isEditRow:!1,isAddressRow:!0},this.locationControlTable);b.label=a.label;b.keyField=
a.keyField;b.parent=this;var c=h.create("td",{className:"field-control-td text-left pad-left-5"},b);h.create("div",{className:"main-text float-left",innerHTML:a.label},c);var e=this.csvStore.matchFieldPrefix,c=this.feature.fieldInfo.filter(function(b){return b.name===e+a.keyField})[0];this._initValidationBox(a.label,b,c.value,!1,!0)}))},_syncAddressInfo:function(a){"keydown"===a.type&&a.keyCode!==k.ENTER&&a.keyCode!==k.SPACE||this._featureToolbar._syncDisabled||(a=this._getAddress(),this._updateAddressFields(a,
!0),this._featureToolbar._hasAddressEdit=!1,this._featureToolbar._updateSync(!0))},_locate:function(a){this._featureToolbar._locate(a)},getXYFields:function(){this._featureToolbar._isAddressFeature=!1;var a=this.parent._pageContainer.getViewByTitle("Coordinates"),b=a.xField,a=a.yField;this._featureToolbar.xField=this.csvStore.xFieldName;this._featureToolbar.yField=this.csvStore.yFieldName;return[{keyField:this.csvStore.xFieldName,label:b.label,value:this.csvStore.xFieldName},{keyField:this.csvStore.yFieldName,
label:a.label,value:this.csvStore.yFieldName}]},_updateAddressFields:function(a,b){this._address=a;b?f.forEach(this.locationControlTable.rows,c.hitch(this,function(a){if(this._syncFields.hasOwnProperty(a.keyField))for(var b=this._syncFields[a.keyField],c=0;c<this.featureControlTable.rows.length;c++){var e=this.featureControlTable.rows[c];if(e.isEditRow&&e.fieldName===b.layerFieldName){a=this.csvStore.matchFieldPrefix+a.keyField;a=this._address&&this._address.hasOwnProperty(a)?this._address[a]:"";
this.isDuplicate&&this._useValuesFromLayer?(e.layerValueTextBox.set("value",a),e.layerValueTextBox.emit("keyUp")):(e.fileValueTextBox.set("value",a),e.fileValueTextBox.emit("keyUp"));break}}})):f.forEach(this.locationControlTable.rows,c.hitch(this,function(a){var b=this.csvStore.useAddr&&!this.csvStore.useMultiFields?"Match_addr":a.keyField;a.addressValueTextBox&&(this.csvStore.useAddr||(b=this.csvStore.xFieldName===b?"x":"y"),b=this._address&&this._address.hasOwnProperty(b)?this._address[b]:"",a.addressValueTextBox.set("value",
b))}))},_validateAddressDifference:function(){var a=!1;this.locationControlTable&&f.forEach(this.locationControlTable.rows,c.hitch(this,function(b){if(this._syncFields&&this._syncFields.hasOwnProperty(b.keyField)&&!a){var c=b.addressValueTextBox.displayedValue;b=this._syncFields[b.keyField];for(var e=0;e<this.featureControlTable.rows.length;e++){var d=this.featureControlTable.rows[e];if(d.isEditRow&&d.fieldName===b.layerFieldName&&!a){a=this.isDuplicate&&this._useValuesFromLayer?d.layerValueTextBox.displayedValue!==
c:d.fileValueTextBox.displayedValue!==c;break}}}}));return a},_getAddress:function(){this._address={};f.forEach(this.locationControlTable.rows,c.hitch(this,function(a){a.addressValueTextBox&&(this._address[this.csvStore.matchFieldPrefix+a.keyField]=a.addressValueTextBox.value)}));return this._address},_getAddressFieldsValues:function(){var a={};f.forEach(this.locationControlTable.rows,function(b){b.addressValueTextBox&&(a[b.keyField]=b.addressValueTextBox.value)});return a},_initLabel:function(a,
b,c,e){var d=this._getField(a),m=h.create("td",{className:"field-control-td field-row-width2"},a),g=new p({style:{width:"100%",height:"32px"},title:b,invalidMessage:this.nls.review.valuesDoNotMatch});g.decimalSeperator=this.csvStore.decimalSeperator;this._addLocalizeFloatSupport(g,b,e,d);g.set("value",b);g.set("readonly",!0);g.placeAt(m);g.startup();g.isFile=c;g.isAddress=e;g.row=a;g.parent=this;c?(a.fileValueTextBox=g,a.fileValue=b):e?(a.addressValueTextBox=g,a.addressValue=b):(a.layerValueTextBox=
g,a.layerValue=b);c&&(g.validator=this._valuesMatch,g.validate())},_initValidationBox:function(a,b,c,e,g){var m=this._getField(b),q=h.create("td",{className:"field-control-td",colspan:this.isDuplicate?1:2},b);if(m&&m.type&&"date"===m.type){var C=m.fieldInfo&&m.fieldInfo.format?m.fieldInfo:void 0;c=-1===[null,void 0,""].indexOf(c)?new Date(c):void 0;var l=-1===[null,void 0,""].indexOf(c)?!0:!1;a=new d({"aria-label":a,style:{width:"100%",height:"32px"},title:l?C?A.localizeDateByFieldInfo(c,C):A.localizeDate(c):
"",onChange:this._onChange})}else if(m&&m.domainValues){C=function(a){var b;-1<m.values.indexOf(a)&&(b=m.domainValues.filter(function(b){return b.label===a}));return b&&-1<b.length?b[0].value:a};c=-1<[null,void 0,""].indexOf(c)?"":-1<m.codes.indexOf(c)?c:C(c);var y=[{label:this.nls.review.selectValue,value:null,selected:!0}],E=c;f.forEach(m.domainValues,function(a){if(c.toString()===a.value.toString()||c.toString()===a.label.toString())E=a.label;y.push({label:a.label,value:a.value})});a=new B({"aria-label":a,
style:{width:"100%",height:"32px"},options:y,onChange:this._onChange,title:E});q.style.overflow="hidden"}else a=new p({"aria-label":a,style:{width:"100%",height:"32px"},title:c});a.decimalSeperator=this.csvStore.decimalSeperator;this._addLocalizeFloatSupport(a,c,g,m);a.set("intermediateChanges",!0);a.set("value",this.isDuplicate&&g?"":c);a.placeAt(q);a.startup();this.lastValueTextBox=a.domNode;a.isFile=e;a.isAddress=g;a.row=b;a.featureToolbar=this._featureToolbar;if(!g){var z;m&&m.length&&(z=D.substitute({num:m.length},
this.nls.warningsAndErrors.rangeMessage));a.invalidLengthMessage=z;a.invalidTypeMessage=this.nls.warningsAndErrors.invalidMessage;a.fieldLength=m.length;a.fieldType=m.type;a.fieldNullable=m.nullable;m&&m.type&&"date"!==m.type&&(a.validator=this._valuesValidForType)}a.parent=this;e?(b.fileValueTextBox=a,b.fileValue=c):g?(b.addressValueTextBox=a,b.addressValue=c):(b.layerValueTextBox=a,b.layerValue=c);a.on("keyUp",function(a){var b;a="undefined"!==typeof a.target.value?this.parent._getValue(a.target.value):
"date"===this.fieldType?"":this.value;if(this.isAddress)a=a!==this.parent._getValue(this.row.addressValue),b=this.parent._changedAddressRows.indexOf(this.row.rowIndex),-1===b&&a?this.parent._changedAddressRows.push(this.row.rowIndex):-1<b&&!a&&this.parent._changedAddressRows.splice(b,1),this.parent.emit("address-change",0<this.parent._changedAddressRows.length);else if(b=this.validate(),this.row._isValid=b){b=this.parent._getValue(this.row.fileValue);var c=this.parent._getValue(this.row.layerValue);
a=this.isFile?a!==b:a!==c;c=this.isFile?this.parent._changedFileAttributeRows:this.parent._changedLayerAttributeRows;b=c.indexOf(this.row.rowIndex);-1===b&&a?c.push(this.row.rowIndex):-1<b&&!a&&c.splice(b,1);var e=!0;f.forEach(this.parent.featureControlTable.rows,function(a){"undefined"===typeof a._isValid||a._isValid||(e=!1)});e?this.parent.emit("attribute-change",0<c.length):this.featureToolbar._updateSave(!0)}else this.featureToolbar._updateSave(!0)})},_getField:function(a){for(var b,c=0;c<this.csvStore.fsFields.length;c++){var e=
this.csvStore.fsFields[c];if(e.name===a.fieldName){b=e;break}}return b},_addLocalizeFloatSupport:function(a,b,c,e){"."!==a.decimalSeperator&&(c&&!this.csvStore.useAddr||e&&e.type&&"float"===e.type)&&(a.title=-1!==[null,void 0,""].indexOf(b)?"":isNaN(b)||"."===a.decimalSeperator?b:A.localizeNumber(b),a.format=function(a){return-1!==[null,void 0,""].indexOf(a)||isNaN(a)?a:A.localizeNumber(a).toString().replace(".","")},a.parse=function(a){return a&&a.toString&&-1<a.toString().indexOf(this.decimalSeperator)?
a.toString().replace(this.decimalSeperator,"."):a})},_onChange:function(a){var b;a="undefined"!==typeof a?this.parent._getValue(a):"date"===this.fieldType?"":this.value;b=this.validate();if(this.row._isValid=b){b=this.parent._getValue(this.row.fileValue);var c=this.parent._getValue(this.row.layerValue);a=this.isFile?a.toString()!==b.toString():a.toString()!==c.toString();c=this.isFile?this.parent._changedFileAttributeRows:this.parent._changedLayerAttributeRows;b=c.indexOf(this.row.rowIndex);-1===
b&&a?c.push(this.row.rowIndex):-1<b&&!a&&c.splice(b,1);var e=!0;f.forEach(this.parent.featureControlTable.rows,function(a){"undefined"===typeof a._isValid||a._isValid||(e=!1)});e?this.parent.emit("attribute-change",0<c.length):this.featureToolbar._updateSave(!0)}else this.featureToolbar._updateSave(!0)},_valuesValidForType:function(a){var b=a.toString();if(b.length>this.fieldLength)return this.invalidMessage=this.invalidLengthMessage,!1;if(0===b.length)return"undefined"!==typeof this.fieldNullable?
this.fieldNullable:!0;this.invalidMessage=this.invalidTypeMessage;switch(this.fieldType){case "int":return/^-?[0-9]+$/.exec(a);case "float":return"."!==this.decimalSeperator?/^-?[0-9]+[.,]?[0-9]*$/.exec(a):/^-?[0-9]+[.]?[0-9]*$/.exec(a);case "date":if(a)try{return!isNaN((new Date(a)).getTime())}catch(C){return console.error(C),!1}else return!0;case "domainInt":return/^-?[0-9]+$/.exec(a);case "domain":return!0;case "other":return!0}},_valuesMatch:function(){return this.row.fileValueTextBox&&this.row.layerValueTextBox?
this.row.fileValueTextBox.value===this.row.layerValueTextBox.value:!0},_validateValues:function(){var a=!0;f.forEach(this.featureControlTable.rows,c.hitch(this,function(b){if(b.isEditRow){"undefined"===typeof b._isValid||b._isValid||(a=!1);var c="date"===b.fileValueTextBox.fieldType&&b.fileValueTextBox.value.toString()===b.fileValueTextBox._invalidDate?"":this._getValue(b.fileValueTextBox.value),e=this._getValue(b.fileValue),d="date"===b.layerValueTextBox.fieldType&&b.layerValueTextBox.value.toString()===
b.layerValueTextBox._invalidDate?"":this._getValue(b.layerValueTextBox.value),g=this._getValue(b.layerValue);b.parent._useValuesFromFile&&(c===e&&c===g||this._changedFileAttributeRows.push(b.rowIndex));b.parent._useValuesFromLayer&&d!==g&&this._changedLayerAttributeRows.push(b.rowIndex)}}));var b=this._useValuesFromFile?this._changedFileAttributeRows:this._changedLayerAttributeRows;a?this.emit("attribute-change",0<b.length):this._featureToolbar._updateSave(!0)},_getValue:function(a){return-1===[null,
void 0,""].indexOf(a)?a:""},_validateGeoms:function(){var a=this._featureToolbar._hasAttributeEdit,b=this._featureToolbar._hasGeometryEdit;this._useGeomFromLayer?this._featureToolbar._updateSaveAndCancel(!a):b?this._featureToolbar._updateSaveAndCancel(!a&&!b):this._featureToolbar._updateSaveAndCancel(!a)},_initSelectRow:function(a,b,c,e){b=h.create("tr",{className:"task-instruction-row bottom-border",isRadioRow:!0,isEditRow:!1},b);b.radioButtons=[];b.useType=e;var d=h.create("td",{},b);h.create("div",
{className:"main-text float-left pad-left-5",innerHTML:a},d);this._createSelect(b,c,e)},_createSelect:function(a,b,e){var d=h.create("td",{colspan:2,className:"field-control-td"},a);b=new B({style:{display:"table",width:"100%",height:"28px"},options:[{label:this.nls.review.fromLayer,value:"layer",selected:!0},{label:this.nls.review.fromFile,value:"file"}],onChange:c.hitch(this,b)});a.fromSelect=b;h.place(b.domNode,d);b.startup();"geom"===e&&this.own(g(a.fromSelect,"change",c.hitch(this,function(){this._updateLocationPanelLastNode()})))},
_useGeomChanged:function(a){this._useGeomFromFile=a="file"===a;this._useGeomFromLayer=!a;a&&this.resetAddressValues(this._featureToolbar._originalValues);a&&!this._hasBeenLocatedForFile?this._hasBeenLocatedForFile||this._featureToolbar._locateFeature().then(c.hitch(this,function(a){this._featureToolbar._originalValues.duplicateGeometry=a.feature.geometry;this._hasBeenLocatedForFile=!0;var b=[a.feature,this._editFeature];if(a.feature.geometry.x!==this._editFeature.geometry.x||a.feature.geometry.y!==
this._editFeature.geometry.y)this.map&&this.map.extent&&this.map.extent.contains?this.map.extent.contains(a.feature.geometry)&&this.map.extent.contains(this._editFeature.geometry)||this.csvStore._zoomToData(b):this.csvStore._zoomToData(b);this._featureToolbar._flashFeatures(b);this._validateGeoms()})):(this._featureToolbar._updateFeature(this._useGeomFromFile?this._featureToolbar._originalValues.duplicateGeometry:this._editFeature.geometry,!1,!0),this._featureToolbar._flashFeatures([a?this._feature:
this._editFeature]),this._validateGeoms());this._useGeomFromLayer&&this._updateAddressFields(this._featureToolbar._originalValues.editAddress,!1);this._toggleLocationControls(!1);this._syncFields&&this._featureToolbar._updateSync(!this._validateAddressDifference())},_toggleFeature:function(a){if("keydown"!==a.type||a.keyCode===k.ENTER||a.keyCode===k.SPACE)(this._featureExpanded=!this._featureExpanded)?(this._locationExpanded=!1,u.set(this.featureTr,"aria-expanded","true"),u.set(this.locationTr,"aria-expanded",
"false"),this.lastFocusNode=this.locationTr):u.set(this.featureTr,"aria-expanded","false"),this._updateInfoRows(),this.parent.updateFirstLastNode(!1)},_toggleLocation:function(a){if("keydown"!==a.type||a.keyCode===k.ENTER||a.keyCode===k.SPACE)(this._locationExpanded=!this._locationExpanded)?(this._featureExpanded=!1,u.set(this.featureTr,"aria-expanded","false"),u.set(this.locationTr,"aria-expanded","true")):(u.set(this.locationTr,"aria-expanded","false"),this.lastFocusNode=this.locationTr),this._updateInfoRows(),
this._updateLocationPanelLastNode()},_updateLocationPanelLastNode:function(){var a,b=!1;n.contains(this.toggleLocation,"bg-toggle-down-img")?this.lastFocusNode=this.locationTr:(a=x.findWidgets(this.locationInformation))&&0<a.length&&(a.reverse(),f.some(a,c.hitch(this,function(a){if(a&&!a.disabled)return b=!0,this.lastFocusNode=a.domNode,!0})));b||(this.lastFocusNode=this.locationTr);this.parent.updateFirstLastNode(!1)},_updateInfoRows:function(){this._updateRow(this._featureExpanded,this.featureInformation,
this.toggleFeature);this._updateRow(this._locationExpanded,this.locationInformation,this.toggleLocation)},_updateRow:function(a,b,c){var e=["bg-toggle-up-img","bg-toggle-up-img-white"],d=["bg-toggle-down-img","bg-toggle-down-img-white"];a?n.remove(b,"display-none"):n.add(b,"display-none");this._updateImageNode(a?e:d,a?d:e,c)},updateImageNodes:function(){var a=this.pageContainer.isDarkTheme,b=a?"next-arrow-img":"next-arrow-img-white",c=a?"next-arrow-img-white":"next-arrow-img",e=l("."+b,this.domNode);
f.forEach(e,function(a){n.remove(a,b);n.add(a,c)});b=a?"bg-toggle-up-img":"bg-toggle-up-img-white";c=a?"bg-toggle-up-img-white":"bg-toggle-up-img";e=l("."+b,this.domNode);f.forEach(e,function(a){n.remove(a,b);n.add(a,c)});b=a?"bg-toggle-down-img":"bg-toggle-down-img-white";c=a?"bg-toggle-down-img-white":"bg-toggle-down-img";e=l("."+b,this.domNode);f.forEach(e,function(a){n.remove(a,b);n.add(a,c)})},_updateImageNode:function(a,b,c){var e=this.pageContainer.isDarkTheme;n.remove(c,e?b[1]:b[0]);n.add(c,
e?a[1]:a[0])},_toggleLocationControls:function(a){var b=this.isDuplicate&&this._useGeomFromLayer?!0:a;this.locationControlTable&&f.forEach(this.locationControlTable.rows,function(c){c.fromSelect&&c.fromSelect.set("disabled",a);c.isAddressRow&&c.addressValueTextBox&&c.addressValueTextBox.set("disabled",b)});b?this._featureToolbar._disableEdit():this._featureToolbar._enableEdit()},_useValuesChanged:function(a){this._useValuesFromFile=a="file"===a;this._useValuesFromLayer=!a;this._toggleEnabled(a);this._validateValues();
this._syncFields&&this._featureToolbar._updateSync(!this._validateAddressDifference())},_toggleEnabled:function(a){f.forEach(this.featureControlTable.rows,function(b){b.isRadioRow||(b.fileValueTextBox&&b.fileValueTextBox.set("disabled",!a),b.layerValueTextBox&&b.layerValueTextBox.set("disabled",a))})},_toggleEditControls:function(a){this.featureControlTable&&f.forEach(this.featureControlTable.rows,function(b){b.isRadioRow&&b.fromSelect.set("disabled",a);b.isEditRow&&(b.fileValueTextBox&&(a?b.fileValueTextBox.set("disabled",
a):b.parent.isDuplicate&&b.parent._useValuesFromFile?b.fileValueTextBox.set("disabled",a):b.parent.isDuplicate||b.fileValueTextBox.set("disabled",a)),b.layerValueTextBox&&(a?b.layerValueTextBox.set("disabled",a):b.parent.isDuplicate&&b.parent._useValuesFromLayer?b.layerValueTextBox.set("disabled",a):b.parent.isDuplicate||b.layerValueTextBox.set("disabled",a)))});this._toggleLocationControls(a)},resetAttributeValues:function(){f.forEach(this.featureControlTable.rows,c.hitch(this,function(a){a.fileValueTextBox&&
a.fileValueTextBox.set("value",void 0===a.fileValue?"":a.fileValue);a.layerValueTextBox&&a.layerValueTextBox.set("value",a.layerValue)}));this._changedFileAttributeRows=[];this._changedLayerAttributeRows=[]},resetAddressValues:function(a,b){f.forEach(this.locationControlTable.rows,c.hitch(this,function(c){var e=this.csvStore.useAddr&&!this.csvStore.useMultiFields?"Match_addr":c.keyField;c.addressValueTextBox&&(e=this.isDuplicate&&this._useGeomFromLayer&&"not-duplicate"!==b?a.editAddress&&a.editAddress.hasOwnProperty(e)?
a.editAddress[e]:void 0:c.addressValue,c.addressValueTextBox.set("value",e))}))},resetGeometry:function(a){this._feature.geometry=a;this.feature.geometry=a;this._featureToolbar._updateLayer(this.layer,null,[this._feature],null,!1,!0).then(c.hitch(this,function(){this._featureToolbar._flashFeatures([this._feature])}));this.resetFromLayerRows()},resetFromLayerRows:function(){this.isDuplicate&&(this._featureToolbar._fileGeometryModified||(this._useGeomFromLayer=!0),this._featureToolbar._fileValuesModified||
(this._useValuesFromLayer=!0),f.forEach(this.featureControlTable.rows,c.hitch(this,function(a){a.fromSelect&&("geom"===a.useType&&this._useGeomFromLayer||"values"===a.useType&&this._useValuesFromLayer)&&a.fromSelect.set("value","layer")})),f.forEach(this.locationControlTable.rows,c.hitch(this,function(a){a.fromSelect&&("geom"===a.useType&&!this._useGeomFromLayer||"values"===a.useType&&this._useValuesFromLayer)&&a.fromSelect.set("value","layer")})))},setStyleColor:function(a){this.styleColor=a;this._featureToolbar.styleColor=
a}})})},"widgets/DataAggregation/js/UI/FeatureToolbar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Evented dojo/query dojo/dom-class dojo/dom-attr dojo/dom-construct dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dojo/on dojo/keys dojox/gfx/fx dojo/text!./templates/FeatureToolbar.html esri/toolbars/edit jimu/dijit/Message jimu/dijit/Popup jimu/portalUtils jimu/utils esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/Color esri/graphic esri/geometry/webMercatorUtils esri/request".split(" "),
function(v,c,f,h,n,u,k,x,p,B,t,r,w,b,l,g,d,a,e,q,y,z,A,D,m,E){return v([B,t,h],{templateString:l,baseClass:"cf-feature-toolbar",declaredClass:"FeatureToolbar",label:"FeatureToolbar",parent:null,nls:null,map:null,appConfig:null,config:null,feature:null,layer:null,theme:"",locators:[],styleColor:"",featureView:null,_editToolbar:null,csvStore:null,_isAddressFeature:!0,_stageLayer:null,constructor:function(a){c.mixin(this,a);this._syncDisabled=this._locateDisabled=this._cancelDisabled=this._saveDisabled=
!0;this._hasAttributeEdit=!1;this.own(r(this.featureView,"attribute-change",c.hitch(this,this._attributeChange)));this._hasAddressEdit=!1;this.own(r(this.featureView,"address-change",c.hitch(this,this._addressChange)));this._hasGeometryEdit=!1;this.own(r(this._editToolbar,"graphic-move-stop",c.hitch(this,this._graphicMoveStop)));this.own(r(this.featureView,"address-located",c.hitch(this,this._graphicMoveStop)));this.locator=this._getLocator(0);this._initOriginalValues()},postCreate:function(){this.inherited(arguments)},
startup:function(){this.inherited(arguments);this._started=!0;this.updateImageNodes()},_getLocator:function(a){for(var b;a<this.csvStore._geocodeSources.length;a++)if(this.locatorSource=this.csvStore._geocodeSources[a],this.locatorSource.locator.locationToAddress){b=this.locatorSource.locator;this._locatorIndex=a;break}b&&(b.outSpatialReference=this.map.spatialReference,b.countryCode=this.locatorSource.countryCode);return b},_initOriginalValues:function(){this._originalValues=c.clone(this.featureView.feature)},
_attributeChange:function(a){this._hasAttributeEdit=a;this.featureView.isDuplicate&&this.featureView._useGeomFromLayer?this._updateSaveAndCancel(!this._hasAttributeEdit):this._updateSaveAndCancel(!(this._hasAttributeEdit||this._hasGeometryEdit));this._updateSync(!this.featureView._validateAddressDifference())},_addressChange:function(a){this._hasAddressEdit=a;this._updateLocate(!a)},_graphicMoveStop:function(a){this.featureView.isShowing&&(this._hasGeometryEdit=!0,this.featureView.isDuplicate&&this.featureView._useGeomFromLayer?
this._updateSaveAndCancel(!this._hasAttributeEdit):this._updateSaveAndCancel(!(this._hasAttributeEdit||this._hasGeometryEdit)),this.map.infoWindow.setFeatures(this.featureView._feature),this.map.infoWindow.select(0),a?this._reverseLocate(a.graphic.geometry).then(c.hitch(this,function(){this._hasAddressEdit=!0;this._updateLocate(!0);this.featureView._validateAddressDifference()&&this._updateSync(!1);this.locator=this._getLocator(0)}),function(a){this.locator=this._getLocator(0);new d(a)}):this.featureView._validateAddressDifference()&&
this._updateSync(!1))},_reverseLocate:function(a){var b=new p;if(this._isAddressFeature){var d=this.parent.portal?this.parent.portal:this.appConfig.portalUrl?e.getPortal(this.appConfig.portalUrl):null,g=this.locatorSource&&this.locatorSource.isEsriLocator;E({url:this.locator.url+"/reverseGeocode",content:{f:"json",location:JSON.stringify(a),distance:100,outSR:JSON.stringify(a.spatialReference),forStorage:g?this.featureView.isDuplicate&&!this.featureView.isDuplicateLocated||this.featureView.isUnMatched&&
!this.featureView.isUnMatchedLocated:!1,token:g?d&&d.credential&&d.credential.token?d.credential.token:null:null},callbackParamName:"callback"}).then(c.hitch(this,function(a){this.featureView._updateAddressFields(a.address,!1);b.resolve({address:a.address})}),c.hitch(this,function(c){this._getNextLocator()?this._reverseLocate(a).then(function(a){b.resolve(a)}):(this.featureView._updateAddressFields({},!1),b.reject({message:c.message}))}))}else a.spatialReference.isWebMercator&&a.spatialReference.isWebMercator()&&
(d=m.webMercatorToGeographic(a)),this.featureView._updateAddressFields(d||a,!1),b.resolve({geometry:a});return b},_enableEdit:function(){this._editToolbar.activate(g.MOVE,this.featureView._feature)},_disableEdit:function(){this._editToolbar.deactivate()},_undoEdits:function(){this._hasAttributeEdit&&(this.featureView.resetAttributeValues(),this._hasAttributeEdit=!1);this._hasAddressEdit&&(this.featureView.resetAddressValues(this._originalValues),this._hasAddressEdit=!1);this._hasGeometryEdit?(this.featureView.resetGeometry(this._originalValues.geometry),
this._hasGeometryEdit=!1):this.featureView.resetFromLayerRows();this._updateSync(!this.featureView._validateAddressDifference());this._updateLocate(!0)},_locate:function(a){if("keydown"!==a.type||a.keyCode===w.ENTER||a.keyCode===w.SPACE)this._locateDisabled||this._locateFeature().then(c.hitch(this,function(){this._hasAddressEdit=!1;this._updateLocate(!0)}))},_cancel:function(b){if(("keydown"!==b.type||b.keyCode===w.ENTER||b.keyCode===w.SPACE)&&!this._cancelDisabled)var e=new a({titleLabel:this.nls.featureToolbar.cancelTitle,
width:400,autoHeight:!0,content:x.create("div",{innerHTML:this.nls.featureToolbar.cancelMessage,style:"padding-bottom: 10px;"}),buttons:[{label:this.nls.yes,onClick:c.hitch(this,function(){e.close();e=null;this._undoEdits();this._updateSaveAndCancel(!0);this._panToAndSelectFeature(this.featureView.isDuplicate&&this.featureView._useGeomFromLayer?this.featureView._editFeature:this.featureView._feature)})},{label:this.nls.no,onClick:c.hitch(this,function(){e.close()})}],onClose:c.hitch(this,function(){e=
null})})},_save:function(a,b){if("keydown"!==a.type||a.keyCode===w.ENTER||a.keyCode===w.SPACE){var e=this.featureView._feature;if(!this._saveDisabled||!0===b){!0!==b&&(this._setFieldValues(this.featureView),this._setAddressValues(this.featureView),this.featureView.feature.geometry=e.geometry,this._originalValues.geometry=e.geometry,this.featureView.isDuplicate&&(this._originalValues.duplicateGeometry=e.geometry));if(-1===this.featureView.label.indexOf("UnMatched")&&-1===this.featureView.label.indexOf("DuplicateFeatures"))this._updateLayer(this._stageLayer,
null,[e],null,!0,!1).then(c.hitch(this,function(a){a&&"success"===a.status&&this._updateFeatureListLabel(e)}));else if(this.featureView.isDuplicate&&!0!==b)this.featureView._updateDuplicateAttributes(null,!0),this._updateLayer(this.layer,null,[e],null,!0,!1).then(c.hitch(this,function(a){a&&"success"===a.status&&this._updateFeatureListLabel(e)}));else{var d=e.attributes[this.layer.objectIdField];this._updateLayer(this.layer,null,null,[e],!0,!1).then(c.hitch(this,function(a){a&&"success"===a.status&&
this.featureView._parentFeatureList.removeFeature(this.featureView.feature,d).then(c.hitch(this,function(){f.forEach(this.featureView._skipFields,c.hitch(this,function(a){delete e.attributes[a]}));this._updateLayer(this._stageLayer,[e],null,null,!0,!1).then(c.hitch(this,function(a){a&&"success"===a.status&&(a.hasOwnProperty("objectId")&&(this.featureView.feature.fieldInfo.filter(c.hitch(this,function(a){return a.name===this._stageLayer.objectIdField}))[0].value=a.objectId),this.featureView.feature.label=
e.attributes[this.csvStore.labelField],a=this.parent._pageContainer.getViewByTitle("Review"),a.matchedFeatureList.addFeature(this.featureView.feature),a.matchedFeatureList.resetFeatureList(),a._updateReviewRows(!0===b?"duplicate":"unmatched"))}))}))}))}!0!==b&&this._updateSaveAndCancel(!0)}}},_updateFeatureListLabel:function(a){var b=this.csvStore.labelField;a=a.attributes[b];var c=q.stripHTML(a.toString?a.toString():"");c!==this.featureView.featureListLabel.innerHTML&&("."!==this.csvStore.decimalSeperator&&
(a=this.feature.fieldInfo.filter(function(a){return a.name===b&&a.needsFormat&&-1===[null,void 0].indexOf(c)}))&&a.hasOwnProperty("length")&&0<a.length&&(c=q.localizeNumber(c),a[0].formattedValue=c),this.featureView.featureListLabel.innerHTML=c,this.featureView.pageTitleDiv.innerHTML=c)},_updateLayer:function(a,b,e,g,f,q){var l=new p;a.applyEdits(b,e,g).then(c.hitch(this,function(a){var b={status:"success"};this.featureView.isDuplicate&&(this._hasGeometryEdit&&this.featureView._useGeomFromFile&&(this._fileGeometryModified=
!0),this._hasAttributeEdit&&this.featureView._useValuesFromFile&&(this._fileValuesModified=!0));f&&(this._hasAttributeEdit=this._hasGeometryEdit=!1);a&&a.hasOwnProperty("length")&&0<a.length&&a[0].hasOwnProperty("objectId")&&(b.objectId=a[0].objectId);!q&&e&&e.hasOwnProperty("length")&&0<e.length&&(a=this.featureView.parent._pageContainer.getViewByTitle("Review"),a._updateNode(a.submitButton,!0));l.resolve(b)}),c.hitch(this,function(a){new d({message:this.nls.warningsAndErrors.saveError});l.resolve({status:"error",
error:a})}));return l},_setFieldValues:function(a){var b=a._useValuesFromFile,c=b?a._changedFileAttributeRows:a._changedLayerAttributeRows,e=a._feature,d=a.feature;f.forEach(a.featureControlTable.rows,function(a){if(a.isEditRow&&-1<c.indexOf(a.rowIndex)||a.parent&&a.parent.isDuplicate&&!b){var g=a.parent.isDuplicate&&!b?a.layerValueTextBox:a.fileValueTextBox;e.attributes[a.fieldName]=g.value;d.fieldInfo.filter(function(b){return b.name===a.fieldName})[0].value=g.value;a.parent.isDuplicate&&!b?a.layerValue=
g.value:a.fileValue=g.value;if(g.textbox)g.textbox.title=g.value;else if(g.domNode){var f=g.attr("displayedValue");g.domNode.title=f?f:g.value}}})},_setAddressValues:function(a){var b=a._getAddress(),c=this.csvStore.matchFieldPrefix;a.isDuplicate&&a._useGeomFromLayer||f.forEach(a.addressFields,function(e){var d=c+e.keyField;a.feature.fieldInfo.filter(function(a){return a.name===d})[0].value=b[d];for(var g,f=0;f<a.locationControlTable.rows.length&&(g=a.locationControlTable.rows[f],!g.isAddressRow||
g.keyField!==e.keyField);f++);g.addressValueTextBox.textbox?g.addressValueTextBox.textbox.title=b[d]:g.addressValueTextBox.domNode&&(e=g.addressValueTextBox.attr("displayedValue"),g.addressValueTextBox.domNode.title=e?e:g.addressValueTextBox.value);g.addressValue=b[d]})},_updateFeature:function(a,b,e){var d=this.featureView;d.feature.geometry=a;d._feature.geometry=a;a=[d._feature];d.isDuplicate?(d.isDuplicateLocated||(d.isDuplicateLocated=!0),this._hasGeometryEdit=d._editFeature.geometry.x!==d._feature.geometry.x||
d._editFeature.geometry.y!==d._feature.geometry.y):d.isUnMatched&&!d.isUnMatchedLocated&&(d.isUnMatchedLocated=!0);b||this._updateLayer(d.layer,null,a,null,!1,e).then(c.hitch(this,function(a){a&&"success"===a.status&&(this._panToAndSelectFeature(d._feature),d.emit("address-located"))}))},_locateFeature:function(a){var b=new p,g=this.featureView._getAddressFieldsValues();if(this._isAddressFeature){var f=this.parent.portal?this.parent.portal:this.appConfig.portalUrl?e.getPortal(this.appConfig.portalUrl):
null;this._addressToLocation({address:g,countryCode:this.locatorSource.countryCode,outFields:["ResultID","Score"],forStorage:this.featureView.isDuplicate&&!this.featureView.isDuplicateLocated||this.featureView.isUnMatched&&!this.featureView.isUnMatchedLocated,token:f&&f.credential&&f.credential.token?f.credential.token:null}).then(c.hitch(this,function(c){this.locator=this._getLocator(0);this._updateFeature(c.location,a,!0);b.resolve({feature:this.featureView.feature,address:c.address})}),function(a){new d({message:a.message})})}else g=
this.csvStore._getGeometry(g[this.xField],g[this.yField]),this._updateFeature(g,a,!0),b.resolve({feature:this.featureView.feature,geometry:g});return b},_addressToLocation:function(a){var b=new p;a.maxLocations=1;this.locator.addressToLocations(a,c.hitch(this,function(c){var e=this.csvStore.minScore,d;c&&0<c.length?(f.forEach(c,function(a){"undefined"===typeof d&&a.score>=e&&(d=a);d&&a.score>d.score&&(d=a)}),d?b.resolve(d):this._getNextLocator()?this._addressToLocation(a).then(function(a){b.resolve(a)}):
b.reject({message:this.nls.warningsAndErrors.cannotLocate})):this._getNextLocator()?this._addressToLocation(a).then(function(a){b.resolve(a)}):b.reject({message:this.nls.warningsAndErrors.cannotLocate})}),function(a){b.reject(a)});return b},_getNextLocator:function(){var a=!1,b=this._locatorIndex+1;b<this.csvStore._geocodeSources.length&&(this.locator=this._getLocator(b),a="undefined"!==typeof this.locator);return a},_flashFeatures:function(a){var e;f.forEach(a,c.hitch(this,function(a){if(a.geometry){var d=
A.fromHex(this.styleColor),g=c.clone(d);g.a=.4;d=new y(y.STYLE_CIRCLE,15,new z(z.STYLE_SOLID,d,1),g);a=new D(a.geometry,d);this.map.graphics.add(a);e=a.getLayer?a.getLayer():e;(a=a.getDojoShape())&&b.animateStroke({shape:a,duration:900,color:{start:a.strokeStyle.color,end:a.strokeStyle.color},width:{start:25,end:0}}).play()}}));setTimeout(c.hitch(this,function(b){b&&b.clear&&(b.clear(),a&&(a[0]._layer&&a[0]._layer.infoTemplate||a[0].infoTemplate)&&(this.map.infoWindow.setFeatures(a),this.map.infoWindow.select(0)))}),
1200,e)},_panToAndSelectFeature:function(a){if(a&&a.geometry){var b=this.map.getMaxZoom(),e=Math.round(.25*b);this.map.centerAndZoom(a.geometry,0<b-e?b-e:b).then(c.hitch(this,function(){this._flashFeatures([a])}))}},setStyleColor:function(a){this.styleColor=a},_updateCancel:function(a){this._cancelDisabled=a;this._updateImageNode("bg-cancel","bg-cancel-white","bg-cancel-disabled",this._cancelDisabled,this.domNode);this.cancelButton&&(a?k.set(this.cancelButton,"tabindex","-1"):k.set(this.cancelButton,
"tabindex","0"))},_updateSaveAndCancel:function(a){this._updateSave(a);this._updateCancel(a)},_updateSave:function(a){this._saveDisabled=a;this._updateImageNode("bg-save","bg-save-white","bg-save-disabled",this._saveDisabled,this.domNode);this.saveButton&&(a?k.set(this.saveButton,"tabindex","-1"):k.set(this.saveButton,"tabindex","0"))},_updateLocate:function(a){this._locateDisabled=a;this._updateImageNode("bg-locate","bg-locate-white","bg-locate-disabled",this._locateDisabled,this.featureView.domNode);
a?k.set(this.featureView.locateButton,"tabindex","-1"):k.set(this.featureView.locateButton,"tabindex","0")},_updateSync:function(a){this._syncDisabled=a;this.featureView.syncFields&&(this._updateImageNode("bg-sync","bg-sync-white","bg-sync-disabled",this._syncDisabled,this.featureView.domNode),a?k.set(this.featureView.syncFields,"tabindex","-1"):k.set(this.featureView.syncFields,"tabindex","0"))},updateImageNodes:function(){this._updateImageNode("bg-cancel","bg-cancel-white","bg-cancel-disabled",
this._cancelDisabled,this.domNode);this._updateImageNode("bg-save","bg-save-white","bg-save-disabled",this._saveDisabled,this.domNode);this._updateImageNode("bg-locate","bg-locate-white","bg-locate-disabled",this._locateDisabled,this.featureView.domNode);this._updateImageNode("bg-sync","bg-sync-white","bg-sync-disabled",this._syncDisabled,this.featureView.domNode)},_updateImageNode:function(a,b,c,e,d){var g=this.pageContainer.isDarkTheme,q=e?c:g?b:a,l=g?b:a;e=!1;g=n("."+a,d);g.hasOwnProperty("length")&&
0===g.length?g=n("."+c,d):(e=!0,l=a);!e&&g.hasOwnProperty("length")&&0===g.length?g=n("."+b,d):e||(e=!0,l=c);f.forEach(g,function(a){u.remove(a,l);u.add(a,q)})}})})},"dojox/gfx/fx":function(){define("dojo/_base/lang ./_base ./matrix dojo/_base/Color dojo/_base/array dojo/_base/fx dojo/_base/connect dojo/sniff".split(" "),function(v,c,f,h,n,u,k,x){function p(a,b){this.start=a;this.end=b}function B(a,b,c){this.start=a;this.end=b;this.units=c}function t(a,b){this.start=a;this.end=b;this.temp=new h}function r(a){this.values=
a;this.length=a.length}function w(a,b){this.values=a;this.def=b?b:{}}function b(a,b){this.stack=a;this.original=b}function l(a,b,d,g){if(a.values)return new r(a.values);var e,f;f=a.start?c.normalizeColor(a.start):e=b?d?b[d]:b:g;a.end?a=c.normalizeColor(a.end):(e||(e=b?d?b[d]:b:g),a=e);return new t(f,a)}var g=c.fx={};p.prototype.getValue=function(a){return(this.end-this.start)*a+this.start};B.prototype.getValue=function(a){return(this.end-this.start)*a+this.start+this.units};t.prototype.getValue=function(a){return h.blendColors(this.start,
this.end,a,this.temp)};r.prototype.getValue=function(a){return this.values[Math.min(Math.floor(a*this.length),this.length-1)]};w.prototype.getValue=function(a){var b=v.clone(this.def),c;for(c in this.values)b[c]=this.values[c].getValue(a);return b};b.prototype.getValue=function(a){var b=[];n.forEach(this.stack,function(c){if(c instanceof f.Matrix2D)b.push(c);else if("original"==c.name&&this.original)b.push(this.original);else if("matrix"==c.name){if(c.start instanceof f.Matrix2D&&c.end instanceof
f.Matrix2D){var e=new f.Matrix2D,d;for(d in c.start)e[d]=(c.end[d]-c.start[d])*a+c.start[d];b.push(e)}}else c.name in f&&(e=f[c.name],"function"!=typeof e?b.push(e):(d=n.map(c.start,function(b,e){return(c.end[e]-b)*a+b}),e=e.apply(f,d),e instanceof f.Matrix2D&&b.push(e)))},this);return b};var d=new h(0,0,0,0);g.animateStroke=function(a){a.easing||(a.easing=u._defaultEasing);var b=new u.Animation(a),c=a.shape,g;k.connect(b,"beforeBegin",b,function(){g=c.getStroke();var b=a.color,e={},f;b&&(e.color=
l(b,g,"color",d));(b=a.style)&&b.values&&(e.style=new r(b.values));if(b=a.width){var q=b,y=g;q.values?f=new r(q.values):(b=q.start?q.start:f=y?y.width:1,q.end?f=q.end:"number"!=typeof f&&(f=y?y.width:1),f=new p(b,f));e.width=f}(b=a.cap)&&b.values&&(e.cap=new r(b.values));if(b=a.join)b.values?e.join=new r(b.values):(f=b.start?b.start:g&&g.join||0,b=b.end?b.end:g&&g.join||0,"number"==typeof f&&"number"==typeof b&&(e.join=new p(f,b)));this.curve=new w(e,g)});k.connect(b,"onAnimate",c,"setStroke");return b};
g.animateFill=function(a){a.easing||(a.easing=u._defaultEasing);var b=new u.Animation(a),c=a.shape,g;k.connect(b,"beforeBegin",b,function(){g=c.getFill();var b=a.color;b&&(this.curve=l(b,g,"",d))});k.connect(b,"onAnimate",c,"setFill");return b};g.animateFont=function(a){a.easing||(a.easing=u._defaultEasing);var b=new u.Animation(a),c=a.shape,d;k.connect(b,"beforeBegin",b,function(){d=c.getFont();var b=a.style,e={},g,f;b&&b.values&&(e.style=new r(b.values));(b=a.variant)&&b.values&&(e.variant=new r(b.values));
(b=a.weight)&&b.values&&(e.weight=new r(b.values));(b=a.family)&&b.values&&(e.family=new r(b.values));(b=a.size)&&b.units&&(g=parseFloat(b.start?b.start:c.font&&c.font.size||"0"),f=parseFloat(b.end?b.end:c.font&&c.font.size||"0"),e.size=new B(g,f,b.units));this.curve=new w(e,d)});k.connect(b,"onAnimate",c,"setFont");return b};g.animateTransform=function(a){a.easing||(a.easing=u._defaultEasing);var e=new u.Animation(a),d=a.shape,g;k.connect(e,"beforeBegin",e,function(){g=d.getTransform();this.curve=
new b(a.transform,g)});k.connect(e,"onAnimate",d,"setTransform");if("svg"===c.renderer&&(9<=x("ie")||x("ff")))var f=[k.connect(e,"onBegin",e,function(){for(var a=d.getParent();a&&a.getParent;)a=a.getParent();a&&(d.__svgContainer=a.rawNode.parentNode,d.__svgRoot=a.rawNode,d.__svgRoot&&d.__svgRoot.getAttribute&&(d.__svgWidth=parseInt(d.__svgRoot.getAttribute("width"),10),isNaN(d.__svgWidth)&&delete d.__svgWidth))}),k.connect(e,"onAnimate",e,function(){try{if(d.__svgContainer){var a=d.__svgContainer.style.visibility;
d.__svgContainer.style.visibility="visible";d.__svgContainer.style.visibility=a;var b=d.__svgWidth;if(!isNaN(b))try{d.__svgRoot.setAttribute("width",b-5E-6),d.__svgRoot.setAttribute("width",b)}catch(m){}}}catch(m){}}),k.connect(e,"onEnd",e,function(){n.forEach(f,k.disconnect);if(d.__svgContainer){var a=d.__svgContainer;if(null==a.getAttribute("__gotVis")){a.setAttribute("__gotVis",!0);var b=d.__svgContainer.style.visibility,c=d.__svgRoot,e=d.__svgWidth;a.style.visibility="visible";setTimeout(function(){try{a.style.visibility=
b;a.removeAttribute("__gotVis");a=null;try{isNaN(e)||(c.setAttribute("width",e-5E-6),c.setAttribute("width",e))}catch(C){}}catch(C){}},100)}}delete d.__svgContainer;delete d.__svgRoot;delete d.__svgWidth})];return e};return g})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(v,c,f,h,n,u,k,x,p,B,t,r,w,b,l,g,d,a,e,q,y){var z=c(w,{declaredClass:"esri.toolbars.Edit",constructor:function(b,c){this._map=b;this._tool=0;if(this._map.loaded)this._scratchGL=b.graphics;else var d=h.connect(this._map,"onLoad",this,function(){h.disconnect(d);d=null;this._scratchGL=this._map.graphics});b=k("esri-mobile");this._defaultOptions=f.mixin({vertexSymbol:new a(a.STYLE_CIRCLE,b?20:12,new e(e.STYLE_SOLID,new u([0,0,0,.5]),1),new u([128,128,128])),ghostVertexSymbol:new a(a.STYLE_CIRCLE,
b?18:10,new e(e.STYLE_SOLID,new u([0,0,0,.5]),1),new u([255,255,255,.75])),ghostLineSymbol:new e(e.STYLE_DOT,new u([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:b?24:16,boxLineSymbol:new e(e.STYLE_DASH,new u([64,64,64]),1),boxHandleSymbol:new a(a.STYLE_SQUARE,b?16:9,new e(e.STYLE_SOLID,new u([0,0,0,.5]),1),new u([255,255,255,.75])),textAnchorSymbol:new a(a.STYLE_CIRCLE,10,null,new u([255,0,0]))},c||{})},activate:function(a,b,c){this.deactivate();this._graphic=b;this._options=
f.mixin(f.mixin({},this._defaultOptions),c||{});var e=z.MOVE;c=z.EDIT_VERTICES;var d=z.SCALE,g=z.ROTATE,l=z.EDIT_TEXT,q=!1,m=!1,y=!1,A=this._map,k=A.spatialReference,p=b.geometry.spatialReference;this._geo=!(!k||!p||k.equals(p)||!k.isWebMercator()||4326!==p.wkid);this._isTextPoint=this._prepareTextSymbolEditing(b,a);(a&e)===e&&(q=this._enableMove(b));e=(a&d)===d;g=(a&g)===g;if(e||g)y=this._enableBoxEditing(b,e,g);(a&c)===c&&(m=this._enableVertexEditing(b));(a&l)===l&&this._enableTextEditing(b);if(!(q||
m||y))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=a)this._mapPanEndHandle=h.connect(A,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=h.connect(A,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,b);A.snappingManager&&(q||m)&&A.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var a=this._tool,b=this._graphic;if(a){var c=
!!this._modified;this._clear();h.disconnect(this._mapPanEndHandle);h.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(a,b,{isModified:c});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(a,b){},onDeactivate:function(a,b,c){},
onGraphicMoveStart:function(a){},onGraphicFirstMove:function(a){this._modified=!0},onGraphicMove:function(a,b){},onGraphicMoveStop:function(a,b){},onGraphicClick:function(a,b){},onVertexMoveStart:function(a,b){},onVertexFirstMove:function(a,b){this._modified=!0},onVertexMove:function(a,b,c){},onVertexMoveStop:function(a,b,c){},onVertexAdd:function(a,b){this._modified=!0},onVertexClick:function(a,b){},onVertexMouseOver:function(a,b){},onVertexMouseOut:function(a,b){},onVertexDelete:function(a,b){this._modified=
!0},onTextEditStart:function(a,b){},onTextEditEnd:function(a){},onScaleStart:function(a){},onScaleFirstMove:function(a){this._modified=!0},onScale:function(a,b){},onScaleStop:function(a,b){},onRotateStart:function(a){},onRotateFirstMove:function(a){this._modified=!0},onRotate:function(a,b){},onRotateStop:function(a,b){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic","transform"],
"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(a,b){if("point"===a.geometry.type||"multipoint"===a.geometry.type){var c=a.getLayer(),e=c.renderer,c=a.symbol||c._getSymbol(a);!c&&(e.hasVisualVariables("sizeInfo",!1)||e.hasVisualVariables("colorInfo",!1)||e.hasVisualVariables("opacityInfo",!1))&&e.addBreak&&
e.infos&&1===e.infos.length&&(c=e.infos[0].symbol||e.defaultSymbol);if(c&&"textsymbol"===c.type){if((b&z.SCALE)===z.SCALE||(b&z.ROTATE)===z.ROTATE||(b&z.EDIT_TEXT)===z.EDIT_TEXT){a.setSymbol(new q(c.toJson()));var d=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(a),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){d._boxEditor&&d._boxEditor.refresh()})):
v(["../dijit/SymbolEditor"],function(b){if(!d._textSymbolEditor){var c;c=d._options.textSymbolEditorHolder?x.create("div",null,d._options.textSymbolEditorHolder):x.create("div",null,d._map.root);d._textSymbolEditor=new b({graphic:a},c);b=d._textSymbolEditor.domNode.parentNode.id;p.set(d._textSymbolEditor.domNode,{position:"map_root"===b?"absolute":"relative",left:"map_root"===b?d._map.width/2-100+"px":"5px",top:"20px","z-index":50});d._textSymbolEditor.startup();d._textSymbolEditor.createForm(a);
d._textSymbolEditor.show();d._textSymbolEditor.on("symbol-change",function(){d._boxEditor&&d._boxEditor.refresh()})}})}if((b&z.MOVE)===z.MOVE||(b&z.ROTATE)===z.ROTATE||(b&z.SCALE)===z.SCALE)this._textAnchor=new y(a.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(a){var b=this._map;switch(a.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new l(a,b,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(a){var b=
this._map;switch(a.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=g.create(a,b,this),!0}return!1},_enableBoxEditing:function(a,c,d){var e=this._map,g=a.geometry.type;return"polyline"===g||"polygon"===g||this._isTextPoint?(this._boxEditor=new b(a,e,this,c,d,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(a){return this._isTextPoint?(this._textEditor=new d(a,this._map,this),h.connect(this._textEditor,"onEditStart",f.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var a=this._graphicMover;a&&(a.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var a=this._vertexEditor;a&&(a.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var a=this._boxEditor;a&&(a.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(a,b,c){c&&this._refreshMoveables()},_refreshMoveables:function(a){var b=n.filter([this._graphicMover,this._vertexEditor,this._boxEditor],t.isDefined);n.forEach(b,function(b){b.refresh(a)})},_beginOperation:function(a){n.forEach(this._getAffectedTools(a),function(a){a.suspend()})},_endOperation:function(a){n.forEach(this._getAffectedTools(a),function(a){a.resume()})},_getAffectedTools:function(a){var b=[];switch(a){case "MOVE":b=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":b=[this._boxEditor];break;case "BOX":b=[this._vertexEditor]}return b=n.filter(b,t.isDefined)}});f.mixin(z,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});k("extend-esri")&&f.setObject("toolbars.Edit",z,B);return z})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(v,c,f,h,n,u,k,x,p,B,t,r,w,b,l,g,d){v=v(null,{declaredClass:"esri.toolbars._Box",constructor:function(a,b,d,g,f,l,h){this._graphic=a;this._map=b;this._toolbar=d;this._scale=g;this._rotate=f;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=l;a=d._options;this._markerSymbol=a.boxHandleSymbol;this._lineSymbol=a.boxLineSymbol;this._moveStartHandler=c.hitch(this,this._moveStartHandler);this._firstMoveHandler=c.hitch(this,this._firstMoveHandler);
this._moveStopHandler=c.hitch(this,this._moveStopHandler);this._moveHandler=c.hitch(this,this._moveHandler);this._isTextPoint=h;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){f.forEach(this._getAllGraphics(),function(a){a.hide()})},resume:function(){f.forEach(this._getAllGraphics(),function(a){a.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
f.forEach(this._connects,h.disconnect);var a=this._toolbar._scratchGL;this._anchors&&f.forEach(this._anchors,function(b){a.remove(b.graphic);(b=b.moveable)&&b.destroy()});this._box&&a.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var a=this._map,b=this._toolbar._scratchGL,g=this._getBoxCoords(),l=new w(a.spatialReference),h=c.clone(f.filter(g,function(a,b){return 8!==b&&0===b%2}));h[0]&&h.push([h[0][0],h[0][1]]);l.addPath(h);this._rotate&&
l.addPath([g[1],g[8]]);this._box?this._box.setGeometry(l):(this._box=new d(l,this._lineSymbol),b.add(this._box));this._anchors?f.forEach(this._anchors,function(b,c){this._scale||(c=8);var d=new r(g[c],a.spatialReference);b.graphic.setGeometry(d);var d=b.moveable,e=b.graphic.getDojoShape();e&&(d?e!==d.shape&&(d.destroy(),b.moveable=this._getMoveable(b.graphic,c)):b.moveable=this._getMoveable(b.graphic,c))},this):(this._anchors=[],this._connects=[],f.forEach(g,function(c,e){!this._scale&&8>e||(c=new r(c,
a.spatialReference),c=new d(c,this._markerSymbol),this._isTextPoint&&1===e%2&&c.hide(),b.add(c),this._anchors.push({graphic:c,moveable:this._getMoveable(c,e)}))},this))}else this._cleanUp()},_getBoxCoords:function(a){var b=this._map,d,g=[],l,h,k;if(this._isTextPoint){d=this._graphic.getNode().getBoundingClientRect();var m=b.__container.getBoundingClientRect();d=[{x:d.left-m.left,y:d.top-m.top},{x:d.right-m.left,y:d.top-m.top},{x:d.right-m.left,y:d.bottom-m.top},{x:d.left-m.left,y:d.bottom-m.top}]}else d=
this._getTransformedBoundingBox(this._graphic);f.forEach(d,function(c,d,e){l=c;(h=e[d+1])||(h=e[0]);k={x:(l.x+h.x)/2,y:(l.y+h.y)/2};a||(l=b.toMap(l),k=b.toMap(k));g.push([l.x,l.y]);g.push([k.x,k.y])});this._rotate&&(d=c.clone(g[1]),d=a?{x:d[0],y:d[1]}:b.toScreen({x:d[0],y:d[1],spatialReference:b.spatialReference}),d.y-=this._toolbar._options.rotateHandleOffset,a||(d=b.toMap(d)),g.push([d.x,d.y]));return g},_getTransformedBoundingBox:function(a){var b=this._map,c=a.geometry.getExtent(),d=a.geometry.spatialReference;
a=new r(c.xmin,c.ymax,d);c=new r(c.xmax,c.ymin,d);a=b.toScreen(a);c=b.toScreen(c);return[{x:a.x,y:a.y},{x:c.x,y:a.y},{x:c.x,y:c.y},{x:a.x,y:c.y}]},_getAllGraphics:function(){var a=[this._box];this._anchors&&f.forEach(this._anchors,function(b){a.push(b.graphic)});return a=f.filter(a,t.isDefined)},_getMoveable:function(a,b){var c=a.getDojoShape();if(c)return a=new x(c),a._index=b,this._connects.push(h.connect(a,"onMoveStart",this._moveStartHandler)),this._connects.push(h.connect(a,"onFirstMove",this._firstMoveHandler)),
this._connects.push(h.connect(a,"onMoveStop",this._moveStopHandler)),a.onMove=this._moveHandler,(c=c.getEventSource())&&k.set(c,"cursor",this._toolbar._cursors["box"+b]),a},_moveStartHandler:function(a){this._toolbar["on"+(8===a.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(a){this._toolbar._deactivateScrollWheel();var b=a.host._index,d=this._wrapOffset=a.host.shape._wrapOffsets[0]||0,g=this._graphic.getLayer().getNavigationTransform(),l;a=f.map(this._getBoxCoords(!0),
function(a){return{x:a[0]+d,y:a[1]}});l=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:a[1].x,y:a[3].y};this._centerCoord=p.multiplyPoint(p.invert(g),l);if(8===b)l=p.multiplyPoint(p.invert(g),a[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,l)),this._startLine=[this._centerCoord,l],this._moveLine=c.clone(this._startLine);else if(l=p.multiplyPoint(p.invert(g),a[b]),g=p.multiplyPoint(p.invert(g),a[(b+4)%8]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,
l)),this._firstMoverToAnchor=Math.sqrt((l.x-this._centerCoord.x)*(l.x-this._centerCoord.x)+(l.y-this._centerCoord.y)*(l.y-this._centerCoord.y)),this._startBox=g,this._startBox.width=a[4].x-a[0].x,this._startBox.height=a[4].y-a[0].y,this._moveBox=c.clone(this._startBox),this._xfactor=l.x>g.x?1:-1,this._yfactor=l.y>g.y?1:-1,1===b||5===b)this._xfactor=0;else if(3===b||7===b)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===b?this._rotateEvent:this._scaleEvent)+"FirstMove"](this._graphic)},
_moveHandler:function(a,b){a=a.host._index;var c=this._defaultEventArgs,d,e,g;c.angle=0;c.scaleX=1;c.scaleY=1;if(8===a)d=this._startLine,e=this._moveLine,g=e[1],g.x+=b.dx,g.y+=b.dy,b=this._getAngle(d,e),this._isTextPoint&&(b+=this._graphic.symbol.angle),e=p.rotategAt(b,d[0]),this._graphic.getDojoShape().setTransform(e),c.transform=e,c.angle=b,c.around=d[0];else{d=this._startBox;e=this._moveBox;e.width+=b.dx*this._xfactor;e.height+=b.dy*this._yfactor;this._uniformScaling||this._isTextPoint?(d=e.x+
this._xfactor*e.width,e=e.y+this._yfactor*e.height,d=Math.sqrt((d-this._centerCoord.x)*(d-this._centerCoord.x)+(e-this._centerCoord.y)*(e-this._centerCoord.y)),this._scaleRatio=b=g=d/this._firstMoverToAnchor,d=this._centerCoord):(b=e.width/d.width,g=e.height/d.height,d={x:d.x,y:d.y});if(isNaN(b)||Infinity===b||-Infinity===b)b=1;if(isNaN(g)||Infinity===g||-Infinity===g)g=1;e=p.scaleAt(b,g,d);if(this._isTextPoint){var f=p.rotategAt(this._graphic.symbol.angle,d);this._graphic.getDojoShape().setTransform([f,
e])}else this._graphic.getDojoShape().setTransform(e);c.transform=e;c.scaleX=b;c.scaleY=g;c.around=d}this._toolbar["on"+(8===a?this._rotateEvent:this._scaleEvent)](this._graphic,c)},_moveStopHandler:function(a){this._toolbar._activateScrollWheel();var b=this._graphic,c=this._toolbar,d=c._geo?l.geographicToWebMercator(b.geometry):b.geometry,f=d.spatialReference,h=b.getDojoShape(),k=h.getTransform(),m=b.getLayer().getNavigationTransform();this._isTextPoint?(b=this._graphic.symbol,8===a.host._index?
b.angle+=this._getAngle(this._startLine,this._moveLine):b.font.setSize(Math.round(b.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(b)):(d=d.toJson(),this._updateSegments(d.paths||d.rings,k,m,f),h.setTransform(null),d=g.fromJson(d),b.setGeometry(c._geo?l.webMercatorToGeographic(d,!0):d));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;c._endOperation("BOX");this._defaultEventArgs.transform=k;c["on"+(8===a.host._index?this._rotateEvent:
this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(a,b,c,d){var e=this._map,g=this._wrapOffset||0;f.forEach(a,function(a){f.forEach(a,function(a){this._updatePoint(a,d,g,p,e,c,b)},this)},this)},_updatePoint:function(a,b,c,d,g,f,l){b=g.toScreen({x:a[0],y:a[1],spatialReference:b},!0);b.x+=c;b=d.multiplyPoint([f,l,d.invert(f)],b);b.x-=c;c=g.toMap(b);a[0]=c.x;a[1]=c.y},_getAngle:function(a,b){return 180*Math.atan2(b[0].y-b[1].y,b[0].x-b[1].x)/Math.PI-180*Math.atan2(a[0].y-
a[1].y,a[0].x-a[1].x)/Math.PI},_deNormalizePoint:function(a,b){var c=this._map._getFrameWidth();if(-1===c)return a;for(a={x:a.x,y:a.y};Math.abs(a.x-b.x)>=c;)a.x=a.x<b.x?a.x+c:a.x-c;var d=Math.abs(a.x-b.x);Math.abs(a.x-b.x+c)<d?a.x+=c:Math.abs(a.x-b.x-c)<d&&(a.x-=c);return a}});u("extend-esri")&&c.setObject("toolbars._Box",v,B);return v})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(v,c,f,h,n,u,k,x,p,B){return c("dojox.gfx.Moveable",null,{constructor:function(c,f){this.shape=c;this.delay=f&&0<f.delay?f.delay:0;this.mover=f&&f.mover?f.mover:p;this.leftButtonOnly=f&&f.leftButtonOnly;this.events=[this.shape.on(u.press,v.hitch(this,"onMouseDown"))]},destroy:function(){f.forEach(this.events,function(c){c.remove()});this.events=this.shape=null},onMouseDown:function(c){this.delay?(this.events.push(this.shape.on(u.move,v.hitch(this,"onMouseMove")),this.shape.on(u.release,v.hitch(this,
"onMouseUp"))),this._lastX=c.clientX,this._lastY=c.clientY):this.leftButtonOnly&&!B.isLeft(c)||new this.mover(this.shape,c,this);h.stop(c)},onMouseMove:function(c){var f=c.clientY;if(Math.abs(c.clientX-this._lastX)>this.delay||Math.abs(f-this._lastY)>this.delay)this.onMouseUp(c),new this.mover(this.shape,c,this);h.stop(c)},onMouseUp:function(c){this.events.pop().remove()},onMoveStart:function(c){n.publish("/gfx/move/start",c);k.add(x.body(),"dojoMove")},onMoveStop:function(c){n.publish("/gfx/move/stop",
c);k.remove(x.body(),"dojoMove")},onFirstMove:function(c){},onMove:function(c,f,h){this.onMoving(c,f,h);this.shape.applyLeftTransform(f);this.onMoved(c,f)},onMoving:function(c,f){},onMoved:function(c,f){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(v,c,f,h,n,u){return f("dojox.gfx.Mover",null,{constructor:function(c,f,p){this.shape=c;this.lastX=f.clientX;this.lastY=f.clientY;c=this.host=p;f=
document;p=h(f,n.move,v.hitch(this,"onFirstMove"));this.events=[h(f,n.move,v.hitch(this,"onMouseMove")),h(f,n.release,v.hitch(this,"destroy")),h(f,"dragstart",v.hitch(u,"stop")),h(f,"selectstart",v.hitch(u,"stop")),p];if(c&&c.onMoveStart)c.onMoveStart(this)},onMouseMove:function(c){var f=c.clientX,h=c.clientY;this.host.onMove(this,{dx:f-this.lastX,dy:h-this.lastY},c);this.lastX=f;this.lastY=h;u.stop(c)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){c.forEach(this.events,
function(c){c.remove()});var f=this.host;if(f&&f.onMoveStop)f.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(v,c,f,h,n,u,k,x,p,B,t,r,w,b){var l=v(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(b,c,a,e){this.graphic=b;this.map=c;this.toolbar=a;this.tempPt=e;this._enableGraphicMover();this._moved=!1},refresh:function(b){var c=this.graphic.getDojoShape();!c||!b&&c._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var b=this.graphic,c=b.getDojoShape();c&&(c._hostGraphic=b,this._moveable=new u(c,{mover:l.Mover}),this._moveStartHandle=
f.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=f.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=f.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=f.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(b=c.getEventSource())&&n.set(b,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var b=this._moveable;if(b){f.disconnect(this._moveStartHandle);f.disconnect(this._firstMoveHandle);
f.disconnect(this._movingHandle);f.disconnect(this._moveStopHandle);var c=b.shape;c&&(c._hostGraphic=null,(c=c.getEventSource())&&n.set(c,"cursor","inherit"));b.destroy()}this._moveable=null},_moveStartHandler:function(){var b=this.graphic,c=this.map;this._startTx=b.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&c.snappingManager&&c.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(b)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(b,c,a){b=b.shape.getTransform();c=this.map;var d;t("esri-pointer")?d=c.navigationManager.pointerEvents._processTouchEvent(a,a):a&&"pointermove"===a.type&&(d=B.prototype._processTouchEvent.call({map:c},a,a));d&&c.snappingManager&&c.snappingManager._onSnappingMouseMoveHandler(d);this.tempPt&&this.tempPt.getDojoShape().setTransform(b);this.toolbar.onGraphicMove(this.graphic,b)},_moveStopHandler:function(c){var d=this.graphic,a=this.toolbar,e=this.map,g=a._geo?r.geographicToWebMercator(d.geometry):
d.geometry,f=g.type,l=d.getDojoShape(),k=l.getTransform();if(h.toJson(k)!==h.toJson(this._startTx)){this._moved=!0;switch(f){case "point":var f=[k,x.invert(this._startTx)],p;e.snappingManager&&(p=e.snappingManager._snappingPoint);g=p||e.toMap(x.multiplyPoint(f,e.toScreen(g,!0)));e.snappingManager&&e.snappingManager._killOffSnapping();break;case "polyline":g=this._updatePolyGeometry(g,g.paths,k);break;case "polygon":g=this._updatePolyGeometry(g,g.rings,k)}l.setTransform(null);d.setGeometry(a._geo?
r.webMercatorToGeographic(g,!0):g);this.tempPt&&this.tempPt.setGeometry(new b(d.geometry.toJson()))}else this._moved=!1;a._endOperation("MOVE");a.onGraphicMoveStop(d,k);this._moved||(c=c.__e,e=this.map.position,c=new w(c.pageX-e.x,c.pageY-e.y),a.onGraphicClick(d,{screenPoint:c,mapPoint:this.map.toMap(c)}))},_updatePolyGeometry:function(b,c,a){var d=this.map,g=b.getPoint(0,0),d=d.toMap(d.toScreen(g).offset(a.dx,a.dy));a=d.x-g.x;for(var g=d.y-g.y,f,l,h,d=0;d<c.length;d++)for(l=c[d],f=0;f<l.length;f++)h=
b.getPoint(d,f),b.setPoint(d,f,h.offset(a,g));return b}});l.Mover=v(k,{declaredClass:"esri.toolbars._Mover",constructor:function(b,c,a){this.__e=c}});t("extend-esri")&&(c.setObject("toolbars._GraphicMover",l,p),c.setObject("toolbars._Mover",l.Mover,p));return l})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),
function(v,c,f,h,n,u,k,x,p,B,t,r){var w=v(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(b,c,g){this.graphic=b;this.map=c;this.toolbar=g;b=g._options;this._symbol1=b.vertexSymbol;this._symbol2=b.ghostVertexSymbol;c=b.ghostLineSymbol;this._lineStroke={style:c.style,width:c.width,color:c.color};this._canDel=b.allowDeleteVertices;this._canAdd=b.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(b){b?(this._removeControllers(),
this._addControllers()):(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=f.connect(p,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=f.connect(p,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),
this._symbol1);this._canAdd&&(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var b=this._getGraphicsLayer();this._mouseOverHandle=f.connect(b,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=f.connect(b,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new u({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),b=this._ctxDelete=new k({label:r.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),
this._deleteHandle=f.connect(b,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(b),this._ctxMenu.startup())},_removeControllers:function(){f.disconnect(this._firstMoveHandle);f.disconnect(this._moveStopHandle);f.disconnect(this._mouseOverHandle);f.disconnect(this._mouseOutHandle);f.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=
this._mpVertexMovers=null},_add:function(b,c,g){var d,a,e=this.graphic,f=[];for(d=0;d<b.length;d++){var l=b[d],h=[];for(a=0;a<l.length;a++)h.push(new p(l[a],c,e,d,a,l.length,this,g));f.push(h)}return f},_remove:function(b){b&&h.forEach(b,function(b){h.forEach(b,function(b){b.destroy()})})},_refresh:function(b){b&&h.forEach(b,function(b){h.forEach(b,function(b){b.refresh()})})},_isNew:function(b){return-1===h.indexOf(this._vertexMovers[b.segIndex],b)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(b){b=this._selectedMover;this._updateRelatedGraphic(b,b.relatedGraphic,b.graphic.geometry,b.segIndex,b.ptIndex,b.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(b);this._deleteVertex(b);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(b){b=b.graphic;var c=this._findMover(b);c&&(this.toolbar.onVertexMouseOver(this.graphic,c._getInfo()),c._placeholder||(this._selectedMover=c,this._canDel&&this._bindCtxNode(b.getDojoShape().getNode())))},_mouseOutHandler:function(b){if(b=
this._findMover(b.graphic))this.toolbar.onVertexMouseOut(this.graphic,b._getInfo())},_bindCtxNode:function(b){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(b);this._bindNode=b},_unbindCtxNode:function(){var b=this._bindNode;b&&this._ctxMenu.unBindDomNode(b)},_findMover:function(b){var c,g=[];c=this._mpVertexMovers;h.forEach(this._vertexMovers,function(a){g=g.concat(a)});c&&h.forEach(c,function(a){g=g.concat(a)});
for(c=0;c<g.length;c++){var d=g[c];if(d.graphic===b)return d}},_firstMoveHandler:function(b){!this._isNew(b)&&this._canAdd&&this._hideRelatedMidpoints(b);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(b,c){var g=this._isNew(b);c&&(c.dx||c.dy)?(this._updateRelatedGraphic(b,b.relatedGraphic,b.graphic.geometry,b.segIndex,b.ptIndex,b.segLength,g),this._canAdd&&(g?this._addMidpoints(b):(this._repositionRelatedMidpoints(b),this._showRelatedMidpoints(b))),this.toolbar._endOperation("VERTICES")):
!g&&this._canAdd&&this._showRelatedMidpoints(b)},_showRelatedMidpoints:function(b){var c=this._getAdjacentMidpoints(b.ptIndex,b.segLength),g=this._mpVertexMovers[b.segIndex];for(b=0;b<c.length;b++){var d=g[c[b]];d.graphic.show();d.refresh()}},_hideRelatedMidpoints:function(b){var c=this._getAdjacentMidpoints(b.ptIndex,b.segLength),g=this._mpVertexMovers[b.segIndex];for(b=0;b<c.length;b++)g[c[b]].graphic.hide()},_repositionRelatedMidpoints:function(b){var c,g=this._getAdjacentMidpoints(b.ptIndex,b.segLength),
d=this._mpVertexMovers[b.segIndex];for(c=0;c<g.length;c++){var a=this._getAdjacentVertices(g[c],b.segLength),e=b.relatedGraphic.geometry.getPoint(b.segIndex,a[0]),a=b.relatedGraphic.geometry.getPoint(b.segIndex,a[1]),e=new B({x:(e.x+a.x)/2,y:(e.y+a.y)/2,spatialReference:e.spatialReference.toJson()});d[g[c]].graphic.setGeometry(e)}},_addMidpoints:function(b){var c=b.segIndex,g=b.ptIndex,d=b.segLength,a=g+1,e,f=d+1;this._mpVertexMovers[c].splice(g,1);var h=this._vertexMovers[c];for(e=0;e<a;e++)h[e].segLength+=
1;for(e=a;e<h.length;e++)h[e].ptIndex+=1,h[e].segLength+=1;b.ptIndex=a;b.segLength=h.length+1;h.splice(a,0,b);b.graphic.setSymbol(this._symbol1);h=this._mpVertexMovers[c];for(e=0;e<g;e++)h[e].segLength+=1;for(e=g;e<d-1;e++)h[e].ptIndex+=1,h[e].segLength+=1;a=this._getAdjacentVertices(g,f);c=this._getAdjacentVertices(g+1,f);d=b.relatedGraphic.geometry.getPoint(b.segIndex,a[0]);e=b.relatedGraphic.geometry.getPoint(b.segIndex,a[1]);a=new B({x:(d.x+e.x)/2,y:(d.y+e.y)/2,spatialReference:d.spatialReference.toJson()});
d=b.relatedGraphic.geometry.getPoint(b.segIndex,c[0]);e=b.relatedGraphic.geometry.getPoint(b.segIndex,c[1]);c=new B({x:(d.x+e.x)/2,y:(d.y+e.y)/2,spatialReference:d.spatialReference.toJson()});d=new p(a,this._symbol2,this.graphic,b.segIndex,g,f,this,!0);b=new p(c,this._symbol2,this.graphic,b.segIndex,g+1,f,this,!0);h.splice(g,0,d,b)},_deleteVertex:function(b){var c,g=b.ptIndex,d=this._vertexMovers[b.segIndex];for(c=0;c<g;c++)--d[c].segLength;for(c=g+1;c<d.length;c++){var a=d[c];--a.ptIndex;--a.segLength}d.splice(g,
1);c=b._getInfo();b.destroy();this.toolbar.onVertexDelete(this.graphic,c)}});c.mixin(w,{create:function(b,c,g){switch(b.geometry.type){case "multipoint":return new w.MultipointVertexEditor(b,c,g);case "polyline":return new w.PolylineVertexEditor(b,c,g);case "polygon":return new w.PolygonVertexEditor(b,c,g)}}});w.MultipointVertexEditor=v(w,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=f.connect(p,"onMoveStart",this,this._moveStartHandler);
f.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);f.disconnect(this._moveStartHandle)},_getSegments:function(b){var c=b.points,g=[],d=b.spatialReference;for(b=0;b<c.length;b++){var a=c[b];g.push(new B({x:a[0],y:a[1],spatialReference:d.toJson()}))}return[g]},_getMidpointSegments:function(b){return[]},_getControlPoints:function(b,c,g,d,a){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(b){var c=b.graphic;if(b=this._findMover(b))this.toolbar.onVertexMouseOver(c,
b._getInfo()),this._selectedMover=b,this._canDel&&this._bindCtxNode(b.graphic.getDojoShape().getNode())},_mouseOutHandler:function(b){var c=b.graphic;if(b=this._findMover(b))this.toolbar.onVertexMouseOut(c,b._getInfo())},_findMover:function(b){var c=[].concat(this._vertexMovers[0]),g=b.target;for(b=0;b<c.length;b++){var d=c[b];if(d.graphic.getDojoShape().getNode()===g)return d}},_moveStartHandler:function(b){var c=b.ptIndex,g=b.segLength-1,d=b.relatedGraphic.geometry.points;b=d.splice(c,1);d.push(b[0]);
d=this._vertexMovers[0];for(b=g;b>c;b--)--d[b].ptIndex;b=d.splice(c,1);d.push(b[0]);b[0].ptIndex=g},_moveStopHandler:function(b){this._updateRelatedGraphic(b,b.relatedGraphic,b.graphic.geometry,b.segIndex,b.ptIndex,b.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(b,c,g,d,a,e,f,h){b=c.geometry;h?b.removePoint(a):b.setPoint(a,g);c.setGeometry(b)},_deleteMidpoints:function(b){}});w.PolylineVertexEditor=v(w,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(b){var c,g,d=b.paths,a=[];for(c=0;c<d.length;c++){var e=d[c],f=[];for(g=0;g<e.length;g++)f.push(b.getPoint(c,g));a.push(f)}return a},_getMidpointSegments:function(b){var c,g,d=b.paths,a=[],e=b.spatialReference;for(c=0;c<d.length;c++){var f=d[c],h=[];for(g=0;g<f.length-1;g++){var k=b.getPoint(c,g),p=b.getPoint(c,g+1),k=new B({x:(k.x+p.x)/2,y:(k.y+p.y)/2,spatialReference:e.toJson()});h.push(k)}a.push(h)}return a},_getControlPoints:function(b,c,g,d,a){var e=this.map,f,l;this._isNew(b)?
(b=d,d+=1,0<=b&&(f=e.toScreen(c.getPoint(g,b))),d<=a&&(l=e.toScreen(c.getPoint(g,d)))):(b=d-1,d+=1,0<=b&&(f=e.toScreen(c.getPoint(g,b))),d<a&&(l=e.toScreen(c.getPoint(g,d))));return[f,l]},_getAdjacentMidpoints:function(b,c){var g=[],d=b-1;0<=d&&g.push(d);b<c-1&&g.push(b);return g},_getAdjacentVertices:function(b,c){return[b,b+1]},_deleteMidpoints:function(b){var c=this._mpVertexMovers[b.segIndex],g=c.length-1,d=this._getAdjacentMidpoints(b.ptIndex,b.segLength).sort(),a,e=d[0];for(a=0;a<e;a++)--c[a].segLength;
for(a=e+1;a<c.length;a++){var f=c[a];--f.ptIndex;--f.segLength}if(1===d.length)c.splice(e,1)[0].destroy();else for(f=this._getAdjacentVertices(e,g),a=b.relatedGraphic.geometry.getPoint(b.segIndex,f[0]),f=b.relatedGraphic.geometry.getPoint(b.segIndex,f[1]),a=new B({x:(a.x+f.x)/2,y:(a.y+f.y)/2,spatialReference:a.spatialReference.toJson()}),b=new p(a,this._symbol2,this.graphic,b.segIndex,e,g,this,!0),c=c.splice(e,d.length,b),a=0;a<c.length;a++)c[a].destroy()},_updateRelatedGraphic:function(b,c,g,d,a,
e,f,h){b=c.geometry;f?b.insertPoint(d,a+1,t.fromJson(g.toJson())):h?b.removePoint(d,a):b.setPoint(d,a,t.fromJson(g.toJson()));c.setGeometry(b)}});w.PolygonVertexEditor=v(w,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(b){var c,g,d=b.rings,a=[];for(c=0;c<d.length;c++){var e=d[c],f=[];for(g=0;g<e.length-1;g++)f.push(b.getPoint(c,g));a.push(f)}return a},_getMidpointSegments:function(b){var c,g,d=b.rings,a=[],e=b.spatialReference;for(c=0;c<d.length;c++){var f=d[c],
h=[];for(g=0;g<f.length-1;g++){var k=b.getPoint(c,g),p=b.getPoint(c,g+1),k=new B({x:(k.x+p.x)/2,y:(k.y+p.y)/2,spatialReference:e.toJson()});h.push(k)}a.push(h)}return a},_getControlPoints:function(b,c,g,d,a){var e=this.map;this._isNew(b)?b=d:(b=d-1,b=0>b?(a+b)%a:b);d=(d+1)%a;a=e.toScreen(c.getPoint(g,b));c=e.toScreen(c.getPoint(g,d));return[a,c]},_getAdjacentMidpoints:function(b,c){var g=b-1;return[0>g?(c+g)%c:g,b]},_getAdjacentVertices:function(b,c){return[b,(b+1)%c]},_deleteMidpoints:function(b){var c=
b.ptIndex,g=this._mpVertexMovers[b.segIndex],d=g.length-1,a=this._getAdjacentMidpoints(c,b.segLength).sort(),e,f;f=a[0];var h=a[a.length-1];if(0===c)for(e=this._getAdjacentVertices(d-1,d),c=b.relatedGraphic.geometry.getPoint(b.segIndex,e[0]),e=b.relatedGraphic.geometry.getPoint(b.segIndex,e[1]),c=new B({x:(c.x+e.x)/2,y:(c.y+e.y)/2,spatialReference:c.spatialReference.toJson()}),b=new p(c,this._symbol2,this.graphic,b.segIndex,d-1,d,this,!0),g.splice(h,1,b)[0].destroy(),g.splice(f,1)[0].destroy(),a=
0;a<g.length-1;a++)f=g[a],--f.ptIndex,--f.segLength;else{e=this._getAdjacentVertices(f,d);c=b.relatedGraphic.geometry.getPoint(b.segIndex,e[0]);e=b.relatedGraphic.geometry.getPoint(b.segIndex,e[1]);c=new B({x:(c.x+e.x)/2,y:(c.y+e.y)/2,spatialReference:c.spatialReference.toJson()});b=new p(c,this._symbol2,this.graphic,b.segIndex,f,d,this,!0);h=g.splice(f,a.length,b);for(a=0;a<h.length;a++)h[a].destroy();for(a=0;a<f;a++)--g[a].segLength;for(a=f+1;a<g.length;a++)f=g[a],--f.ptIndex,--f.segLength}},_updateRelatedGraphic:function(b,
c,g,d,a,e,f,h){b=c.geometry;f?b.insertPoint(d,a+1,t.fromJson(g.toJson())):h?(b.removePoint(d,a),0===a&&b.setPoint(d,e-1,t.fromJson(b.getPoint(d,0).toJson()))):(b.setPoint(d,a,t.fromJson(g.toJson())),0===a&&b.setPoint(d,e,t.fromJson(g.toJson())));c.setGeometry(b)}});n("extend-esri")&&(c.setObject("toolbars._GraphicVertexEditor",w,x),c.setObject("toolbars._MultipointVertexEditor",w.MultipointVertexEditor,x),c.setObject("toolbars._PolylineVertexEditor",w.PolylineVertexEditor,x),c.setObject("toolbars._PolygonVertexEditor",
w.PolygonVertexEditor,x));return w})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(v,c,f,h,n,u,k,x,p,B,t,r,w){v=v(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(b,c,g,d,a,e,f,h){this.point=b;this.symbol=c;this.relatedGraphic=g;this.segIndex=d;this.ptIndex=
a;this.segLength=e;this.editor=f;this.map=f.map;this._scratchGL=f.toolbar._scratchGL;this._placeholder=h||!1;this._type=g.geometry.type;this._init();this._enable()},refresh:function(b){if(b||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var b=new t(this.point.toJson()),
b=new r(b,this.symbol);switch(this._type){case "multipoint":b._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(b)}this.graphic=b},_enable:function(){var b=this.graphic.getDojoShape();b&&(b._hasMover=!0,this._moveable=this._getMoveable(b),(b=b.getEventSource())&&n.set(b,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var b=this._moveable;if(b){f.disconnect(this._startHandle);
f.disconnect(this._firstHandle);f.disconnect(this._movingHandle);f.disconnect(this._stopHandle);var c=b.shape;c&&(c=c.getEventSource())&&n.set(c,"cursor","inherit");b.destroy();this._moveable=null}},_needRefresh:function(){var b=this.graphic.getDojoShape(),c=!1;if(b)switch(this._type){case "multipoint":var g=this.relatedGraphic.getDojoShape();g&&(g=g.children[this.ptIndex],b!==g&&(this.graphic._shape=g,c=!0));break;case "polyline":case "polygon":c=!b._hasMover}return c},_getMoveable:function(b){b=
new u(b,h("mac")&&h("ff")&&!B("esri-touch")&&{leftButtonOnly:!0});this._startHandle=f.connect(b,"onMoveStart",this,this._moveStartHandler);this._firstHandle=f.connect(b,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=f.connect(b,"onMoving",this,this._movingHandler);this._stopHandle=f.connect(b,"onMoveStop",this,this._moveStopHandler);return b},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,
segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(b){var c=this.map;c.snappingManager&&c.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();b.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(b){var c=b.shape,g=this._getControlEdges(),d=this._scratchGL._div,a,e=[],f=b.host.shape._wrapOffsets[0]||
0;for(a=0;a<g.length;a++){var h=g[a];h.x1+=f;h.x2+=f;e.push([d.createLine({x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2}).setStroke(this.editor._lineStroke),h.x1,h.y1,h.x2,h.y2])}c._lines=e;b.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(b,c,g){c=this.map;var d;B("esri-pointer")?d=c.navigationManager.pointerEvents._processTouchEvent(g,g):g&&"pointermove"===g.type&&(d=p.prototype._processTouchEvent.call({map:c},
g,g));d&&c.snappingManager&&c.snappingManager._onSnappingMouseMoveHandler(d);g=b.shape;b=g.getTransform();g=g._lines;for(d=0;d<g.length;d++)c=g[d],c[0].setShape({x1:c[1]+b.dx,y1:c[2]+b.dy,x2:c[3],y2:c[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),b)},_moveStopHandler:function(b){b=b.shape;var c=this.editor.toolbar,g=b.getTransform(),d=this.map,a=this.graphic,e=c._geo?w.geographicToWebMercator(a.geometry):a.geometry;c._activateScrollWheel();var f,h=b._lines;if(h){for(f=
0;f<h.length;f++)h[f][0].removeShape();b._lines=null}f=!1;var h=!0,p=this._getInfo();g&&(g.dx||g.dy)?this._placeholder&&(this._placeholder=!1,f=!0):h=!1;var t;d.snappingManager&&(t=d.snappingManager._snappingPoint);var n=[g,k.invert(this._startTx)];t=t||d.toMap(k.multiplyPoint(n,d.toScreen(e,!0)));d.snappingManager&&d.snappingManager._killOffSnapping();b.setTransform(null);a.setGeometry(c._geo?w.webMercatorToGeographic(t,!0):t);this.constructor.onMoveStop(this,g);c.onVertexMoveStop(this.relatedGraphic,
p,g);if(!h)c.onVertexClick(this.relatedGraphic,p);if(f)c.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var b=this.map,c=this.relatedGraphic.geometry,g=this.segIndex,d=this.ptIndex,a=this.segLength,e=this._scratchGL.getNavigationTransform(),f=e.dx,e=e.dy,h=b.toScreen(this.graphic.geometry),b=h.x-f,h=h.y-e,k=[],c=this.editor._getControlPoints(this,c,g,d,a);c[0]&&k.push({x1:b,y1:h,x2:c[0].x-f,y2:c[0].y-e});c[1]&&k.push({x1:b,y1:h,x2:c[1].x-f,y2:c[1].y-e});return k}});
B("extend-esri")&&c.setObject("toolbars.VertexMover",v,x);c.mixin(v,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return v})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(v,c,f,h,n,u,k,x,p,B){v=v(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(c,f,h){this._graphic=c;this._map=f;
this._toolbar=h;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(c){this._editBox?(f.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=f.connect(c.getLayer(),"onDblClick",this,function(k){this._map.navigationManager.setImmediateClick(!1);k.graphic==c&&(h.stop(k),f.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,
this._addTextBox(c))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(f.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(h,n){if(!this._editBox){var t;h.symbol.text||(h.symbol.text="Tempt text",h.setSymbol(h.symbol),t="");var b=this._createInputTextStyle(h,this._map);""!==t&&(t=n||h.symbol.text);this._editBox=u.create("input",{type:"text",value:t});
x.set(this._editBox,b);k.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=f.connect(this._editBox,"onkeyup",c.hitch(this,function(b){b.keyCode!=p.ENTER&&b.keyCode!==p.TAB||this._disable()}));this._editBoxBlurHandler=f.connect(this._editBox,"onblur",c.hitch(this,function(b){this._disable()}));h.symbol.text="";h.setSymbol(h.symbol);h.hide();var l=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",
c.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(b){x.set(l,{left:this._editBoxLeft+b.delta.x+"px",top:this._editBoxTop+b.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(x.get(l,"left"));this._editBoxTop=parseFloat(x.get(l,"top"))});this.onEditStart(h,this._editBox);this._toolbar.onTextEditStart(h,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(f.disconnect(this._editBoxBlurHandler),
this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(f.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(c,
f){f=c.getDojoShape().getTransformedBoundingBox();var h=c.getLayer(),h=h.hasLocalNavigationTransform()?{dx:0,dy:0}:h.getNavigationTransform(),b=c.symbol.font;return{"font-family":b.family,"font-size":b.size+"px","font-style":b.style,"font-variant":b.variant,"font-weight":b.weight,left:f[0].x+h.dx+"px",top:f[0].y+h.dy+"px",width:Math.abs(f[0].x-f[1].x)/Math.cos(c.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var c=this._graphic.symbol;
c.text=this._editBox.value;this._graphic.setSymbol(c)}else this._graphic.getLayer().remove(this._graphic)}});n("extend-esri")&&c.setObject("toolbars.TextEditor",v,B);return v})},"widgets/DataAggregation/js/UI/LocationType":function(){define("dojo/_base/declare dojo/_base/lang dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/Deferred dojo/on dojo/keys dojo/text!./templates/LocationType.html dijit/form/RadioButton".split(" "),function(v,c,f,h,n,u,k,x,p,B){return v([f,
h,n,u],{baseClass:"cf-location-type",declaredClass:"CriticalFacilities.LocationType",templateString:B,_started:null,label:"LocationType",parent:null,nls:null,map:null,appConfig:null,config:null,useAddress:!0,useCoordinates:!1,theme:"",styleColor:"",_coordinatesView:void 0,_addressView:void 0,constructor:function(f){c.mixin(this,f)},postCreate:function(){this.inherited(arguments);this._initRadioButtons()},_initRadioButtons:function(){this.own(x(this.rdoAddress,"change",c.hitch(this,this._rdoAddressChanged)));
this.own(x(this.rdoCoordinates,"change",c.hitch(this,this._rdoCoordinateChanged)));this.rdoAddress.set("checked",this.useAddress);this.useAddress&&(this.lastFocusNode=this.rdoAddress.focusNode);this.rdoCoordinates.set("checked",this.useCoordinates)},startup:function(){this._started=!0;this._updateAltIndexes()},onShown:function(){this.pageContainer.nextDisabled=!1},validate:function(c,f){var h=new k;"next-view"===c?h.resolve(this._nextView()):"back-view"===c?h.resolve(this._backView()):this._homeView(f).then(function(b){h.resolve(b)});
return h},_nextView:function(){return!0},_backView:function(){return!0},_homeView:function(c){var f=new k;this.pageContainer.getViewByTitle("Home").verifyClearSettings(c).then(function(c){f.resolve(c)});return f},_updateAltIndexes:function(){if(this.pageContainer&&!this._coordinatesView&&!this._addressView){this._coordinatesView=this.pageContainer.getViewByTitle("Coordinates");this._addressView=this.pageContainer.getViewByTitle("Addresses");var c=this.rdoAddress.get("checked");this._addressView&&
this._coordinatesView&&(this._addressView.altBackIndex=this.index,this._coordinatesView.altBackIndex=this.index,this.altNextIndex=c?this._addressView.index:this._coordinatesView.index)}},_rdoAddressClick:function(){this.rdoAddress.set("checked",!0)},_rdoAddressChanged:function(c){this.useAddress=c;this._addressView&&this._coordinatesView&&(this.altNextIndex=c?this._addressView.index:this._coordinatesView.index);c&&(this.lastFocusNode=this.rdoAddress.focusNode,this.parent.updateFirstLastNode(!1));
this.parent._locationMappingComplete=!1},_rdoCoordinateClick:function(){this.rdoCoordinates.set("checked",!0)},_rdoCoordinateChanged:function(c){this.useCoordinates=c;this._addressView&&this._coordinatesView&&(this.altNextIndex=c?this._coordinatesView.index:this._addressView.index);c&&(this.lastFocusNode=this.rdoCoordinates.focusNode,this.parent.updateFirstLastNode(!1));this.parent._locationMappingComplete=!1},setStyleColor:function(c){this.styleColor=c},updateImageNodes:function(){},_getResults:function(){return this.useAddress?
this._addressView._getResults():this._coordinatesView._getResults()}})})},"jimu/dijit/EditorXssFilter":function(){define("dojo/_base/declare dojo/_base/array dijit/_WidgetBase dojo/_base/lang dojo/Evented libs/arcgis-html-sanitizer/arcgis-html-sanitizer".split(" "),function(v,c,f,h,n,u){var k=null,x=v([f,n],{baseClass:"jimu-editor-xss-filter",declaredClass:"jimu.dijit.EditorXssFilter",sanitizer:null,xss:null,whiteList:{},graphicsWhiteList:{},postCreate:function(){this.whiteList=this._getWhiteList();
this.sanitizer=new u({whiteList:this.whiteList,safeAttrValue:h.hitch(this,function(c,f,h,k){return"style"===f?this.xss.friendlyAttrValue(h).replace(/\"/g,"'"):"img"===c&&"src"===f?this.xss.escapeAttrValue(h):this.xss.safeAttrValue(c,f,h,k)}),onTag:h.hitch(this,function(c,f,h){if(h.isWhite&&this._isInWhiteList(c,this.graphicsWhiteList))return f}),onIgnoreTagAttr:h.hitch(this,function(c,f,h,k){if("data-"===f.substr(0,5))return f+'\x3d"'+this.xss.escapeAttrValue(h)+'"'}),onIgnoreTag:h.hitch(this,function(c,
f,h){if("o:"===c.substr(0,2)||"!--[if"===c||"!--[endif]--"===c)return f})},!0);this.xss=this.sanitizer.xss},sanitize:function(c){return this.sanitizer.sanitize(c)},_getWhiteList:function(){var c="title height width class style font-family id align text-align".split(" "),f={div:c,h1:c,h2:c,h3:c,h4:c,h5:c,h6:c,span:c,p:c,s:c,strong:c,em:c,u:c,ol:c,ul:c,li:c,a:["href","target"].concat(c),img:["src","alt","border"].concat(c),blockquote:c,font:["face","size","color"].concat(c),pre:c,code:c,b:c,i:c,wbr:c,
video:"autoplay controls loop muted poster preload".split(" ").concat(c),audio:["autoplay","controls","loop","muted","preload"].concat(c),source:["media","src","type"].concat(c),table:["cellpadding","cellspacing","border"].concat(c),tbody:[].concat(c),tr:["valign"].concat(c),td:["valign","colspan","rowspan","nowrap"].concat(c),th:["valign","colspan","rowspan","nowrap"].concat(c),hr:c,html:c,title:c,link:["rel","href"],style:["type"].concat(c),body:c};this.graphicsWhiteList={animate:[],animateMotion:[],
animateTransform:[],circle:[],clipPath:[],"color-profile":[],defs:[],desc:[],discard:[],ellipse:[],feBlend:[],feColorMatrix:[],feComponentTransfer:[],feComposite:[],feConvolveMatrix:[],feDiffuseLighting:[],feDisplacementMap:[],feDistantLight:[],feDropShadow:[],feFlood:[],feFuncA:[],feFuncB:[],feFuncG:[],feFuncR:[],feGaussianBlur:[],feImage:[],feMerge:[],feMergeNode:[],feMorphology:[],feOffset:[],fePointLight:[],feSpecularLighting:[],feSpotLight:[],feTile:[],feTurbulence:[],filter:[],foreignObject:[],
g:[],hatch:[],hatchpath:[],line:[],linearGradient:[],marker:[],mask:[],mesh:[],meshgradient:[],meshpatch:[],meshrow:[],metadata:[],mpath:[],path:[],pattern:[],polygon:[],polyline:[],radialGradient:[],rect:[],set:[],solidcolor:[],stop:[],svg:[],switch:[],symbol:[],text:[],textPath:[],title:[],tspan:[],use:[],view:[],object:[],canvas:c};return this._extendObjectOfArrays([f,{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay",
"controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],
sub:[],summary:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:"autoplay controls loop preload src height width".split(" ")},this.graphicsWhiteList])},_extendObjectOfArrays:function(f){var h={};c.forEach(f,function(f){var k=Object.keys(f);c.forEach(k,function(c){Array.isArray(f[c])&&
Array.isArray(h[c])?h[c]=h[c].concat(f[c]):h[c]=f[c]},this)},this);return h},_isInWhiteList:function(f,h){h=Object.keys(h);var k=!1;c.forEach(h,function(c){f===c&&(k=!0)},this);return k}});x.getInstance=function(){null===k&&(k=new x);return k};return x})},"widgets/DataAggregation/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/DataAggregation/js/UI/templates/PageContainer.html":'\x3cdiv style\x3d"height: 100%;" class\x3d"no-select"\x3e\r\n  \x3cdiv class\x3d"control-node" data-dojo-attach-point\x3d"controlNode"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"controlTable" class\x3d"control-table" cellpading\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"controlTr" style\x3d"line-height:20px;"\x3e\r\n          \x3c!--BACK--\x3e\r\n          \x3ctd nowrap class\x3d"page-item-td-left" data-dojo-attach-point\x3d"backTd"\r\n            data-dojo-attach-event\x3d"onclick:_prevView , onkeydown:_prevView" \x3e\r\n            \x3cdiv class\x3d"float-left bg-img bg-back-img margin-right-5" data-dojo-attach-point\x3d"backImage" tabindex\x3d"0"\r\n            role\x3d"button" aria-label\x3d"${nls.back}"\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"page-item-div main-text" title\x3d"${nls.back}" label\x3d"${nls.back}"\x3e${nls.back}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3c!--HOME--\x3e\r\n          \x3ctd nowrap align\x3d"center" class\x3d"page-item-td-center " data-dojo-attach-point\x3d"homeTd"\r\n            data-dojo-attach-event\x3d"onclick:_homeView , onkeydown:_homeView"\x3e\r\n            \x3cdiv\x3e\r\n              \x3cdiv class\x3d"bg-home bg-home-img" data-dojo-attach-point\x3d"homeImage" tabindex\x3d"0"\r\n                role\x3d"button" aria-label\x3d"${nls.startPage.homeButtonLabel}"\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"page-item-div"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3c!--NEXT--\x3e\r\n          \x3ctd nowrap class\x3d"page-item-td-right" data-dojo-attach-point\x3d"nextTd"\r\n            data-dojo-attach-event\x3d"onclick:_nextView , onkeydown:_nextView"\x3e\r\n            \x3cdiv class\x3d"float-right bg-img bg-next-img margin-left-5" data-dojo-attach-point\x3d"nextImage" tabindex\x3d"0"\r\n              role\x3d"button" aria-label\x3d"${nls.next}"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"page-item-div main-text" title\x3d"${nls.next}" label\x3d"${nls.next}"\x3e${nls.next}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"container-node" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"tab-shelter" data-dojo-attach-point\x3d"shelter"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Home.html":'\x3cdiv style\x3d"height: 100%;" class\x3d"no-select"\x3e\r\n  \x3c!-- aria-label added at runtime--\x3e\r\n  \x3cdiv class\x3d"bottom-border-mid esriCTSchemaMapInstructions" data-dojo-attach-point\x3d"schemaMapInstructions" tabindex\x3d"0" role\x3d"region"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"pageInstruction" class\x3d"main-instruction"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"upload-tab-node" data-dojo-attach-point\x3d"uploadTabNode"\x3e\r\n    \x3cdiv class\x3d"schema-map-instructions"\x3e\r\n      \x3cdiv class\x3d"usage-instruction"\x3e\r\n        ${nls.startPage.dragDrop}\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"drop-or-browse"\x3e\r\n        ${nls.startPage.or}\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"browseContainer"\x3e\r\n        \x3cform class\x3d"file-form" enctype\x3d"multipart/form-data" method\x3d"post" data-dojo-attach-point\x3d"fileForm"\x3e\r\n          \x3clabel for\x3d"${id}_file" class\x3d"jimu-btn" data-dojo-attach-point\x3d"uploadLabel" \r\n          tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.startPage.browse}" \x3e${nls.startPage.browse}\x3c/label\x3e\r\n          \x3cinput id\x3d"${id}_file" name\x3d"file" type\x3d"file" class\x3d"upload-input" data-dojo-attach-point\x3d"fileNode"/\x3e\r\n        \x3c/form\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"warning-instruction" data-dojo-attach-point\x3d"loadWarning"\x3e\r\n      \x3cspan\x3e${nls.warningsAndErrors.loadWarning}\x3c/span\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"credit-warning-container" data-dojo-attach-point\x3d"creditsLink" tabindex\x3d"0" role\x3d"link" aria-label\x3d"${nls.warningsAndErrors.consumesCredits}"\x3e\r\n    \x3ca  data-dojo-attach-point\x3d"creditsLinkTag" class\x3d"credit-warning" target\x3d"_blank" \r\n      href\x3d"http://www.esri.com/software/arcgis/arcgisonline/credits"\x3e${nls.warningsAndErrors.consumesCredits}\x3c/a\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Addresses.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" tabindex\x3d"0" role\x3d"region" aria-label\x3d"${nls.mapping.locationMapping} ${nls.address.addressPageHint}"\x3e${nls.mapping.locationMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row" data-dojo-attach-point\x3d"mainInstructionRow"\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.address.addressPageHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"task-row task-instruction-row" data-dojo-attach-point\x3d"singleAddressRow"\x3e\r\n        \x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"singleFieldHintTd"\x3e\r\n          \x3c!--table for single field--\x3e\r\n          \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr class\x3d"task-row task-instruction-row" data-dojo-attach-point\x3d"singleRadioRow"\x3e\r\n                \x3ctd colspan\x3d"2" class\x3d"pad-left-10 field-control-td"\x3e\r\n                  \x3cinput name\x3d"addr" data-dojo-type\x3d"dijit/form/RadioButton" class\x3d"jimu-radio-btn" id\x3d"rdo-single"\r\n                    type\x3d"radio" data-dojo-attach-point\x3d"rdoSingleAddress" title\x3d"${nls.address.singleField}"\r\n                    tabindex\x3d"0" aria-label\x3d"${nls.address.singleField} ${nls.address.singleFieldHint}" role\x3d"radio"\r\n                    data-dojo-attach-event\x3d"onClick:_rdoSingleAddressClick"/\x3e\r\n                  \x3clabel class\x3d"main-text" for\x3d"rdo-single"\x3e${nls.address.singleField}\x3c/label\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr class\x3d"bottom-border-bold sub-task-hint panel-title-hint"\r\n                data-dojo-attach-point\x3d"singleSubTaskHintTr"\x3e\r\n                \x3ctd colspan\x3d"2" class\x3d"pad-left-20 panel-title-hint-td float-left"\r\n                  data-dojo-attach-point\x3d"singleSubTaskHintTd"\x3e\r\n                  \x3cspan class\x3d"instruction"\x3e${nls.address.singleFieldHint}\x3c/span\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr class\x3d"bottom-border"\x3e\r\n                \x3ctd data-dojo-attach-point\x3d"singleFieldTableRow"\x3e\r\n                  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n                    \x3ccolgroup\x3e\r\n                      \x3ccol width\x3d"40%" /\x3e\r\n                      \x3ccol width\x3d"60%" /\x3e\r\n                    \x3c/colgroup\x3e\r\n                    \x3ctbody data-dojo-attach-point\x3d"singleFieldTable"\x3e\r\n                    \x3c/tbody\x3e\r\n                  \x3c/table\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"multiAddressRow"\x3e\r\n        \x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"multiFieldHintTd"\x3e\r\n          \x3c!--table for multi field--\x3e\r\n          \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr class\x3d"task-row task-instruction-row" data-dojo-attach-event\x3d"onClick:_rdoMultiAddressClick"\r\n                data-dojo-attach-point\x3d"multiRadioRow"\x3e\r\n                \x3ctd colspan\x3d"2" class\x3d"pad-left-10 field-control-td"\x3e\r\n                  \x3cinput name\x3d"addr" data-dojo-type\x3d"dijit/form/RadioButton" class\x3d"jimu-radio-btn" id\x3d"rdo-multi"\r\n                    type\x3d"radio" data-dojo-attach-point\x3d"rdoMultiAddress" title\x3d"${nls.address.multiField}" \r\n                    tabindex\x3d"0" aria-label\x3d"${nls.address.multiField} ${nls.address.multiFieldHint}" role\x3d"radio"/\x3e\r\n                  \x3clabel class\x3d"main-text" for\x3d"rdo-multi"\x3e${nls.address.multiField}\x3c/label\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr class\x3d"bottom-border sub-task-hint panel-title-hint"\x3e\r\n                \x3ctd colspan\x3d"2" class\x3d"pad-left-20 panel-title-hint-td float-left"\r\n                  data-dojo-attach-point\x3d"multiSubTaskHintTd"\x3e\r\n                  \x3cspan class\x3d"instruction"\x3e${nls.address.multiFieldHint}\x3c/span\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd data-dojo-attach-point\x3d"multiFieldTableRow"\x3e\r\n                  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n                    \x3ccolgroup\x3e\r\n                      \x3ccol width\x3d"40%" /\x3e\r\n                      \x3ccol width\x3d"60%" /\x3e\r\n                    \x3c/colgroup\x3e\r\n                    \x3ctbody data-dojo-attach-point\x3d"multiFieldTable"\x3e\x3c/tbody\x3e\r\n                  \x3c/table\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Coordinates.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0" data-dojo-attach-point\x3d"coordinateTable"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.mapping.locationMapping} ${nls.coordinates.coordinatesPageHint}"\x3e${nls.mapping.locationMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.coordinates.coordinatesPageHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/FieldMapping.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" tabindex\x3d"0" role\x3d"region" aria-label\x3d"${nls.mapping.schemaMapping}${nls.fieldMapping.fieldMappingPageHint}"\x3e\r\n            ${nls.mapping.schemaMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"task-instruction-row bottom-border-bold"\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.fieldMapping.fieldMappingPageHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"pad-top-10"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"fieldMappingTable"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/StartPage.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" tabindex\x3d"0" role\x3d"region"\r\n            aria-label\x3d"${nls.startPage.locationAndField} ${nls.startPage.locationAndFieldHint}"\x3e\r\n            ${nls.startPage.locationAndField}\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"locationAndFieldHint"\x3e\r\n            ${nls.startPage.locationAndFieldHint}\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"field-control-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text"\x3e${nls.startPage.targetLayerLabel}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"esriCTTargetLayerParent"\x3e\r\n            \x3cdiv class\x3d"esriCTTargetLayerSelector" aria-label\x3d"${nls.startPage.targetLayerLabel}" style\x3d"width: 100%;"\r\n              data-dojo-attach-point\x3d"targetLayerSelector" data-dojo-type\x3d"jimu/dijit/formSelect"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"task-row" data-dojo-attach-event\x3d"onClick:_locationMappingClick , onkeydown:_locationMappingClick"\r\n        tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.mapping.locationMapping} ${nls.mapping.locationMappingHint}"\x3e\r\n        \x3ctd class\x3d"field-control-td"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.mapping.locationMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"jimu-icon jimu-icon-error incomplete-mark" data-dojo-attach-point\x3d"locationMappingComplete" title\x3d"${nls.startPage.mappingErrorMsg}"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"instruction-padding"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.mapping.locationMappingHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"task-row" data-dojo-attach-point\x3d"fieldMappingRow" data-dojo-attach-event\x3d"onClick:_schemaMappingClick , onkeydown:_schemaMappingClick"\r\n        tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.mapping.schemaMapping} ${nls.mapping.schemaMappingHint}"\x3e\r\n        \x3ctd class\x3d"field-control-td"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.mapping.schemaMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"jimu-icon jimu-icon-error incomplete-mark" data-dojo-attach-point\x3d"fieldMappingComplete" title\x3d"${nls.startPage.mappingErrorMsg}"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border pad-top-10 task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"instruction-padding"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.mapping.schemaMappingHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv class\x3d"pad-top-10"\x3e\r\n    \x3cdiv class\x3d"jimu-btn float-right display-none" data-dojo-attach-point\x3d"addToMapButton"\r\n      data-dojo-attach-event\x3d"onClick:_addToMapClick , onkeydown:_addToMapClick" tabindex\x3d"0" aria-label\x3d"${nls.buttons.addToMap}" role\x3d"button"\x3e\r\n      ${nls.buttons.addToMap}\x3c/div\x3e\r\n    \x3cdiv class\x3d"float-right bg-loading-img bg-loading pad-top-10 display-none" data-dojo-attach-point\x3d"progressNode"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Review.html":'\x3cdiv class\x3d"pad-left-5 no-select" style\x3d"height: 100%"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0" data-dojo-attach-point\x3d"reviewRowTable"\x3e\r\n    \x3ctbody\x3e\r\n\r\n      \x3ctr data-dojo-attach-point\x3d"reviewDataRow" tabindex\x3d"0" role\x3d"region" aria-label\x3d"${nls.review.reviewData} ${nls.review.reviewDataHint}"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text"\x3e${nls.review.reviewData}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"reviewDataHint"\x3e${nls.review.reviewDataHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"pad-bottom-10 task-row" data-dojo-attach-point\x3d"unMatchedControlRow"\r\n        data-dojo-attach-event\x3d"onclick:_reviewUnMatched , onkeydown:_reviewUnMatched" tabindex\x3d"0" role\x3d"button"\x3e\r\n        \x3ctd class\x3d"field-control-td width-100"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.review.reviewUnMatched}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-right-15 float-right main-text field-control-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"unMatchedCount"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border pad-bottom-10 task-instruction-row" data-dojo-attach-point\x3d"unMatchedHintRow"\x3e\r\n        \x3ctd colspan\x3d"3" data-dojo-attach-point\x3d"unMatchedHintTd" class\x3d"instruction-padding"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.review.reviewUnMatchedHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"pad-bottom-10 task-row" data-dojo-attach-point\x3d"duplicateControlRow" tabindex\x3d"0" role\x3d"button" \r\n        data-dojo-attach-event\x3d"onclick:_reviewDuplicate , onkeydown:_reviewDuplicate"\x3e\r\n        \x3ctd class\x3d"field-control-td width-100"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.review.reviewDuplicate}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-right-15 float-right main-text field-control-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"duplicateCount"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border pad-bottom-10 task-instruction-row" data-dojo-attach-point\x3d"duplicateHintRow"\x3e\r\n        \x3ctd colspan\x3d"3" data-dojo-attach-point\x3d"duplicateHintTd" class\x3d"instruction-padding"\x3e\r\n          \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"reviewDuplicateHint"\x3e${nls.review.reviewDuplicateHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"pad-bottom-10 task-row" data-dojo-attach-point\x3d"matchedControlRow"\r\n        data-dojo-attach-event\x3d"onclick:_reviewMatched , onkeydown:_reviewMatched" tabindex\x3d"0" role\x3d"button"\x3e\r\n        \x3ctd class\x3d"field-control-td width-100"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.review.reviewMatched}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-right-15 float-right main-text field-control-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"matchedCount"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border pad-bottom-10 task-instruction-row" data-dojo-attach-point\x3d"matchedHintRow"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"instruction-padding"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.review.reviewMatchedHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv class\x3d"pad-top-10 float-right"\x3e\r\n    \x3cdiv style\x3d"margin-right: 15px;" class\x3d"float-left bg-loading-img bg-loading pad-top-10 display-none" data-dojo-attach-point\x3d"progressNode"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-btn float-left margin-right-15" data-dojo-attach-point\x3d"submitButton" tabindex\x3d"0" role\x3d"button"\r\n      aria-label\x3d"${nls.buttons.submit}" data-dojo-attach-event\x3d"onclick:_submit , onkeydown:_submit"\x3e\r\n      ${nls.buttons.submit}\x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-btn float-left" data-dojo-attach-point\x3d"downloadButton" tabindex\x3d"0" role\x3d"button"\r\n      aria-label\x3d"${nls.buttons.download}" data-dojo-attach-event\x3d"onclick:_download , keydown:_download"\x3e${nls.buttons.download}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/FeatureList.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" data-dojo-attach-point\x3d"pageTitle" tabindex\x3d"0" role\x3d"region" \r\n          aria-label\x3d"${nls.review.reviewMatched} ${nls.review.reviewMatchedHint}"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"pageHint"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd\x3e\r\n          \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n            \x3ctbody data-dojo-attach-point\x3d"featureListTable"\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Feature.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n\r\n  \x3c!-- Title table --\x3e\r\n  \x3ctable class\x3d"page-table display-none table-layout" cellpading\x3d"0" data-dojo-attach-point\x3d"featureTitleTable"\r\n    tabindex\x3d"0" role\x3d"region"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" data-dojo-attach-point\x3d"pageTitleDiv"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"pageHintDiv"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3c!--Feature toolbar table--\x3e\r\n  \x3ctable class\x3d"page-table display-none table-layout" cellpading\x3d"0" data-dojo-attach-point\x3d"featureToolbarTable"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n        \x3ctd data-dojo-attach-point\x3d"reviewRowRecordTd" class\x3d"pad-bottom-10 pad-top-10"\x3e\r\n          \x3cspan class\x3d"float-left main-text pad-right-10 display-none pad-left-5" data-dojo-attach-point\x3d"reviewText"\r\n            style\x3d"line-height:30px;"\x3e${nls.review.item}\x3c/span\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_duplicateFlag" class\x3d"pad-bottom-10 duplicate-flag"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-bottom-10 pad-top-10 feature-toolbar-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"featureToolbar"\x3e\r\n\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3c!--feature toggle table--\x3e\r\n  \x3ctable data-dojo-attach-point\x3d"featureToggleTable" class\x3d"page-table display-none table-layout" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"bottom-border toggle-expand-row" data-dojo-attach-point\x3d"featureTr" data-dojo-attach-event\x3d"onclick:_toggleFeature  , onkeydown:_toggleFeature" tabindex\x3d"0"\r\n        role\x3d"button" aria-label\x3d"${nls.review.feature}" aria-expanded\x3d"false"\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"field-control-td text-left field-row-width pad-left-5"\x3e\r\n          \x3cdiv class\x3d"font-size-med main-text float-left"\x3e\r\n            ${nls.review.feature}\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd style\x3d"width: 20px;" nowrap class\x3d"page-item-td-nav" data-dojo-attach-point\x3d"featureTd"\x3e\r\n          \x3cdiv class\x3d"float-right bg-img-toggle bg-toggle-down-img margin-left-5"\r\n            data-dojo-attach-point\x3d"toggleFeature"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"featureInformation" class\x3d"display-none"\x3e\r\n\r\n    \x3c!--feature controls table--\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"featureTable" class\x3d"page-table display-none table-layout" cellpading\x3d"0"\x3e\r\n      \x3ccolgroup\x3e\r\n        \x3ccol width\x3d"30%" /\x3e\r\n        \x3ccol width\x3d"35%" /\x3e\r\n        \x3ccol width\x3d"35%" /\x3e\r\n      \x3c/colgroup\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"featureControlTable"\x3e\x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3c!--location toggle table--\x3e\r\n  \x3ctable data-dojo-attach-point\x3d"locationControlToggleTable" class\x3d"page-table display-none table-layout"\r\n    cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"bottom-border toggle-expand-row"  data-dojo-attach-point\x3d"locationTr" data-dojo-attach-event\x3d"onclick:_toggleLocation , onkeydown:_toggleLocation" tabindex\x3d"0"\r\n        role\x3d"button" aria-label\x3d"${nls.review.locationInfo}" aria-expanded\x3d"false"\x3e\r\n        \x3ctd class\x3d"field-control-td text-left field-row-width pad-left-5"\x3e\r\n          \x3cdiv class\x3d"font-size-med main-text float-left"\x3e\r\n            ${nls.review.locationInfo}\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd style\x3d"width: 20px;" class\x3d"page-item-td-nav" data-dojo-attach-point\x3d"locationTd"\x3e\r\n          \x3cdiv class\x3d"float-right bg-img-toggle bg-toggle-down-img margin-left-5"\r\n            data-dojo-attach-point\x3d"toggleLocation"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"locationInformation" class\x3d"display-none"\x3e\r\n\r\n    \x3c!--location toolbar--\x3e\r\n    \x3ctable class\x3d"page-table display-none" cellpading\x3d"0" data-dojo-attach-point\x3d"locationSyncTable"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n          \x3ctd class\x3d"field-control-td pad-left-5"\x3e\r\n            \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"locationHint"\x3e${nls.review.locationControlHint}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"field-control-td" title\x3d"${nls.review.sync}"\x3e\r\n            \x3cdiv class\x3d"float-right bg-ft-img bg-sync feature-toolbar-btn" data-dojo-attach-point\x3d"syncFields"\r\n              data-dojo-attach-event\x3d"onclick:_syncAddressInfo , keydown:_syncAddressInfo"\r\n              role\x3d"button" aria-label\x3d"${nls.review.sync}"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd title\x3d"${nls.featureToolbar.locate}"\x3e\r\n            \x3cdiv class\x3d"bg-ft-img bg-locate feature-toolbar-btn float-right" data-dojo-attach-point\x3d"locateButton"\r\n              data-dojo-attach-event\x3d"onclick:_locate , keydown:_locate" role\x3d"button" aria-label\x3d"${nls.featureToolbar.locate}"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\r\n    \x3c!--location controls table--\x3e\r\n    \x3ctable class\x3d"page-table display-none" cellpading\x3d"0" data-dojo-attach-point\x3d"locationControlTable"\x3e\r\n      \x3ccolgroup\x3e\r\n        \x3ccol width\x3d"35%" /\x3e\r\n        \x3ccol width\x3d"65%" /\x3e\r\n      \x3c/colgroup\x3e\r\n      \x3ctbody\x3e\x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\r\n  \x3c/div\x3e\r\n\r\n\x3c/div\x3e\r\n\r\n',
"url:widgets/DataAggregation/js/UI/templates/FeatureToolbar.html":'\x3cdiv class\x3d"float-right no-select"\x3e\r\n  \x3ctable class\x3d"control-table table-layout" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"feature-toolbar-row"\x3e\r\n        \x3ctd title\x3d"${nls.featureToolbar.cancel}"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"cancelButton" role\x3d"button" tabindex\x3d"-1" class\x3d"bg-ft-img bg-cancel feature-toolbar-btn" \r\n          aria-label\x3d"${nls.featureToolbar.cancel}" data-dojo-attach-event\x3d"onclick:_cancel, onkeydown:_cancel"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd title\x3d"${nls.featureToolbar.save}"\x3e\r\n          \x3cdiv  data-dojo-attach-point\x3d"saveButton" role\x3d"button" tabindex\x3d"-1" class\x3d"float-right bg-ft-img bg-save feature-toolbar-btn"\r\n          aria-label\x3d"${nls.featureToolbar.save}" data-dojo-attach-event\x3d"onclick:_save, onkeydown:_save"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/LocationType.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" tabindex\x3d"0" role\x3d"region"\r\n            aria-label\x3d"${nls.mapping.locationMapping} ${nls.locationMapping.locationMappingPageHint}"\x3e\r\n            ${nls.mapping.locationMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.locationMapping.locationMappingPageHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"task-row task-instruction-row" \x3e \r\n        \x3ctd class\x3d"field-control-td pad-left-10"\x3e\r\n          \x3cinput name\x3d"lt" data-dojo-type\x3d"dijit/form/RadioButton"\r\n                 class\x3d"jimu-radio-btn"\r\n                 id\x3d"${id}_rdo-address"\r\n                 type\x3d"radio"\r\n                 data-dojo-attach-point\x3d"rdoAddress"\r\n                 title\x3d"${nls.locationMapping.useAddress}" \r\n                 tabindex\x3d"0" \r\n                 aria-label\x3d"${nls.locationMapping.useAddress} ${nls.locationMapping.useAddressHint}"\r\n                 data-dojo-attach-event\x3d"onClick:_rdoAddressClick"\r\n                 role\x3d"radio"/\x3e\r\n          \x3clabel class\x3d"main-text" for\x3d"${id}_rdo-address"\x3e${nls.locationMapping.useAddress}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n        \x3ctd class\x3d"pad-left-20 pad-bottom-10"\x3e\r\n          \x3cspan class\x3d"instruction"\x3e${nls.locationMapping.useAddressHint}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"task-instruction-row task-row"\x3e\r\n        \x3ctd class\x3d"field-control-td pad-left-10"\x3e\r\n          \x3cinput name\x3d"lt" data-dojo-type\x3d"dijit/form/RadioButton"\r\n                 class\x3d"jimu-radio-btn"\r\n                 id\x3d"${id}_rdo-coordinate"\r\n                 type\x3d"radio"\r\n                 data-dojo-attach-point\x3d"rdoCoordinates"\r\n                 title\x3d"${nls.locationMapping.useCoordinates}" \r\n                 tabindex\x3d"0"\r\n                 aria-label\x3d"${nls.locationMapping.useCoordinates} ${nls.locationMapping.useCoordinatesHint}"\r\n                 data-dojo-attach-event\x3d"onClick:_rdoCoordinateClick"\r\n                 role\x3d"radio"/\x3e\r\n          \x3clabel class\x3d"main-text" for\x3d"${id}_rdo-coordinate"\x3e${nls.locationMapping.useCoordinates}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n        \x3ctd class\x3d"pad-left-20 pad-bottom-10"\x3e\r\n          \x3cspan class\x3d"instruction"\x3e${nls.locationMapping.useCoordinatesHint}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/Widget.html":'\x3cdiv style\x3d"width: 100%; height: 100%;" class\x3d"no-select"\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"pageNavigation"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:widgets/DataAggregation/css/style.css":".jimu-widget-critical-facilities .disabled{cursor: default; background-color: #a0acbf;}.jimu-widget-critical-facilities-ui .credit-warning{color: #86909c; margin-bottom: 10px;}.jimu-widget-critical-facilities-ui .credit-warning-container{margin-top: 20px; margin-bottom: 10px; position: absolute; bottom: 0px;}.jimu-widget-critical-facilities .processing {background-image: url('images/loading.gif'); background-repeat: no-repeat; background-position: center center; height: 22px; width: 100%;}.jimu-widget-critical-facilities-ui .no-select {-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}.jimu-widget-critical-facilities-ui .font-size-large {font-size: 16px;}.jimu-widget-critical-facilities-ui .font-size-med {font-size: 14px;}.jimu-widget-critical-facilities-ui .bottom-border {border-bottom: 1px solid;}.jimu-widget-critical-facilities-ui .bottom-border-bold {border-bottom: 3px solid;}.jimu-widget-critical-facilities-ui .bottom-border-mid {border-bottom: 2px solid;}.jimu-widget-critical-facilities-ui .width-all {width: 100%;}.jimu-widget-critical-facilities-ui .table-layout {table-layout: fixed;}.jimu-widget-critical-facilities-ui .feature-toolbar-btn {padding: 10px; display: block;}.jimu-widget-critical-facilities-ui .feature-toolbar-row {line-height: 25px;}.jimu-widget-critical-facilities-ui .duplicate-col-headers {overflow: hidden; width: 100%; white-space: normal !important; line-height: 1.5; text-align: center;}.jimu-widget-critical-facilities-ui .page-item-td {cursor: pointer; min-width: 0; white-space: nowrap;}.jimu-widget-critical-facilities-ui .float-left {float: left;}.jimu-rtl .jimu-widget-critical-facilities-ui .float-left {float: right;}.jimu-widget-critical-facilities-ui .float-right {float: right;}.jimu-rtl .jimu-widget-critical-facilities-ui .float-right {float: left;}.jimu-widget-critical-facilities-ui .text-left {text-align: left;}.jimu-rtl .jimu-widget-critical-facilities-ui .text-left {text-align: right;}.jimu-widget-critical-facilities-ui .field-row-width {word-break: break-word;}.jimu-widget-critical-facilities-ui .field-row-width2 {word-break: break-word;}.jimu-widget-critical-facilities-ui .pad-side-15 {padding-left: 15px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-side-15 {padding-right: 15px;}.jimu-widget-critical-facilities-ui .bg-home-img {background-image: url('../images/home_black.png');}.jimu-widget-critical-facilities-ui .page-item-td-center:hover .bg-home-img {background-image: url('../images/home_hover.png');}.jimu-widget-critical-facilities-ui .bg-home-img-white {background-image: url('../images/home_white.png');}.jimu-widget-critical-facilities-ui .page-item-td-center:hover .bg-home-img-white {background-image: url('../images/home_hover.png');}.jimu-widget-critical-facilities-ui .bg-home {width: 20px; height: 20px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer; margin: auto; margin-top: 2px;}.jimu-widget-critical-facilities-ui .bg-img {width: 12px; height: 20px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer; margin-left: 2px;}.jimu-widget-critical-facilities-ui .esriCTSchemaMapInstructions {max-height: 150px; overflow: auto; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .toggle-expand-row {cursor: pointer;}.jimu-widget-critical-facilities-ui .bg-img-toggle {width: 16px; height: 12px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer;}.jimu-widget-critical-facilities-ui .page-item-td-nav {cursor: pointer; min-width: 0; white-space: nowrap;}.jimu-widget-critical-facilities-ui .bg-toggle-down-img {background-image: url('../images/nav_down_black.png');}.jimu-widget-critical-facilities-ui .toggle-expand-row:hover .bg-toggle-down-img {background-image: url('../images/nav_down_hover.png');}.jimu-widget-critical-facilities-ui .bg-toggle-down-img-white {background-image: url('../images/nav_down_white.png');}.jimu-widget-critical-facilities-ui .toggle-expand-row:hover .bg-toggle-down-img-white {background-image: url('../images/nav_down_hover.png');}.jimu-widget-critical-facilities-ui .bg-toggle-up-img {background-image: url('../images/nav_up_black.png');}.jimu-widget-critical-facilities-ui .toggle-expand-row:hover .bg-toggle-up-img {background-image: url('../images/nav_up_hover.png');}.jimu-widget-critical-facilities-ui .bg-toggle-up-img-white {background-image: url('../images/nav_up_white.png');}.jimu-widget-critical-facilities-ui .toggle-expand-row:hover .bg-toggle-up-img-white {background-image: url('../images/nav_up_hover.png');}.jimu-widget-critical-facilities-ui .feature-toolbar-td {width: 58px;}.jimu-widget-critical-facilities-ui .duplicate-flag {padding-bottom: 9px; float: left; display: inline-table;}.jimu-widget-critical-facilities-ui .bg-ft-img {width: 15px; height: 15px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer; margin: auto;}.jimu-widget-critical-facilities-ui .bg-locate {background-image: url('../images/locate_black.png');}.jimu-widget-critical-facilities-ui .bg-locate:hover {background-image: url('../images/locate_hover.png');}.jimu-widget-critical-facilities-ui .bg-locate-white {background-image: url('../images/locate_white.png');}.jimu-widget-critical-facilities-ui .bg-locate-white:hover {background-image: url('../images/locate_hover.png');}.jimu-widget-critical-facilities-ui .bg-locate-disabled {background-image: url('../images/locate_disabled.png'); cursor: default;}.jimu-widget-critical-facilities-ui .bg-save {background-image: url('../images/save_black.png');}.jimu-widget-critical-facilities-ui .bg-save:hover {background-image: url('../images/save_hover.png');}.jimu-widget-critical-facilities-ui .bg-save-white {background-image: url('../images/save_white.png');}.jimu-widget-critical-facilities-ui .bg-save-white:hover {background-image: url('../images/save_hover.png');}.jimu-widget-critical-facilities-ui .bg-save-disabled {background-image: url('../images/save_disabled.png'); cursor: default;}.jimu-widget-critical-facilities-ui .bg-sync {background-image: url('../images/sync_black.png');}.jimu-widget-critical-facilities-ui .bg-sync:hover {background-image: url('../images/sync_hover.png');}.jimu-widget-critical-facilities-ui .bg-sync-white {background-image: url('../images/sync_white.png');}.jimu-widget-critical-facilities-ui .bg-sync-white:hover {background-image: url('../images/sync_hover.png');}.jimu-widget-critical-facilities-ui .bg-sync-disabled {background-image: url('../images/sync_disabled.png'); cursor: default;}.jimu-widget-critical-facilities-ui .bg-cancel {background-image: url('../images/cancel_black.png');}.jimu-widget-critical-facilities-ui .bg-cancel:hover {background-image: url('../images/cancel_hover.png');}.jimu-widget-critical-facilities-ui .bg-cancel-white {background-image: url('../images/cancel_white.png');}.jimu-widget-critical-facilities-ui .bg-cancel-white:hover {background-image: url('../images/cancel_hover.png');}.jimu-widget-critical-facilities-ui .bg-cancel-disabled {background-image: url('../images/cancel_disabled.png'); cursor: default;}.jimu-widget-critical-facilities-ui .feature-list-row {}.jimu-widget-critical-facilities-ui .feature-list-row:hover {cursor:pointer;}.jimu-widget-critical-facilities-ui .feature-list-row:hover .next-arrow-img {background-image: url('../images/nav_right_hover.png'); cursor: pointer;}.jimu-rtl .jimu-widget-critical-facilities-ui .feature-list-row:hover .next-arrow-img {background-image: url('../images/nav_left_hover.png'); cursor: pointer;}.jimu-widget-critical-facilities-ui .page-item-td-left {cursor: pointer; min-width: 0; white-space: nowrap; text-align: left;}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-left {cursor: pointer; min-width: 0; white-space: nowrap; text-align: right;}.jimu-widget-critical-facilities-ui .bg-back-img {background-image: url('../images/nav_left_black.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .bg-back-img {background-image: url('../images/nav_right_black.png');}.jimu-widget-critical-facilities-ui .bg-back-img-white {background-image: url('../images/nav_left_white.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .bg-back-img-white {background-image: url('../images/nav_right_white.png');}.jimu-widget-critical-facilities-ui .page-item-td-left:hover .bg-back-img {background-image: url('../images/nav_left_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-left:hover .bg-back-img {background-image: url('../images/nav_right_hover.png');}.jimu-widget-critical-facilities-ui .page-item-td-left:hover .bg-back-img-white {background-image: url('../images/nav_left_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-left:hover .bg-back-img-white {background-image: url('../images/nav_right_hover.png');}.jimu-widget-critical-facilities-ui .page-item-td-right {cursor: pointer; min-width: 0; white-space: nowrap; text-align: right;}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-right {cursor: pointer; min-width: 0; white-space: nowrap; text-align: left;}.jimu-widget-critical-facilities-ui .bg-next-img {background-image: url('../images/nav_right_black.png'); margin-right: 2px;}.jimu-rtl .jimu-widget-critical-facilities-ui .bg-next-img {background-image: url('../images/nav_left_black.png');}.jimu-widget-critical-facilities-ui .bg-next-img-white {background-image: url('../images/nav_right_white.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .bg-next-img-white {background-image: url('../images/nav_left_white.png');}.jimu-widget-critical-facilities-ui .page-item-td-right:hover .bg-next-img {background-image: url('../images/nav_right_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-right:hover .bg-next-img {background-image: url('../images/nav_left_hover.png');}.jimu-widget-critical-facilities-ui .page-item-td-right:hover .bg-next-img-white {background-image: url('../images/nav_right_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-right:hover .bg-next-img-white {background-image: url('../images/nav_left_hover.png');}.jimu-widget-critical-facilities-ui .jimu-tab3 .page-item-td.jimu-state-active {color: #48494B;}.jimu-widget-critical-facilities-ui .control-node {padding-bottom: 10px; border-bottom: 2px solid;}.jimu-widget-critical-facilities-ui .container-node {padding-top: 10px;}.jimu-widget-critical-facilities-ui .control-disbaled {opacity: .3; cursor: default; pointer-events: none;}.jimu-widget-critical-facilities-ui .min-width-200 {min-width: 200px;}.jimu-widget-critical-facilities-ui .main-text {font-weight: bold; display: inline-block;}.jimu-widget-critical-facilities-ui .panel-title-td {padding: 0px 0px 5px 0px;}.jimu-widget-critical-facilities-ui .panel-title-text {font-weight: bold; display: inline-block; font-size: 15px;}.jimu-widget-critical-facilities-ui .panel-title-hint-td {padding-bottom: 10px; padding-left: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .panel-title-hint-td {padding-right: 5px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .main-instruction {color: #898989; font-size: 13px;}.jimu-widget-critical-facilities-ui .instruction {color: #898989; font-size: 11px;}.jimu-widget-critical-facilities-ui .instruction-padding {padding-left: 15px; padding-bottom: 10px;}.jimu-rtl .jimu-widget-critical-facilities-ui .instruction-padding {padding-right: 15px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .width-100 {width: 100%;}.jimu-widget-critical-facilities-ui .pad-10 {padding: 10px;}.jimu-widget-critical-facilities-ui .pad-top-10 {padding-top: 10px;}.jimu-widget-critical-facilities-ui .pad-bottom-10 {padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .pad-left-5 {padding-left: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-5 {padding-right: 5px;}.jimu-widget-critical-facilities-ui .pad-left-10 {padding-left: 10px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-10 {padding-right: 10px;}.jimu-widget-critical-facilities-ui .pad-left-15 {padding-left: 15px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-15 {padding-right: 15px;}.jimu-widget-critical-facilities-ui .pad-left-20 {padding-left: 20px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-20 {padding-right: 20px;}.jimu-widget-critical-facilities-ui .pad-left-30 {padding-left: 30px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-30 {padding-right: 30px;}.jimu-widget-critical-facilities-ui .pad-right-10 {padding-right: 10px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-right-10 {padding-left: 10px;}.jimu-widget-critical-facilities-ui .pad-right-15 {padding-right: 15px !important;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-right-15 {padding-left: 15px !important;}.jimu-widget-critical-facilities-ui .margin-right-5 {margin-right: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .margin-right-5 {margin-left: 5px;}.jimu-widget-critical-facilities-ui .margin-left-5 {margin-left: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .margin-left-5 {margin-right: 5px;}.jimu-widget-critical-facilities-ui .margin-right-15 {margin-right: 15px;}.jimu-rtl .jimu-widget-critical-facilities-ui .margin-right-15 {margin-left: 15px;}.jimu-widget-critical-facilities-ui .field-control {min-width: 150px; width: 100%; float: right;}.jimu-rtl .jimu-widget-critical-facilities-ui .field-control {min-width: 150px; width: 100%; float: left;}.jimu-widget-critical-facilities-ui .field-control-td {padding-top: 10px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .sub-field-control-td {padding-bottom: 10px; padding-left: 10px;}.jimu-rtl .jimu-widget-critical-facilities-ui .sub-field-control-td {padding-right: 10px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .min-width-80 {min-width: 80px;}.jimu-widget-critical-facilities-ui .task-text {float: left; padding-left: 10px; font-weight: bold; font-size: 14px;}.jimu-rtl .jimu-widget-critical-facilities-ui .task-text {float: right; padding-right: 10px; font-weight: bold; font-size: 14px;}.jimu-widget-critical-facilities-ui .task-row {cursor: pointer;}.jimu-widget-critical-facilities-ui .dijitSelectLabel {text-align: left; text-overflow: ellipsis; overflow: hidden;}.jimu-widget-critical-facilities-ui .next-arrow {width: 15px; height: 16px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer;}.jimu-widget-critical-facilities-ui .next-arrow-img {background-image: url('../images/nav_right_black.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .next-arrow-img {background-image: url('../images/nav_left_black.png');}.jimu-widget-critical-facilities-ui .next-arrow-img-white {background-image: url('../images/nav_right_white.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .next-arrow-img-white {background-image: url('../images/nav_left_white.png');}.jimu-widget-critical-facilities-ui .task-row:hover .next-arrow-img {background-image: url('../images/nav_right_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .task-row:hover .next-arrow-img {background-image: url('../images/nav_left_hover.png');}.jimu-widget-critical-facilities-ui .task-row:hover .next-arrow-img-white {background-image: url('../images/nav_right_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .task-row:hover .next-arrow-img-white {background-image: url('../images/nav_left_hover.png');}.jimu-widget-critical-facilities-ui .sub-task-hint {text-align: left; margin: auto; line-height: 20px; color: #898989; font-size: 11px;}.jimu-widget-critical-facilities-ui .panel-title-hint {padding-left: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .panel-title-hint {padding-right: 5px;}.jimu-widget-critical-facilities-ui .task-instruction-row {text-align: left; margin: auto;}.jimu-rtl .jimu-widget-critical-facilities-ui .task-instruction-row {text-align: right; margin: auto;}.jimu-widget-critical-facilities-ui .page-table {width: 100%; border-collapse: collapse; font-size: 13px;}.jimu-widget-critical-facilities-ui .width-15 {width: 15px;}.jimu-widget-critical-facilities-ui .display-none {display: none;}.jimu-widget-critical-facilities-ui .display-table-row-group {display: table-row-group;}.jimu-widget-critical-facilities-ui .no-padding {padding: 0px;}.jimu-widget-critical-facilities-ui .cf-page-container {position: relative; width: 100%;}.jimu-widget-critical-facilities-ui .cf-home .disabled {cursor: default; background-color: #a0acbf;}.jimu-widget-critical-facilities-ui .cf-home .upload-tab-node {margin-top: 20px;}.jimu-widget-critical-facilities-ui .cf-home .schema-map-instructions {text-align: center;}.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse {display: block; margin-top: 10px; margin-bottom: 10px; font-size: 11px; color: #898989; line-height: 20px; position: relative;}.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:before,.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:after {content: \"\"; display: block; height: 1px; width: 45%; background: #eee; position: absolute; top: 9px; left: 0;}.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:before,.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:after {content: \"\"; display: block; height: 1px; width: 45%; background: #eee; position: absolute; top: 9px; right: 0;}.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:after {right: 0; left: auto;}.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:after {right: auto; left: 0;}.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse b {display: inline-block; padding-right: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .drop-or-browse b {display: inline-block; padding-left: 5px;}.jimu-widget-critical-facilities-ui .cf-home .file-form {display: inline-block;}.jimu-widget-critical-facilities-ui .cf-home .file-form label {display: inline-block; font-size: 11px; text-transform: uppercase; padding: 5px; margin-right: 5px; min-width: 180px; line-height: 20px; white-space: normal;}.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .file-form label {display: inline-block; font-size: 11px; text-transform: uppercase; padding: 5px; margin-left: 5px; min-width: 180px; line-height: 20px; white-space: normal;}.jimu-widget-critical-facilities-ui .cf-home .upload-input {display: none;}.jimu-widget-critical-facilities-ui .cf-home .warning-instruction {color: firebrick; display: none;}.jimu-widget-critical-facilities-ui .cf-home .usage-instruction {font-size: 14px; font-weight: bold;}.jimu-widget-critical-facilities-ui .cf-home .startpage-hint {padding-top: 10px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .cf-home .bottom {padding-top: 10px; padding-bottom: 10px;}.jimu-popup .cf-warning-icon {width: 30px; height: 30px; position: relative; background-size: contain; background-repeat: no-repeat; margin-top: 10px; background-image: url('../images/warning.png');} .jimu-widget-critical-facilities-ui .cf-home .address-search {display: inline-block;}.jimu-widget-critical-facilities-ui .esriCTSearchOuterContainer {padding: 0px 0px 15px 0px; clear: both;}.jimu-widget-critical-facilities-ui .esriCTSearchDiv {float: left; clear: both; margin-right: 10px;}.jimu-widget-critical-facilities-ui .esriCTSearchHeader {margin-bottom: 10px;}.jimu-widget-critical-facilities-ui .esriCTSearchDiv .arcgisSearch {float: left; width: 100% !important;}.jimu-widget-critical-facilities-ui .esriCTSearchContainer {width: 100%; height: 35px;}.jimu-widget-critical-facilities-ui .arcgisSearch .searchGroup .searchInput {width: 170px; padding: 6px 24px 6px 12px !important;}.esriRtl .jimu-widget-critical-facilities-ui .arcgisSearch .searchGroup .searchInput {padding: 6px 12px 6px 24px !important;}.jimu-widget-critical-facilities-ui .arcgisSearch .searchBtn {padding: 6px;}.jimu-widget-critical-facilities-ui .jimu-widget-search .arcgisSearch .searchGroup .searchInputGroup .searchInput {width: auto;}.jimu-widget-critical-facilities-ui .esriCTSearchContainer .searchClear {top: 2px !important;}.jimu-widget-critical-facilities-ui .done-mark {background-image: url('../images/check.png'); width: 15px; height: 16px; position: relative; background-size: contain; float: right; margin-right: 10px; background-repeat: no-repeat;}.jimu-rtl .jimu-widget-critical-facilities-ui .done-mark {background-image: url('../images/check.png'); width: 15px; height: 16px; position: relative; background-size: contain; float: left; margin-left: 10px; background-repeat: no-repeat;}.jimu-widget-critical-facilities-ui .incomplete-mark{margin-right: 10px;}.jimu-rtl .jimu-widget-critical-facilities-ui .incomplete-mark{margin-left: 10px; margin-right: 0px;}.jimu-widget-critical-facilities-ui .bg-loading {background-image: url('../css/images/loading.gif');}.jimu-widget-critical-facilities-ui .bg-loading-img {width: 75px; height: 15px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer; margin: auto;}.LaunchpadTheme .jimu-widget-critical-facilities-ui .jimu-simple-table .simple-table-cell {border-bottom: none !important; padding-top: 1px; padding-bottom: 1px; height: 33px;}.LaunchpadTheme .jimu-widget-critical-facilities-ui .simple-table-row {border-bottom: 1px solid #ddd !important;}.LaunchpadTheme .jimu-widget-critical-facilities-ui .dijitTextBoxDisabled .dijitInputInner {color: black !important;}.DartTheme .jimu-widget-critical-facilities-ui .dijitTextBoxDisabled .dijitInputInner {color: #8e8d8d !important;}.DartTheme .jimu-popup {color: white !important;}.DartTheme .jimu-popup .title {color: white !important;}.DartTheme .jimu-widget-critical-facilities-ui .jimu-simple-table .simple-table-row .normal-text-div {color: white !important;}.DartTheme .jimu-widget-critical-facilities-ui .jimu-simple-table .simple-table-row:hover .normal-text-div {color: black !important;}.DartTheme .jimu-widget-critical-facilities-ui .main-text {font-weight: normal !important;}.DartTheme .jimu-widget-critical-facilities-ui .panel-title-text {font-weight: normal !important;}.DartTheme .jimu-widget-critical-facilities-ui .task-text {font-weight: normal !important;}.DartTheme .jimu-rtl .jimu-widget-critical-facilities-ui .task-text {font-weight: normal !important;}.DartTheme .jimu-widget-critical-facilities-ui .cf-home .usage-instruction {font-weight: normal !important;}",
"*now":function(v){v(['dojo/i18n!*preload*widgets/DataAggregation/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/on jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/Deferred dojo/DeferredList dojo/dom-construct dojo/dom-class dojo/dom-attr jimu/LayerStructure jimu/LayerInfos/LayerInfos jimu/portalUtils jimu/dijit/Message jimu/dijit/Popup esri/lang esri/request ./js/UI/PageContainer ./js/UI/Home ./js/UI/StartPage ./js/UI/LocationType jimu/dijit/EditorXssFilter jimu/utils".split(" "),function(v,c,f,h,n,u,k,x,p,B,t,r,w,b,l,g,d,a,e,q,y,z,A,D){return v([n,
u],{baseClass:"jimu-widget-critical-facilities-ui",portal:null,editLayer:null,_configLayerInfo:null,_url:"",_geocodeSources:null,_fsFields:null,_singleFields:null,_multiFields:null,_pageContainer:null,_userCanEdit:!0,_userHasCredits:!1,_hasLocators:!0,_locationMappingComplete:!1,_fieldMappingComplete:!1,_tempResultsAdded:!1,postCreate:function(){this.inherited(arguments);this.editorXssFilter=A.getInstance();this.nls=c.mixin(this.nls,window.jimuNls.common);this.openAtStartAysn=!0;w.getInstance(this.map,
this.map.itemInfo).then(c.hitch(this,function(a){this.operLayerInfos=a;this._initEditLayerNode();this.editLayerNode&&this._initUserProperties().then(c.hitch(this,function(){this._initThemeAndConfig()}))}))},_initUserProperties:function(){var a=new k;this.validatePrivileges().then(c.hitch(this,function(b){this._userCanEdit=b.canEdit;this._userHasCredits=b.hasCredits;this._userCanEdit&&this._userHasCredits?a.resolve(!0):this._alertUser().then(c.hitch(this,function(b){this._hasLocators=b;a.resolve(!0)}))}));
return a},_initEditLayerNode:function(){var a=this.config.layerSettings;a&&a.layerInfo&&a.layerInfo.featureLayer&&(a=[a]);var b=!0;a&&0<a.length&&(this.layerStructure=r.getInstance(),f.some(a,c.hitch(this,function(a){var c,d;if(a&&a.layerInfo&&a.layerInfo.featureLayer&&a.layerInfo.featureLayer.id&&(d=this.operLayerInfos.getLayerInfoById(a.layerInfo.featureLayer.id),(c=this.layerStructure.getNodeById(a.layerInfo.featureLayer.id))&&d&&d.layerObject&&d.layerObject.isEditable()))return this._configLayerInfo=
a.layerInfo,this._symbol=a.symbol,this.editLayerNode=c,b=!1,!0})));b?this._showPopup([this.nls.warningsAndErrors.noLayersWarning],""):-1!==[null,void 0].indexOf(this.editLayerNode)&&this._showNoEditLayerMessage()},_showNoEditLayerMessage:function(){this._userHasCredits=this._userCanEdit=!1;var a=[this.nls.startPage.appropriateCredentials+"\x3c/br\x3e\x3c/br\x3e",this.nls.startPage.or+"\x3c/br\x3e\x3c/br\x3e",d.substitute({layerName:this.config.layerSettings.layerInfo.featureLayer.title},this.nls.startPage.shared)];
this._showPopup(a,d.substitute({layerName:this.config.layerSettings.layerInfo.featureLayer.title},this.nls.startPage.unableToAccess))},_initThemeAndConfig:function(){this._initConfigInfo();this._initEditLayerInfo().then(c.hitch(this,function(){this._initBaseArgs();this._initPageContainer(!1)}))},_alertUser:function(){var a=new k;this._userCanEdit?this._removeWorldLocator(!0).then(function(b){a.resolve(0<b.length)}):(this.showEditMessage(),a.resolve(!1));return a},_removeWorldLocator:function(){var b=
new k,d=[],e=[];f.forEach(this.config.sources,function(b){e.push(b.url);d.push(a({url:b.url,content:{f:"json"},handleAs:"json"}))});(new x(d)).then(c.hitch(this,function(a){if(a){for(var d=[],g=[],h=0;h<a.length;h++)g.push(this._validateLocator(a[h][1],e[h]));(new x(g)).then(c.hitch(this,function(a){f.forEach(a,c.hitch(this,function(a){a[1]&&d.push(a[1])}));this._updateSources(d);b.resolve(this.config.sources)}))}}));return b},_validateLocator:function(b,d){var e=new k;b&&b.locatorProperties?b.locatorProperties.isAGOWorldLocator?
(b=(b=/\/[0-9A-Fa-f]{32}\//.exec(d))&&b.length?b[0].substr(1).slice(0,-1):!1)?a({url:this.appConfig.portalUrl+"sharing/rest/content/items/"+b,content:{f:"json"},handleAs:"json"}).then(c.hitch(this,function(a){e.resolve(a.access&&"public"===a.access?!1:d)}),function(a){console.log(a)}):e.resolve(d):e.resolve(!1):e.resolve(d);return e},_updateSources:function(a){if(0<a.length){var b=[];this.config.sources=this.config.sources.filter(function(c){if(-1===a.indexOf(c.url))return!0;b.push(c.name);return!1});
var c=this._getMessages(b);this._showPopup(c,d.substitute({widgetName:this.label},this.nls.startPage.cannotUseLocator),!0)}},_getMessages:function(a){var b=[],e="";a?f.forEach(a,c.hitch(this,function(a){e+=d.substitute({widgetName:this.label,locator:a},this.nls.startPage.userCredits);e+="\x3c/br\x3e\x3c/br\x3e"})):(e+=this.nls.startPage.notEnoughCredits,e+="\x3c/br\x3e\x3c/br\x3e");""!==e&&(b.push(e),b.push(this.nls.startPage.contactAdmin+"\x3c/br\x3e\x3c/br\x3e"),0<this.config.sources.length&&(e=
"",f.forEach(this.config.sources,c.hitch(this,function(a){e+=d.substitute({locator:a.name},this.nls.startPage.canUseLocator);e+="\x3c/br\x3e\x3c/br\x3e"})),b.push(e)));return b},_showPopup:function(a,b,d){var e=this,f=p.create("div",{tabindex:"0",role:"region",style:"outline-offset:-2px"}),h="";p.create("div",{className:"cf-warning-icon",style:"float: "+(window.isRTL?"right; margin-left":"left; margin-right")+": 10px;"},f);for(var k="padding-"+(window.isRTL?"right":"left")+": 50px;",m=0;m<a.length;m++){var l=
a[m],h=h+l;p.create("div",{innerHTML:l,style:(0===m?"padding-top:10px; ":"")+k+"word-wrap: break-word;"},f)}h&&t.set(f,"aria-label",D.stripHTML(h));var n=new g({width:500,autoHeight:!0,content:f,titleLabel:b,buttons:[{label:this.nls.ok,onClick:c.hitch(this,function(){n.close();n=null})}],onClose:function(){n=null;setTimeout(c.hitch(this,function(){d&&D.focusFirstFocusNode(e.domNode)}),200)}})},_initBaseArgs:function(){this._baseArgs={nls:this.nls,map:this.map,parent:this,config:this.config,appConfig:this.appConfig,
theme:this.theme,styleColor:this.styleColor,singleEnabled:this.singleEnabled,multiEnabled:this.multiEnabled,xyEnabled:this.xyEnabled}},onAppConfigChanged:function(a,b,c){switch(b){case "widgetChange":this._clearResults()}},_initConfigInfo:function(){if(this._configLayerInfo){this._valid=!0;this._url=this._configLayerInfo.featureLayer.url;this._geocodeSources=this.config.sources;this.xyEnabled=this.config.xyEnabled;this.singleEnabled=this.multiEnabled=!1;this._fsFields=[];f.forEach(this._configLayerInfo.fieldInfos,
c.hitch(this,function(a){a&&a.visible&&this._fsFields.push({name:a.fieldName,label:a.label,value:a.type,isRecognizedValues:a.isRecognizedValues,duplicate:a.duplicate})}));var a=function(a,b){f.forEach(a.isRecognizedValues,function(a){-1===b.isRecognizedValues.indexOf(a)&&b.isRecognizedValues.push(a)})};this._singleFields=[];this._multiFields=[];var b=[],d=[],e=[],g=[];this._geocodeSources&&f.forEach(this._geocodeSources,c.hitch(this,function(h){this.singleEnabled=this.singleEnabled?this.singleEnabled:
h.singleEnabled;this.multiEnabled=this.multiEnabled?this.multiEnabled:h.multiEnabled;if(h.singleEnabled){var k=h.singleAddressFields[0],m=k.label||k.alias,l=e.indexOf(m),n=k.fieldName||k.name,p=g.indexOf(n);-1<l||-1<p?a(k,this._singleFields[-1<l?l:p]):(e.push(m),g.push(n),this._singleFields.push({label:m,value:n,type:"STRING",isRecognizedValues:k.isRecognizedValues}))}h.multiEnabled&&(f.forEach(h.addressFields,c.hitch(this,function(c){if(c&&c.visible){var e=c.label||c.alias,f=b.indexOf(e),g=c.fieldName||
c.name,h=d.indexOf(g);-1<f||-1<h?(e=this._multiFields[-1<f?f:h],"undefined"===typeof e.fieldList?e.fieldList=[e.value,g]:e.fieldList.push(g),a(c,this._multiFields[-1<f?f:h])):(b.push(e),d.push(g),this._multiFields.push({label:e,value:g,type:"STRING",isRecognizedValues:c.isRecognizedValues}))}})),this.multiEnabled=0<this._multiFields.length)}))}},_initEditLayerInfo:function(){var a=new k;this.editLayerNode.getLayerObject().then(c.hitch(this,function(b){this.infoTemplate=this.editLayerNode.getInfoTemplate();
this.editLayer=b;this.editLayerDefinition=D.getFeatureLayerDefinition(b);this._updateFsFields(this.editLayer,this.infoTemplate);a.resolve(!0)}));return a},_updateFsFields:function(a,b){var c=a.typeIdField,d=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle"],e=["esriFieldTypeDouble"],g=this.editLayer||this.editLayerDefinition;f.forEach(this._fsFields,function(f){var h=0;a:for(;h<a.fields.length;h++){var k=a.fields[h];if(k.name===f.name){f.domain=k.domain;f.length=k.length;f.isTypeIdField=
f.name===c;f.subtypes=a.subtypes;var m=!0,h=f.domain,l=!0,n;if(h||f.isTypeIdField)n=D.getCodedValueListForCodedValueOrSubTypes(g,f.name,{});if(n){f.domainValues=n;f.codes=[];f.values=[];for(var p=0;p<n.length;p++){var q=n[p];f.codes.push(q.value);l&&(l=!isNaN(parseInt(q.label,10))&&!isNaN(parseFloat(q.label))&&parseFloat(q.label).toString().length===q.label.toString().length);f.values.push(q.label)}p=0;b:for(;p<n.length;p++)if(m=n[p].value,m=!isNaN(parseInt(m,10))&&parseInt(m,10).toString().length===
m.toString().length,!m)break b}n=k.type;f.type=-1<d.indexOf(n)&&l?"int":-1<e.indexOf(n)&&l?"float":"esriFieldTypeDate"===n?"date":h&&m&&l?"domainInt":h?"domain":"other";f.esriFieldType=n;if("date"===f.type){b:{if(b&&b.info&&b.info.fieldInfos)for(h=b.info.fieldInfos,l=0;l<h.length;l++)if(n=h[l],n.fieldName===f.name){h=n;break b}h=void 0}f.fieldInfo=h}f.nullable=k.nullable;break a}}})},updateFirstLastNode:function(a){var b,c,d;b=this._pageContainer.getSelectedTitle();view=this._pageContainer.getViewByTitle(b);
var e;e=B.contains(this._pageContainer.backImage,"control-disbaled")?this._pageContainer.homeImage:this._pageContainer.backImage;b.indexOf(!1)&&(c=e,d=view.lastFocusNode);switch(b){case "Home":c=view.firstFocusNode;d=view.lastFocusNode;break;case "StartPage":c=e;d=view.lastFocusNode;break;case "LocationType":c=e;d=view.lastFocusNode;break;case "FieldMapping":b=this._pageContainer.getViewByTitle("Home");c=this._pageContainer.backImage;d=b.fieldMappingView.lastFieldSelect;break;case "Addresses":c=e;
d=view.lastFocusNode;break;case "Coordinate":c=e;d=view.lastFocusNode;break;case "Review":c=e;d=view.downloadButton;break;case "MatchedFeatures":c=e;d=view.lastFocusNode;break;case "UnMatchedFeatures":c=e;d=view.lastFocusNode;break;case "DuplicateFeatures":c=e,d=view.lastFocusNode}c&&d&&this.domNode&&(D.initFirstFocusNode(this.domNode,c),D.initLastFocusNode(this.domNode,d),a&&D.isAutoFocusFirstNodeWidget(this)&&D.focusFirstFocusNode(this.domNode))},_initPageContainer:function(a){this._initHomeView(a).then(c.hitch(this,
function(a){this._pageContainer&&!this._pageContainer._destroyed?(this._tempResultsAdded=this._fieldMappingComplete=this._locationMappingComplete=!1,this._pageContainer.reset(),this._pageContainer.displayControllerOnStart=!1,this._pageContainer.toggleController(!0)):(this._pageContainer=new e({nls:this.nls,appConfig:this.appConfig,displayControllerOnStart:!1,parent:this,styleColor:this.styleColor},this.pageNavigation),this.own(h(this._pageContainer,"view-changed",c.hitch(this,function(){this.updateFirstLastNode(!0)}))));
var b=this._initStartPageView();this.own(h(b,"targetLayerChanged",c.hitch(this,function(b){var d=this.config.layerSettings;d&&d.layerInfo&&d.layerInfo.featureLayer&&(d=[d]);for(var e=0;e<d.length;e++)d[e].layerInfo.featureLayer.id===b&&(this._configLayerInfo=d[e].layerInfo,this._symbol=d[e].symbol,this.editLayerNode=this.layerStructure.getNodeById(this._configLayerInfo.featureLayer.id));this._initConfigInfo();this._initEditLayerInfo().then(c.hitch(this,function(){this._configLayerInfo&&(a._fsFields=
c.clone(this._fsFields),a.targetLayerUpdated())}))})));b=[a,b];if(this.xyEnabled&&(this.multiEnabled||this.singleEnabled)){var d=this._initLocationTypeView();b.push(d)}this._pageContainer.views=b;this._pageContainer.startup()}))},_initHomeView:function(a){var b=new k;a?this._initUserProperties().then(c.hitch(this,function(){b.resolve(this._getHome())})):b.resolve(this._getHome());return b},_getHome:function(){this.config.hasOwnProperty("editorDescription")&&this.config.editorDescription||(this.config.editorDescription=
this.nls.startPage.defaultStartPageInstructions);return new q(c.mixin({pageInstructionText:this.editorXssFilter.sanitize(this.config.editorDescription),_geocodeSources:this._geocodeSources,_fsFields:this._fsFields,_singleFields:this._singleFields,_multiFields:this._multiFields,userName:this.userName,disabled:!this._userCanEdit||!this._userHasCredits&&!this._hasLocators},this._baseArgs))},_initStartPageView:function(){return new y(this._baseArgs)},_initLocationTypeView:function(){return new z(this._baseArgs)},
_clearResults:function(){if(this._pageContainer){var a=this._pageContainer.getViewByTitle("Home");a&&(a._clearStore(!0),a._clearMapping())}},validatePrivileges:function(){var a=new k;this.portal=this.portal||b.getPortal(this.appConfig.portalUrl);this.portal.getUser().then(c.hitch(this,function(b){this.userName=b.username;this.userCredits="undefined"!==typeof b.availableCredits?b.availableCredits:"undefined"!==typeof this.portal.availableCredits?this.portal.availableCredits:0;!this.userCredits&&this.portal.isPortal&&
(this.userCredits=1);this._checkLayerEditable(0<this.userCredits).then(function(b){a.resolve(b)})}),c.hitch(this,function(b){console.log(b);this._checkLayerEditable(!1).then(function(b){a.resolve(b)})}));return a},_checkLayerEditable:function(a){var b=new k;this.editLayerNode.isEditable().then(c.hitch(this,function(c){b.resolve({canEdit:c,hasCredits:a})}));return b},showEditMessage:function(){var a=[];"undefined"!==typeof this.userName?a=[this.nls.startPage.userPrivilege+"\x3c/br\x3e\x3c/br\x3e",
this.nls.startPage.contactAdminEdit]:(this.portal=this.portal||b.getPortal(this.appConfig.portalUrl),a=[d.substitute({layerName:this.editLayer.name},this.nls.startPage.noAnonymousEdit+"\x3c/br\x3e\x3c/br\x3e"),d.substitute({org:this.portal.name},this.nls.startPage.pleaseLogin)]);this._showPopup(a,this.nls.startPage.invalidEdit)},locatorError:function(a,b){a=[a+"\x3c/br\x3e\x3c/br\x3e"];b&&a.push(d.substitute({locator:b},this.nls.startPage.canUseLocator));this._showPopup(a,this.nls.warningsAndErrors.locatorError)},
erroInCSV:function(){this._showPopup([this.nls.warningsAndErrors.invalidCSV+"\x3c/br\x3e"],"")}})});