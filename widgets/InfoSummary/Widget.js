// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"dojox/gfx/fx":function(){define("dojo/_base/lang ./_base ./matrix dojo/_base/Color dojo/_base/array dojo/_base/fx dojo/_base/connect dojo/sniff".split(" "),function(Y,A,v,e,b,t,u,L){function I(b,l){this.start=b;this.end=l}function k(b,l,p){this.start=b;this.end=l;this.units=p}function m(b,l){this.start=b;this.end=l;this.temp=new e}function x(b){this.values=b;this.length=b.length}function E(b,l){this.values=b;this.def=l?l:{}}function B(b,l){this.stack=b;this.original=l}function r(b,
l,p,k){if(b.values)return new x(b.values);var h,e;e=b.start?A.normalizeColor(b.start):h=l?p?l[p]:l:k;b.end?b=A.normalizeColor(b.end):(h||(h=l?p?l[p]:l:k),b=h);return new m(e,b)}var y=A.fx={};I.prototype.getValue=function(b){return(this.end-this.start)*b+this.start};k.prototype.getValue=function(b){return(this.end-this.start)*b+this.start+this.units};m.prototype.getValue=function(b){return e.blendColors(this.start,this.end,b,this.temp)};x.prototype.getValue=function(b){return this.values[Math.min(Math.floor(b*
this.length),this.length-1)]};E.prototype.getValue=function(b){var l=Y.clone(this.def),p;for(p in this.values)l[p]=this.values[p].getValue(b);return l};B.prototype.getValue=function(k){var l=[];b.forEach(this.stack,function(p){if(p instanceof v.Matrix2D)l.push(p);else if("original"==p.name&&this.original)l.push(this.original);else if("matrix"==p.name){if(p.start instanceof v.Matrix2D&&p.end instanceof v.Matrix2D){var e=new v.Matrix2D,h;for(h in p.start)e[h]=(p.end[h]-p.start[h])*k+p.start[h];l.push(e)}}else p.name in
v&&(e=v[p.name],"function"!=typeof e?l.push(e):(h=b.map(p.start,function(b,h){return(p.end[h]-b)*k+b}),e=e.apply(v,h),e instanceof v.Matrix2D&&l.push(e)))},this);return l};var z=new e(0,0,0,0);y.animateStroke=function(b){b.easing||(b.easing=t._defaultEasing);var l=new t.Animation(b),p=b.shape,e;u.connect(l,"beforeBegin",l,function(){e=p.getStroke();var h=b.color,l={},k;h&&(l.color=r(h,e,"color",z));(h=b.style)&&h.values&&(l.style=new x(h.values));if(h=b.width){var m=h,t=e;m.values?k=new x(m.values):
(h=m.start?m.start:k=t?t.width:1,m.end?k=m.end:"number"!=typeof k&&(k=t?t.width:1),k=new I(h,k));l.width=k}(h=b.cap)&&h.values&&(l.cap=new x(h.values));if(h=b.join)h.values?l.join=new x(h.values):(k=h.start?h.start:e&&e.join||0,h=h.end?h.end:e&&e.join||0,"number"==typeof k&&"number"==typeof h&&(l.join=new I(k,h)));this.curve=new E(l,e)});u.connect(l,"onAnimate",p,"setStroke");return l};y.animateFill=function(b){b.easing||(b.easing=t._defaultEasing);var k=new t.Animation(b),p=b.shape,e;u.connect(k,
"beforeBegin",k,function(){e=p.getFill();var h=b.color;h&&(this.curve=r(h,e,"",z))});u.connect(k,"onAnimate",p,"setFill");return k};y.animateFont=function(b){b.easing||(b.easing=t._defaultEasing);var e=new t.Animation(b),p=b.shape,m;u.connect(e,"beforeBegin",e,function(){m=p.getFont();var h=b.style,e={},l,t;h&&h.values&&(e.style=new x(h.values));(h=b.variant)&&h.values&&(e.variant=new x(h.values));(h=b.weight)&&h.values&&(e.weight=new x(h.values));(h=b.family)&&h.values&&(e.family=new x(h.values));
(h=b.size)&&h.units&&(l=parseFloat(h.start?h.start:p.font&&p.font.size||"0"),t=parseFloat(h.end?h.end:p.font&&p.font.size||"0"),e.size=new k(l,t,h.units));this.curve=new E(e,m)});u.connect(e,"onAnimate",p,"setFont");return e};y.animateTransform=function(e){e.easing||(e.easing=t._defaultEasing);var k=new t.Animation(e),p=e.shape,m;u.connect(k,"beforeBegin",k,function(){m=p.getTransform();this.curve=new B(e.transform,m)});u.connect(k,"onAnimate",p,"setTransform");if("svg"===A.renderer&&(9<=L("ie")||
L("ff")))var h=[u.connect(k,"onBegin",k,function(){for(var b=p.getParent();b&&b.getParent;)b=b.getParent();b&&(p.__svgContainer=b.rawNode.parentNode,p.__svgRoot=b.rawNode,p.__svgRoot&&p.__svgRoot.getAttribute&&(p.__svgWidth=parseInt(p.__svgRoot.getAttribute("width"),10),isNaN(p.__svgWidth)&&delete p.__svgWidth))}),u.connect(k,"onAnimate",k,function(){try{if(p.__svgContainer){var b=p.__svgContainer.style.visibility;p.__svgContainer.style.visibility="visible";p.__svgContainer.style.visibility=b;var e=
p.__svgWidth;if(!isNaN(e))try{p.__svgRoot.setAttribute("width",e-5E-6),p.__svgRoot.setAttribute("width",e)}catch(T){}}}catch(T){}}),u.connect(k,"onEnd",k,function(){b.forEach(h,u.disconnect);if(p.__svgContainer){var e=p.__svgContainer;if(null==e.getAttribute("__gotVis")){e.setAttribute("__gotVis",!0);var k=p.__svgContainer.style.visibility,m=p.__svgRoot,l=p.__svgWidth;e.style.visibility="visible";setTimeout(function(){try{e.style.visibility=k;e.removeAttribute("__gotVis");e=null;try{isNaN(l)||(m.setAttribute("width",
l-5E-6),m.setAttribute("width",l))}catch(N){}}catch(N){}},100)}}delete p.__svgContainer;delete p.__svgRoot;delete p.__svgWidth})];return k};return y})},"widgets/InfoSummary/js/ClusterLayer":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/event dojo/_base/lang dojo/_base/Color dojo/_base/html dojo/DeferredList dojo/dom-class dojo/dom dojox/gfx/fx dojo/on dojo/Evented jimu/utils esri/layers/GraphicsLayer esri/graphic esri/geometry/Extent esri/geometry/Point esri/symbols/PictureMarkerSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/TextSymbol esri/symbols/Font esri/renderers/SimpleRenderer esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/symbols/jsonUtils esri/renderers/jsonUtils esri/layers/FeatureLayer".split(" "),
function(Y,A,v,e,b,t,u,L,I,k,m,x,E,B,r,y,z,Z,l,p,F,h,M,V,T,ca,N,ba,X){return Y("ClusterLayer",[B,x],{constructor:function(f){this.clusterGraphics=[];this.cancelRequest=!1;this.clusterSize=120;this._singles=[];this._showSingles=!0;this.updateFeatures=void 0;this.hidePanel=f.hidePanel;this._parent=f._parent;this._parentLayer=f.parentLayer;this.layerDefinition=f.layerDefinition;this._parentLayer&&(this.objectIdField=this._parentLayer.objectIdField,this.fields=this._parentLayer.fields);this.name=f.name;
this._map=f.map;this.color=b.fromString(f.color||"#ff0000");this._styleColor=f._styleColor;this.symbolData=f.lyrInfo.symbolData;this.countColor=this.symbolData._highLightColor;this.itemId=f.lyrInfo.itemId;this.refresh=f.lyrInfo.refresh;this.displayFeatureCount=this.symbolData.displayFeatureCount;this.node=f.node;this.countEnabled=f.countEnabled;this.legendNode=f.legendNode;this.id=f.id;this.infoTemplate=f.infoTemplate;this.url=f.lyrInfo.url;this._testRenderer=f.lyrInfo.renderer;(this.originOperLayer=
f.originOperLayer)&&this._getInfoTemplate(this.originOperLayer);this.lyrInfo=f.lyrInfo;this.lyrType=f.lyrType;this.filter=f.filter;this.showAllFeatures=f.showAllFeatures;this.listDisabled=f.listDisabled;this.selfType=f.selfType;this._setupSymbols();this._setFieldNames();this.countFeatures(this._parentLayer);0<this._parentLayer.refreshInterval&&setInterval(e.hitch(this,this._updateEnd),6E4*this._parentLayer.refreshInterval)},countFeatures:function(b){var f=new V;f.geometry=this.showAllFeatures?b.fullExtent:
this._map.extent;b.queryCount?b.queryCount(f,e.hitch(this,function(f){if(0<f)this.hidePanel||(this.nodeCount=f),this._initFeatures(this._parentLayer);else if(!this.hidePanel)if(this.nodeCount=0,b.url){var H=new X(b.url);m(H,"load",e.hitch(this,function(){this.countFeatures(H)}))}else this._initFeatures(this._parentLayer)})):this._initFeatures(this._parentLayer)},_initFeatures:function(b){this._features=[];var f=!0,k=new V;(-1<["CSV","Feature Collection","GeoRSS","KML"].indexOf(this.lyrType)||!this.url)&&
b.graphics?(this._getSourceFeatures(b.graphics),this.clusterFeatures()):"undefined"!==typeof this.url?this.loadData(this.url):(k.where=!this.showAllFeatures&&this.filter?this.filter:"1\x3d1",k.outFields=["*"],k.returnGeometry=!0,b.queryFeatures?b.queryFeatures(k).then(e.hitch(this,function(b){b.features&&(this._getSourceFeatures(b.features),this.clusterFeatures())})):f="error");"error"!==f&&(this.extentChangeSignal||(this.extentChangeSignal=this._map.on("extent-change",e.hitch(this,this.handleMapExtentChange))),
this.clickSignal||(this.clickSignal=this.on("click",e.hitch(this,this.handleClick))))},_getSourceFeatures:function(b){this._features=[];for(var f=0;f<b.length;f++){var e=b[f];e.geometry&&(this.preFormatDomain(e),this._features.push(e))}},_getInfoTemplate:function(b){b=b.parentLayerInfo?b.parentLayerInfo:b;if(b.controlPopupInfo&&(b=b.controlPopupInfo.infoTemplates)){if(this.url){var f=this.url.split("/").pop();f&&(b.indexOf?-1<b.indexOf(f)&&(this.infoTemplate=b[f].infoTemplate):b.hasOwnProperty(f)&&
(this.infoTemplate=b[f].infoTemplate))}this.setInfoTemplate(this.infoTemplate)}},_setFieldNames:function(){this._fieldNames=[];if(this.infoTemplate&&"undefined"!==typeof this.infoTemplate.info){var b=this.infoTemplate.info.fieldInfos;if(b)for(var e=0;e<b.length;e++)b[e].visible&&this._fieldNames.push(b[e].fieldName)}if(this.symbolData.featureDisplayOptions&&0<this.symbolData.featureDisplayOptions.fields.length)for(b=0;b<this.symbolData.featureDisplayOptions.fields.length;b++)e=this.symbolData.featureDisplayOptions.fields[b],
-1===this._fieldNames.indexOf(e.name)&&this._fieldNames.push(e.name);1>this._fieldNames.length&&(this._fieldNames=["*"])},setLayerInfo:function(b){this.lyrInfo=b},clearSingles:function(b){A.forEach(b||this._singles,function(b){this.remove(b)},this);this._singles.length=0},_getSingleGraphic:function(b){b=new r(new z(b.geometry.x,b.geometry.y,this._map.spatialReference),null,b.attributes);b.setSymbol(this._singleSym);return b},_addSingles:function(b){A.forEach(b,function(b){b=this._getSingleGraphic(b);
this._singles.push(b);this._showSingles&&this.add(b)},this);this._map.infoWindow.setFeatures(this._singles)},initalCount:function(b){if(!this.hidePanel){var f=new V;f.returnGeometry=!1;f.geometry=this.showAllFeatures?null:this._map.extent;f.where=!this.showAllFeatures&&this.filter?this.filter:"1\x3d1";(new T(b)).executeForIds(f).then(e.hitch(this,function(b){var f;this.node?(L.contains(this.node,"searching")&&L.remove(this.node,"searching"),this.node.innerHTML=b?E.localizeNumber(b.length):0,f=this.node.parentNode):
this.legendNode&&(f=this.legendNode.previousSibling);this.updateExpand(f,b?!1:!0)}))}},updateExpand:function(b,e){if(!this.hidePanel&&"undefined"!==typeof b){var f;-1<b.id.indexOf("rec_")&&(f=b.id.replace("rec_",""),f=I.byId("exp_"+f));e?(b&&(t.addClass(b,"recDefault"),t.addClass(b,"inActive")),f&&t.addClass(f,"expandInActive")):this.visible&&(b&&(t.removeClass(b,"recDefault"),t.removeClass(b,"inActive")),f&&t.removeClass(f,"expandInActive"))}},loadData:function(b){if(0<b.length){this.initalCount(b);
var f=new V;f.where="1\x3d1";this.filter&&(f.where=this.filter);f.returnGeometry=!1;this.queryPending=!0;(new T(b)).executeForIds(f).then(e.hitch(this,function(f){var k=this._parentLayer&&this._parentLayer.maxRecordCount?this._parentLayer.maxRecordCount:1E3;if(f){this.queryIDs=f;f=[];var h,p;h=0;for(p=this.queryIDs.length;h<p;h+=k){var H=this.queryIDs.slice(h,h+k),m=new V;m.outFields=["*"];m.objectIds=H;m.returnGeometry=!0;m.outSpatialReference=this._map.spatialReference;H=new T(b);f.push(H.execute(m))}this._features=
[];this.cancelRequest?console.log("Cancelled ClusterLayer 1"):(new u(f)).then(e.hitch(this,function(b){this.queryPending=!1;if(this.cancelRequest)console.log("Cancelled ClusterLayer 2");else if(b){for(var f=this._map.spatialReference,e=[],k=0;k<b.length;k++)if(b[k][1].features)for(var a=0;a<b[k][1].features.length;a++){var c=b[k][1].features[a];if("undefined"!==typeof c.geometry&&null!==c.geometry&&c.geometry){var g=new z(c.geometry.x,c.geometry.y,f),g=new r(g);g.setAttributes(c.attributes);this.infoTemplate&&
g.setInfoTemplate(this.infoTemplate);this.preFormatDomain(g);e.push(g)}}b=!0;1E4>e&&(b=JSON.stringify(this._features)!==JSON.stringify(e));b&&(this.requiresReload=!0,this._features=e,this.clusterFeatures(),this.emit("update-end",{bubbles:!0,cancelable:!0}))}}))}}))}},preFormatDomain:function(b){A.forEach(this.fields,e.hitch(this,function(f){if(f&&f.hasOwnProperty("name")&&this._parent&&b&&b.hasOwnProperty("attributes")&&b.attributes.hasOwnProperty(f.name)){var e=this._parent._checkDomainField(f),
k=this._parent._checkDomainAndSubtype(this.layerDefinition,f.name,b.attributes,{layerObject:this._parentLayer});if(e||k)b.attributes[f.name]=this._parent.formatDomainValue(b.attributes[f.name],e,k)}}))},handleClick:function(b){var f=[];if(b.graphic&&(f=b.graphic,f.attributes)){var e=f.attributes;e.Data&&1<e.Data.length?(this.clearSingles(this._singles),f=e.Data,b.stopPropagation(),this._addSingles(f)):e.Data&&1===e.Data.length?(e.Data[0].symbol=f.symbol,this._map.infoWindow.setFeatures([e.Data[0]])):
this._map.infoWindow.setFeatures([f])}this.infoTemplate&&this._map.infoWindow.show(b.mapPoint);v.stop(b)},handleMapExtentChange:function(b){if(b.levelChange)this.clusterFeatures();else if(b.delta){b=b.delta;var f=Math.abs(b.y);(50<Math.abs(b.x)||50<f)&&this.clusterFeatures()}},refreshFeatures:function(b){if(this.itemId){var f=b.featureSet.features;b.featureSet.transform&&(f=(new ca(b.featureSet)).features);"undefined"===typeof this.updateFeatures&&(this.updateFeatures=f);b=!0;1E4>f.length&&(b=JSON.stringify(this.updateFeatures)!==
JSON.stringify(f));if(b){this.requiresReload=!0;this._features=[];this._parentLayer.clear();b=this._parentLayer.spatialReference;for(var e=0;e<f.length;e++){var k=f[e];if(k.geometry){var h=new r(this.getGraphicOptions(k,b));h.setAttributes(k.attributes);this.infoTemplate&&h.setInfoTemplate(this.infoTemplate);this.preFormatDomain(h);this._parentLayer.add(h);this._features.push(h)}else console.log("Null geometry skipped")}this.clusterFeatures()}this.updateFeatures=f}else this.url&&this.loadData(this.url)},
getGraphicOptions:function(b,e){return"undefined"!==typeof b.geometry.rings?{geometry:{rings:b.geometry.rings,spatialReference:{wkid:e.wkid}}}:"undefined"!==typeof b.geometry.paths?{geometry:{paths:b.geometry.paths,spatialReference:{wkid:e.wkid}}}:"undefined"!==typeof b.geometry.points?{geometry:{points:b.geometry.points,spatialReference:{wkid:e.wkid}}}:{geometry:new z(b.geometry.x,b.geometry.y,b.geometry.spatialReference)}},flashFeatures:function(){this._map.graphics.clear();this.flashGraphics(this.graphics)},
flashSingle:function(f){if("undefined"===typeof f.symbol){var e=new p(p.STYLE_NULL,new b(0,0,0,0),0),k=this.color.toRgb();f.setSymbol(new l(l.STYLE_CIRCLE,9,e,new b([k[0],k[1],k[2],.5])))}this.flashGraphics([f])},flashGraphics:function(b){for(var f=0;f<b.length;f++)this._flashFeature(b[f]);setTimeout(e.hitch(this,this._clearFeatures),1100)},_flashFeature:function(f){var h;if(f.geometry){var m=b.fromHex(this._styleColor),t=e.clone(m);t.a=.4;"undefined"!==typeof f.symbol&&(h=new l(l.STYLE_CIRCLE,f.symbol.size,
new p(p.STYLE_SOLID,m,1),t))}"undefined"!==typeof h&&(f=new r(f.geometry,h),this._map.graphics.add(f),h=f.getDojoShape())&&(k.animateStroke({shape:h,duration:700,color:{start:h.strokeStyle.color,end:h.strokeStyle.color},width:{start:18,end:0}}).play(),setTimeout(this._clearFeature,850,f))},_clearFeatures:function(){this._map.graphics.clear()},_clearFeature:function(b){b.getLayer().remove(b)},setColor:function(b){this.color=b},setStyleColor:function(b){this._styleColor=b},cancelPendingRequests:function(){console.log("Cancel Query...");
this.queryPending&&(this.cancelRequest=!0);this.removeEventListeners()},removeEventListeners:function(){this.extentChangeSignal&&(this.extentChangeSignal.remove(),this.extentChangeSignal=null);this.clickSignal&&(this.clickSignal.remove(),this.clickSignal=null)},isLayerClusterEnabled:function(b){var f=!1;A.some(this._parent.config.layerInfos,e.hitch(this,function(e){if(b===e.layer+this._parent.UNIQUE_APPEND_VAL_CL&&e.symbolData.clusteringEnabled)return f=!0}));return f},clusterFeatures:function(){var b=
!0;this.clear();null===this._map&&(this._map=this._parent.map);this._map.infoWindow.isShowing&&(A.some(this._map.infoWindow.features,e.hitch(this,function(a){if(a._layer&&this.isLayerClusterEnabled(a._layer.id))return b=!1,!0})),!b&&this._parent.isOpen?this._map.infoWindow.hide():this._parent.config.hasOwnProperty("displayClusterLayer")&&!0===this._parent.config.displayClusterLayer&&!b&&this._map.infoWindow.hide());var k=this._features,p=0;if("undefined"!==typeof k){if(0<k.length&&(this.visible||
this.requiresReload)){var m=this.clusterSize;this.clusterGraphics=[];for(var l=this._map.spatialReference,t=this._map.extent,v=new z(t.xmin,t.ymax,l),w=Math.ceil(this._map.height/m),u=Math.ceil(this._map.width/m),D=t.getWidth()/this._map.width*m,m=t.getHeight()/this._map.height*m,t=0;t<w;t++)for(var B=0;B<u;B++){var x=v.x+D*B,a=v.y-m*t,a=new y(x,a-m,x+D,a,l),x=[],c;for(c in k){var g=k[c];a.contains(g.geometry)&&(p+=1,x.push(g))}0<x.length&&(a=this.getClusterCenter(x),this.clusterGraphics.push({center:a,
graphics:x}))}for(var d in this.clusterGraphics){l=this.clusterGraphics[d];v=l.graphics.length;w=l.graphics;c=E.localizeNumber(v);D=u=19*c.length;u+=5;m=new h;m.family="Arial";m.size="16px";c=new F(c,m,this.countColor);c.setOffset(0,-4);var q;this.symbolData&&this.symbolData.symbol?this.symbolData.symbol.size?q=this.symbolData.symbol.size:this.symbolData.symbol.width&&(q=this.symbolData.symbol.width,m=this.symbolData.symbol.height,q=q>=m?q:m):this.icon.width?(u=this.icon.width>=u?this.icon.width+
5:u,u=this.icon.height>=u?this.icon.height+5:u,D=this.icon.width>=D?this.icon.width+1:D,D=this.icon.height>=D?this.icon.height+1:D):this.icon.size&&(q=this.icon.size);q&&(u=q>=u?q+5:u,D=q>=D?q+1:D);D>=u&&(u+=0===D-u?4:D-u+5);this._setSymbols(u+15,u);w={Count:v,Data:w};1<v?"undefined"!==typeof this.symbolData?"CustomSymbol"!==this.symbolData.symbolType?(this.add(new r(l.center,this.csym,w)),this.displayFeatureCount?this.add(new r(l.center,c,w)):this.add(new r(l.center,this.csym3,w))):(this.add(new r(l.center,
this.csym,w)),this.displayFeatureCount?this.add(new r(l.center,c,w)):this.add(new r(l.center,this.psym,w))):(this.add(new r(l.center,this.csym,w)),this.displayFeatureCount?this.add(new r(l.center,c,w)):this.add(new r(l.center,this.psym,w))):(l=l.graphics[0].geometry,this.renderer&&(l=(this.renderer.hasOwnProperty("getSymbol")||this.renderer.hasOwnProperty("symbol"))&&"LayerSymbol"===this.symbolData.symbolType?new r(l,null,w.Data[0].attributes,this.infoTemplate):"EsriSymbol"===this.symbolData.symbolType?
new r(l,N.fromJson(this.symbolData.symbol),w,this.infoTemplate):"LayerSymbol"!==this.symbolData.symbolType?new r(l,this.psym,w,this.infoTemplate):this.renderer.symbol?new r(l,null,w,this.infoTemplate):new r(l,this.psym,w,this.infoTemplate),"undefined"!==typeof l&&this.add(l)))}}this._updateNode(this.showAllFeatures?k.length:p)}},_updateNode:function(b){if(!this.hidePanel){var e;this.node?(this.node.innerHTML=E.localizeNumber(b?b:0),e=this.node.parentNode):this.legendNode&&(e=this.legendNode.previousSibling);
this.updateExpand(e,b&&0<b&&this.visible?!1:!0)}},_setSymbols:function(f,k){var h=this.color.toRgb(),m,t,u;if("undefined"!==typeof this.symbolData){var v;"custom"===this.backgroundClusterSymbol?v=h:(m=N.fromJson(this.backgroundClusterSymbol),0===m.outline.color.a||0===m.outline.width?(t=p.STYLE_NULL,u=0):(t=p.STYLE_SOLID,u=m.outline.width));m?(h=p(t,m.outline.color,u),v=m.color.toRgb(),this.csym=new l(l.STYLE_CIRCLE,f,h,new b([v[0],v[1],v[2],.75]))):this.csym=new l(l.STYLE_CIRCLE,f,null,new b([v[0],
v[1],v[2],.75]));(f=this.symbolData.s)&&-1<f.indexOf("${appPath}")?(f=window.location.pathname.replace("index.html",""),f=this.symbolData.s.replace("${appPath}",window.location.origin+f)):f=this.symbolData.s?this.symbolData.s:this.icon.imageData;if(f&&"CustomIcon"===this.symbolData.iconType){var w,r;this.symbolData.symbol&&this.symbolData.symbol.height&&(w=this.symbolData.symbol.height);this.symbolData.symbol&&this.symbolData.symbol.width&&(r=this.symbolData.symbol.width);w&&r?r=w=r>w?r:w:(w=this.symbolData.icon.height?
this.symbolData.icon.height:k,r=this.symbolData.icon.width?this.symbolData.icon.width:k);this.psym=new Z(f,w,r)}else f&&"LayerIcon"===this.symbolData.iconType?this.psym=N.fromJson(this.symbolData.symbol):"esriPMS"===this.icon.type?this.psym=this.icon:(k=p(this.icon.outline.style,this.icon.outline.color,this.icon.outline.width),this.psym=new l(this.icon.style,this.icon.size,k,this.icon.color));this.csym2=e.clone(this.psym);this.csym3=e.clone(this.csym2);"undefined"!==typeof this.csym2.xoffset&&(this.csym3.xoffset=
0);"undefined"!==typeof this.csym2.yoffset&&(this.csym3.yoffset=0)}else w=new p(p.STYLE_NULL,new b(0,0,0,0),0),this.csym=new l(l.STYLE_CIRCLE,f,w,new b([h[0],h[1],h[2],.5])),this.psym=new Z(this.icon.url,f-10,f-10),this.psym2=new Z(this.icon.url,k-7,k-7),w=new p(p.STYLE_NULL,new b(0,0,0,0),0),this.csym2=new l(l.STYLE_CIRCLE,k,w,new b([h[0],h[1],h[2],.5]))},_setupSymbols:function(){if("undefined"!==typeof this.symbolData){this.countColor=this.symbolData._highLightColor;this.backgroundClusterSymbol=
this.symbolData.clusterSymbol;this.icon=this.symbolData.icon;"LayerSymbol"===this.symbolData.symbolType?this._parentLayer.renderer?this.renderer=this._parentLayer.renderer.toJson?this._parentLayer.renderer:ba.fromJson(this._parentLayer.renderer):this._testRenderer?this.renderer=ba.fromJson(this._testRenderer):this.symbolData.renderer&&(this.renderer=this.symbolData.renderer.toJson?this.symbolData.renderer:ba.fromJson(this.symbolData.renderer)):this.renderer=new M(N.fromJson(this.symbolData.symbol));
var e=this.color.toRgb(),k=new p(p.STYLE_NULL,new b(0,0,0,0),0);this._singleSym=new l(l.STYLE_CIRCLE,9,k,new b([e[0],e[1],e[2],.5]))}},getLayer:function(){return this},getClusterCenter:function(b){var e=0,k=0,f=b.length;A.forEach(b,function(b){e+=b.geometry.x;k+=b.geometry.y},this);return new z(e/f,k/f,b[0].geometry.spatialReference)},destroy:function(){this._clear();this.removeEventListeners()},_clear:function(){this.clear();this._features=[]},_updateEnd:function(){this.url&&this.loadData(this.url)}})})},
"widgets/InfoSummary/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/InfoSummary/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"panelContent" data-dojo-attach-point\x3d"panelMain"\x3e\r\n    \x3cdiv class\x3d"page" data-dojo-attach-point\x3d"panelPage"\x3e\r\n      \x3cdiv class\x3d"pageContent rounded" data-dojo-attach-point\x3d"pageContent"\x3e\r\n        \x3cdiv class\x3d"pageHeader pageHeader-border roundedTop jimu-main-background dart-bgcolor box-bgcolor" data-dojo-attach-point\x3d"pageHeader"\x3e\r\n          \x3cdiv class\x3d"pageCounter"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"panelMainIcon" /\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"pageTitle" data-dojo-attach-point\x3d"pageTitle"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"lastUpdated" data-dojo-attach-point\x3d"lastUpdated"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"pageClose" data-dojo-attach-point\x3d"pageCloseMain" data-dojo-attach-event\x3d"onclick:_close"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"pageBody roundedBottom" data-dojo-attach-point\x3d"pageBody"\x3e\r\n        \x3cdiv class\x3d"resultsContent noselect" data-dojo-attach-point\x3d"pageMain"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/InfoSummary/css/style.css":".jimu-widget-InfoSummary {width: 100%; height: 100%;}.jimu-widget-InfoSummary .legendLayer{font-size: 12px;}.jimu-widget-InfoSummary .legendOff{overflow: hidden; display: none;}.jimu-widget-InfoSummary .legendOn{display: block; width: 100%; visibility: visible; height: auto; overflow: hidden;}.jimu-widget-InfoSummary .featureItem{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: left; min-height: 30px;}.jimu-rtl .jimu-widget-InfoSummary .featureItem{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: right; min-height: 30px;}.jimu-widget-InfoSummary .featureItem:hover {background-color: lightgray;}.jimu-widget-InfoSummary .layer-row-mouseover-dashboard {background-color: #3d3d3d !important;}.jimu-widget-InfoSummary .rec:hover .expandUp-dashboard {background-color: #3d3d3d; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .rec:hover .expandDown-dashboard {background-color: #3d3d3d; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandDown-dashboard {background-image: url(../images/_nav_down.png); background-color: #222; bottom: -5px; background-position-y: -1px; border-bottom: 1px solid #dcdcdc; -webkit-border-bottom-radius: 8px; -moz-border-bottom-radius: 8px; -o-border-bottom-radius: 8px; -ms-border-bottom-radius: 8px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .expandUp-dashboard {background-image: url(../images/_nav_up.png); bottom: -1px; background-color: #222; background-position-y: 2px; border-top: 1px solid #dcdcdc; border-left: 1px solid #dcdcdc; border-right: 1px solid #dcdcdc; -webkit-border-top-radius: 8px; -moz-border-top-radius: 8px; -o-border-top-radius: 8px; -ms-border-top-radius: 8px; border-top-left-radius: 8px; border-top-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .expand-dashboard {width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; left: 45%; background-color: #222; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-rtl .jimu-widget-InfoSummary .expand-dashboard {width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; right: 45%; background-color: #222; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageUp-dashboard {background-image: url(../images/_nav_up.png); background-color: #666666;}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageDown-dashboard {background-image: url(../images/_nav_down.png); background-color: #666666;}.jimu-widget-InfoSummary .groupItemImage-dashboard {width: 25px; height: 12px; cursor: pointer; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; cursor: pointer; vertical-align: middle; -webkit-border-radius: 10px; -moz-border-radius: 10px; -o-border-radius: 10px; -ms-border-radius: 10px; border-radius: 10px; border: 2px solid #6d6d6d;}.jimu-widget-InfoSummary .groupItemImageUp-dashboard {background-image: url(../images/_nav_up.png);}.jimu-widget-InfoSummary .groupItemImageDown-dashboard {background-image: url(../images/_nav_down.png);}.jimu-widget-InfoSummary .featureItem-dart {display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: left; min-height: 30px;}.jimu-rtl .jimu-widget-InfoSummary .featureItem-dart {display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: right; min-height: 30px;}.jimu-widget-InfoSummary .featureItem-dart:hover {background-color: rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItem-dart:focus, .jimu-widget-InfoSummary .rec-dart:focus,.jimu-widget-InfoSummary .featureItem-dart:focus {outline: 2px solid #24B5CC !important; outline-offset: -2px;}.jimu-widget-InfoSummary .groupItem-dart {display: block; width: 100%; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: left; overflow: hidden; text-align: -webkit-left; text-align: -moz-left; text-align: left;}.jimu-rtl .jimu-widget-InfoSummary .groupItem-dart {display: block; width: 100%; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: right; overflow: hidden; text-align: -webkit-right; text-align: -moz-right; text-align: right;}.jimu-widget-InfoSummary .groupItemTitle-dart:hover .groupItemImageUp-dart{background-image: url(../images/_nav_up.png); background-color: rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItemTitle-dart:hover .groupItemImageDown-dart{background-image: url(../images/_nav_down.png); background-color: rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItemTitle-dart{width: 100%; height: 30px; display: table;}.jimu-widget-InfoSummary .groupItemImage-dart{width: 25px; height: 12px; cursor: pointer; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; cursor: pointer; vertical-align: middle; -webkit-border-radius: 10px; -moz-border-radius: 10px; -o-border-radius: 10px; -ms-border-radius: 10px; border-radius: 10px; border: 2px solid rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItemImageUp-dart{background-image: url(../images/_nav_up.png);}.jimu-widget-InfoSummary .groupItemImageDown-dart {background-image: url(../images/_nav_down.png);}.jimu-widget-InfoSummary .expand-dart {width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; left: 45%; background-color: #4c4c4c; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-rtl .jimu-widget-InfoSummary .expand-dart {width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; right: 45%; background-color: #4c4c4c; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandUp-dart {background-image: url(../images/_nav_up.png); bottom: -1px; background-position-y: 2px; border-top: 1px solid rgba(0,0,0,.5); border-left: 1px solid rgba(0,0,0,.5); border-right: 1px solid rgba(0,0,0,.5); -webkit-border-top-radius: 8px; -moz-border-top-radius: 8px; -o-border-top-radius: 8px; -ms-border-top-radius: 8px; border-top-left-radius: 8px; border-top-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .expandDown-dart {background-image: url(../images/_nav_down.png); bottom: -5px; background-position-y: -1px; border-bottom: 1px solid rgba(0,0,0,.5); -webkit-border-bottom-radius: 8px; -moz-border-bottom-radius: 8px; -o-border-bottom-radius: 8px; -ms-border-bottom-radius: 8px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .groupField{text-align: left; display: table-cell; font-size: 14px; width: 100%; padding-left: 5px;}.jimu-rtl .jimu-widget-InfoSummary .groupField{text-align: right; display: table-cell; font-size: 14px; width: 100%; padding-right: 5px;}.jimu-widget-InfoSummary .groupFieldImage{text-align: left; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .groupFieldImage{text-align: right; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-right: 10px;}.jimu-widget-InfoSummary .groupItem{display: block; width: 100%; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: left; overflow: hidden; text-align: -webkit-left; text-align: -moz-left; text-align: left;}.jimu-rtl .jimu-widget-InfoSummary .groupItem{display: block; width: 100%; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: right; overflow: hidden; text-align: -webkit-right; text-align: -moz-right; text-align: right;}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageUp{background-image: url(../images/_nav_up.png); background-color: gray;}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageDown{background-image: url(../images/_nav_down.png); background-color: gray;}.jimu-widget-InfoSummary .groupItemTitle{width: 100%; height: 30px; display: table; line-height: 30px;}.jimu-widget-InfoSummary .groupItemTitle:focus, .jimu-widget-InfoSummary .featureItem:focus, .jimu-widget-InfoSummary .rec:focus {outline: 2px solid #24B5CC !important; outline-offset: -2px; border: 1px solid #24B5CC;}.jimu-widget-InfoSummary .groupItemImage{width: 25px; height: 12px; cursor: pointer; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; cursor: pointer; vertical-align: middle; -webkit-border-radius: 10px; -moz-border-radius: 10px; -o-border-radius: 10px; -ms-border-radius: 10px; border-radius: 10px; border: 2px solid #dcdcdc;}.jimu-widget-InfoSummary .groupItemImageUp{background-image: url(../images/default_nav_up.png); background-color: white;}.jimu-widget-InfoSummary .groupItemImageDown{background-image: url(../images/default_nav_down.png); background-color: white;}.jimu-widget-InfoSummary .groupOff{display: none !important;}.jimu-widget-InfoSummary .groupOn{height: auto; display: block;}.jimu-widget-InfoSummary .clusterSymbol{margin: 4px 4px 4px 4px; display: block; width: 35px; visibility: visible; height: 35px; float: left; -moz-border-radius: 30px; -webkit-border-radius: 30px; border-radius: 30px; opacity:0.60; filter: alpha(opacity\x3d30); z-index: 3;}.jimu-widget-InfoSummary .panelMain {display: block;}.jimu-widget-InfoSummary .panelContent {position: absolute; right: 0px; top: 0px; width: 100%; height: 100%;}.jimu-widget-InfoSummary .page {position: relative; width: 100%; margin-left: 0px; height: 100%; display: block;}.jimu-widget-InfoSummary .pageContent {position:absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; overflow: hidden; display: block;}.jimu-widget-InfoSummary .pageHeader-border {border-bottom: 1px solid lightgray;}.jimu-widget-InfoSummary .pageHeader-border-dart {border-bottom: 1px solid black;}.jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 160px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 180px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageHeaderRefreshNoText {position: relative; width: 100%; height: 160px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 8px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .pageTitleRefresh {position: absolute; left: 0px; bottom: 25px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .pageTitleRefresh-tab {position: absolute; left: 0px; bottom: 25px; height: auto; font-size: 16px; text-align: center; width: 100%;}.jimu-widget-InfoSummary .lastUpdated {position: absolute; left: 0px; bottom: 5px; height: auto; font-size: 12px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .lastUpdated-tab {position: absolute; left: 0px; bottom: 5px; height: auto; font-size: 12px; text-align: center; width: 100%;}.jimu-widget-InfoSummary .pageTitleWidth {width: 100%;}.jimu-widget-InfoSummary .pageCounter {position: absolute; top: 10px; width: auto; height: auto; left: 15px; right:15px;}.jimu-widget-InfoSummary .pageBody {position: absolute; top: 160px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 180px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .pageBodyRefreshNoText {position: absolute; top: 160px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .resultsContent {width: 100%; min-height: 100%; overflow-x: hidden; overflow-y: hidden;}.jimu-widget-InfoSummary .recDefault {cursor: default;}.jimu-widget-InfoSummary .recIcon {position: absolute; left: 10px; top: 10px; width: 50px; height: 50px; border: 3px solid rgba(0,0,0,1); -moz-border-radius: 41px; -webkit-border-radius: 41px; border-radius: 41px; opacity: 0.5; filter: alpha(opacity\x3d50); cursor: pointer;}.jimu-rtl .jimu-widget-InfoSummary .recIcon {position: absolute; right: 10px; top: 10px; width: 50px; height: 50px; border: 3px solid rgba(0,0,0,1); -moz-border-radius: 41px; -webkit-border-radius: 41px; border-radius: 41px; opacity: 0.5; filter: alpha(opacity\x3d50); cursor: pointer;}.jimu-widget-InfoSummary .thumb2{width: 43px; height: 43px; align-content: center; vertical-align: super; z-index: 1;}.jimu-widget-InfoSummary .sub-active {opacity: 0.8; filter: alpha(opacity\x3d80);}.jimu-widget-InfoSummary .active {background-color: rgba(0,0,0,0.25);}.jimu-rtl .jimu-widget-InfoSummary .active {background-color: rgba(0,0,0,0.25);}.jimu-widget-InfoSummary .groupCountLabel {line-height: 30px; font-size: 16px; font-weight: 300; display: table-cell; width: auto; height: 100%; padding-right: 10px; vertical-align: middle;}.jimu-rtl .jimu-widget-InfoSummary .groupCountLabel {line-height: 30px; font-size: 16px; font-weight: 300; display: table-cell; width: auto; height: 100%; padding-left: 10px; vertical-align: middle;}.jimu-widget-InfoSummary .inActive {opacity: 0.6; filter: alpha(opacity\x3d60);}.jimu-widget-InfoSummary .recLabel {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-left: 65px; text-overflow: ellipsis; width: 100%; padding-right: 10px; max-width: 100px; overflow: hidden; word-wrap: break-word;}.jimu-rtl .jimu-widget-InfoSummary .recLabel {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-right: 65px; text-overflow: ellipsis; width: 100%; padding-left: 10px; max-width: 200px; overflow: hidden; word-wrap: break-word;}.jimu-widget-InfoSummary .recLabelNoCount {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-left: 65px; margin-right: 10px; text-overflow: ellipsis; overflow: hidden; width: auto;}.jimu-rtl .jimu-widget-InfoSummary .recLabelNoCount {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-right: 65px; margin-left: 10px; text-overflow: ellipsis; overflow: hidden; width: auto;}.jimu-widget-InfoSummary .recNumInActive {height: 100%; text-align: center; font-size: 28px; margin-right: 10px; float: right; display: none; width: 0px; padding-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .recNumInActive {height: 100%; text-align: center; font-size: 28px; margin-right: 10px; float: left; display: none; width: 0px; padding-left: 10px;}.jimu-widget-InfoSummary .recNum {height: 100%; text-align: center; font-size: 28px; margin-right: 10px; float: right; display: table-cell; width: auto; padding-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .recNum {height: 100%; text-align: center; font-size: 28px; margin-left: 10px; float: left; display: table-cell; width: auto; padding-right: 10px;}.jimu-widget-InfoSummary .innerMainPanelIcon {background-size: contain; width: 100%; max-width: 310px; height: 120px; background-repeat: no-repeat; background-position: 50% 50%; display: inline-block;}.jimu-widget-InfoSummary .innerSVGPosition {width: 100%; height: 100%; vertical-align: middle;}.jimu-widget-InfoSummary .innerCirclePosition {position: relative; top: 8px; left: 8px;}.jimu-widget-InfoSummary .pageBodyNoIcon {position: absolute; top: 0px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .pageHeaderNoIcon {position: relative; width: 100%; height: 0px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageBodyNoIconRefresh {position: absolute; top: 25px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .pageHeaderNoIconRefresh {position: relative; width: 100%; height: 25px; text-align: center; display: block;}.jimu-widget-InfoSummary .solidBorder {border: 1px solid #dcdcdc;}.jimu-widget-InfoSummary .solidBorder-dart {border-bottom: 1px solid rgba(0,0,0,.5);}.jimu-widget-InfoSummary .imageDataGFX {display: block; float: left; width: 30px; height: 30px; margin-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .imageDataGFX {display: block; float: right; width: 30px; height: 30px; margin-right: 10px;}.jimu-widget-InfoSummary .rec {position: relative; width: 100%; height: 70px; display: table; line-height: 70px; cursor: pointer;}.jimu-widget-InfoSummary .rec:hover .expandUp {background-image: url(../images/nav_up.png); background-color: #f2f2f2; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .rec:hover .expandDown {background-image: url(../images/nav_down.png); background-color: #f2f2f2; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .searching{height: 10px; width: 40px; background-image: url(../images/loading.gif); background-repeat: no-repeat; background-size: contain; position: absolute; top: 32px; bottom: 0px; right: 0px;}.jimu-rtl .jimu-widget-InfoSummary .searching{height: 10px; width: 40px; background-image: url(../images/loading.gif); background-repeat: no-repeat; background-size: contain; position: absolute; top: 32px; bottom: 0px; left: 0px;}.jimu-widget-InfoSummary .expandSearching{background-image: url(../images/loading.gif); position: absolute; background-repeat: no-repeat; background-size: contain; bottom: 0px; right: 0px; display: block;}.jimu-rtl .jimu-widget-InfoSummary .expandSearching{background-image: url(../images/loading.gif); position: absolute; background-repeat: no-repeat; background-size: contain; bottom: 0px; left: 0px; display: block;}.jimu-widget-InfoSummary .expand{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; left: 45%; background-color: white; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-rtl .jimu-widget-InfoSummary .expand{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; right: 45%; background-color: white; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandInActive{opacity: 0; display:none; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandImageContainer{width: 25px; height: 12px; margin-right: 5px; display: table-cell; vertical-align: middle; text-align: center; padding-right: 5px;}.jimu-rtl .jimu-widget-InfoSummary .expandImageContainer{width: 25px; height: 12px; margin-left: 5px; display: table-cell; vertical-align: middle; text-align: center; padding-left: 5px;}.jimu-widget-InfoSummary .expandUp{background-image: url(../images/default_nav_up.png); bottom: -1px; background-position-y: 2px; border-top: 1px solid #dcdcdc; border-left: 1px solid #dcdcdc; border-right: 1px solid #dcdcdc; -webkit-border-top-radius:8px; -moz-border-top-radius:8px; -o-border-top-radius:8px; -ms-border-top-radius:8px; border-top-left-radius: 8px; border-top-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .expandDown{background-image: url(../images/default_nav_down.png); bottom: -5px; background-position-y: -1px; border-bottom: 1px solid #dcdcdc; -webkit-border-bottom-radius:8px; -moz-border-bottom-radius:8px; -o-border-bottom-radius:8px; -ms-border-bottom-radius:8px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; z-index: 1;}.noselect {-webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}.jimu-widget-InfoSummary .rec-dart {position: relative; width: 100%; height: 70px; display: table; line-height: 70px; color: #6e6e6e; cursor: pointer;}.jimu-widget-InfoSummary .rec-dart:hover .expandUp-dart {background-color: black; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .rec-dart:hover .expandDown-dart {background-color: black; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .layer-row-mouseover {background-color: #f2f2f2;}.jimu-widget-InfoSummary .layer-row-mouseover-dart {background-color: rgba(0,0,0,.5);}@media only screen and (max-width: 750px) {.jimu-widget-InfoSummary .pageContent{} .jimu-widget-InfoSummary .pageHeader{position: relative; width: 100%; height: 0px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 45px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageHeaderRefreshNoText {position: relative; width: 100%; height: 25px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 20px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;} .jimu-widget-InfoSummary .pageTitleWidth {width: 100%;} .jimu-widget-InfoSummary .pageCounter {display: none; position: absolute; left: 5px; margin-left: 0px; top: 0px; width: 70px; font-size: 40px; height: 70px; line-height: 70px; border: 5px solid rgba(0,0,0,1); -moz-border-radius: 40px; -webkit-border-radius: 40px; border-radius: 40px;} .jimu-widget-InfoSummary .pageBody {position: absolute; top: 0px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;} .jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 45px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;} .jimu-widget-InfoSummary .pageBodyRefreshNoText {position: absolute; top: 25px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}}",
"*now":function(Y){Y(['dojo/i18n!*preload*widgets/InfoSummary/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("jimu/BaseWidget jimu/LayerInfos/LayerInfos jimu/utils dojo/dom dojo/dom-class dojo/dom-construct dojo/on dojo/dom-style dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/Color dojo/promise/all dojo/_base/array dojo/DeferredList dojo/Deferred dojo/query dojox/gfx/fx dojox/gfx dojo/_base/xhr dojo/keys dojo/dom-attr dijit/focus dijit/_WidgetsInTemplateMixin esri/graphic esri/geometry/Point esri/symbols/SimpleMarkerSymbol esri/symbols/PictureMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/Color esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/arcgis/utils esri/symbols/jsonUtils esri/request esri/renderers/SimpleRenderer esri/renderers/jsonUtils ./js/ClusterLayer esri/layers/LayerDrawingOptions".split(" "),function(Y,
A,v,e,b,t,u,L,I,k,m,x,E,B,r,y,z,Z,l,p,F,h,M,V,T,ca,N,ba,X,f,H,fa,da,ia,la,ea,w,ja,D,ka,ga){return I([Y,V],{baseClass:"jimu-widget-InfoSummary",name:"InfoSummary",opLayerInfos:null,layerList:{},UNIQUE_APPEND_VAL_CL:"_CL",widgetChange:!1,refreshInterval:0,refreshIntervalValue:0,configLayerInfos:[],legendNodes:[],currentQueryList:[],symbols:[],row:null,clusterLayerArray:[],initialOpen:!0,isOpen:!1,postCreate:function(){this.inherited(arguments);this.inPanelOverrides(this.appConfig.theme.name);this.configLayerInfos=
this.config.layerInfos;this.layerList={};this._initWidget()},_forceClose:function(){var a=this.appConfig.theme.name,c=this.getPanel();if(-1<"LaunchpadTheme DartTheme FoldableTheme JewelryBoxTheme BillboardTheme TabTheme DashboardTheme PocketTheme".split(" ").indexOf(a))c.containerNode.parentNode.style.display="none",c.containerNode.style.display="none",this.widgetManager.closeWidget(this.id);else if("BoxTheme"===a){if(c.containerNode.parentNode.style.display="none",c.containerNode.style.display="none",
c.getParent&&c.getParent()._toggleBox)for(var a=z(".icon-node-active"),g=0;g<a.length;g++)-1<a[g].outerHTML.indexOf(this.id)&&c.getParent()._toggleBox()}else if("PlateauTheme"===a)if(c.containerNode.parentNode.style.display="none",c.containerNode.style.display="none",this.widgetManager.closeWidget(this.id),this.aw)this.aw._switchNodeToClose(this.id),this.aw._closeDropMenu();else for(c=this.widgetManager.appConfig.widgetOnScreen.widgets,a=0;a<this.widgetManager.appConfig.widgetOnScreen.widgets.length;a++)if(c[a].isThemeWidget){this.aw=
this.widgetManager.getWidgetById(c[a].id);this.aw._switchNodeToClose(this.id);this.aw._closeDropMenu();break}},inPanelOverrides:function(a){"undefined"!==typeof this.iconClickHandler&&(this.iconClickHandler.remove(),this.iconClickHandler=void 0);var c=this.getPanel();if(this.config.hidePanel)if(c=["DartTheme","BoxTheme","FoldableTheme","JewelryBoxTheme","PlateauTheme"],"LaunchpadTheme"===a||"PocketTheme"===a)this._forceClose(),a=z(".selected"),0<a.length&&-1<a[0].parentNode.outerHTML.indexOf(this.id)&&
(this.iconClickHandler=u(a[0],"click",k.hitch(this,this._forceClose)));else{if(-1<c.indexOf(a))for("BoxTheme"===a&&this._forceClose(),a=z(".icon-node"),c=0;c<a.length;c++)-1<a[c].outerHTML.indexOf(this.id)&&(this.iconClickHandler=u(a[c],"click",k.hitch(this,this._forceClose)))}else switch(c.containerNode&&c.containerNode.firstChild&&c.containerNode.firstChild.className&&(c.containerNode.firstChild.style.padding="0px 0px 10px 0px"),-1===["TabTheme","BillboardTheme","PlateauTheme","DashboardTheme"].indexOf(a)&&
this._updateBackgroundColors(!0),this.isDartTheme="DartTheme"===a,this.isDashboardTheme="DashboardTheme"===a,b.contains(this.pageHeader,this.isDartTheme?"pageHeader-border":"pageHeader-border-dart")&&b.remove(this.pageHeader,this.isDartTheme?"pageHeader-border":"pageHeader-border-dart"),b.add(this.pageHeader,this.isDartTheme?"pageHeader-border-dart":"pageHeader-border"),a){case "DartTheme":this.updateForDartTheme(c);break;case "BoxTheme":this.updateForBoxTheme(c);break;case "TabTheme":this.updateForTabTheme(c);
break;case "LaunchpadTheme":this.updateForLaunchpadTheme(c);break;case "BillboardTheme":this.updateForBillboardTheme(c);break;case "PlateauTheme":this.updateForPlateauTheme(c);break;case "DashboardTheme":this.updateForDashboardTheme(c)}},updateForLaunchpadTheme:function(a){a.containerNode.style.top="30px"},updateForTabTheme:function(a){if(0<a.containerNode.children.length){var c=a.containerNode.children[0];1<c.children.length&&(c.children[1].style.padding="14px 0px 14px 0px")}a.config.isOnScreen||
this._updateBackgroundColors(!1)},updateForBoxTheme:function(a){a.containerNode.parentNode.style.top="140px"},updateForDartTheme:function(a){a.containerNode.style.right="0px";a.containerNode.style.left="0px"},updateForBillboardTheme:function(){this._updateBackgroundColors(!1)},updateForPlateauTheme:function(){this._updateBackgroundColors(!1)},updateForDashboardTheme:function(){this._updateBackgroundColors(!1)},_updateBackgroundColors:function(a){b.contains(this.lastUpdated,a?"lastUpdated-tab":"lastUpdated")&&
b.remove(this.lastUpdated,a?"lastUpdated-tab":"lastUpdated");b.add(this.lastUpdated,a?"lastUpdated":"lastUpdated-tab");a=a&&"DashboardTheme"!==this.appConfig.theme.name;this.useDarkText=!a;b.contains(this.pageHeader,"jimu-main-background")&&!a?b.remove(this.pageHeader,"jimu-main-background"):!b.contains(this.pageHeader,"jimu-main-background")&&a&&b.add(this.pageHeader,"jimu-main-background");b.contains(this.pageHeader,"dart-bgcolor")&&!a?b.remove(this.pageHeader,"dart-bgcolor"):!b.contains(this.pageHeader,
"dart-bgcolor")&&a&&b.add(this.pageHeader,"dart-bgcolor");b.contains(this.pageHeader,"box-bgcolor")&&!a?b.remove(this.pageHeader,"box-bgcolor"):!b.contains(this.pageHeader,"box-bgcolor")&&a&&b.add(this.pageHeader,"box-bgcolor")},startup:function(){this.inherited(arguments)},onOpen:function(){this.widgetChange=!1;this.isOpen=!0;this.hidePanel?"BoxTheme"!==this.appConfig.theme.name&&this._forceClose():this._updatePanelHeader();this.appConfig.theme.styles&&this.appConfig.theme.styles[0]&&this._updateStyleColor(this.appConfig.theme.styles[0]);
this.hidePanel||this._setVisibleSubLayers();this.hidePanel||this.showAllFeatures||"undefined"!==typeof this.mapExtentChangedHandler||(this.mapExtentChangedHandler=this.map.on("extent-change",k.hitch(this,this._mapExtentChange)));this.config.refreshEnabled&&this.enableRefresh();this.map.infoWindow&&(this.map.infoWindow.highlight=!0);this.config.hasOwnProperty("displayClusterLayer")&&!1===this.config.displayClusterLayer&&this.clusterLayerArray.length&&this.clusterLayerArray.forEach(k.hitch(this,function(a){a.clusterLayer.show()}));
this.config.expandList||(this.initialOpen=!1)},_updateRenderer:function(a,c){if(a&&a.orgRenderer){if(c.setLayerDrawingOptions&&!isNaN(a.subLayerId)){var g=[],d=new ga;d.renderer=a.newRenderer;g[a.subLayerId]=d;c.setLayerDrawingOptions(g)}else c.setRenderer?c.setRenderer(a.newRenderer):console.log("Error setting the new renderer...will use the default rendering of the layer");"function"===typeof c.refresh&&c.refresh()}},_getParentLayer:function(a,c){var g;c&&c.layerInfos?g=c:a&&"undefined"!==typeof a.parentLayerID&&
(g=this.map.getLayer(a.parentLayerID));return g},_setVisibleSubLayers:function(){var a=[],c;for(c in this.layerList){var g=this.layerList[c],d=g.li,b=g.layerObject;this._updateRenderer(d,b);var n=this._getParentLayer(d,b);if(n&&n.visibleLayers){var b=!1,e=0;a:for(;e<a.length;e++)if(a[e].id===n.id){b=!0;break a}0!==a.length&&b||a.push({id:n.id,layers:n.visibleLayers});b=0;b;a:for(;b<a.length;b++)if(a[b].id===n.id)break a;e=a[b].layers;if(n.layerInfos){if(0<n.layerInfos.length&&d&&"undefined"!==typeof d.subLayerId){var n=
-1<e.indexOf(d.subLayerId),k=g.parentLayerVisible,f=g.layerObject.parentLayerVisible;"ClusterLayer"===g.type&&(n||k||f)?(g.parentLayerVisible=!0,g.layerObject.parentLayerVisible=!0,g.visible=!0,n&&e.splice(e.indexOf(d.subLayerId),1)):n||k?(g.parentLayerVisible=!0,g.visible=!0,-1===e.indexOf(d.subLayerId)&&e.push(d.subLayerId)):(g.parentLayerVisible=!1,g.visible=!1,n&&e.splice(e.indexOf(d.subLayerId),1),"ClusterLayer"===g.type&&(g.layerObject.parentLayerVisible=!1,-1<this.map.graphicsLayerIds.indexOf(g.id)&&
(d=this.map.getLayer(g.id),d.setVisibility(!1))))}a[b].layers=e}this.updatePanelVisibility(g,c,g)}else b&&("ClusterLayer"===g.type&&b._parentLayer&&(-1<this.map.graphicsLayerIds.indexOf(g.id)&&(d=this.map.getLayer(g.id),"undefined"===typeof g.layerObject.parentLayerVisible&&(g.parentLayerVisible=b._parentLayer.visible,g.layerObject.parentLayerVisible=b._parentLayer.visible),d.setVisibility(g.layerObject.parentLayerVisible)),b._parentLayer.setVisibility&&b._parentLayer.setVisibility(!1)),this.updatePanelVisibility(b,
c,g));this.showAllFeatures&&this.config.expandList&&g.legendOpen&&!g.isLoaded&&(d=g.visScaleRange,"undefined"!==typeof d&&(d=this._inVisibleRange(c)),g.visible&&d&&(g.updateList=!0))}for(c=0;c<a.length;c++)(g=this.map.getLayer(a[c].id))&&g.setVisibleLayers(a[c].layers);this.initialOpen&&(this.openAtStartAysn=!0);this._support508Accessibility(!v.isAutoFocusFirstNodeWidget(this))},updatePanelVisibility:function(a,c,g){if(!this.hidePanel&&"undefined"!==typeof a.visible){var d=g.visScaleRange,q=e.byId("recLabel_"+
c),n,k=e.byId("rec_"+c),f=e.byId("recIcon_"+c),ha=e.byId("exp_"+c),h=e.byId("recNum_"+c);k&&(n=b.contains("rec_"+c,"inActive"));a.visible?(f&&!b.contains("recIcon_"+c,"active")&&(b.add("recIcon_"+c,"active"),n||b.add("recIcon_"+c,"sub-active")),this.config.countEnabled&&h&&b.contains("recNum_"+c,"recNumInActive")&&(b.remove("recNum_"+c,"recNumInActive"),b.add("recNum_"+c,"recNum")),q&&q.firstChild&&!n&&b.remove(q.firstChild,"inActive"),g.listDisabled||("undefined"===typeof d||d)&&ha&&b.contains("exp_"+
c,"expandInActive")&&b.remove("exp_"+c,"expandInActive"),k&&b.contains("rec_"+c,"recDefault")&&b.remove("rec_"+c,"recDefault")):(f&&b.contains("recIcon_"+c,"active")&&(b.remove("recIcon_"+c,"active"),n||b.remove("recIcon_"+c,"sub-active")),this.config.countEnabled&&h&&b.contains("recNum_"+c,"recNum")&&(b.remove("recNum_"+c,"recNum"),b.add("recNum_"+c,"recNumInActive")),q&&q.firstChild&&!n&&b.add(q.firstChild,"inActive"),g.listDisabled||(ha&&!b.contains("exp_"+c,"expandInActive")&&b.add("exp_"+c,"expandInActive"),
g.toggleLegend.remove()),k&&b.contains("rec_"+c,"rec")&&b.add("rec_"+c,"recDefault"))}this.initialOpen&&(this.openAtStartAysn=!0);this._support508Accessibility(!v.isAutoFocusFirstNodeWidget(this))},enableRefresh:function(){var a=null,c=[],g;for(g in this.layerList){var b,a=this.layerList[g];a.li&&(b=a.li.itemId);if("ClusterLayer"!==a.type)a=a.layerObject;else for(var q=0;q<this.layerInfos.length;q++){var n=this.layerInfos[q];if(n.layerObject){a=n.layerObject;break}}b&&-1===c.indexOf(b)&&c.push(b);
a&&(a.refreshInterval=this.config.refreshInterval)}0<c.length&&this.refreshLayers();a=6E4*this.config.refreshInterval;0===this.refreshInterval&&0===this.refreshIntervalValue?(this.refreshIntervalValue=a,this.refreshInterval=setInterval(k.hitch(this,this.refreshLayers),this.refreshIntervalValue)):0!==this.refreshIntervalValue&&this.refreshIntervalValue!==a&&(this.refreshIntervalValue=a,clearInterval(this.refreshInterval),this.refreshInterval=0,this.refreshInterval=setInterval(k.hitch(this,this.refreshLayers),
this.refreshIntervalValue))},getItem:function(a){var c=new y,b=("/"!==window.portalUrl.substr(-1)?window.portalUrl+="/":window.portalUrl)+"sharing/rest/content/items/"+a;w({url:b,content:{f:"json",requestTime:Date.now()}}).then(k.hitch(this,function(a){c.resolve({response:a,url:b})}));return c},_updatePanelTime:function(a){this.hidePanel||(this.lastUpdated.innerHTML="\x3cdiv\x3e\x3c/div\x3e",this.lastUpdated.innerHTML=v.fieldFormatter.getFormattedDate(new Date(a),{dateFormat:"shortDateShortTime"}))},
refreshLayers:function(){var a=[],c;for(c in this.layerList){var b=this.layerList[c],d;b.li&&b.li.itemId?d=b.li.itemId:b.layerObject.itemId&&(d=b.layerObject.itemId);d&&-1===this.currentQueryList.indexOf(d)&&(this.currentQueryList.push(d),a.push(this.getItem(d)))}if(0<a.length){var q=[];(new r(a)).then(k.hitch(this,function(a){this.currentQueryList=[];if(a){for(var c=0;c<a.length;c++){var b=a[c][1],g=b.response;g&&this._shouldUpdate(g)&&q.push({response:g,id:g.id,url:b.url})}0<q.length&&this._updateItems(q)}}))}},
_updateItems:function(a){var c=[],b=[];a.forEach(k.hitch(this,function(a){b.push(a.id);c.push(this._getItemData(a.response,a.url))}));(new r(c)).then(k.hitch(this,function(a){for(var c=0;c<a.length;c++)this._updateItem(a[c][1])}))},_shouldUpdate:function(a){a=a.modified;var c=!0;this.lastModifiedTime&&(c=this.lastModifiedTime<a);return c},_getItemData:function(a,c){if(a){a=a.modified;var b=[null,void 0];this.lastModifiedTime=this.lastModifiedTime<a||-1!==b.indexOf(this.lastModifiedTime)?a:this.lastModifiedTime;
this._updatePanelTime(a);return w({url:c+"/data",content:{f:"json",requestTime:Date.now()}})}},_updateItem:function(a){for(var c=0;c<a.layers.length;c++)this._updateLayerItem(a.layers[c],this.lastModifiedTime)},_updateLayerItem:function(a){var c,b,d,q,n;for(n in this.layerList){var e=this.layerList[n];if(e.pl&&e.pl.layerDefinition){if(e.pl.layerDefinition.name===a.layerDefinition.name){c=e;b=e.pl;break}}else if(e.layerObject._parentLayer){if(e.layerObject._parentLayer.name===a.layerDefinition.name||
e.layerDefinition&&e.layerDefinition.name===a.layerDefinition.name)d="undefined"!==typeof e.listDisabled?e.listDisabled:!1,q=e.li.symbolData.featureDisplayOptions.fields&&0<e.li.symbolData.featureDisplayOptions.fields.length,!d&&q&&(e.isLoaded=!1),e.layerObject.refreshFeatures(a),e.layerObject&&this._loadList(e,!0)}else if(e.layerDefinition&&e.pl){if(e.layerDefinition.name===a.layerDefinition.name){c=e;b=e.pl;break}}else if(e.pl&&e.pl.name&&e.pl.name===a.layerDefinition.name){c=e;b=e.pl;break}}if(a&&
c&&b&&(b.featureSet||b.graphics)){n=a.featureSet.features;var f;if(b.featureSet)f=b.featureSet.features;else{f=[];var h=this._getSpatialReference(n),m=this._getSpatialReference(b.graphics);B.forEach(b.graphics,function(a){var c=a.geometry,c=c.rings?{rings:c.rings}:c.paths?{paths:c.paths}:c.points?{points:c.points}:c.x&&c.y?{x:c.x,y:c.y}:{};c!=={}&&f.push({attributes:a.attributes,geometry:k.mixin({spatialReference:h&&m&&h.wkid===m.wkid?h:m},c)})})}a.featureSet.transform&&(n=(new ia(a.featureSet)).features);
a=!0;1E4>n.length&&(a=JSON.stringify(f)!==JSON.stringify(n));if(a){d="undefined"!==typeof c.listDisabled?c.listDisabled:!1;q=c.li.symbolData.featureDisplayOptions.fields&&0<c.li.symbolData.featureDisplayOptions.fields.length;!d&&q&&(c.isLoaded=!1,c.requiresReload=!0);d&&(c.li.layerListExtentChanged=!0);c.layerObject.clear();a=c.layerObject.spatialReference;for(d=0;d<n.length;d++)q=n[d],q.geometry?(e=this.getGraphicOptions(q,a),e=new T(e),e.setAttributes(q.attributes),this._infoTemplate&&e.setInfoTemplate(this._infoTemplate),
c.layerObject.add(e)):console.log("Null geometry skipped");c.layerObject.refresh();b.featureSet&&(b.featureSet.features=n);this.countFeatures(c).then(k.hitch(this,function(a){a.layerObject&&a.layerObject.visible&&this._loadList(a,!0)}))}}},_getSpatialReference:function(a){var c;a&&a.hasOwnProperty("length")&&0<a.length&&(a=a[0],a.geometry&&a.geometry.spatialReference&&(c=a.geometry.spatialReference));return c},getGraphicOptions:function(a,c){return"undefined"!==typeof a.geometry.rings?{geometry:{rings:a.geometry.rings,
spatialReference:{wkid:c.wkid}}}:"undefined"!==typeof a.geometry.paths?{geometry:{paths:a.geometry.paths,spatialReference:{wkid:c.wkid}}}:"undefined"!==typeof a.geometry.points?{geometry:{points:a.geometry.points,spatialReference:{wkid:c.wkid}}}:{geometry:new ca(a.geometry.x,a.geometry.y,a.geometry.spatialReference)}},_initWidget:function(){this.hidePanel="undefined"!==typeof this.config.hidePanel?this.config.hidePanel:!1;this.showAllFeatures="undefined"!==typeof this.config.showAllFeatures?this.config.showAllFeatures:
!1;this.map.itemId&&A.getInstance(this.map,this.map.itemInfo).then(k.hitch(this,function(a){this.wmLayerInfos=a.getLayerInfoArrayOfWebmap();this.layerInfos=a.getLayerInfoArray();this.operLayerInfos=a;this._updateLayerIDs();this.config.upgradeFields&&this._upgradeFields();this._createPanelUI(this.configLayerInfos,a).then(k.hitch(this,function(){this._addFilterChanged(a);this._addVisibleChanged(a);this._addZoomChanged(a);this._setVisibleSubLayers()}))}))},_updateLayerIDs:function(){var a=[],c=0;for(;c<
this.configLayerInfos.length;c++){var b=this.configLayerInfos[c],d=this.operLayerInfos.getLayerInfoById(b.id);if(d)b.url=d.layerObject&&d.layerObject.url?d.layerObject.url:b.url;else{var q=!1,n=0;b:for(;n<this.wmLayerInfos.length;n++){var e=this.wmLayerInfos[n],f=e?e.originOperLayer:void 0,h=this._compareURL(f,b),f=this._compareItemID(f,b),e=this._compareSubId(e,b);if(d=(h=h?h:f?f:e?e:void 0)?this.operLayerInfos.getLayerInfoById(h):d){this.configLayerInfos[c].id=d.id;this.configLayerInfos[c].layer=
d.id;this.configLayerInfos[c].url=d.layerObject&&d.layerObject.url?d.layerObject.url:this.configLayerInfos[c].url;q=!0;break b}}q||d||a.push(c)}}0<a.length&&(a.sort(function(a,c){return c-a}),B.forEach(a,k.hitch(this,function(a){this.configLayerInfos.splice(a,1)})))},_compareSubId:function(a,c){if(a&&a.subId&&-1<a.subId.indexOf(c.id)&&a.layerObject){var b=this._compareGeom(a.layerObject,c);c=this._compareFields(a.layerObject,c);if(b&&c)return a.subId}},_compareItemID:function(a,c){if(a&&a.itemId&&
a.itemId===c.itemId)if(a.featureCollection&&a.featureCollection.layers&&a.featureCollection.layers.hasOwnProperty("length")){a=a.featureCollection.layers;for(var b=0;b<a.length;b++){var d=a[b];if(this._compareGeom(d,c)&&this._compareFields(d,c))return d.id}}else console.log("error in checking item by itemID")},_compareURL:function(a,c){return a&&a.url&&c.url&&a.url===c.url?a.id:void 0},_compareGeom:function(a,c){return a&&a.geometryType&&c.geometryType?a.geometryType===c.geometryType:void 0},_compareFields:function(a,
c){var b;a&&a.fields&&c.fields&&a.fields.length===c.fields.length&&(b=a.fields.filter(function(a){for(var b=0;b<c.fields.length;b++)if(a.name===c.fields[b].name)return a}).length===a.fields.length);return b},_upgradeFields:function(){if(this.configLayerInfos)for(var a=0;a<this.configLayerInfos.length;a++){var c=this.configLayerInfos[a];if(c&&c.symbolData&&c.symbolData.featureDisplayOptions){var b=this.operLayerInfos.getLayerInfoById(c.id);if(b){var d=c.symbolData.featureDisplayOptions.fields;if("undefined"===
typeof d||d.hasOwnProperty("length")&&0===d.length){var e=b&&b.layerObject?b.layerObject:void 0,d=e&&e.objectIdField?e.objectIdField:void 0,n="",f="";if((e=c.fields?c.fields:e?e.fields:void 0)&&0<e.length){var k=0;a:for(;k<e.length;k++){var h=e[k];""===n&&"esriFieldTypeOID"!==h.type&&"esriFieldTypeGeometry"!==h.type&&h.name!==d&&(n=h.name,f=h.alias||h.name);d||(d="esriFieldTypeOID"===h.type?h.name:d);if(d&&""!==n)break a}}k=e="";c=c.infoTemplate&&c.infoTemplate.info&&c.infoTemplate.info.fieldInfos?
c.infoTemplate:b?b.getInfoTemplate():void 0;if(!c)a:for(b=b.getSubLayers(),h=0;h<b.length;h++){var m=b[h];if(m.title&&m.layerObject&&m.layerObject.name&&m.title===m.layerObject.name){c=m.getInfoTemplate?m.getInfoTemplate():c;break a}}b=c?c.info.fieldInfos:[];c=0;a:for(;c<b.length;c++)if((h=b[c])&&h.visible&&(!d||d!==h.fieldName)){e=h.fieldName;k=h.label||h.fieldName;break a}this.configLayerInfos[a].symbolData.featureDisplayOptions.fields=[{name:e?e:n,label:e?k:f}]}}}}},_addFilterChanged:function(a){2.1<=
parseFloat(this.appConfig.wabVersion)&&this.own(a.on("layerInfosFilterChanged",k.hitch(this,function(a){B.forEach(a,k.hitch(this,function(a){var c=a.id,b=a.id+this.UNIQUE_APPEND_VAL_CL;a=a.getFilter();this.layerList.hasOwnProperty(c)?(this.layerList[c].isLoaded=this.layerList[c].filter===a,this.layerList[c].filter=a,this._loadList(this.layerList[c],!0)):this.layerList.hasOwnProperty(b)&&(this.layerList[b].layerObject.filter=a,this.layerList[b].layerObject._initFeatures())}))})))},_updateVisibility:function(a){if(a){var c=
a.id,b=a.isShowInMap();if(this.layerList.hasOwnProperty(c)){var d=this.layerList[c];if(a=c===d.li.id?d.li:c===d.id?a:void 0)c=this._inVisibleRange(c),d.visible===b&&d.visScaleRange===c||this._toggleLayerUI(a,b,c)}}},_addVisibleChanged:function(a){this.own(a.on("layerInfosIsVisibleChanged",k.hitch(this,function(a){B.forEach(a,function(a){this._updateVisibility(a)},this)})))},_addZoomChanged:function(a){this.own(u(this.map,"zoom-end",k.hitch(this,function(){a.traversal(k.hitch(this,function(a){this._updateVisibility(a)}))})))},
_updatePanelHeader:function(){var a;a=this.map.width;this.config.displayPanelIcon&&750<a?(this.pageHeader&&(m.removeClass(this.pageHeader,"pageHeaderNoIcon"),m.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),this.config.refreshEnabled?""!==this.config.mainPanelText?m.addClass(this.pageHeader,"pageHeaderRefresh"):m.addClass(this.pageHeader,"pageHeaderRefreshNoText"):m.addClass(this.pageHeader,"pageHeader")),this.pageBody&&(m.removeClass(this.pageBody,"pageBodyNoIcon"),m.removeClass(this.pageBody,
"pageBodyNoIconRefresh"),this.config.refreshEnabled?""!==this.config.mainPanelText?m.addClass(this.pageBody,"pageBodyRefresh"):m.addClass(this.pageBody,"pageBodyRefreshNoText"):m.addClass(this.pageBody,"pageBody")),this.pageTitle&&(m.addClass(this.pageTitle,"pageTitleWidth"),this.config.refreshEnabled?(m.removeClass(this.pageTitle,"pageTitle"),m.removeClass(this.pageTitle,"pageTitleRefresh-tab"),m.removeClass(this.pageTitle,"pageTitleRefresh"),m.addClass(this.pageTitle,this.useDarkText?"pageTitleRefresh-tab":
"pageTitleRefresh")):(m.removeClass(this.pageTitle,"pageTitleRefresh"),m.removeClass(this.pageTitle,"pageTitleRefresh-tab"),m.addClass(this.pageTitle,"pageTitle"))),a=this.config.mainPanelText,"undefined"===typeof a&&(a=""),this.pageTitle.innerHTML=a,this.panelMainIcon.innerHTML=this.config.mainPanelIcon):this.config.displayPanelIcon||this.config.refreshEnabled?!this.config.displayPanelIcon&&this.config.refreshEnabled?(this.pageHeader&&(m.removeClass(this.pageHeader,"pageHeader"),m.removeClass(this.pageHeader,
"pageHeaderNoIcon"),m.addClass(this.pageHeader,"pageHeaderNoIconRefresh")),this.pageBody&&(m.removeClass(this.pageBody,"pageBody"),m.removeClass(this.pageBody,"pageBodyNoIcon"),m.addClass(this.pageBody,"pageBodyNoIconRefresh")),this.pageTitle&&m.removeClass(this.pageTitle,"pageTitleWidth"),this.pageTitle.innerHTML="\x3cdiv\x3e\x3c/div\x3e",this.panelMainIcon.innerHTML="\x3cdiv\x3e\x3c/div\x3e"):this.config.displayPanelIcon&&750>=a&&this.config.refreshEnabled&&(this.pageHeader&&(m.removeClass(this.pageHeader,
"pageHeaderNoIcon"),m.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),m.removeClass(this.pageHeader,"pageHeader"),""!==this.config.mainPanelText?m.addClass(this.pageHeader,"pageHeaderRefresh"):m.addClass(this.pageHeader,"pageHeaderRefreshNoText")),this.pageBody&&(m.removeClass(this.pageBody,"pageBodyNoIcon"),m.removeClass(this.pageBody,"pageBodyNoIconRefresh"),m.removeClass(this.pageBody,"pageBody"),""!==this.config.mainPanelText?m.addClass(this.pageBody,"pageBodyRefresh"):m.addClass(this.pageBody,
"pageBodyRefreshNoText")),this.pageTitle&&m.addClass(this.pageTitle,"pageTitleWidth"),a=this.config.mainPanelText,"undefined"===typeof a&&(a=""),this.pageTitle.innerHTML=a):(this.pageHeader&&(m.removeClass(this.pageHeader,"pageHeader"),m.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),m.addClass(this.pageHeader,"pageHeaderNoIcon")),this.pageBody&&(m.removeClass(this.pageBody,"pageBody"),m.removeClass(this.pageBody,"pageBodyNoIconRefresh"),m.addClass(this.pageBody,"pageBodyNoIcon")),this.pageTitle.innerHTML=
"\x3cdiv\x3e\x3c/div\x3e",this.panelMainIcon.innerHTML="\x3cdiv\x3e\x3c/div\x3e")},_createPanelUI:function(a,c){var b=new y;this.numClusterLayers=0;this.hidePanel||(this._updatePanelHeader(),this._updateUI(null),this._clearChildNodes(this.pageMain),this.updateEnd=[]);for(var d=[],e=[],n=0;n<a.length;n++){var f=a[n];"ThemeCluster"===f.symbolData.clusterType&&this.updateThemeClusterSymbol(f,n);var h=c.getLayerInfoById(f.id);h&&e.push(h.getLayerType());d.push({jimuLayerInfo:h,lyrInfo:f})}this._getLayerDetails(e,
d).then(k.hitch(this,function(a){B.forEach(a,k.hitch(this,function(a){this.updateLayerList(a.layerObject,a.lyrInfo,a.layerType,a.jimuLayerInfo)}));this._initUpdateEnd();this.addMapLayers();this.hidePanel||setTimeout(k.hitch(this,function(){this.openAtStartAysn=!0;this._mapExtentChange(!v.isAutoFocusFirstNodeWidget(this))}),1E3);b.resolve()}));return b},_getLayerDetails:function(a,c){var b=new y,d=[];0<a.length?(new r(a)).then(k.hitch(this,function(a){if(a)for(var g=0;g<a.length;g++)c[g].layerType=
a[g][1],d.push(c[g].jimuLayerInfo.getLayerObject());0<d.length&&(new r(d)).then(k.hitch(this,function(a){if(a)for(var d=0;d<a.length;d++)c[d].layerObject=a[d][1];b.resolve(c)}))})):b.resolve(c);return b},_initUpdateEnd:function(){if(!this.hidePanel)for(var a in this.layerList){var c=this.layerList[a];"ClusterLayer"!==c.type&&c&&c.layerObject&&c.layerObject.hasOwnProperty("refreshInterval")&&0<c.layerObject.refreshInterval&&this.updateEnd.push(this.own(u(c.layerObject,"update-end",k.hitch(this,this._updateEnd))))}},
_updateEnd:function(a){var c=this.layerList.hasOwnProperty(a.target.id)?a.target.id:this.layerList.hasOwnProperty(a.target.id+"_CL")?a.target.id+"_CL":"";if(""===c)for(var b in this.layerList){var d=this.layerList[b];if(d&&d.layerObject&&d.layerObject.id===a.target.id){c=d.li.id;break}}this.layerList.hasOwnProperty(c)&&(a=this.layerList[c],a.isLoaded=!1,a.updating=!1,a.requiresReload=!0,a&&(a.legendOpen?this._loadList(a,this.config.countEnabled):this.config.countEnabled&&this.countFeatures(a)))},
updateThemeClusterSymbol:function(a,c){a=a.symbolData;this.appConfig.theme.styles&&this.appConfig.theme.styles[0]&&"undefined"===typeof this._styleColor&&this._updateStyleColor(this.appConfig.theme.styles[0]);if(this._styleColor){var b=x.fromHex(this._styleColor);c+=1;var d=0<c?30*c:30,e=0===c%2,n=b.g,f=b.b,b=b.r-d;e&&(255<b?b-=255:0>b&&(b+=255));f-=d;0===c%3&&e&&(255<f?f-=255:0>f&&(f+=255));d=n-d;0===c%5&&e&&(255<d?d-=255:0>d&&(d+=255));a.clusterType="CustomCluster";a.clusterSymbol={color:[b,d,f,
1],outline:{color:[0,0,0,0],width:0,type:"esriSLS",style:"esriSLSNull"},type:"esriSFS",style:"esriSFSSolid"}}},removeOldClusterLayers:function(a){var c=[],b;for(b in this.layerList)if("ClusterLayer"===this.layerList[b].type){var d=0;a:for(;d<a.length;d++){var e=a[d];if(e.id+this.UNIQUE_APPEND_VAL_CL===b){e.symbolData&&!e.symbolData.clusteringEnabled&&c.push(b);break a}}}if(0<c.length)for(var n in c)if(this.layerList.hasOwnProperty(c[n])){if(-1<this.map.graphicsLayerIds.indexOf(c[n])){if((a=this.layerList[c[n]])&&
a.li){var f;a.li.parentLayerID&&(f=this.operLayerInfos.getLayerInfoById(a.li.parentLayerID));!f&&a.li.layer&&(f=this.operLayerInfos.getLayerInfoById(a.li.layer));f&&a.hasOwnProperty("parentLayerVisible")&&f.setTopLayerVisible(a.parentLayerVisible)}this.map.removeLayer(this.layerList[c[n]].layerObject)}this.layerList[c[n]].layerObject.destroy();delete this.layerList[c[n]]}},addMapLayers:function(){for(var a=Object.keys(this.layerList).reverse(),c=0;c<a.length;c++){var b=a[c],d=this.layerList[b];d.type&&
"ClusterLayer"===d.type&&-1===this.map.graphicsLayerIds.indexOf(b)&&this.map.addLayer(d.layerObject)}},updateLayerList:function(a,c,b,d){var g,e=null,f,h,m;d=d||this.operLayerInfos.getLayerInfoById(a.id);var l=this._checkSelfType(d,c,b,a),p=this._checkListDisabled(c),t=v.getFeatureLayerDefinition(a);if(c.symbolData.clusteringEnabled)g=this._getClusterLayer(c,a,d,b,t),f="ClusterLayer",b=g,h=g.id,this.clusterLayerArray.push({clusterLayer:g,parentID:c.id}),this.hidePanel||this.own(u(g,"update-end",k.hitch(this,
function(){this._loadList(this.layerList[g.id],!0)}))),this.numClusterLayers+=1;else if("ArcGISStreamLayer"===a.layerType)f="StreamLayer",h=a.layerObject.id,b=a.layerObject,m=a;else{h="FeatureLayer"===b?c.id:a.id;var G=this.operLayerInfos.getLayerInfoById(c.parentLayerID)||a.parentLayerInfo;if(G&&G.layerObject&&(e=G.layerObject,f=e.type,G.originOperLayer&&G.originOperLayer.featureCollection&&(f=G.originOperLayer.featureCollection.layers)))for(G=0;G<f.length;G++){var r=f[G];r.id===h&&(m=r)}g=a.layerObject?
a.layerObject:a;f=b;b=e&&!e.empty?e:g?g:a;if("geo_rss"===l&&b&&b.getFeatureLayers)for(G=b.getFeatureLayers(),r=0;r<G.length;r++){var w=G[r];w.id===c.id&&(b=w)}m=m?m:a}this.layerList[h]={type:f,layerObject:b,pl:m,id:h,visible:d&&d.isShowInMap?d.isShowInMap():!0,li:c,filter:d?d.getFilter():"1\x3d1",infoTemplate:d.getInfoTemplate()||c.infoTemplate,selfType:l,listDisabled:p,showAllFeatures:this.showAllFeatures,layerDefinition:t};"ArcGISStreamLayer"!==a.layerType&&this.updateRenderer(h);this.hidePanel||
this._addPanelItem(e?e:g?g:a,c,p,d)},_checkListDisabled:function(a){return a.symbolData.featureDisplayOptions.listDisabled?a.symbolData.featureDisplayOptions.listDisabled:a.symbolData.featureDisplayOptions.fields?0===a.symbolData.featureDisplayOptions.fields.length:!0},_checkSelfType:function(a,c,b,d){d=(c=c.layerObject&&!c.layerObject.empty?c.layerObject:d)&&c.originOperLayer?c.originOperLayer:d;a=(a=a.originOperLayer&&a.originOperLayer.selfType?a.originOperLayer.selfType:d&&d.selfType?d.selfType:
"")&&""!==a?a:d&&d.layerType&&"CSV"===d.layerType?"collection":"Feature Collection"===b?"collection":"CSVLayer"===b?"collection":"";!a&&b&&"KML"===b&&(a="kml");return a},updateRenderer:function(a){a=this.layerList[a];if("LayerSymbol"!==a.li.symbolData.symbolType){"undefined"===typeof a.li.orgRenderer&&(a.li.orgRenderer=a.layerObject.renderer?a.layerObject.renderer:a.li.renderer);var c=new ja(ea.fromJson(a.li.symbolData.symbol));a.li.newRenderer=c;if(a.layerObject.setLayerDrawingOptions&&!isNaN(a.li.subLayerId)){var b=
[],d=new ga;d.renderer=c;b[a.li.subLayerId]=d;a.layerObject.setLayerDrawingOptions(b)}else a.layerObject.setRenderer?a.layerObject.setRenderer(c):console.log("Error setting the new renderer...will use the default rendering of the layer");"function"===typeof a.layerObject.refresh&&a.layerObject.refresh()}},_onRecNodeMouseover:function(a){b.add(a,this.isDartTheme?"layer-row-mouseover-dart":this.isDashboardTheme&&!this.isLightTheme?"layer-row-mouseover-dashboard":"layer-row-mouseover")},_onRecNodeMouseout:function(a){b.remove(a,
this.isDartTheme?"layer-row-mouseover-dart":this.isDashboardTheme&&!this.isLightTheme?"layer-row-mouseover-dashboard":"layer-row-mouseover")},_addPanelItem:function(a,c,b,d){var g=c.id+this.UNIQUE_APPEND_VAL_CL,g=c.id in this.layerList?c.id:g in this.layerList?g:"",e=this.layerList[g];if(e){var f=e.type,l;l=this.isDashboardTheme?["rec","expand","expandDown-dashboard","solidBorder"]:this.isDartTheme?["rec-dart","expand-dart","expandDown-dart","solidBorder-dart"]:["rec","expand","expandDown","solidBorder"];
var p=t.create("div",{"class":l[0]+" "+l[3]+" esriCTInfoLayer",id:"rec_"+g,"attr-layerid":g,tabindex:0,"aria-label":c.label},this.pageMain);b?(m.setStyle(p,"cursor","default"),l="expand-empty"):(this.own(u(p,"mouseover",k.hitch(this,this._onRecNodeMouseover,p))),this.own(u(p,"mouseout",k.hitch(this,this._onRecNodeMouseout,p))),l=l[1]+" "+l[2],d&&d.isInScale&&(l+=d.isInScale()?"":" expandInActive"));var r=t.create("div",{"class":"recIcon active sub-active",id:"recIcon_"+g,"attr-layerid":g,tabindex:-1,
role:"button","aria-label":this.nls.logoPrefix+c.label},p),aa=t.create("div",{"class":l,id:"exp_"+g,tabindex:-1,"attr-layerid":g,role:"button","aria-label":this.nls.expand,"aria-expanded":"false"},p);c.panelImageData&&-1<c.panelImageData.toString().indexOf("\x3cimg")&&(d=document.createElement("div"),d.innerHTML=c.panelImageData,d=new ba(d.children[0].src,26,26),c.panelImageData=this._createImageDataDiv(d,44,44,void 0,!0).innerHTML);r.innerHTML=c.panelImageData;L.set(r.firstChild,"border-radius",
"41px");var w;this.config.countEnabled?(c=t.create("div",{"class":"recLabel",id:"recLabel_"+g,innerHTML:"\x3cp\x3e"+c.label+"\x3c/p\x3e"},p),m.setStyle(c,"top","20px"),w=t.create("div",{"class":"recNum",id:"recNum_"+g,innerHTML:""},p)):c=t.create("div",{"class":"recLabelNoCount",id:"recLabel_"+g,innerHTML:"\x3cp\x3e"+c.label+"\x3c/p\x3e"},p);"ClusterLayer"===f?(a.node=w,b||this._addLegend(g,e),a._updateNode(a.nodeCount)):"StreamLayer"===f?(e.node=w,this.countFeatures(e),b||this._addLegend(g,e)):(e.node=
w,this._addLegend(g,e));u(r,"click",k.hitch(this,this._toggleLayerVisibility,e));u(r,"keydown",k.hitch(this,function(a){if(a.keyCode===F.TAB)a.stopPropagation(),a.preventDefault(),M.focus(aa);else if(a.keyCode===F.ESCAPE)a.stopPropagation(),a.preventDefault(),h.set(r,"tabindex",-1),h.set(aa,"tabindex",-1),this._support508Accessibility(),M.focus(p);else if(a.keyCode===F.ENTER||a.keyCode===F.SPACE)a.stopPropagation(),a.preventDefault(),this._toggleLayerVisibility(e,a),M.focus(a.currentTarget)}));b||
(e.toggleLegend=u(p,"click",k.hitch(this,this._toggleLegend,e)),u(p,"keydown",k.hitch(this,function(a){if(a.keyCode===F.ENTER||a.keyCode===F.SPACE)a.stopPropagation(),a.preventDefault(),h.set(r,"tabindex",0),h.set(aa,"tabindex",0),M.focus(r),v.initFirstFocusNode(this.domNode,r),v.initLastFocusNode(this.domNode,aa)})),u(aa,"keydown",k.hitch(this,function(a){var c=this.layerList[a.currentTarget.id.split("exp_")[1]];this.handleArrowLayer(a,c)})));e.legendOpen?h.set(aa,"aria-expanded","true"):h.set(aa,
"aria-expanded","false")}},handleArrowLayer:function(a,c){var b=a.currentTarget.id,d=h.get(a.currentTarget,"attr-layerid"),f="rec_".concat(d),d="recIcon_".concat(d);if(a.keyCode===F.TAB)a.stopPropagation(),a.preventDefault(),M.focus(e.byId(d));else if(a.keyCode===F.ESCAPE)a.stopPropagation(),a.preventDefault(),h.set(e.byId(d),"tabindex",-1),h.set(e.byId(b),"tabindex",-1),this._support508Accessibility(),M.focus(e.byId(f));else if(a.keyCode===F.ENTER||a.keyCode===F.SPACE)a.stopPropagation(),a.preventDefault(),
this._toggleLegend(c,a,!0)},_addLegend:function(a,c){c.legendOpen=null===this.row&&this.config.expandList;c.legendNode=t.create("div",{"class":"legendLayer "+(c.legendOpen?"legendOn":"legendOff"),id:"legend_"+a},this.pageMain);"ClusterLayer"===c.type&&(c.layerObject.legendNode=c.legendNode);this.row="firstRowExpanded"},_getListFields:function(a){var c=[],b=this._getInfoTemplate(a);B.forEach(b&&b.info&&b.info.fieldInfos?b.info.fieldInfos:[],function(a){a.visible&&-1===a.fieldName.indexOf("/")&&c.push(a.fieldName)});
var d=a.li.symbolData&&a.li.symbolData.featureDisplayOptions?a.li.symbolData.featureDisplayOptions:{};B.forEach(d.fields||[],function(a){-1===c.indexOf(a.name)&&c.push(a.name)});d.groupField&&-1===c.indexOf(d.groupField.name)&&c.push(d.groupField.name);if(0===c.length||"undefined"===typeof b)c=["*"];"*"!==c[0]&&a.layerObject&&a.layerObject.objectIdField&&-1===c.indexOf(a.layerObject.objectIdField)&&c.push(a.layerObject.objectIdField);return c},_loadList:function(a,c){if(!this.hidePanel){var g=a.layerObject.id in
this.layerList?a.layerObject.id:a.li.id;c&&this._addSearching(g);var d=this._getListFields(a);if("ClusterLayer"===a.type){a.li.layerListExtentChanged&&(a.layerObject.clusterFeatures(),a.li.layerListExtentChanged=!1);var e=[];if(a.layerObject.clusterGraphics||a.layerObject._features){if(this.showAllFeatures)e=a.layerObject._features;else for(var g=a.layerObject.clusterGraphics,n=0;n<g.length;n++){var f=g[n];if(f.graphics&&0<f.graphics.length)for(var h=0;h<f.graphics.length;h++)e.push(f.graphics[h])}setTimeout(k.hitch(this,
function(){this._updateList(e,a.legendNode,a.layerObject.node,d,c,a)}),100)}else this._removeSearching(g,a.legendNode?!b.contains(a.legendNode,"legendOff"):!0)}else this.getFeatures(a,d,c)}},_addSearching:function(a){var c=this.layerList[a].listDisabled,g=c?"expand-empty":this.isDartTheme?"expandDown-dart":this.isDashboardTheme&&!this.isLightTheme?"expandDown-dashboard":"expandDown",d=c?"expand-empty":this.isDartTheme?"expandUp-dart":this.isDashboardTheme&&!this.isLightTheme?"expandUp-dashboard":
"expandUp",c=c?"expandSearching-empty":"expandSearching";a="exp_"+a;e.byId(a)&&(b.contains(a,g)&&(b.remove(a,g),b.add(a,c)),b.contains(a,d)&&(b.remove(a,d),b.add(a,c)))},_removeSearching:function(a,c){var g=this.layerList[a].listDisabled,d=g?"expand-empty":this.isDartTheme?"expandDown-dart":this.isDashboardTheme&&!this.isLightTheme?"expandDown-dashboard":"expandDown",f=g?"expand-empty":this.isDartTheme?"expandUp-dart":this.isDashboardTheme&&!this.isLightTheme?"expandUp-dashboard":"expandUp",g=g?"expandSearching-empty":
"expandSearching",n="exp_"+a;e.byId(n)&&(b.contains(n,g)&&(b.remove(n,g),b.add(n,c?f:d)),c&&this._setFeatureItemFocused(a))},_setFeatureItemFocused:function(a){if(a){var c,b,d,f;f=this._getClusteringEnabledValue(a);c="legend_".concat(a);b="recIcon_".concat(a);d="exp_".concat(a);f&&-1===a.lastIndexOf("_CL",a.length-3)&&(c+="_CL",b+="_CL",d+="_CL");a=e.byId(c);if(z(".groupItem",a).length)h.set(e.byId(b),"tabIndex",-1),h.set(e.byId(d),"tabIndex",-1),this._support508Accessibility(!0),b=z(".groupItemTitle",
a),b.length&&(this.initialOpen||M.focus(b[0]));else if(a=z(".featureItem",a),c=a.length)h.set(e.byId(b),"tabIndex",-1),h.set(e.byId(d),"tabIndex",-1),this._support508Accessibility(!0),this.initialOpen||M.focus(a[0])}},_getClusteringEnabledValue:function(a){var c;-1<a.lastIndexOf("_CL",a.length-3)&&(a=a.split("_CL")[0]);for(c in this.configLayerInfos){var b=this.configLayerInfos[c];if(b.id===a)return b.symbolData.clusteringEnabled}},_getClusterLayer:function(a,c,b,d,f){var g=c.layerObject?c.layerObject:
c,h=a.infoTemplate,k=g&&g.originOperLayer?g.originOperLayer:c.parentLayerInfo?c.parentLayerInfo:b?b.originOperLayer:void 0,q=null,q=a.id+this.UNIQUE_APPEND_VAL_CL;c=!0;-1<this.map.graphicsLayerIds.indexOf(q)||-1<this.map._layers.indexOf(q)?(q=this.map.getLayer(q),g=f=!1,JSON.stringify(q.symbolData)!==JSON.stringify(a.symbolData)&&(q.symbolData=a.symbolData,q.countColor=a.symbolData._highLightColor,g=!0),d=t.toDom(a.panelImageData),JSON.stringify(q.icon)!==JSON.stringify(d.src)&&(q.icon=d.src,g=!0),
t.destroy(d.id),q.displayFeatureCount=a.symbolData.displayFeatureCount,q.refresh!==a.refresh&&(q.refresh=a.refresh,f=!0),g&&q._setupSymbols(),q.countEnabled=this.config.countEnabled,q.hidePanel=this.hidePanel,q.showAllFeatures!==this.showAllFeatures&&(f=!0,q.showAllFeatures=this.showAllFeatures),q.listDisabled!==this.listDisabled&&(f=!0,q.listDisabled=this.listDisabled),f?q.url&&q.refreshFeatures(q.url):g&&q.clusterFeatures()):(c=!1,q=new ka({name:a.label+this.UNIQUE_APPEND_VAL_CL,id:q,map:this.map,
node:e.byId("recNum_"+q),legendNode:e.byId("legend_"+q),infoTemplate:"undefined"!==typeof g.infoTemplate?g.infoTemplate:h,refreshInterval:this.config.refreshInterval,refreshEnabled:this.config.refreshEnabled,parentLayer:g,lyrInfo:a,lyrType:d,_styleColor:this._styleColor,originOperLayer:k,countEnabled:this.config.countEnabled,hidePanel:this.hidePanel,filter:b?b.getFilter():"1\x3d1",showAllFeatures:this.showAllFeatures,listDisabled:this.listDisabled,_parent:this,layerDefinition:f}));q.setVisibility(c?
q.visible:b.isShowInMap?b.isShowInMap():!0);return q},_createImageDataDiv:function(a,c,b,d,e){var g;if(a){g=c;var f=b;if(a.height&&a.width){var h;if(a.height>a.width)h=a.width/a.height,f=c*h;else if(a.width===a.height||a.width>a.height)f=c,h=a.width/a.height,g=0<h?b*h:b}"undefined"!==typeof a.setWidth?"undefined"!==typeof a.setHeight?(a.setWidth(e?f-.25*f:f),a.setHeight(e?g-.25*g:g)):a.setWidth(2):"undefined"!==typeof a.size&&20<a.size&&a.setSize(20);g=t.create("div",{"class":"imageDataGFX"},d);d=
l.createSurface(g,c,b);a=ea.getShapeDescriptors(a);d.createShape(a.defaultShape).setFill(a.fill).setStroke(a.stroke).applyTransform({dx:c/2,dy:b/2})}return g},_updateUI:function(a){this.styleName=a;this.isDashboardTheme&&(this.isLightTheme=a?"light"===a:this.isLightTheme,this._updateNodes(this.isLightTheme?"expandDown-dashboard":"expandDown",this.isLightTheme?"expandDown":"expandDown-dashboard"),this._updateNodes(this.isLightTheme?"expandUp-dashboard":"expandUp",this.isLightTheme?"expandUp":"expandUp-dashboard"),
this._updateNodes(this.isLightTheme?"expand-dashboard":"expand",this.isLightTheme?"expand":"expand-dashboard"),this._updateNodes(this.isLightTheme?"groupItemImageUp-dashboard":"groupItemImageUp",this.isLightTheme?"groupItemImageUp":"groupItemImageUp-dashboard"),this._updateNodes(this.isLightTheme?"groupItemImageDown-dashboard":"groupItemImageDown",this.isLightTheme?"groupItemImageDown":"groupItemImageDown-dashboard"),this._updateNodes(this.isLightTheme?"groupItemImage-dashboard":"groupItemImage",
this.isLightTheme?"groupItemImage":"groupItemImage-dashboard"))},_updateNodes:function(a,c){var g=z("."+a);B.forEach(g,function(d){b.remove(d,a);b.add(d,c)})},_toggleLayerVisibility:function(a,c){c.stopPropagation();this.map.infoWindow.hide();c=a.id?a.id:a.layerObject.id;var g=this.layerList[c];g||(a.pl&&(c=a.pl.id),g=this.layerList[c]);if(g){a=[null,void 0,"null","undefined"];var d=g.li&&g.li.hasOwnProperty("subLayerId")?-1===a.indexOf(g.li.subLayerId)&&"-1"!==g.li.subLayerId.toString():!1;a=this.operLayerInfos.getLayerInfoById(c);
var e=!b.contains("recIcon_"+c,"active");if(d&&"ClusterLayer"!==g.type){if(e)for(c=a.parentLayerInfo;c;)c.setTopLayerVisible(!0),c=c.parentLayerInfo;a.setTopLayerVisible(e)}else g&&(g.layerObject.setVisibility(e),"ClusterLayer"===g.type&&e&&(g.layerObject.handleMapExtentChange({levelChange:!0}),g.layerObject.flashFeatures()),"undefined"!==typeof g.pl&&(g.pl.visibility=e,-1<this.map.graphicsLayerIds.indexOf(c)&&this.map.getLayer(c).setVisibility(e)))}},_toggleLayerUI:function(a,c,g){var d=a.id?a.id:
a.layerObject.id,f=this.layerList[d];f||(a.pl&&(d=a.pl.id),f=this.layerList[d]);if(f){a=e.byId("recLabel_"+d);this.layerList[d].visible=c;this.layerList[d].parentLayerVisible=c;this.layerList[d].visScaleRange=g;"ClusterLayer"===this.layerList[d].type&&(this.layerList[d].layerObject.parentLayerVisible=c);if(this.config.countEnabled&&b.contains("recNum_"+d,c?"recNumInActive":"recNum")){this._updatePanel(f,d);var n=this.isDartTheme?" darkThemeColor":" lightThemeColor";b.remove("recNum_"+d,c?"recNumInActive":
"recNum");b.add("recNum_"+d,(c?"recNum":"recNumInActive")+n)}var n=this.isDartTheme?"expandDown-dart":this.isDashboardTheme&&!this.isLightTheme?"expandDown-dashboard":"expandDown",m=this.isDartTheme?"expandUp-dart":this.isDashboardTheme&&!this.isLightTheme?"expandUp-dashboard":"expandUp",p=b.contains("rec_"+d,"inActive");if(c&&g){b.add("recIcon_"+d,"active");p||b.add("recIcon_"+d,"sub-active");a&&a.firstChild&&!p&&b.remove(a.firstChild,"inActive");b.contains("exp_"+d,"expandInActive")&&g&&b.remove("exp_"+
d,"expandInActive");f.toggleLegend&&f.toggleLegend.remove();if(c=e.byId("rec_"+d))f.toggleLegend=u(c,"click",k.hitch(this,this._toggleLegend,f)),b.contains(c.id,"inActive")&&g&&(b.remove(c.id,"inActive"),h.set(c.id,"tabindex",0));b.contains("rec_"+d,"recDefault")&&b.remove("rec_"+d,"recDefault");f.listDisabled||(this.showAllFeatures&&(!this.showAllFeatures||f.hasOwnProperty("isLoaded")&&f.isLoaded)||this._loadList(f,!0),f.legendOpen&&(b.add("legend_"+d,"legendOn"),b.remove("legend_"+d,"legendOff"),
b.contains("exp_"+d,n)&&(b.remove("exp_"+d,n),b.add("exp_"+d,m)),h.set(e.byId("exp_"+d),"aria-expanded","true"),M.focus(e.byId("recIcon_"+d))))}else{var l=c?b.add:b.remove;l("recIcon_"+d,"active");p||l("recIcon_"+d,"sub-active");a&&a.firstChild&&!p&&(c?b.remove:b.add)(a.firstChild,"inActive");b.contains("exp_"+d,"expandInActive")||b.add("exp_"+d,"expandInActive");f.legendOpen&&b.contains("legend_"+d,"legendOn")&&(b.remove("legend_"+d,"legendOn"),b.add("legend_"+d,"legendOff"),b.contains("exp_"+d,
m)&&(b.remove("exp_"+d,m),b.add("exp_"+d,n)),h.set(e.byId("exp_"+d),"aria-expanded","false"));f.toggleLegend&&f.toggleLegend.remove();b.contains("rec_"+d,"rec")&&b.add("rec_"+d,"recDefault");!g&&((g=e.byId("recIcon_"+d))&&b.contains(g,"sub-active")||!g)&&(b.add("rec_"+d,"inActive"),h.set("rec_"+d,"tabindex",-1))}}return!1},_toggleLegend:function(a,c,g){if("thumb2"!==c.currentTarget.className&&"recIcon"!==c.currentTarget.className){var d=a.layerObject.id in this.layerList?a.layerObject.id:a.li.id;
if(b.contains("legend_"+d,"legendOff")){this._addSearching(d);this.layerList[d].legendOpen=!0;if("undefined"===typeof this.layerList[d].li.layerListExtentChanged||this.layerList[d].requiresReload)this.layerList[d].li.layerListExtentChanged=!0,this.layerList[d].requiresReload=!1;this.layerList[d].li.layerListExtentChanged?setTimeout(k.hitch(this,function(){this._loadList(a,!1)}),500):this._removeSearching(d,!0);b.remove("legend_"+d,"legendOff");b.add("legend_"+d,"legendOn");h.set(e.byId("exp_"+d),
"aria-expanded","true");g&&this._setFeatureItemFocused(d)}else if(b.contains("legend_"+d,"legendOn")){this.layerList[d].legendOpen=!1;g=this.isDartTheme?"expandDown-dart":this.isDashboardTheme&&!this.isLightTheme?"expandDown-dashboard":"expandDown";var f=this.isDartTheme?"expandUp-dart":this.isDashboardTheme&&!this.isLightTheme?"expandUp-dashboard":"expandUp";b.contains("exp_"+d,f)&&(b.remove("exp_"+d,f),b.add("exp_"+d,g));b.remove("legend_"+d,"legendOn");b.add("legend_"+d,"legendOff");h.set(e.byId("exp_"+
d),"aria-expanded","false")}}c.stopPropagation()},_toggleGroup:function(a,c){var g=c.currentTarget.id.slice(0,-2),d=this.isDartTheme?"featureItem-dart":"featureItem",e=!0;c.target.parentNode&&(""!==c.target.parentNode.id&&b.contains(c.target.parentNode.id,d)&&(e=!1),""!==c.target.id&&b.contains(c.target.id,d)&&(e=!1));var d=this.isDartTheme?"groupItemImage-dart":this.isDashboardTheme&&!this.isLightTheme?"groupItemImage-dashboard":"groupItemImage",f=this.isDartTheme?"groupItemImageUp-dart":this.isDashboardTheme&&
!this.isLightTheme?"groupItemImageUp-dashboard":"groupItemImageUp",h=this.isDartTheme?"groupItemImageDown-dart":this.isDashboardTheme&&!this.isLightTheme?"groupItemImageDown-dashboard":"groupItemImageDown";if(e){a=a.layerObject.id in this.layerList?a.layerObject.id:a.li.id;var e=document.getElementById(c.currentTarget.id),k=e.childNodes[0].childNodes.length-1;b.contains(g,"groupOff")?(this.layerList[a].openGroups&&0<this.layerList[a].openGroups.length?-1===this.layerList[a].openGroups.indexOf(g)&&
this.layerList[a].openGroups.push(g):this.layerList[a].openGroups=[g],b.remove(g,"groupOff"),b.add(g,"groupOn"),this._updateLastNode(),this.layerList[a].groupOpen=!0,-1<e.childNodes[0].childNodes[k].childNodes[0].className.indexOf(d)&&(m.removeClass(e.childNodes[0].childNodes[k].childNodes[0],h),m.addClass(e.childNodes[0].childNodes[k].childNodes[0],f))):b.contains(g,"groupOn")&&(b.remove(g,"groupOn"),b.add(g,"groupOff"),this._updateLastNode(),this.layerList[a].openGroups&&0<this.layerList[a].openGroups.length?
(g=this.layerList[a].openGroups.indexOf(g),-1<g&&this.layerList[a].openGroups.splice(g,1),0===this.layerList[a].openGroups.length&&(this.layerList[a].groupOpen=!1)):this.layerList[a].groupOpen=!1,-1<e.childNodes[0].childNodes[k].childNodes[0].className.indexOf(d)&&(m.removeClass(e.childNodes[0].childNodes[k].childNodes[0],f),m.addClass(c.currentTarget.childNodes[0].childNodes[k].childNodes[0],h)))}},onAppConfigChanged:function(a,c,b){switch(c){case "themeChange":this.inPanelOverrides(b);this.destroy();
break;case "layoutChange":this.inPanelOverrides(b);break;case "styleChange":this.hidePanel||(this._updateUI(b),this._updateStyleColor(b));break;case "widgetChange":this.widgetChange=!0;b&&b.config&&b.config.layerInfos&&this.removeOldClusterLayers(b.config.layerInfos);this.row=null;break;case "mapChange":this._clearMap()}},_updateStyleColor:function(a){setTimeout(k.hitch(this,function(){var c=this.getPanel();switch(this.appConfig.theme.name){case "BoxTheme":c=c.containerNode.parentNode.parentNode.children[0];
break;case "DartTheme":c=c.containerNode.parentNode;break;case "TabTheme":c=c.containerNode;break;case "BillboardTheme":c=c.containerNode.parentNode;break;case "FoldableTheme":c=c.containerNode.parentNode.firstChild;break;default:c=this.pageHeader}c=window.getComputedStyle(c,null).getPropertyValue("background-color");if("transparent"===c||-1!==[null,void 0].indexOf(H.fromRgb(c).toHex()))c="rgba(0, 0, 0, 0)";this._styleColor=H.fromRgb(c).toHex();for(var b in this.layerList)c=this.layerList[b],"ClusterLayer"===
c.type&&c.layerObject.setStyleColor(this._styleColor);this._updateUI(a)}),50)},_clearMap:function(){if(this.layerList){for(var a in this.layerList){var c=this.layerList[a];if("ClusterLayer"===c.type){var b=!0;"undefined"!==typeof this.continuousRefreshEnabled&&(b=!this.continuousRefreshEnabled);b&&(c.layerObject._clear(),this.map.removeLayer(c.layerObject))}}this.layerList={}}},_close:function(){this.widgetManager.closeWidget(this.id)},onClose:function(){this.inherited(arguments);this.isOpen=!1;for(var a in this.layerList){var c=
this.layerList[a];if(c.li&&c.li.orgRenderer){if(c.layerObject.setLayerDrawingOptions&&!isNaN(c.li.subLayerId))try{var b=c.layerObject.layerDrawingOptions,d=JSON.parse(c.li.rendererJson);b[c.li.subLayerId].renderer=D.fromJson(d);c.layerObject.setLayerDrawingOptions(b)}catch(q){console.log(q),c.layerObject.setLayerDrawingOptions([])}else c.layerObject.setRenderer?c.layerObject.setRenderer(c.li.orgRenderer):console.log("Error re-setting the renderer");"function"===typeof c.layerObject.refresh&&c.layerObject.refresh()}}a=
!0;"undefined"!==typeof this.config.continuousRefreshEnabled&&(a=!this.config.continuousRefreshEnabled);a&&0!==this.refreshInterval&&(this.refreshIntervalValue=0,clearInterval(this.refreshInterval),this.refreshInterval=0);this.hidePanel||("undefined"!==typeof this.mapExtentChangedHandler?(this.mapExtentChangedHandler.remove(),this.mapExtentChangedHandler=void 0):"undefined"!==typeof this.iconClickHandler&&(this.iconClickHandler.remove(),this.iconClickHandler=void 0));this.config.hasOwnProperty("displayClusterLayer")&&
!1===this.config.displayClusterLayer&&this.clusterLayerArray.length&&B.forEach(this.clusterLayerArray,k.hitch(this,function(a){a.clusterLayer.hide();(a=this.operLayerInfos.getLayerInfoById(a.parentID))&&a.show()}))},_clearChildNodes:function(a){for(;a.hasChildNodes();)a.removeChild(a.lastChild)},_inVisibleRange:function(a){var c=!0;(a=this.operLayerInfos.getLayerInfoById(a))&&a.isCurrentScaleInTheScaleRange&&(c=a.isInScale());return c},_mapExtentChange:function(a){for(var c in this.layerList)this._updatePanel(this.layerList[c],
c);this._support508Accessibility("boolean"===typeof a?a:void 0)},_updatePanel:function(a,c){a.visScaleRange=this._inVisibleRange(c);this.showAllFeatures||this._clearList(a);!a.legendOpen||a.groupEnabled&&!a.groupOpen?(a.li&&(a.li.layerListExtentChanged=!0),a.visible&&a.visScaleRange?("ClusterLayer"===a.type&&a.layerObject.initalLoad&&this.config.countEnabled&&a.layerObject._updateNode(a.layerObject.node.innerHTML),"ClusterLayer"!==a.type&&("undefined"===typeof a.layerObject?console.log("layer object not known"):
this.countFeatures(a))):a.visScaleRange||this._updateList([],a.legendNode,a.node,[],!0,a)):a.visible&&a.visScaleRange?(a.updateList=!0,this._loadList(a,a.updateList)):this._updateList([],a.legendNode,a.node,[],!0,a)},getFeatures:function(a,c,b){var d=a.layerObject,e=a.legendNode,g=a.node,f=!a.listDisabled&&a.legendOpen?!0:!1,h=a.visScaleRange,m=d&&d.maxRecordCount?d.maxRecordCount:void 0,p,l=[],t=this._getQuery(a,c,f);if(a.visible&&h)if(d.queryFeatures)a.listDisabled||l.push(d.queryFeatures(t)),l.push(d.queryIds(t));
else if(p=a.li.url,(-1<p.indexOf("MapServer")||-1<p.indexOf("FeatureServer"))&&-1===p.indexOf("WFSServer"))h=new da(p),a.listDisabled||l.push(h.execute(t)),l.push(h.executeForIds(t));else{if(-1<p.indexOf("WFSServer")||a.type&&"WFSLayer"===a.type)t=new y,t.resolve(this._queryWFS(d&&d.graphics?d.graphics:[])),l.push(t)}else this._updateList([],a.legendNode,a.node,[],!0,a);0<l.length&&E(l).then(k.hitch(this,function(h){var n=a.layerObject.id in this.layerList?a.layerObject.id:a.li.id,l;g&&(l=this.config.countEnabled?
g.parentNode:g.previousSibling);(a.type&&"WFSLayer"===a.type||a.li&&a.li.url&&-1<a.li.url.indexOf("WFSServer"))&&h[0]&&h[0].hasOwnProperty("length")?(l=h[0].length,this.config.countEnabled&&(g.innerHTML=v.localizeNumber(l)),this._removeSearching(n,!1),this._updateList(h[0],e,g,c,l,a)):h&&1<h.length?(n=h[1])&&m&&n.length>m?this._chunkRequest(d,p,n,m,c,f).then(k.hitch(this,function(d){this._updateList(d,e,g,c,b,a)})):this._updateList(h[0].features,e,g,c,b,a):h&&1===h.length?(this.config.countEnabled&&
(g.innerHTML=v.localizeNumber(h[0].length)),this._removeSearching(n,!1)):(this.config.countEnabled&&(g.innerHTML=v.localizeNumber(0)),this.updateExpand(l,!0),this._removeSearching(n,a.legendOpen))}),function(a){console.log(a)})},_chunkRequest:function(a,c,b,d,e,f){var g=new y,h=[],n,m;n=0;for(m=b.length;n<m;n+=d){var l=b.slice(n,n+d),p=new fa;p.outFields=e;p.objectIds=l;p.returnGeometry=f;a.queryFeatures?h.push(a.queryFeatures(p)):c&&(l=new da(c),h.push(l.execute(p)))}(new r(h)).then(k.hitch(this,
function(a){if(a){for(var c=[],b=0;b<a.length;b++)a[b][1].features&&c.push.apply(c,a[b][1].features);g.resolve(c)}}));return g},_clearList:function(a){!a.isLoaded&&a.legendNode&&(a.isLoaded=!1,a.legendNode.innerHTML="")},_updateList:function(a,c,g,d,f,n,m){var l=n.li?n.li:n;if(a){"ClusterLayer"===n.type&&n.layerObject.node&&b.contains(n.layerObject.node.id,"searching")&&b.remove(n.layerObject.node.id,"searching");var p=n.visScaleRange,q=n.infoTemplate,r=n.symbolData?n.symbolData.featureDisplayOptions:
l&&l.symbolData?l.symbolData.featureDisplayOptions:{};if(g||c)c&&(n.hasOwnProperty("isLoaded")?!n.isLoaded:1)&&(c.innerHTML=""),f&&g&&this.config.countEnabled&&(p?g.innerHTML=v.localizeNumber(a.length):function(a,c,b,d){this.countFeatures(n,n.id||l.id).then(k.hitch(this,function(e){var g=this.config.countEnabled?a.parentNode:c.previousSibling;("ClusterLayer"===e.type&&e.visible||"ClusterLayer"!==e.type)&&this.updateExpand(g,b?0===d.length:!0)}))}.call(this,g,c,p,a)),g=this.config.countEnabled?g.parentNode:
c.previousSibling,("ClusterLayer"===n.type&&n.visible||"ClusterLayer"!==n.type)&&this.updateExpand(g,p?0===a.length:!0);if(!m){if(!n.listDisabled&&!n.isLoaded&&0<a.length){m=this.operLayerInfos.getLayerInfoById(n.id);f="ClusterLayer"===n.type?n.layerObject.renderer:l.bypassDrawingInfo&&l.rendererJson&&D.fromJson(JSON.parse(l.rendererJson))?D.fromJson(JSON.parse(l.rendererJson)):m&&m.layerObject&&m.layerObject.renderer?m.layerObject.renderer:a[0]._graphicsLayer?a[0]._graphicsLayer.renderer:n.layerObject&&
n.layerObject.renderer?n.layerObject.renderer:l&&l.renderer?D.fromJson(l.renderer)||l.renderer:n.renderer?D.fromJson(n.renderer)||n.renderer:void 0;var w=n.li&&n.li.fields?n.li.fields:n.fields,G=[];g=[];m=[];for(var x=0;x<a.length;x++){var J=a[x];"undefined"===typeof J.infoTemplate&&q&&(J.infoTemplate=q);var z=f&&f.getSymbol?f.getSymbol(J):J.symbol?ea.fromJson(J.symbol):void 0,y=J._layer&&J._layer.objectIdField?J._layer.objectIdField:l&&l.oidFieldName&&l.oidFieldName.name?l.oidFieldName.name:n.layerObject&&
n.layerObject.objectIdField?n.layerObject.objectIdField:n&&n.oidFieldName?n.oidFieldName:void 0,A=y?J.attributes[y]:c.id+x,H=this.getDisplayString(J,n,"*"===d[0]?J.attributes:d,r,y,"*"===d[0]?!1:!0),y=H.displayString,E=H.aliasNames,H=H.firstValue,O,P,K,Q;if(r.groupEnabled){var R=void 0,U=void 0,N=void 0;if("undefined"===typeof r.groupByField||r.groupByField)O=r.groupField,R=J.attributes[O.name],Q="byField",N=R;else if(O=r.groupByRendererOptions.fields[0],R=J.attributes[O.name],P=r.groupByRendererOptions.values,
Q="byRenderer",null!==R&&""!==R){K=0;a:for(;K<P.length;K++){var S=P[K],C=S.value,C=(C=C.split("\x26\x26"))&&1<C.length?R+C[0]+"\x26\x26 "+R+C[1]:isNaN(R)?"'"+R+"'"+S.value:R+S.value;if(eval(C)){U=S;break a}}"undefined"!==typeof U&&null!==U&&(N=U.label.replace(/ /g,""))}P="group_"+l.id+"_"+O.name+"_"+N;var S=!0,T;if(0<G.length)a:for(K=0;K<G.length;K++)if(C=G[K],P===C.id&&("byField"===Q&&R===C.value||"byRenderer"===Q)){S=!1;T=C.node;K=C.parent;break a}if(S){K=t.create("div",{"class":this.isDartTheme?
"groupItem-dart":"groupItem",id:P+"_c"});var S=t.create("div",{"class":this.isDartTheme?"groupItemTitle-dart":"groupItemTitle",id:P+"_t","attr-layerid":l.id,role:"button",tabindex:"0"},K),C="",W="byRenderer"===Q?"":O.name+": ";"undefined"!==typeof E&&E.hasOwnProperty(O.name)&&""!==E[O.name]&&(W="byField"===Q?E[O.name]+": ":"");"byField"===Q?"undefined"!==typeof O.label&&""!==O.label&&(W=C=O.label+": "):"undefined"!==typeof U?"undefined"!==typeof U.label&&""!==U.label&&(W=C=W+U.label):W=C=W+R;": "===
C&&(W=C="");E=this._getFormattedValue(J,O.name,n,w);"byRenderer"===Q&&z&&this._createImageDataDiv(k.clone(z),30,30,S,I);t.create("div",{"class":"byField"===Q?"groupField":"groupFieldImage",innerHTML:"byField"===Q?C+E:C,title:"byField"===Q?W+E:W},S);I=!1;n.openGroups&&0<n.openGroups.length&&(I=-1<n.openGroups.indexOf(P));var U=this.isDartTheme?" darkThemeColor":" lightThemeColor",U=t.create("div",{"class":this.isDartTheme?"groupCountLabel":"groupCountLabel"+U},S),W=t.create("div",{"class":this.isDartTheme||
this.isDashboardTheme&&!this.isLightTheme?"expandImageContainer-dart":"expandImageContainer"},S),X=this.isDartTheme?"groupItemImageUp-dart":this.isDashboardTheme&&!this.isLightTheme?"groupItemImageUp-dashboard":"groupItemImageUp",Y=this.isDartTheme?"groupItemImageDown-dart":this.isDashboardTheme&&!this.isLightTheme?"groupItemImageDown-dashboard":"groupItemImageDown",L=this.isDartTheme?"groupItemImage-dart":this.isDashboardTheme&&!this.isLightTheme?"groupItemImage-dashboard":"groupItemImage",L=L+(I?
" "+X:" "+Y);t.create("div",{"class":L},W);L=this.isDartTheme?"groupItem-dart":"groupItem";L+=n.groupOpen&&I?" groupOn":" groupOff";P=t.create("div",{"class":L,id:P},K);G.push({id:"group_"+l.id+"_"+O.name+"_"+N,node:P,parent:K,value:R});g.push({value:R,node:K,countNode:U,count:1});u(K,"click",k.hitch(this,this._toggleGroup,n));u(S,"keydown",k.hitch(this,function(a){var c=h.get(a.currentTarget,"attr-layerid"),b=this._getClusteringEnabledValue(c);if(a.keyCode===F.SPACE||a.keyCode===F.ENTER)e.byId(a.currentTarget.parentNode.id).click(),
a.preventDefault();if(a.keyCode===F.ESCAPE){a.stopPropagation();a.preventDefault();a="rec_"+c;var d="recIcon_"+c,g="exp_"+c;b&&-1===c.lastIndexOf("_CL",c.length-3)&&(a+="_CL",d+="_CL",g+="_CL");h.set(e.byId(d),"tabindex",-1);h.set(e.byId(g),"tabindex",-1);this._support508Accessibility();M.focus(e.byId(a))}}));h.set(S,"aria-label","byField"===Q?C+E:C)}else g.filter(function(a){if(a.node.id===T.id+"_c")return a})[0].count+=1,P=T}var A=t.create("div",{"class":this.isDartTheme?"featureItem-dart":"featureItem",
id:"feature_"+l.id+"_"+A,"attr-layerid":l.id,role:"button",tabindex:0}),I=!1;l&&l.symbolData&&(I="CustomSymbol"===l.symbolData.symbolType);!z||r.groupEnabled&&"byRenderer"===Q||this._createImageDataDiv(k.clone(z),30,30,A,I);u(A,"click",k.hitch(this,this._panToFeature,J));u(A,"keydown",k.hitch(this,function(a){var c=h.get(a.currentTarget,"attr-layerid"),b=this._getClusteringEnabledValue(c);if(a.keyCode===F.ENTER||a.keyCode===F.SPACE)a.currentTarget.click(),a.preventDefault();if(a.keyCode===F.ESCAPE){a.stopPropagation();
a.preventDefault();a="rec_"+c;var d="recIcon_"+c,g="exp_"+c;b&&-1===c.lastIndexOf("_CL",c.length-3)&&(a+="_CL",d+="_CL",g+="_CL");h.set(e.byId(d),"tabindex",-1);h.set(e.byId(g),"tabindex",-1);this._support508Accessibility();M.focus(e.byId(a))}}));-1<y.indexOf(" - ")&&(y=y.slice(0,-3));h.set(A,"aria-label",y);t.create("div",{style:"padding: 7px 5px 5px "+(r.groupEnabled&&"byRenderer"===Q?"15px":"50px")+"; text-align: "+(window.isRTL?"right":"left")+";",innerHTML:y,title:y},A);m.push({node:A,updateNode:P?
P:c,firstValue:H})}if(0<g.length){a=r.groupByRendererOptions;if(r.groupByRenderer&&a&&a.values){var V=[];B.forEach(a.values,function(a){V.push(a.label)});r=function(a,c){return V.indexOf(a.node.innerText)-V.indexOf(c.node.innerText)}}else r=function(a,c){return"undefined"===typeof a.value?c.value:"undefined"===typeof c.value?a.value:isNaN(a.value)?a.value.localeCompare(c.value):parseFloat(a.value)-parseFloat(c.value)};var r=g.sort(r),Z=this.config.countEnabled;B.forEach(r,function(a){Z&&(a.countNode.innerHTML=
v.localizeNumber(a.count));c.appendChild(a.node)})}0<m.length&&(r=m.sort(function(a,c){a=a.firstValue;c=c.firstValue;return"undefined"===typeof a||null===a||""===a?1:"undefined"===typeof c||null===c||""===c?-1:a===c?0:isNaN(a)?a.toString().localeCompare(c.toString()):parseFloat(a)-parseFloat(c)}),B.forEach(r,function(a){t.place(a.node,a.updateNode)}))}if(!this.showAllFeatures||this.showAllFeatures&&p)l.layerListExtentChanged=!1;r=n.layerObject&&n.layerObject.id&&n.layerObject.id in this.layerList?
n.layerObject.id:l.id;this.showAllFeatures&&n.visible&&p&&(p=!0,n.layerObject&&"ClusterLayer"===n.type&&(p=!n.layerObject.queryPending,n.layerObject.hasOwnProperty("requiresReload")&&(p=p&&!n.layerObject.requiresReload,n.layerObject.requiresReload=!1)),n.isLoaded=p);this._removeSearching(r,n.legendOpen);this.initialOpen=!1}}},_support508Accessibility:function(a){var c,b,d,e,f;d=1;c=z(".esriCTInfoLayer",this.domNode);c.length&&(c.forEach(k.hitch(this,function(a){f=h.get(a,"attr-layerid");e=this.operLayerInfos.getLayerInfoById(f);
(visible=e.isShowInMap()&&e.isInScale())&&d&&(b=a,d=0);visible||h.set(a,"tabindex",-1)})),v.initFirstFocusNode(this.domNode,b),a||M.focus(b),this._updateLastNode())},_updateLastNode:function(){var a,c,g,d,f,n,l,m;a=z(".esriCTInfoLayer",this.domNode);if(a.length&&(a.forEach(k.hitch(this,function(a){l=h.get(a,"attr-layerid");n=this.operLayerInfos.getLayerInfoById(l);if(m=n.isShowInMap()&&n.isInScale())c=a,g=h.get(a,"attr-layerid")})),c&&(v.initLastFocusNode(this.domNode,c),a="legend_".concat(g),(a=
e.byId(a))&&b.contains(a,"legendOn"))))if(d=z(".groupItemTitle",a),f=d.length){if(c=d[f-1],v.initLastFocusNode(this.domNode,c),d=c.nextSibling,b.contains(d,"groupOn")&&(a=z(".featureItem",a),d=a.length))c=a[d-1],v.initLastFocusNode(this.domNode,c)}else if(a=z(".featureItem",a),d=a.length)c=a[d-1],v.initLastFocusNode(this.domNode,c)},updateExpand:function(a,c){if("undefined"!==typeof a){var g,d;-1<a.id.indexOf("rec_")&&(g=a.id.replace("rec_",""),d=e.byId("exp_"+g));c?(a&&(m.addClass(a,"recDefault"),
((c=e.byId("recIcon_"+g))&&b.contains(c,"sub-active")||!c)&&m.addClass(a,"inActive")),d&&(b.contains(d,"expand-empty")||m.addClass(d,"expandInActive"))):(a&&(m.removeClass(a,"recDefault"),m.removeClass(a,"inActive")),d&&(b.contains(d,"expand-empty")||m.removeClass(d,"expandInActive")))}},getDisplayString:function(a,c,b,d,e,f){var g="",h={},n="";if(0<d.fields.length){var l=c.li&&c.li.fields?c.li.fields:c.fields;B.forEach(d.fields,k.hitch(this,function(d){for(var e in b){var k=f?b[e]:e;if(k===d.name){e=
this._getFormattedValue(a,k,c,l);var m=this._getRawFeatureValue(a,k);h[k]=this._checkAliasName(l,k);n=""===n?m:n;m=(k="undefined"!==typeof d.label)?""===d.label.trim()?"":": ":"";g+=(k?d.label:"")+m+e+" - ";break}}}))}return{displayString:g,aliasNames:h,firstValue:n}},_getRawFeatureValue:function(a,c){a=a.attributes[c];return"undefined"===typeof a||null===a?"":a},_getFormattedValue:function(a,c,b,d){var e=a.attributes[c],e="undefined"===typeof e||null===e?"":e,g,f=this._getInfoTemplate(b);f&&(f.info&&
f.info.fieldInfos?g=f.info.fieldInfos:f._fieldsMap&&(g=f._fieldsMap));var h;g&&Array.isArray(g)&&g.hasOwnProperty("length")&&(h=this._getFieldByName(g,c));if(d=this._getFieldByName(d,c))g=this._checkIntField(d),f="ClusterLayer"===b.type?!1:this._checkDomainField(d),a="ClusterLayer"===b.type?!1:this._checkDomainAndSubtype(b.layerDefinition,c,a.attributes,b),e=this._checkDateField(d)?this.formatDateValue(e,h):f||a?this.formatDomainValue(e,f,a):g?this.formatNumberValue(e,h):e;return e},_getFieldByName:function(a,
c){if(a){var b=a.filter(function(b){return b.name===c||b.fieldName===c||a.hasOwnProperty(b)&&a[b].fieldName===c});if(b&&0<b.length)return b[0]}},_getInfoTemplate:function(a){var c=a.infoTemplate;c||(a.layerObject&&a.layerObject.infoTemplate?c=a.layerObject.infoTemplate:a.li&&a.li.infoTemplate&&(c=a.li.infoTemplate));if(!c&&"undefined"!==typeof a.li.subLayerId){var b=a.layerObject.infoTemplates;b&&b.hasOwnProperty(a.li.subLayerId)&&(c=b[a.li.subLayerId].infoTemplate)}return c},formatNumberValue:function(a,
c){var b=a;isNaN(a)||""===a||(b=v.localizeNumberByFieldInfo(a,c&&c.format?c:void 0));return b||""},formatDomainValue:function(a,c,b){if(b)return b;if(c&&c.codedValues)for(c=c.codedValues,b=0;b<c.length;b++){var d=c[b];if(d.code===a)return d.name}},formatDateValue:function(a,c){return a?(c=c&&c.format?c:void 0,a=new Date(parseInt(a,10)),c?v.localizeDateByFieldInfo(a,c):v.localizeDate(a)):""},_checkAliasName:function(a){return"undefined"!==typeof a.alias?a.alias:!1},_checkDomainField:function(a){return"undefined"!==
typeof a.domain?a.domain:!1},_checkDomainAndSubtype:function(a,c,b,d){return a&&c&&b&&(a=v.getDisplayValueForCodedValueOrSubtype(d.layerObject&&d.layerObject.renderer?d.layerObject:a,c,b))&&a.isCodedValueOrSubtype&&"undefined"!==typeof a.displayValue?a.displayValue:!1},_checkDateField:function(a){return"esriFieldTypeDate"===a.type},_checkIntField:function(a){return-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(a.type)},_checkDisplayField:function(a,
c){var b=!0;if(a)for(var d=0;d<a.length;d++){if(a[d].name===c)return a[d];b=!1}return b},flashGraphics:function(a){for(var c=0;c<a.length;c++)this._flashFeature(a[c])},_flashFeature:function(a){var c;if(a.geometry){var b=H.fromHex(this._styleColor),d=k.clone(b);d.a=.4;switch(a.geometry.type){case "point":c=new N(N.STYLE_CIRCLE,15,new X(X.STYLE_SOLID,b,1),d);break;case "polyline":c=new X(X.STYLE_SOLID,b,3);break;case "polygon":c=new f(f.STYLE_DIAGONAL_CROSS,new X(X.STYLE_SOLID,b,2),d)}}a=new T(a.geometry,
c);this.map.graphics.add(a);if(c=a.getDojoShape())Z.animateStroke({shape:c,duration:900,color:{start:c.strokeStyle.color,end:c.strokeStyle.color},width:{start:25,end:0}}).play(),setTimeout(this._clearFeature,1075,a)},_clearFeature:function(a){a.getLayer().remove(a)},_panToFeature:function(a){if(a.geometry){var c=a.geometry;if("polyline"===c.type)var b=c.paths[Math.ceil(c.paths.length/2)-1],b=b[Math.ceil((b.length-1)/2)],c=new ca(b[0],b[1],c.spatialReference);"point"!==c.type&&(c=c.getExtent().getCenter());
this._pan(a,c).then(k.hitch(this,function(){this._flashFeature(a);if(a._layer&&a._layer.infoTemplate||a.infoTemplate)this.map.infoWindow.setFeatures([a]),this.map.infoWindow.select(0),this.map.infoWindow.show(c)}))}},_pan:function(a,c){var b=new y;this.showAllFeatures&&!this.map.extent.contains(a.geometry)?this.map.centerAt(c).then(function(a){b.resolve(a)}):b.resolve(void 0);return b},_getQuery:function(a,c,b){var d=a.layerObject,e=new fa;e.geometry=this.showAllFeatures?null:this.map.extent;e.outFields=
c;e.returnGeometry=b;c=["collection","kml","geo_rss"];a.selfType&&-1<c.indexOf(a.selfType)||!d.url?this.showAllFeatures&&d&&d.fullExtent&&(e.geometry=d.fullExtent):e.where=a.filter?a.filter:"1\x3d1";return e},_queryWFS:function(a){return a.filter(k.hitch(this,function(a){return this.map.extent.intersects(a.geometry)}))},countFeatures:function(a){var b=new y;if(this.hidePanel)b.resolve(a);else{var e=a.layerObject,d="undefined"!==typeof a.visible?a.visible:e.visible,f=a.visScaleRange,h=this.config.countEnabled?
a.node:a.legendNode,l=this._getQuery(a);if(e.queryCount&&e.visible)(function(a){e.queryCount(l,k.hitch(this,function(c){if(h){var d;this.config.countEnabled?(h.innerHTML=v.localizeNumber(c),d=h.parentNode):d=h.previousSibling;this.updateExpand(d,f?0===c:!0)}b.resolve(a)}))}).call(this,a);else if(a&&a.li&&a.li.url&&d&&(-1<a.li.url.indexOf("MapServer")||-1<a.li.url.indexOf("FeatureServer"))&&-1===a.li.url.indexOf("WFSServer"))(function(a){(new da(a.li.url)).executeForIds(l).then(k.hitch(this,function(c){if(h){var d=
c?c.length:0;this.config.countEnabled?(h.innerHTML=v.localizeNumber(d),c=h.parentNode):c=h.previousSibling;this.updateExpand(c,f?0===d:!0)}b.resolve(a)}))}).call(this,a);else if(d&&("WFSLayer"===a.type||a.li&&a.li.url&&-1<a.li.url.indexOf("WFSServer"))){if(h){var m=this._queryWFS(e&&e.graphics?e.graphics:[]).length;this.config.countEnabled?(h.innerHTML=v.localizeNumber(m),d=h.parentNode):d=h.previousSibling;this.updateExpand(d,f?0===m:!0);b.resolve(a)}}else b.resolve(a)}return b}})});