// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"jimu/dijit/Report":function(){define("dojo/_base/declare jimu/BaseWidget jimu/utils dojo/Evented ./PageUtils dojo/text!./templates/ReportTemplate.html dojo/_base/lang dojo/_base/array dojo/_base/window dojo/dom-construct dojo/dom-class dojo/dom-style dojo/dom dojo/string dojo/on esri/tasks/PrintParameters esri/tasks/PrintTemplate esri/tasks/PrintTask dijit/focus dojo/query dojo/dom-attr".split(" "),function(u,r,t,v,n,k,g,d,l,q,x,b,a,m,f,c,e,h,B,E,w){return u([r,v],{baseClass:"jimu-report",
_printService:null,_printWindow:null,_sizeInPixels:{},_windowOpenedTimer:null,_shownUnableToPrintMapMsg:!1,printTaskUrl:null,reportLogo:"",reportLayout:{},maxNoOfCols:3,styleSheets:[],styleText:"",constructor:function(){this.inherited(arguments);this._sizeInPixels={};this.printTaskUrl=null;this.reportLayout={};this.styleSheets=[]},postMixInProperties:function(){this.nls=g.mixin(window.jimuNls.common,window.jimuNls.report)},postCreate:function(){var a;a={pageSize:n.PageSizes.A4,orientation:n.Orientation.Portrait};
this.inherited(arguments);this.setReportLayout(this.reportLayout,a);this.reportLayout.dpi=96;this.printTaskUrl&&this._createPrintTask()},setReportLayout:function(a,b){b||(b=this.reportLayout);this._validateParameters(a)?this.reportLayout=g.mixin(b,a):this.reportLayout=b},setMapLayout:function(a){var b;b=this.reportLayout.pageSize.MapLayout?this.reportLayout.pageSize.MapLayout:"MAP_ONLY";if("MAP_ONLY"===b)a.exportOptions={dpi:this.reportLayout.dpi},this.reportLayout.orientation.Type===n.Orientation.Landscape.Type&&
this.reportLayout.pageSize!==n.PageSizes.Custom?(a.exportOptions.width=this._sizeInPixels.Height,a.exportOptions.height=this._sizeInPixels.Width):(a.exportOptions.width=this._sizeInPixels.Width,a.exportOptions.height=this._sizeInPixels.Height);else if(b&&n.PageSizes[b])b+=" "+this.reportLayout.orientation.Type;else{var e=[];Object.keys(n.PageSizes).forEach(function(a){e.push(n.PageSizes[a].MapLayout)});-1<e.indexOf(b)&&(b+=" "+this.reportLayout.orientation.Type)}a.layout=b;return a},_validateParameters:function(){return this.reportLayout.pageSize!==
n.PageSizes.Custom||this.reportLayout.size?!0:!1},_createPrintTask:function(){this._printService=new h(this.printTaskUrl,{async:!1})},_createPrintMapParameters:function(a){var b,f;f=new e;a.printTemplate?(f=a.printTemplate,f.format?(b=f.format.toLowerCase(),"png32"!==b&&"png8"!==b&&"jpg"!==b&&"gif"!==b&&(f.format="jpg")):f.format="jpg"):(f=this.setMapLayout(f),f.layoutOptions={customTextElements:[{Date:""}]},f.preserveScale=!0,f.showAttribution=!0,f.format="jpg");b=new c;b.map=a.map;b.template=f;
return b},print:function(b,e){var f,h;this._printService?(this._shownUnableToPrintMapMsg=!1,f=screen.width/2,h=screen.height/1.5,f=11===t.has("ie")?"toolbar\x3dno, location\x3dno, directories\x3dno, status\x3dyes, menubar\x3dno,scrollbars\x3dyes, resizable\x3dyes, width\x3d"+f+", height\x3d"+h+", top\x3d"+(screen.height/2-h/2)+", left\x3d"+(screen.width/2-f/2):null,h=t.detectUserAgent(),(h.browser.hasOwnProperty("firefox")&&h.browser.firefox||h.os.hasOwnProperty("ipad")&&h.os.ipad||h.os.hasOwnProperty("iphone")&&
h.os.iphone)&&this._printWindow&&this._printWindow.close(),this._printWindow=window.open("","_blank",f,!1),this._windowOpenedTimer&&clearInterval(this._windowOpenedTimer),this._windowOpenedTimer=setInterval(g.hitch(this,function(){this._printWindow.closed&&(clearInterval(this._windowOpenedTimer),this.emit("report-window-closed"))}),500),this._printWindow.focus(),setTimeout(g.hitch(this,function(){l.withDoc(this._printWindow.document,g.hitch(this,function(){this._printWindow.document.open("text/html",
"replace");this._printWindow.document.write(k);window.isRTL&&x.add(a.byId("reportBody"),"jimu-rtl");(this.styleSheets&&0<this.styleSheets.length||this.styleText&&""!==this.styleText)&&this._addExternalStyleSheets();this._setPageSize();this._setButtonLabels();this._setReportSizeMessage();this._setReportLogo();this._setReportTitle(b);this._setReportData(e);this._setFootNotes();this._setAccessibility();this._printWindow.document.close()}))}),500)):this.emit("reportError")},_addExternalStyleSheets:function(){var b=
a.byId("reportHead");b&&(d.forEach(this.styleSheets,g.hitch(this,function(a){q.create("link",{rel:"stylesheet",type:"text/css",href:a},b)})),this.styleText&&q.create("style",{type:"text/css",innerHTML:this.styleText},b))},_setPageSize:function(){var e,f,h;h=a.byId("reportMain");this.reportLayout&&(e=this.reportLayout.pageSize,this.reportLayout.pageSize===n.PageSizes.Custom&&this.reportLayout.size&&(e=this.reportLayout.size),e=n.getPageSizeInPixels(e,this.reportLayout.dpi));f=this.reportLayout.orientation.Type===
n.Orientation.Landscape.Type&&this.reportLayout.pageSize!==n.PageSizes.Custom?e.Height:e.Width;this._sizeInPixels=e;b.set(h,{width:f+"px"})},_setReportData:function(b){var e=a.byId("reportData"),f=a.byId("showErrorButton");f.innerHTML=this.nls.unableToPrintMapMsg;e&&d.forEach(b,g.hitch(this,function(a){var b=q.create("div",{},e);a.addPageBreak&&x.add(b,"esriCTPageBreak");"table"===a.type?this._formatAndRenderTables(b,a):"html"===a.type?this._renderHTMLData(b,a):"map"===a.type?(a.title&&this._addSectionTitle(a.title,
b),x.add(b,"esriCTReportMap esriCTReportMapWait"),a.extent&&a.data.map.setExtent(a.extent),this._executePrintTask(a,b,f)):"note"===a.type&&this._createReportNote(b,a)}))},_setFootNotes:function(){var b,e;(e=a.byId("footNotes"))&&this.footNotes&&(b=t.sanitizeHTML(this.footNotes?this.footNotes:""),e.innerHTML=t.fieldFormatter.getFormattedUrl(b))},_setReportLogo:function(){var e,h,c,D;(e=a.byId("reportLogo"))&&this.reportLogo&&(x.remove(e,"esriCTHidden"),e.src=this.reportLogo,w.set(e,"alt",this.nls.image),
D=a.byId("reportHeader"),h=a.byId("reportMain"),c=a.byId("printTitleDiv"),window.isRTL&&q.place(c,D,"first"),h&&c&&(e.complete&&b.set(c,{width:h.clientWidth-e.clientWidth-51+"px"}),this.own(f(e,"load",g.hitch(this,function(){setTimeout(g.hitch(this,function(){b.set(c,{width:h.clientWidth-e.clientWidth-51+"px"})}),300)})))))},_setReportTitle:function(b){var e=a.byId("reportTitle");e&&b&&(e.value=b);w.set(e,"aria-label",this.nls.title)},_createReportNote:function(a,b){var e,h="",c;b.title&&(h=b.title);
h=this._addSectionTitle(h,a);x.add(h,"esriCTNotesTitle");e=q.create("textarea",{"class":"esriCTReportNotes",placeholder:this.nls.notesHint,rows:5,tabindex:"0",role:"textbox","aria-label":this.nls.notesHint},a);c=q.create("p",{"class":"esriCTReportNotesParagraph"},a);x.add(a,"esriCTNotesContainer");b.defaultText&&(e.value=b.defaultText);this.own(f(e,"keydown, change",function(){e.style.height="auto";c.innerHTML=t.sanitizeHTML(e.value?e.value:"");e.style.height=e.scrollHeight+"px"}))},_setReportSizeMessage:function(){var b,
e;this.reportLayout.pageSize===n.PageSizes.Custom&&this.reportLayout.size?(b=this.reportLayout.size,e=this.reportLayout.pageSize):(b=this.reportLayout.pageSize,e=this.reportLayout.pageSize.SizeName?this.reportLayout.pageSize.SizeName:this.reportLayout.SizeName);b=this.reportLayout.orientation.Type===n.Orientation.Landscape.Type&&this.reportLayout.pageSize!==n.PageSizes.Custom?" ("+b.Height+"'' X "+b.Width+"'') ":" ("+b.Width+"'' X "+b.Height+"'') ";a.byId("reportBarMsg").innerHTML=m.substitute(this.nls.reportDimensionsMsg,
{paperSize:e+b+this.reportLayout.orientation.Text})},_setButtonLabels:function(){var b=a.byId("printButton");b.innerHTML=this.nls.printButtonLabel;b.title=this.nls.printButtonLabel;b=a.byId("closeButton");b.innerHTML=this.nls.close;b.title=this.nls.close},_executePrintTask:function(a,b,e){a=this._createPrintMapParameters(a);this._printService.execute(a,g.hitch(this,function(a){b&&(x.remove(b,"esriCTReportMapWait"),a=q.create("img",{src:a.url,"class":"esriCTReportMapImg","aria-label":this.nls.mapArea},
b),this.reportLayout.orientation.Type===n.Orientation.Landscape.Type&&x.add(a,"esriCTReportLandscapeMapImg"));this.emit("report-export-task-completed")}),g.hitch(this,function(){x.replace(b,"esriCTReportMapFail","esriCTPageBreak esriCTReportMapWait");this._shownUnableToPrintMapMsg||(this._shownUnableToPrintMapMsg=!0,e.click());this.emit("report-export-task-failed")}))},_renderHTMLData:function(a,b){a=q.create("div",{"class":"esriCTHTMLData"},a);b.title&&this._addSectionTitle(b.title,a);q.create("div",
{innerHTML:b.data},a)},_addSectionTitle:function(a,b){a=t.sanitizeHTML(a?a:"");return q.create("div",{innerHTML:a,"class":a?"esriCTSectionTitle":""},b)},_formatAndRenderTables:function(a,b){var e=b.data,f,h,c,I,g=this.maxNoOfCols;e.maxNoOfCols&&(g=e.maxNoOfCols);e.cols.length>g&&2>=e.cols.length-g&&(g=e.cols.length);f=0;for(h=e.cols.length;f<h;f+=g){var d={cols:[],rows:[]},y=f+g,m=!1;d.title=0===f?b.title:"";c=e.cols.length-y;2>=c&&0<c&&(y+=c,m=!0);c=e.cols.slice(f,y);I=[];for(var l=0;l<e.rows.length;l++)I.push(e.rows[l].slice(f,
y));d.cols=c;d.rows=I;this._renderTable(q.create("div",{},a),d,b.data.showRowIndex);if(m)break}},_renderTable:function(a,b,e){var f,h;this._addSectionTitle(b.title,a);a=q.create("table",{cellpadding:5,style:{width:"100%"},"class":"esriCTTable"},a);f=q.create("tbody",{},a);h=q.create("tr",{},f);e&&q.create("th",{innerHTML:"#",style:{width:"20px"}},h);d.forEach(b.cols,g.hitch(this,function(a){q.create("th",{innerHTML:a},h)}));d.forEach(b.rows,g.hitch(this,function(a,b){var h;h=q.create("tr",{},f);e&&
q.create("td",{innerHTML:b+1,style:{"word-wrap":"normal"}},h);d.forEach(a,g.hitch(this,function(a){a=t.fieldFormatter.getFormattedUrl(a);q.create("td",{innerHTML:a},h)}))}))},_setAccessibility:function(){this._setFirstFocusNode();this._setLastFocusNode();this._focusFirstNodeOfReport()},_setFirstFocusNode:function(){var b=a.byId("reportTitle");""!==b&&null!==b&&void 0!==b&&t.initFirstFocusNode(this._printWindow.document,b)},_setLastFocusNode:function(){var a=E(".esriCTReportNotes",this._printWindow.document);
""!==a&&null!==a&&void 0!==a&&0<a.length?t.initLastFocusNode(this._printWindow.document,a[0]):(a=E(".esriCTLocaleDateInputTitle",this._printWindow.document),""!==a&&null!==a&&void 0!==a&&0<a.length?t.initLastFocusNode(this._printWindow.document,a[0]):(a=E(".esriCTAOIInputArea",this._printWindow.document),""!==a&&null!==a&&void 0!==a&&0<a.length&&t.initLastFocusNode(this._printWindow.document,a[0])))},_focusFirstNodeOfReport:function(){var b=a.byId("reportTitle");""!==b&&null!==b&&void 0!==b&&(B.curNode&&
B.curNode.blur(),B.focus(b))}})})},"jimu/dijit/PageUtils":function(){define([],function(){var u={};u.Orientation={Landscape:{Type:"Landscape",Text:window.jimuNls.report.landscape},Portrait:{Type:"Portrait",Text:window.jimuNls.report.portrait}};u.PageSizes={A0:{Height:46.8,Width:33.1,SizeName:window.jimuNls.report.a0,MapLayout:"MAP_ONLY"},A1:{Height:33.1,Width:23.4,SizeName:window.jimuNls.report.a1,MapLayout:"MAP_ONLY"},A2:{Height:23.4,Width:16.5,SizeName:window.jimuNls.report.a2,MapLayout:"MAP_ONLY"},
A3:{Height:16.5,Width:11.7,SizeName:window.jimuNls.report.a3,MapLayout:"A3"},A4:{Height:11.7,Width:8.3,SizeName:window.jimuNls.report.a4,MapLayout:"A4"},A5:{Height:8.3,Width:5.8,SizeName:window.jimuNls.report.a5,MapLayout:"MAP_ONLY"},Letter_ANSI_A:{Height:11,Width:8.5,SizeName:window.jimuNls.report.letter+" "+window.jimuNls.report.ansi_a,MapLayout:"Letter ANSI A"},Tabloid_ANSI_B:{Height:17,Width:11,SizeName:window.jimuNls.report.tabloid+" "+window.jimuNls.report.ansi_b,MapLayout:"Tabloid ANSI B"},
ANSI_C:{Height:22,Width:17,SizeName:window.jimuNls.report.ansi_c,MapLayout:"MAP_ONLY"},ANSI_D:{Height:34,Width:22,SizeName:window.jimuNls.report.ansi_d,MapLayout:"MAP_ONLY"},ANSI_E:{Height:44,Width:34,SizeName:window.jimuNls.report.ansi_e,MapLayout:"MAP_ONLY"},Legal:{Height:14,Width:8.5,SizeName:window.jimuNls.report.legal,MapLayout:"MAP_ONLY"},Custom:window.jimuNls.common.custom};u.getPageSizeInPixels=function(r,t){return{Height:r.Height*t,Width:r.Width*t}};return u})},"esri/tasks/PrintParameters":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(u,r,t,v){u=u(null,{declaredClass:"esri.tasks.PrintParameters",map:null,template:null,outSpatialReference:null,extraParameters:null});t("extend-esri")&&r.setObject("tasks.PrintParameters",u,v);return u})},"esri/tasks/PrintTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(u,r,t,v){u=u(null,{declaredClass:"esri.tasks.PrintTemplate",label:null,exportOptions:{width:800,height:1100,dpi:96},layoutOptions:null,
format:"PNG32",layout:"MAP_ONLY",outScale:0,preserveScale:!0,forceFeatureAttributes:!1,showAttribution:null,showLabels:!0});t("extend-esri")&&r.setObject("tasks.PrintTemplate",u,v);return u})},"esri/tasks/PrintTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../lang ../layerUtils ../deferredUtils ../Color ../request ../urlUtils ../geometry/Polygon ../renderers/SimpleRenderer ../symbols/FillSymbol ./Geoprocessor ./PrintTemplate ./Task dojo/dom-attr dojo/dom-construct dojox/gfx/_base dojox/gfx/canvas dojox/json/query dojo/has!extend-esri?./PrintParameters dojo/has!extend-esri?./LegendLayer".split(" "),
function(u,r,t,v,n,k,g,d,l,q,x,b,a,m,f,c,e,h,B,E,w,z,F,G){u=u(B,{declaredClass:"esri.tasks.PrintTask",constructor:function(a,b){this.url=a;this.printGp=new e(this.url);this._handler=r.hitch(this,this._handler);b&&b.async&&(this.async=!0);this._colorEvaluator=G("$..color")},async:!1,_vtlExtent:null,_cimVersion:null,_is11xService:!1,_loadGpServerMetadata:!0,execute:function(a,e,f){if(!this._loadGpServerMetadata)return this._execute(a,e,f);var h=new n(q._dfdCanceller),c=this._url.path,g=c.lastIndexOf("/GPServer/");
0<g&&(c=c.slice(0,g+9));h._pendingDfd=b({url:c,callbackParamName:"callback",content:r.mixin({},this._url.query,{f:"json"})}).then(r.hitch(this,function(b){this._loadGpServerMetadata=!1;this.async="esriExecutionTypeAsynchronous"===b.executionType;this._cimVersion=b.cimVersion;this._is11xService=!!this._cimVersion;h._pendingDfd=this._execute(a);return h._pendingDfd})).then(r.hitch(this,function(a){this._successHandler([a],null,e,h)})).otherwise(function(a){f&&f(a);h.errback(a)});return h},_handler:function(a,
b,e,f,h){try{var c;this.async?"esriJobSucceeded"===a.jobStatus?this.printGp.getResultData(a.jobId,"Output_File",r.hitch(this,function(a){c=a.value;this._successHandler([c],"onComplete",e,h)})):this._errorHandler(Error(a.jobStatus),f,h):(c=a[0].value,this._successHandler([c],"onComplete",e,h))}catch(y){this._errorHandler(y,f,h)}},_execute:function(a,b,e){var f=this._handler,c=this._errorHandler,g=a.template||new h;g.hasOwnProperty("showLabels")||(g.showLabels=!0);var y=g.exportOptions,l;y&&(l={outputSize:[y.width,
y.height],dpi:y.dpi});var y=g.layoutOptions,m,J=[];if(y){this.legendAll=!1;y.legendLayers?t.forEach(y.legendLayers,function(a){var b={};b.id=a.layerId;a.subLayerIds&&(b.subLayerIds=a.subLayerIds);J.push(b)}):this.legendAll=!0;var A,D;if("Miles"===y.scalebarUnit||"Kilometers"===y.scalebarUnit)A="esriKilometers",D="esriMiles";else if("Meters"===y.scalebarUnit||"Feet"===y.scalebarUnit)A="esriMeters",D="esriFeet";m={esriMiles:"mi",esriKilometers:"km",esriFeet:"ft",esriMeters:"m"};m={titleText:y.titleText,
authorText:y.authorText,copyrightText:y.copyrightText,customTextElements:y.customTextElements,scaleBarOptions:{metricUnit:A,metricLabel:m[A],nonMetricUnit:D,nonMetricLabel:m[D]},legendOptions:{operationalLayers:J}}}A=this._getPrintDefinition(a.map,g);a.outSpatialReference&&(A.mapOptions.spatialReference=a.outSpatialReference.toJson());a.template&&d.isDefined(a.template.showAttribution)&&(A.mapOptions.showAttribution=a.template.showAttribution);r.mixin(A,{exportOptions:l,layoutOptions:m});this.allLayerslegend&&
r.mixin(A.layoutOptions,{legendOptions:{operationalLayers:this.allLayerslegend}});if(A.operationalLayers){l=A.operationalLayers;var k,B=function(a){return d.fixJson(r.mixin(a,{type:"esriSLS",cap:void 0,join:void 0,meterLimit:void 0}))},w=/[\u4E00-\u9FFF\u0E00-\u0E7F\u0900-\u097F\u3040-\u309F\u30A0-\u30FF\u31F0-\u31FF]/,C=/[\u0600-\u06FF]/,E=function(a){var b=a.text,e=(a=a.font)&&a.family&&a.family.toLowerCase();b&&a&&("arial"===e||"arial unicode ms"===e)&&(a.family=w.test(b)?"Arial Unicode MS":"Arial",
"normal"!==a.style&&C.test(b)&&(a.family="Arial Unicode MS"))};for(m=0;m<l.length;m++)if(l[m].featureCollection&&l[m].featureCollection.layers)for(D=0;D<l[m].featureCollection.layers.length;D++){var x=l[m].featureCollection.layers[D];x.layerDefinition&&x.layerDefinition.drawingInfo&&x.layerDefinition.drawingInfo.renderer&&x.layerDefinition.drawingInfo.renderer.symbol&&(k=x.layerDefinition.drawingInfo.renderer,"esriCLS"===k.symbol.type?k.symbol=B(k.symbol):"esriTS"===k.symbol.type?E(k.symbol):k.symbol.outline&&
"esriCLS"===k.symbol.outline.type&&(k.symbol.outline=B(k.symbol.outline)));if(x.featureSet&&x.featureSet.features)for(y=0;y<x.featureSet.features.length;y++)k=x.featureSet.features[y],k.symbol&&("esriCLS"===k.symbol.type?k.symbol=B(k.symbol):"esriTS"===k.symbol.type?E(k.symbol):k.symbol.outline&&"esriCLS"===k.symbol.outline.type&&(k.symbol.outline=B(k.symbol.outline)))}}g={Web_Map_as_JSON:v.toJson(d.fixJson(A)),Format:g.format,Layout_Template:g.layout};a.extraParameters&&(g=r.mixin(g,a.extraParameters));
var G=new n(q._dfdCanceller);a=function(a,h){f(a,h,b,e,G)};A=function(a){c(a,e,G)};G._pendingDfd=this.async?this.printGp.submitJob(g,a,null,A):this.printGp.execute(g,a,A);return G},onComplete:function(){},_createMultipointLayer:function(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}},_createPolygonLayer:function(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",
drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}},_createPointLayer:function(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}},_createPolylineLayer:function(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}},_convertSvgSymbol:function(a){if(!(8>=
k("ie")||!a.path&&"image/svg+xml"!==a.contentType)){var b,e=F.createSurface(w.create("div"),1024,1024);b="image/svg+xml"===a.contentType?e.createObject(F.Image,{src:"data:image/svg+xml;base64,"+a.imageData,width:z.pt2px(a.width),height:z.pt2px(a.height),x:0,y:0}):e.createObject(F.Path,a.path).setFill(a.color).setStroke(a.outline);"pendingRender"in e&&e._render(!0);var f=e.rawNode.getContext("2d"),h=Math.ceil(b.getBoundingBox().width),c=Math.ceil(b.getBoundingBox().height);b=f.getImageData(b.getBoundingBox().x,
b.getBoundingBox().y,h,c);f.canvas.width=h;f.canvas.height=c;f.putImageData(b,0,0);f=f.canvas.toDataURL("image/png");a={type:"esriPMS",imageData:f.substr(22,f.length),angle:a.angle,contentType:"image/png",height:a.size?a.size:z.px2pt(c),width:a.size?h/c*a.size:z.px2pt(h),xoffset:a.xoffset,yoffset:a.yoffset};e.destroy();return a}},_convertSvgRenderer:function(a){"simple"===a.type&&a.symbol&&(a.symbol.path||"image/svg+xml"===a.symbol.contentType)?a.symbol=this._convertSvgSymbol(a.symbol):"uniqueValue"===
a.type?(a.defaultSymbol&&(a.defaultSymbol.path||"image/svg+xml"===a.defaultSymbol.contentType)&&(a.defaultSymbol=this._convertSvgSymbol(a.defaultSymbol)),a.uniqueValueInfos&&t.forEach(a.uniqueValueInfos,function(a){if(a.symbol.path||"image/svg+xml"===a.symbol.contentType)a.symbol=this._convertSvgSymbol(a.symbol)},this)):"classBreaks"===a.type&&(a.defaultSymbol&&(a.defaultSymbol.path||"image/svg+xml"===a.defaultSymbol.contentType)&&(a.defaultSymbol=this._convertSvgSymbol(a.defaultSymbol)),a.classBreakInfos&&
t.forEach(a.classBreakInfos,function(a){if(a.symbol.path||"image/svg+xml"===a.symbol.contentType)a.symbol=this._convertSvgSymbol(a.symbol)},this))},_createFeatureCollection:function(a,b,e,f){var h=this._createPolygonLayer(),c=this._createPolylineLayer(),y=this._createPointLayer(),g=this._createMultipointLayer(),l=this._createPointLayer();l.layerDefinition.name="textLayer";delete l.layerDefinition.drawingInfo;if("esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass)h.layerDefinition.name=
c.layerDefinition.name=y.layerDefinition.name=g.layerDefinition.name=r.getObject("arcgisProps.title",!1,a)||a.name||a.id;var d=a.renderer&&"esri.renderer.SimpleRenderer"===a.renderer.declaredClass;if(!a.renderer||a.renderer.valueExpression||r.isFunction(a.renderer.attributeField))delete h.layerDefinition.drawingInfo,delete c.layerDefinition.drawingInfo,delete y.layerDefinition.drawingInfo,delete g.layerDefinition.drawingInfo;else{var A=a.renderer.toJson({useLegacyRotationProperties:!0});if("temporal"===
A.type){var A={latestObservationRenderer:A.latestObservationRenderer,trackLinesRenderer:A.trackRenderer,observationAger:A.observationAger,renderer:A.observationRenderer},I={};a._trackIdField&&(I.trackIdField=a._trackIdField);a._startTimeField&&(I.startTimeField=a._startTimeField);a._endTimeField&&(I.endTimeField=a._endTimeField);h.layerDefinition.drawingInfo=A;h.layerDefinition.timeInfo=I;c.layerDefinition.drawingInfo=A;c.layerDefinition.timeInfo=I;y.layerDefinition.drawingInfo=A;y.layerDefinition.timeInfo=
I;g.layerDefinition.drawingInfo=A;g.layerDefinition.timeInfo=I}else h.layerDefinition.drawingInfo.renderer=A,c.layerDefinition.drawingInfo.renderer=A,y.layerDefinition.drawingInfo.renderer=A,g.layerDefinition.drawingInfo.renderer=A}A=a.fields;A||!a.renderer||a.renderer.valueExpression||r.isFunction(a.renderer.attributeField)||("esri.renderer.ClassBreaksRenderer"===a.renderer.declaredClass?(A=[{name:a.renderer.attributeField,type:"esriFieldTypeDouble"}],a.renderer.normalizationField&&A.push({name:a.renderer.normalizationField,
type:"esriFieldTypeDouble"})):"esri.renderer.UniqueValueRenderer"===a.renderer.declaredClass&&(A=[{name:a.renderer.attributeField,type:"esriFieldTypeString"}],a.renderer.attributeField2&&A.push({name:a.renderer.attributeField2,type:"esriFieldTypeString"}),a.renderer.attributeField3&&A.push({name:a.renderer.attributeField3,type:"esriFieldTypeString"})));A&&(h.layerDefinition.fields=A,c.layerDefinition.fields=A,y.layerDefinition.fields=A,g.layerDefinition.fields=A);A=a.graphics;a.isFeatureReductionActive&&
a.isFeatureReductionActive()&&(A=a.getSingleGraphics());var I=A.length,q,k;for(k=0;k<I;k++){var B=A[k];if(!1!==B.visible&&B.geometry){q=B.toJson();q.symbol&&q.symbol.outline&&q.symbol.outline.color&&q.symbol.outline.color[3]&&!this._is11xService&&(q.symbol.outline.color[3]=255);if(a.renderer&&!q.symbol&&(r.isFunction(a.renderer.attributeField)||a.renderer.valueExpression||this._isFeatureCollectionRequired(a.renderer,a)||"esri.renderer.DotDensityRenderer"===a.renderer.declaredClass||e)){e=e||a.renderer;
var w=null;try{w=e.getSymbol(B)}catch(N){}if(!w)continue;q.symbol=w.toJson();this._isFeatureCollectionRequired(e,a)&&this._applyVisualVariables(q.symbol,{renderer:e,graphic:B,symbol:w,mapResolution:b&&b.getResolutionInMeters(),mapScale:b&&b.getScale()})}q.symbol&&(q.symbol.path||"image/svg+xml"===q.symbol.contentType?q.symbol=this._convertSvgSymbol(q.symbol):q.symbol.text&&delete q.attributes);switch(B.geometry.type){case "polygon":h.featureSet.features.push(q);break;case "polyline":c.featureSet.features.push(q);
break;case "point":q.symbol&&q.symbol.text?l.featureSet.features.push(q):y.featureSet.features.push(q);break;case "multipoint":g.featureSet.features.push(q);break;case "extent":q.geometry=m.fromExtent(B.geometry).toJson(),h.featureSet.features.push(q)}}}b=[];0<h.featureSet.features.length&&b.push(h);0<c.featureSet.features.length&&b.push(c);0<g.featureSet.features.length&&b.push(g);0<y.featureSet.features.length&&b.push(y);0<l.featureSet.features.length&&b.push(l);if(!b.length)return null;t.forEach(b,
function(a){var b=t.every(a.featureSet.features,function(a){return a.symbol});if(d||b)f&&f.forceFeatureAttributes||t.forEach(a.featureSet.features,function(a){delete a.attributes}),f.forceFeatureAttributes||delete a.layerDefinition.fields;b&&delete a.layerDefinition.drawingInfo});t.forEach(b,function(a){a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.renderer&&this._convertSvgRenderer(a.layerDefinition.drawingInfo.renderer)},this);return{id:a.id,opacity:a.opacity,minScale:a.minScale||
0,maxScale:a.maxScale||0,featureCollection:{layers:b}}},_getPrintDefinition:function(a,b){var e={operationalLayers:this._createOperationalLayers(a,b)},f=this._vtlExtent||a.extent,h=a.spatialReference;this._vtlExtent=null;a.spatialReference._isWrappable()&&(f=f._normalize(!0),h=f.spatialReference);f={mapOptions:{showAttribution:a.showAttribution,extent:f.toJson(),spatialReference:h.toJson()}};b.preserveScale&&r.mixin(f.mapOptions,{scale:b.outScale||a.getScale()});a.timeExtent&&r.mixin(f.mapOptions,
{time:[a.timeExtent.startTime.getTime(),a.timeExtent.endTime.getTime()]});a={};r.mixin(a,f,e);return a},_createOperationalLayers:function(b,e){var h,c,m,d,y=[],q=0;e.preserveScale&&(q=e.outScale||b.getScale());this.allLayerslegend=this.legendAll?[]:null;this._vtlExtent=null;var k=t.map(b.layerIds,b.getLayer,b);b._mapImageLyr&&k.push(b._mapImageLyr);for(h=0;h<k.length;h++)if(c=k[h],c.loaded&&c.visible&&(!q||c.isVisibleAtScale(q)))switch(m=c.declaredClass,d={id:c.id,title:r.getObject("arcgisProps.title",
!1,c)||c.id,opacity:c.opacity,minScale:c.minScale||0,maxScale:c.maxScale||0},d=r.mixin(d,this._getUrlAndToken(c)),c.getNode()&&E.get(c.getNode(),"data-reference")&&(d._isRefLayer=!0),m){case "esri.layers.ArcGISDynamicMapServiceLayer":var J=[];m=!!c._params.layers;if(c._params.dynamicLayers)m=e.outScale?c._getDynLayerObjs(e.outScale):v.fromJson(c._params.dynamicLayers),t.forEach(m,function(a){J.push({id:a.id,name:a.name,layerDefinition:a});delete a.id;delete a.name;delete a.maxScale;delete a.minScale}),
0===J.length&&(d.visibleLayers=[-1]);else if(c.supportsDynamicLayers){if(m||c.layerDefinitions||c.layerTimeOptions){var A=c.createDynamicLayerInfosFromLayerInfos(),R=null;m&&(R=c.visibleLayers);var R=l._getVisibleLayers(A,R),B=l._getLayersForScale(e.outScale||b.getScale(),A);t.forEach(A,function(a){if(!a.subLayerIds){var b=a.id;-1<t.indexOf(R,b)&&-1<t.indexOf(B,b)&&(a={source:a.source.toJson()},c.layerDefinitions&&c.layerDefinitions[b]&&(a.definitionExpression=c.layerDefinitions[b]),c.layerTimeOptions&&
c.layerTimeOptions[b]&&(a.layerTimeOptions=c.layerTimeOptions[b].toJson()),J.push({id:b,layerDefinition:a}))}});0===J.length&&(d.visibleLayers=[-1])}}else t.forEach(c.layerInfos,function(a){var b={id:a.id,layerDefinition:{}};c.layerDefinitions&&c.layerDefinitions[a.id]&&(b.layerDefinition.definitionExpression=c.layerDefinitions[a.id]);c.layerTimeOptions&&c.layerTimeOptions[a.id]&&(b.layerDefinition.layerTimeOptions=c.layerTimeOptions[a.id].toJson());(b.layerDefinition.definitionExpression||b.layerDefinition.layerTimeOptions)&&
J.push(b)}),m&&(d.visibleLayers=c.visibleLayers.length?c.visibleLayers:[-1]);J.length&&(d.layers=J);y.push(d);this.allLayerslegend&&this.allLayerslegend.push({id:c.id,subLayerIds:c.visibleLayers});break;case "esri.layers.ArcGISImageServiceLayer":d=r.mixin(d,{url:c.url,bandIds:c.bandIds,compressionQuality:c.compressionQuality,format:c.format,interpolation:c.interpolation});c.mosaicRule&&r.mixin(d,{mosaicRule:c.mosaicRule.toJson()});if(c.renderingRule||c.renderer)this._is11xService?(c.renderingRule&&
(d.renderingRule=c.renderingRule.toJson()),c.renderer&&(d.layerDefinition=d.layerDefinition||{},d.layerDefinition.drawingInfo=d.layerDefinition.drawingInfo||{},d.layerDefinition.drawingInfo.renderer=c.renderer.toJson())):(m=c.getExportImageRenderingRule())&&r.mixin(d,{renderingRule:m.toJson()});y.push(d);this.allLayerslegend&&this.allLayerslegend.push({id:c.id});break;case "esri.layers.RasterXLayer":this._is11xService&&(d=r.mixin(d,{url:c.url,bandIds:c.bandIds,interpolation:c.interpolation}),c.renderer&&
(d.layerDefinition=d.layerDefinition||{},d.layerDefinition.drawingInfo=d.layerDefinition.drawingInfo||{},d.layerDefinition.drawingInfo.renderer=c.renderer.toJson()),y.push(d),this.allLayerslegend&&this.allLayerslegend.push({id:c.id}));break;case "esri.layers.WMSLayer":d=r.mixin(d,{url:c.url,title:c.title,type:"wms",version:c.version,transparentBackground:c.imageTransparency,visibleLayers:c.visibleLayers});y.push(d);this.allLayerslegend&&this.allLayerslegend.push({id:c.id,subLayerIds:c.visibleLayers});
break;case "esri.virtualearth.VETiledLayer":m=c.mapStyle;"roadOnDemand"===m?m="Road":"aerialWithLabelsOnDemand"===m&&(m="Hybrid");d=r.mixin(d,{visibility:c.visible,type:"BingMaps"+m,culture:c.culture,key:c.bingMapsKey});y.push(d);break;case "esri.layers.OpenStreetMapLayer":d=r.mixin(d,{credits:c.copyright,type:"OpenStreetMap",url:a.getAbsoluteUrl(c.tileServers[0])});y.push(d);break;case "esri.layers.WMTSLayer":d=r.mixin(d,{url:c.url,type:"wmts",layer:c._identifier,style:c._style,format:c.format,tileMatrixSet:c._tileMatrixSetId});
y.push(d);break;case "esri.layers.MapImageLayer":m=c.getImages();t.forEach(m,function(a,b){a.visible&&a.href&&(d={id:c.id+"_image"+b,type:"image",title:c.id,minScale:c.minScale||0,maxScale:c.maxScale||0,opacity:c.opacity*a.opacity,extent:a.extent.toJson()},"data:image/png;base64,"===a.href.substr(0,22)?d.imageData=a.href.substr(22):d.url=a.href,y.push(d))});break;case "esri.layers.VectorTileLayer":delete d.url;delete d.token;if(this._is11xService&&c.currentStyleInfo.serviceUrl&&c.currentStyleInfo.styleUrl&&
(m=g.id&&g.id.findCredential(c.currentStyleInfo.styleUrl),A=g.id&&g.id.findCredential(c.currentStyleInfo.serviceUrl),!m&&!A||"2.1.0"!==this._cimVersion)){d.type="VectorTileLayer";d.styleUrl=c.currentStyleInfo.styleUrl;m&&(d.token=m.token);A&&A.token!==d.token&&(d.additionalTokens=[{url:c.currentStyleInfo.serviceUrl,token:A.token}]);y.push(d);break}d.type="image";m=this._vtlExtent||b.extent.offset(0,0);var w=e.exportOptions&&e.exportOptions.dpi||96,A={format:"png",pixelRatio:w/96};"MAP_ONLY"!==e.layout||
!e.preserveScale||e.outScale&&e.outScale!==b.getScale()||96!==w||!e.exportOptions||e.exportOptions.width%2===b.width%2&&e.exportOptions.height%2===b.height%2||(A.area={x:0,y:0,width:b.width,height:b.height},e.exportOptions.width%2!==b.width%2&&--A.area.width,e.exportOptions.height%2!==b.height%2&&--A.area.height,this._vtlExtent||(w=b.toMap({x:A.area.width,y:A.area.height}),m.update(m.xmin,w.y,w.x,m.ymax,m.spatialReference),this._vtlExtent=m));d.extent=m._normalize(!0).toJson();m=c.takeScreenshot(A);
m.isResolved()?m.then(function(a){"data:image/png;base64,"===a.dataURL.substr(0,22)&&(d.imageData=a.dataURL.substr(22))}):console.error("PrintTask: VectorTileLayer.takeScreenshot() returned an unresolved Promise");d.imageData&&y.push(d);break;case "esri.layers.WebTiledLayer":m=c.url.replace(/\$\{/g,"{");d=r.mixin(d,{type:"WebTiledLayer",urlTemplate:m,credits:c.copyright});c.subDomains&&0<c.subDomains.length&&(d.subDomains=c.subDomains);c._wmtsInfo&&(d.wmtsInfo=c._wmtsInfo);delete d.url;y.push(d);
break;default:if(c.getTileUrl||c.getImageUrl)d=r.mixin(d,{url:c.url}),y.push(d)}k=t.map(b.graphicsLayerIds,b.getLayer,b);for(h=0;h<k.length;h++)c=k[h],c.isFeatureReductionActive&&c.isFeatureReductionActive()&&(c.getSingleGraphics().length?k.splice(++h,0,c.getFeatureReductionLayer()):k[h]=c.getFeatureReductionLayer());for(h=0;h<k.length;h++)if(c=k[h],c.loaded&&c.visible&&(!q||c.isVisibleAtScale(q)))switch(m=c.declaredClass,m){case "esri.layers.CSVLayer":if(this._is11xService){d={id:c.id,url:c.url,
title:c.title,opacity:c.opacity,minScale:c.minScale||0,maxScale:c.maxScale||0,type:"CSV",locationInfo:{latitudeFieldName:c.latitudeFieldName,longitudeFieldName:c.longitudeFieldName},layerDefinition:{drawingInfo:{renderer:c.renderer&&c.renderer.toJson({useLegacyRotationProperties:!0})}}};y.push(d);break}case "esri.layers.FeatureLayer":case "esri.layers.LabelLayer":case "esri.layers.StreamLayer":if("esri.layers.LabelLayer"===m&&!e.showLabels||c.renderer&&"esri.renderer.HeatmapRenderer"===c.renderer.declaredClass)continue;
m=null;c.url&&c.renderer&&("esri.renderer.ScaleDependentRenderer"===c.renderer.declaredClass?"scale"===c.renderer.rangeType?m=c.renderer.getRendererInfoByScale(b.getScale())&&c.renderer.getRendererInfoByScale(b.getScale()).renderer:"zoom"===c.renderer.rangeType&&(m=c.renderer.getRendererInfoByZoom(b.getZoom())&&c.renderer.getRendererInfoByZoom(b.getZoom()).renderer):m=c.renderer);A=m&&"esri.layers.CSVLayer"!==c.declaredClass&&!this._isFeatureCollectionRequired(m,c)&&!m.valueExpression;w=c.isFeatureReductionActive&&
c.isFeatureReductionActive();if(m&&!w&&"esri.renderer.DotDensityRenderer"!==m.declaredClass&&"esri.layers.StreamLayer"!==c.declaredClass&&(this._is11xService||A)&&("esri.renderer.SimpleRenderer"===m.declaredClass||"esri.renderer.TemporalRenderer"===m.declaredClass||null==m.attributeField||r.isString(m.attributeField)&&c._getField(m.attributeField,!0)))if(d={id:c.id,title:r.getObject("arcgisProps.title",!1,c)||c.id,opacity:c.opacity,minScale:c.minScale||0,maxScale:c.maxScale||0,layerDefinition:{drawingInfo:{renderer:m.toJson({useLegacyRotationProperties:!0})}}},
d=r.mixin(d,this._getUrlAndToken(c)),"esri.renderer.TemporalRenderer"===m.declaredClass&&(A=d.layerDefinition.drawingInfo,A.latestObservationRenderer=A.renderer.latestObservationRenderer,A.trackLinesRenderer=A.renderer.trackRenderer,A.observationAger=A.renderer.observationAger,A.renderer=A.renderer.observationRenderer,c._trackIdField&&(d.layerDefinition.timeInfo={trackIdField:c._trackIdField})),this._convertSvgRenderer(d.layerDefinition.drawingInfo.renderer),this._is11xService||1>c.opacity||"esri.renderer.TemporalRenderer"===
m.declaredClass||this._updateLayerOpacity(d))if(c._params.source&&(m=c._params.source.toJson(),r.mixin(d.layerDefinition,{source:m})),c.getDefinitionExpression()&&r.mixin(d.layerDefinition,{definitionExpression:c.getDefinitionExpression()}),2!==c.mode)0<c.getSelectedFeatures().length&&(m=t.map(c.getSelectedFeatures(),function(a){return a.attributes[c.objectIdField]}),0<m.length&&c.getSelectionSymbol()&&r.mixin(d,{selectionObjectIds:m,selectionSymbol:c.getSelectionSymbol().toJson()}));else{m=t.map(c.getSelectedFeatures(),
function(a){return a.attributes[c.objectIdField]});if(0===m.length||!c._params.drawMode)break;r.mixin(d.layerDefinition,{objectIds:m});m=null;c.getSelectionSymbol()&&(m=new f(c.getSelectionSymbol()));r.mixin(d.layerDefinition.drawingInfo,{renderer:m&&m.toJson()})}else d=this._createFeatureCollection(c,b,null,e);else d=m&&(m.valueExpression||this._isFeatureCollectionRequired(m,c)||"esri.renderer.DotDensityRenderer"===m.declaredClass)?this._createFeatureCollection(c,b,m,e):this._createFeatureCollection(c,
b,null,e);if(!d)continue;y.push(d);this.allLayerslegend&&this.allLayerslegend.push({id:c.id});break;case "esri.layers._GraphicsLayer":case "esri.layers.GraphicsLayer":case "esri.layers.WFSLayer":d=this._createFeatureCollection(c,b,null,e);if(!d)continue;y.push(d);this.allLayerslegend&&this.allLayerslegend.push({id:c.id});break;case "esri.layers.ArcGISImageServiceVectorLayer":d={id:c.id,title:r.getObject("arcgisProps.title",!1,c)||c.id,opacity:c.opacity,minScale:c.minScale||0,maxScale:c.maxScale||
0,visibility:c.visible,symbolTileSize:c.symbolTileSize,layerDefinition:{drawingInfo:{renderer:c.renderer.toJson({useLegacyRotationProperties:!0})}}},d=r.mixin(d,this._getUrlAndToken(c)),c.mosaicRule&&r.mixin(d,{mosaicRule:c.mosaicRule.toJson()}),y.push(d),this.allLayerslegend&&this.allLayerslegend.push({id:c.id})}q&&t.forEach(y,function(a){a.minScale=0;a.maxScale=0});b.graphics&&0<b.graphics.graphics.length&&(d=this._createFeatureCollection(b.graphics,b,null,e))&&y.push(d);b._labels&&e.showLabels&&
(d=this._createFeatureCollection(b._labels,b,null,e))&&y.push(d);t.forEach(y,function(a,b,c){a._isRefLayer&&(delete a._isRefLayer,c.splice(b,1),c.push(a))});return y},_getUrlAndToken:function(a){return{token:a._getToken(),url:a._url?a._url.path:null}},_updateLayerOpacity:function(a){var b=this._colorEvaluator(a),b=t.filter(b,function(a){return r.isArray(a)&&4===a.length}),c=!0;if(b.length){var e=b[0][3],f;for(f=1;f<b.length;f++)if(e!==b[f][3]){c=!1;break}if(c)for(a.opacity=e/255,f=0;f<b.length;f++)b[f][3]=
255}return c},_isFeatureCollectionRequired:function(a,b){if(b&&b.isFeatureReductionActive&&b.isFeatureReductionActive())return!0;var c=!1;if(b=this._getVariable(a,"rotationInfo",!1))c=(c=b.field)&&r.isFunction(c)||b.valueExpression;return a.hasVisualVariables("sizeInfo")||a.hasVisualVariables("colorInfo")||a.hasVisualVariables("opacityInfo")||c},_getVariable:function(a,b,c){var e;a&&(e=(a=a.getVisualVariablesForType(b,c))&&a[0]);return e},_applyVisualVariables:function(a,b){var e=b.renderer,f=b.graphic,
h=b.symbol,d=b.mapResolution,y=b.mapScale,m=h.type;if("textsymbol"!==m&&"shieldlabelsymbol"!==m){var g=this._getVariable(e,"sizeInfo",!1),l=this._getVariable(e,"colorInfo",!1),A=this._getVariable(e,"opacityInfo",!1);b=this._getVariable(e,"rotationInfo",!1);h instanceof c&&(g=this._getVariable(e,"sizeInfo","outline")||g);d=g?e.getSize(f,{sizeInfo:g,shape:"simplemarkersymbol"===m?h.style:null,resolution:d,scale:y}):f.size;null!=d&&("simplemarkersymbol"===m?a.size=z.px2pt(d):"picturemarkersymbol"===
m?(y=h.width/h.height*d,a.width=z.px2pt(y),a.height=z.px2pt(d),0!==h.xoffset&&(a.xoffset=z.px2pt(h.xoffset/h.width*y)),0!==h.yoffset&&(a.yoffset=z.px2pt(h.yoffset/h.height*d))):"simplelinesymbol"===m?a.width=z.px2pt(d):a.outline&&(a.outline.width=z.px2pt(d)));l&&(!(h=e.getColor(f,{colorInfo:l}))||"simplemarkersymbol"!==m&&"simplelinesymbol"!==m&&"simplefillsymbol"!==m||(a.color=x.toJsonColor(h)));A&&(h=e.getOpacity(f,{opacityInfo:A}),null!=h&&a.color&&(a.color[3]=Math.round(255*h)));b&&(e=e.getRotationAngle(f,
{rotationInfo:b}))&&(a.angle=-e)}}});k("extend-esri")&&r.setObject("tasks.PrintTask",u,g);return u})},"esri/tasks/Geoprocessor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),
function(u,r,t,v,n,k,g,d,l,q,x,b,a,m,f,c,e,h,B,E,w,z,F){u=u(b,{declaredClass:"esri.tasks.Geoprocessor",_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(a){this._jobUpdateHandler=r.hitch(this,this._jobUpdateHandler);this._getJobStatus=r.hitch(this,this._getJobStatus);this._getResultDataHandler=
r.hitch(this,this._getResultDataHandler);this._getResultImageHandler=r.hitch(this,this._getResultImageHandler);this._executeHandler=r.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1E3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(a){this.updateDelay=a},setProcessSpatialReference:function(a){this.processSpatialReference=a},setOutputSpatialReference:function(a){this._setOutSR(a)},setOutSpatialReference:function(a){this._setOutSR(a)},
__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(a){this.outSpatialReference=this.outputSpatialReference=a},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(a,b,c){for(var e in a){var f=a[e];r.isArray(f)?a[e]=n.toJson(t.map(f,function(a){return this._gpEncode({item:a},!0).item},this)):f instanceof Date&&(a[e]=f.getTime())}return this._encode(a,b,c)},_decode:function(b){var f=b.dataType,
d=new E(b);if(-1!==t.indexOf(["GPBoolean","GPDouble","GPLong","GPString"],f))return d;if("GPLinearUnit"===f)d.value=new c(d.value);else if("GPFeatureRecordSetLayer"===f||"GPRecordSet"===f)d.value=new a(d.value);else if("GPDataFile"===f)d.value=new e(d.value);else if("GPDate"===f)b=d.value,r.isString(b)?d.value=new B({date:b}):d.value=new Date(b);else if("GPRasterData"===f||"GPRasterDataLayer"===f)b=b.value.mapImage,d.value=b?new F(b):new h(d.value);else if(-1!==f.indexOf("GPMultiValue:")){var m=f.split(":")[1];
b=d.value;d.value=t.map(b,function(a){return this._decode({paramName:"_name",dataType:m,value:a}).value},this)}else console.log(this.declaredClass+" : GP Data type not handled. : "+d.dataType),d=null;return d},submitJob:function(a,b,c,e,f){var h=this._getOutSR(),d=f.assembly;a=this._gpEncode(r.mixin({},this._url.query,{f:"json","env:outSR":h?h.wkid||n.toJson(h.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||n.toJson(this.processSpatialReference.toJson()):
null},a),null,d&&d[0]);var m=this._jobUpdateHandler,g=this._errorHandler;return l({url:this._url.path+"/submitJob",content:a,callbackParamName:"callback",load:function(a,e){m(a,e,!1,b,c,f.dfd)},error:function(a){g(a,e,f.dfd)}})},_jobUpdateHandler:function(a,b,c,e,f,h){var d=a.jobId;b=new m(a);this._successHandler([b],"onStatusUpdate",f,c&&h);if(!c)switch(clearTimeout(this._updateTimers[d]),this._updateTimers[d]=null,h&&h.progress(b),a.jobStatus){case m.STATUS_SUBMITTED:case m.STATUS_EXECUTING:case m.STATUS_WAITING:case m.STATUS_NEW:var y=
this._getJobStatus;this._updateTimers[d]=setTimeout(function(){y(d,c,e,f,h)},this.updateDelay);break;default:this._successHandler([b],"onJobComplete",e,h)}},_getJobStatus:function(a,b,c,e,f){var h=this._jobUpdateHandler;l({url:this._url.path+"/jobs/"+a,content:r.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(a,d){h(a,d,b,c,e,f)},error:this._errorHandler})},_getResultDataHandler:function(a,b,c,e,f){try{var h=this._decode(a);this._successHandler([h],"onGetResultDataComplete",
c,f)}catch(H){this._errorHandler(H,e,f)}},getResultData:function(a,b,c,e){var f=this._getResultDataHandler,h=this._errorHandler,d=new v(q._dfdCanceller);d._pendingDfd=l({url:this._url.path+"/jobs/"+a+"/results/"+b,content:r.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(a,b){f(a,b,c,e,d)},error:function(a){h(a,e,d)}});return d},checkJobStatus:function(a,b,c){var e=this._jobUpdateHandler,f=this._errorHandler,h=new v(q._dfdCanceller);h._pendingDfd=
l({url:this._url.path+"/jobs/"+a,content:r.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(a,c){e(a,c,!0,null,b,h)},error:function(a){f(a,c,h)}});return h},cancelJob:function(a,b,c){var e=this._errorHandler,f=new v(q._dfdCanceller);f._pendingDfd=l({url:this._url.path+"/jobs/"+a+"/cancel",content:r.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:r.hitch(this,function(a,c){this._successHandler([a],"onJobCancel",b,f)}),error:function(a){e(a,c,f)}});
return f},execute:function(a,b,c,e){var f=this._getOutSR(),h=e.assembly;a=this._gpEncode(r.mixin({},this._url.query,{f:"json","env:outSR":f?f.wkid||n.toJson(f.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||n.toJson(this.processSpatialReference.toJson()):null},a),null,h&&h[0]);var d=this._executeHandler,m=this._errorHandler;return l({url:this._url.path+"/execute",content:a,callbackParamName:"callback",load:function(a,f){d(a,f,b,c,e.dfd)},error:function(a){m(a,
c,e.dfd)}})},_executeHandler:function(a,b,c,e,h){try{var d=a.results,m,y,g=a.messages;m=0;for(y=d.length;m<y;m++)d[m]=this._decode(d[m]);m=0;for(y=g.length;m<y;m++)g[m]=new f(g[m]);this._successHandler([d,g],"onExecuteComplete",c,h)}catch(U){this._errorHandler(U,e,h)}},_getResultImageHandler:function(a,b,c,e,f){try{var h=this._decode(a);this._successHandler([h],"onGetResultImageComplete",c,f)}catch(H){this._errorHandler(H,e,f)}},getResultImage:function(a,b,c,e,f){var h=this._getResultImageHandler,
d=this._errorHandler;c=this._gpEncode(r.mixin({},this._url.query,{f:"json"},c.toJson()));var m=new v(q._dfdCanceller);m._pendingDfd=l({url:this._url.path+"/jobs/"+a+"/results/"+b,content:c,callbackParamName:"callback",load:function(a,b){h(a,b,e,f,m)},error:function(a){d(a,f,m)}});return m},cancelJobStatusUpdates:function(a){clearTimeout(this._updateTimers[a]);this._updateTimers[a]=null},getResultImageLayer:function(a,b,c,e){if(null==b){var f=this._url.path.indexOf("/GPServer/");a=this._url.path.substring(0,
f)+"/MapServer/jobs/"+a}else a=this._url.path+"/jobs/"+a+"/results/"+b;this._url.query&&(a+="?"+g.objectToQuery(this._url.query));b=null==b?new z(a,{imageParameters:c}):new w(a,{imageParameters:c},!0);this.onGetResultImageLayerComplete(b);e&&e(b);return b},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},onGetResultImageLayerComplete:function(){},onJobCancel:function(){}});x._createWrappers(u);
k("extend-esri")&&r.setObject("tasks.Geoprocessor",u,d);return u})},"esri/tasks/JobInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(u,r,t,v,n){u=u(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(k){this.messages=[];r.mixin(this,k);k=this.messages;var g,d=k.length;for(g=0;g<d;g++)k[g]=new n(k[g])},jobId:"",jobStatus:""});r.mixin(u,{STATUS_CANCELLED:"esriJobCancelled",STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",
STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"});t("extend-esri")&&r.setObject("tasks.JobInfo",u,v);return u})},"esri/tasks/GPMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(u,r,t,v){u=u(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(n){r.mixin(this,
n)}});r.mixin(u,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"});t("extend-esri")&&r.setObject("tasks.GPMessage",u,v);return u})},"esri/tasks/LinearUnit":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(u,r,t,v){u=u(null,{declaredClass:"esri.tasks.LinearUnit",constructor:function(n){n&&r.mixin(this,n)},distance:0,units:null,toJson:function(){var n={};this.distance&&(n.distance=this.distance);this.units&&(n.units=this.units);return n}});t("extend-esri")&&r.setObject("tasks.LinearUnit",u,v);return u})},"esri/tasks/DataFile":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(u,r,t,v){u=u(null,{declaredClass:"esri.tasks.DataFile",
constructor:function(n){n&&r.mixin(this,n)},url:null,itemID:null,toJson:function(){var n={};this.url&&(n.url=this.url);this.itemID&&(n.itemID=this.itemID);return n}});t("extend-esri")&&r.setObject("tasks.DataFile",u,v);return u})},"esri/tasks/RasterData":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(u,r,t,v){u=u(null,{declaredClass:"esri.tasks.RasterData",constructor:function(n){n&&r.mixin(this,n)},url:null,format:null,itemID:null,toJson:function(){var n=
{};this.url&&(n.url=this.url);this.format&&(n.format=this.format);this.itemID&&(n.itemID=this.itemID);return n}});t("extend-esri")&&r.setObject("tasks.RasterData",u,v);return u})},"esri/tasks/Date":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(u,r,t,v,n){u=u(null,{declaredClass:"esri.tasks.Date",constructor:function(k){k&&(k.format&&(this.format=k.format),this.date=t.parse(k.date,{selector:"date",datePattern:this.format}))},date:new Date,
format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:t.format(this.date,{selector:"date",datePattern:this.format}),format:this.format}}});v("extend-esri")&&r.setObject("tasks.Date",u,n);return u})},"esri/tasks/ParameterValue":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(u,r,t,v){u=u(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(n){r.mixin(this,n)}});t("extend-esri")&&r.setObject("tasks.ParameterValue",u,v);return u})},
"esri/tasks/GPResultImageLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(u,r,t,v,n,k,g){u=u(g,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(d,g){g&&g.imageParameters&&g.imageParameters.extent&&(this.initialExtent=this.fullExtent=g.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);this.getImageUrl=r.hitch(this,this.getImageUrl);
this.loaded=!0;this.onLoad(this)},getImageUrl:function(d,g,q,k){var b=d.spatialReference.wkid;k(this._url.path+"?"+n.objectToQuery(r.mixin(this._params,{f:"image",bbox:t.toJson(d.toJson()),bboxSR:b,imageSR:b,size:g+","+q})))}});v("extend-esri")&&r.setObject("tasks._GPResultImageLayer",u,k);return u})},"dojox/gfx/canvas":function(){define("./_base dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/window dojo/dom-geometry dojo/dom ./shape ./path ./arc ./matrix ./decompose ./bezierutils".split(" "),
function(u,r,t,v,n,k,g,d,l,q,x,b,a){function m(a,b,c,e,f,h,d,m,y,g){var A,l,q=b.length,J=0;g?(l=g.l/f,J=g.i):l=b[0]/f;for(;h<d;)h+l>d&&(A={l:(h+l-d)*f,i:J},l=d-h),J%2||(a.beginPath(),a.arc(c,e,f,h,h+l,m),y&&a.stroke()),h+=l,++J,l=b[J%q]/f;return A}function f(b,c,e,f){var h=0,d=0,m,y=0;f?(m=f.l,y=f.i):m=c[0];for(;1>d;)d=a.tAtLength(b,m),1==d&&(h=a.computeLength(b),h={l:m-h,i:y}),b=a.splitBezierAtT(b,d),y%2||e.push(b[0]),b=b[1],++y,m=c[y%c.length];return h}function c(a,b,c,e){var h=[b.last.x,b.last.y].concat(c),
d=!(a instanceof Array);c=4===c.length?"quadraticCurveTo":"bezierCurveTo";var m=[];b=f(h,b.canvasDash,m,e);for(e=0;e<m.length;++e)h=m[e],d?(a.moveTo(h[0],h[1]),a[c].apply(a,h.slice(2))):(a.push("moveTo",[h[0],h[1]]),a.push(c,h.slice(2)));return b}function e(b,c,e,f,h,d,m){var y=0,g=0,A=0,l=a.distance(e,f,h,d),q=0;c=c.canvasDash;var J=e,k=f,B,w=!(b instanceof Array);m?(A=m.l,q=m.i):A+=c[0];for(;.01<Math.abs(1-g);)A>l&&(y={l:A-l,i:q},A=l),g=A/l,m=e+(h-e)*g,B=f+(d-f)*g,q++%2||(w?(b.moveTo(J,k),b.lineTo(m,
B)):(b.push("moveTo",[J,k]),b.push("lineTo",[m,B]))),J=m,k=B,A+=c[q%c.length];return y}var h=u.canvas={},B=null,E=x.multiplyPoint,w=Math.PI,z=2*w,F=w/2;b=r.extend;if(n.global.CanvasRenderingContext2D){n=n.doc.createElement("canvas").getContext("2d");var G="function"==typeof n.setLineDash,D="function"==typeof n.fillText}var C={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],
longdashdotdot:[8,3,1,3,1,3]};h.Shape=v("dojox.gfx.canvas.Shape",d.Shape,{_render:function(a){a.save();this._renderTransform(a);this._renderClip(a);this._renderShape(a);this._renderFill(a,!0);this._renderStroke(a,!0);a.restore()},_renderClip:function(a){this.canvasClip&&(this.canvasClip.render(a),a.clip())},_renderTransform:function(a){if("canvasTransform"in this){var b=this.canvasTransform;a.translate(b.dx,b.dy);a.rotate(b.angle2);a.scale(b.sx,b.sy);a.rotate(b.angle1)}},_renderShape:function(a){},
_renderFill:function(a,b){if("canvasFill"in this){var c=this.fillStyle;if("canvasFillImage"in this){var e=c.width,f=c.height,h=this.canvasFillImage.width,d=this.canvasFillImage.height,m=Math.min(e==h?1:e/h,f==d?1:f/d),y=(e-m*h)/2,g=(f-m*d)/2;B.width=e;B.height=f;var A=B.getContext("2d");A.clearRect(0,0,e,f);A.drawImage(this.canvasFillImage,0,0,h,d,y,g,m*h,m*d);this.canvasFill=a.createPattern(B,"repeat");delete this.canvasFillImage}a.fillStyle=this.canvasFill;b&&("pattern"!==c.type||0===c.x&&0===c.y||
a.translate(c.x,c.y),a.fill())}else a.fillStyle="rgba(0,0,0,0.0)"},_renderStroke:function(a,b){var c=this.strokeStyle;c?(a.strokeStyle=c.color.toString(),a.lineWidth=c.width,a.lineCap=c.cap,"number"==typeof c.join?(a.lineJoin="miter",a.miterLimit=c.join):a.lineJoin=c.join,this.canvasDash?G?(a.setLineDash(this.canvasDash),b&&a.stroke()):this._renderDashedStroke(a,b):b&&a.stroke()):b||(a.strokeStyle="rgba(0,0,0,0.0)")},_renderDashedStroke:function(a,b){},getEventSource:function(){return null},on:function(){},
connect:function(){},disconnect:function(){},canvasClip:null,setClip:function(a){this.inherited(arguments);var b=a?"width"in a?"rect":"cx"in a?"ellipse":"points"in a?"polyline":"d"in a?"path":null:null;if(a&&!b)return this;this.canvasClip=a?S(b,a):null;this.parent&&this.parent._makeDirty();return this}});var S=function(a,b){switch(a){case "ellipse":return{canvasEllipse:y({shape:b}),render:function(a){return h.Ellipse.prototype._renderShape.call(this,a)}};case "rect":return{shape:r.delegate(b,{r:0}),
render:function(a){return h.Rect.prototype._renderShape.call(this,a)}};case "path":return{canvasPath:I(b),render:function(a){this.canvasPath._renderShape(a)}};case "polyline":return{canvasPolyline:b.points,render:function(a){return h.Polyline.prototype._renderShape.call(this,a)}}}return null},I=function(a){var b=new dojox.gfx.canvas.Path;b.canvasPath=[];b._setPath(a.d);return b},K=function(a,b,c){var e=a.prototype[b];a.prototype[b]=c?function(){this.parent&&this.parent._makeDirty();e.apply(this,arguments);
c.call(this);return this}:function(){this.parent&&this.parent._makeDirty();return e.apply(this,arguments)}};K(h.Shape,"setTransform",function(){this.matrix?this.canvasTransform=u.decompose(this.matrix):delete this.canvasTransform});K(h.Shape,"setFill",function(){var a=this.fillStyle,b;if(a){if("object"==typeof a&&"type"in a){var c=this.surface.rawNode.getContext("2d");switch(a.type){case "linear":case "radial":b="linear"==a.type?c.createLinearGradient(a.x1,a.y1,a.x2,a.y2):c.createRadialGradient(a.cx,
a.cy,0,a.cx,a.cy,a.r);t.forEach(a.colors,function(a){b.addColorStop(a.offset,u.normalizeColor(a.color).toString())});break;case "pattern":B||(B=document.createElement("canvas")),c=new Image,this.surface.downloadImage(c,a.src),this.canvasFillImage=c}}else b=a.toString();this.canvasFill=b}else delete this.canvasFill});K(h.Shape,"setStroke",function(){var a=this.strokeStyle;if(a){var b=this.strokeStyle.style.toLowerCase();b in C&&(b=C[b]);if(b instanceof Array){this.canvasDash=b=b.slice();var c;for(c=
0;c<b.length;++c)b[c]*=a.width;if("butt"!=a.cap){for(c=0;c<b.length;c+=2)b[c]-=a.width,1>b[c]&&(b[c]=1);for(c=1;c<b.length;c+=2)b[c]+=a.width}}else delete this.canvasDash}else delete this.canvasDash;this._needsDash=!G&&!!this.canvasDash});K(h.Shape,"setShape");h.Group=v("dojox.gfx.canvas.Group",h.Shape,{constructor:function(){d.Container._init.call(this)},_render:function(a){a.save();this._renderTransform(a);this._renderClip(a);for(var b=0;b<this.children.length;++b)this.children[b]._render(a);a.restore()},
destroy:function(){d.Container.clear.call(this,!0);h.Shape.prototype.destroy.apply(this,arguments)}});h.Rect=v("dojox.gfx.canvas.Rect",[h.Shape,d.Rect],{_renderShape:function(a){var b=this.shape,c=Math.min(b.r,b.height/2,b.width/2),e=b.x,f=e+b.width,h=b.y,b=h+b.height,d=e+c,m=f-c,y=h+c,g=b-c;a.beginPath();a.moveTo(d,h);c?(a.arc(m,y,c,-F,0,!1),a.arc(m,g,c,0,F,!1),a.arc(d,g,c,F,w,!1),a.arc(d,y,c,w,w+F,!1)):(a.lineTo(m,h),a.lineTo(f,g),a.lineTo(d,b),a.lineTo(e,y));a.closePath()},_renderDashedStroke:function(a,
b){var c=this.shape,f=Math.min(c.r,c.height/2,c.width/2),h=c.x,d=h+c.width,y=c.y,g=y+c.height,l=h+f,q=d-f,A=y+f,k=g-f;f?(a.beginPath(),c=e(a,this,l,y,q,y),b&&a.stroke(),c=m(a,this.canvasDash,q,A,f,-F,0,!1,b,c),a.beginPath(),c=e(a,this,d,A,d,k,c),b&&a.stroke(),c=m(a,this.canvasDash,q,k,f,0,F,!1,b,c),a.beginPath(),c=e(a,this,q,g,l,g,c),b&&a.stroke(),c=m(a,this.canvasDash,l,k,f,F,w,!1,b,c),a.beginPath(),c=e(a,this,h,k,h,A,c),b&&a.stroke(),m(a,this.canvasDash,l,A,f,w,w+F,!1,b,c)):(a.beginPath(),c=e(a,
this,l,y,q,y),c=e(a,this,q,y,d,k,c),c=e(a,this,d,k,l,g,c),e(a,this,l,g,h,A,c),b&&a.stroke())}});var H=[];(function(){var a=q.curvePI4;H.push(a.s,a.c1,a.c2,a.e);for(var b=45;360>b;b+=45){var c=x.rotateg(b);H.push(E(c,a.c1),E(c,a.c2),E(c,a.e))}})();var y=function(a){var b,c,e,h=[],d=a.shape,m=x.normalize([x.translate(d.cx,d.cy),x.scale(d.rx,d.ry)]);b=E(m,H[0]);h.push([b.x,b.y]);for(d=1;d<H.length;d+=3)c=E(m,H[d]),e=E(m,H[d+1]),b=E(m,H[d+2]),h.push([c.x,c.y,e.x,e.y,b.x,b.y]);if(a._needsDash){b=[];c=
h[0];for(d=1;d<h.length;++d)e=[],f(c.concat(h[d]),a.canvasDash,e),c=[h[d][4],h[d][5]],b.push(e);a._dashedPoints=b}return h};h.Ellipse=v("dojox.gfx.canvas.Ellipse",[h.Shape,d.Ellipse],{setShape:function(){this.inherited(arguments);this.canvasEllipse=y(this);return this},setStroke:function(){this.inherited(arguments);G||(this.canvasEllipse=y(this));return this},_renderShape:function(a){var b=this.canvasEllipse,c;a.beginPath();a.moveTo.apply(a,b[0]);for(c=1;c<b.length;++c)a.bezierCurveTo.apply(a,b[c]);
a.closePath()},_renderDashedStroke:function(a,b){var c=this._dashedPoints;a.beginPath();for(var e=0;e<c.length;++e)for(var f=c[e],h=0;h<f.length;++h){var d=f[h];a.moveTo(d[0],d[1]);a.bezierCurveTo(d[2],d[3],d[4],d[5],d[6],d[7])}b&&a.stroke()}});h.Circle=v("dojox.gfx.canvas.Circle",[h.Shape,d.Circle],{_renderShape:function(a){var b=this.shape;a.beginPath();a.arc(b.cx,b.cy,b.r,0,z,1)},_renderDashedStroke:function(a,b){var c=this.shape,e=0,f,h=this.canvasDash.length;for(i=0;e<z;)f=this.canvasDash[i%
h]/c.r,i%2||(a.beginPath(),a.arc(c.cx,c.cy,c.r,e,e+f,0),b&&a.stroke()),e+=f,++i}});h.Line=v("dojox.gfx.canvas.Line",[h.Shape,d.Line],{_renderShape:function(a){var b=this.shape;a.beginPath();a.moveTo(b.x1,b.y1);a.lineTo(b.x2,b.y2)},_renderDashedStroke:function(a,b){var c=this.shape;a.beginPath();e(a,this,c.x1,c.y1,c.x2,c.y2);b&&a.stroke()}});h.Polyline=v("dojox.gfx.canvas.Polyline",[h.Shape,d.Polyline],{setShape:function(){this.inherited(arguments);var a=this.shape.points,b=a[0],c,e;this.bbox=null;
this._normalizePoints();if(a.length)if("number"==typeof b)b=a;else for(b=[],e=0;e<a.length;++e)c=a[e],b.push(c.x,c.y);else b=[];this.canvasPolyline=b;return this},_renderShape:function(a){var b=this.canvasPolyline;if(b.length){a.beginPath();a.moveTo(b[0],b[1]);for(var c=2;c<b.length;c+=2)a.lineTo(b[c],b[c+1])}},_renderDashedStroke:function(a,b){var c=this.canvasPolyline,f=0;a.beginPath();for(var h=0;h<c.length;h+=2)f=e(a,this,c[h],c[h+1],c[h+2],c[h+3],f);b&&a.stroke()}});h.Image=v("dojox.gfx.canvas.Image",
[h.Shape,d.Image],{setShape:function(){this.inherited(arguments);var a=new Image;this.surface.downloadImage(a,this.shape.src);this.canvasImage=a;return this},_renderShape:function(a){var b=this.shape;a.drawImage(this.canvasImage,b.x,b.y,b.width,b.height)}});h.Text=v("dojox.gfx.canvas.Text",[h.Shape,d.Text],{_setFont:function(){this.fontStyle?this.canvasFont=u.makeFontString(this.fontStyle):delete this.canvasFont},getTextWidth:function(){var a=this.shape,b=0,c;a.text&&(c=this.surface.rawNode.getContext("2d"),
c.save(),this._renderTransform(c),this._renderFill(c,!1),this._renderStroke(c,!1),this.canvasFont&&(c.font=this.canvasFont),b=c.measureText(a.text).width,c.restore());return b},_render:function(a){a.save();this._renderTransform(a);this._renderFill(a,!1);this._renderStroke(a,!1);this._renderShape(a);a.restore()},_renderShape:function(a){var b=this.shape;b.text&&(a.textAlign="middle"===b.align?"center":b.align,this.canvasFont&&(a.font=this.canvasFont),this.canvasFill&&a.fillText(b.text,b.x,b.y),this.strokeStyle&&
(a.beginPath(),a.strokeText(b.text,b.x,b.y),a.closePath()))}});K(h.Text,"setFont");D||h.Text.extend({getTextWidth:function(){return 0},getBoundingBox:function(){return null},_renderShape:function(){}});var Q={M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"};
h.Path=v("dojox.gfx.canvas.Path",[h.Shape,l.Path],{constructor:function(){this.lastControl={}},setShape:function(){this.canvasPath=[];this._dashedPath=[];return this.inherited(arguments)},setStroke:function(){this.inherited(arguments);G||(this.segmented=!1,this._confirmSegmented());return this},_setPath:function(){this._dashResidue=null;this.inherited(arguments)},_updateWithSegment:function(a){var b=r.clone(this.last);this[Q[a.action]](this.canvasPath,a.action,a.args,this._needsDash?this._dashedPath:
null);this.last=b;this.inherited(arguments)},_renderShape:function(a){var b=this.canvasPath;a.beginPath();for(var c=0;c<b.length;c+=2)a[b[c]].apply(a,b[c+1])},_renderDashedStroke:G?function(){}:function(a,b){var c=this._dashedPath;a.beginPath();for(var e=0;e<c.length;e+=2)a[c[e]].apply(a,c[e+1]);b&&a.stroke()},_moveToA:function(a,b,c,f){a.push("moveTo",[c[0],c[1]]);f&&f.push("moveTo",[c[0],c[1]]);for(b=2;b<c.length;b+=2)a.push("lineTo",[c[b],c[b+1]]),f&&(this._dashResidue=e(f,this,c[b-2],c[b-1],c[b],
c[b+1],this._dashResidue));this.last.x=c[c.length-2];this.last.y=c[c.length-1];this.lastControl={}},_moveToR:function(a,b,c,f){b="x"in this.last?[this.last.x+=c[0],this.last.y+=c[1]]:[this.last.x=c[0],this.last.y=c[1]];a.push("moveTo",b);f&&f.push("moveTo",b);for(b=2;b<c.length;b+=2)a.push("lineTo",[this.last.x+=c[b],this.last.y+=c[b+1]]),f&&(this._dashResidue=e(f,this,f[f.length-1][0],f[f.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_lineToA:function(a,b,c,f){for(b=
0;b<c.length;b+=2)f&&(this._dashResidue=e(f,this,this.last.x,this.last.y,c[b],c[b+1],this._dashResidue)),a.push("lineTo",[c[b],c[b+1]]);this.last.x=c[c.length-2];this.last.y=c[c.length-1];this.lastControl={}},_lineToR:function(a,b,c,f){for(b=0;b<c.length;b+=2)a.push("lineTo",[this.last.x+=c[b],this.last.y+=c[b+1]]),f&&(this._dashResidue=e(f,this,f[f.length-1][0],f[f.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_hLineToA:function(a,b,c,f){for(b=0;b<c.length;++b)a.push("lineTo",
[c[b],this.last.y]),f&&(this._dashResidue=e(f,this,f[f.length-1][0],f[f.length-1][1],c[b],this.last.y,this._dashResidue));this.last.x=c[c.length-1];this.lastControl={}},_hLineToR:function(a,b,c,f){for(b=0;b<c.length;++b)a.push("lineTo",[this.last.x+=c[b],this.last.y]),f&&(this._dashResidue=e(f,this,f[f.length-1][0],f[f.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_vLineToA:function(a,b,c,f){for(b=0;b<c.length;++b)a.push("lineTo",[this.last.x,c[b]]),f&&(this._dashResidue=
e(f,this,f[f.length-1][0],f[f.length-1][1],this.last.x,c[b],this._dashResidue));this.last.y=c[c.length-1];this.lastControl={}},_vLineToR:function(a,b,c,f){for(b=0;b<c.length;++b)a.push("lineTo",[this.last.x,this.last.y+=c[b]]),f&&(this._dashResidue=e(f,this,f[f.length-1][0],f[f.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_curveToA:function(a,b,e,f){for(b=0;b<e.length;b+=6)a.push("bezierCurveTo",e.slice(b,b+6)),f&&(this._dashResidue=c(f,this,a[a.length-1],this._dashResidue));
this.last.x=e[e.length-2];this.last.y=e[e.length-1];this.lastControl.x=e[e.length-4];this.lastControl.y=e[e.length-3];this.lastControl.type="C"},_curveToR:function(a,b,e,f){for(b=0;b<e.length;b+=6)a.push("bezierCurveTo",[this.last.x+e[b],this.last.y+e[b+1],this.lastControl.x=this.last.x+e[b+2],this.lastControl.y=this.last.y+e[b+3],this.last.x+e[b+4],this.last.y+e[b+5]]),f&&(this._dashResidue=c(f,this,a[a.length-1],this._dashResidue)),this.last.x+=e[b+4],this.last.y+=e[b+5];this.lastControl.type="C"},
_smoothCurveToA:function(a,b,e,f){for(b=0;b<e.length;b+=4){var h="C"==this.lastControl.type;a.push("bezierCurveTo",[h?2*this.last.x-this.lastControl.x:this.last.x,h?2*this.last.y-this.lastControl.y:this.last.y,e[b],e[b+1],e[b+2],e[b+3]]);f&&(this._dashResidue=c(f,this,a[a.length-1],this._dashResidue));this.lastControl.x=e[b];this.lastControl.y=e[b+1];this.lastControl.type="C"}this.last.x=e[e.length-2];this.last.y=e[e.length-1]},_smoothCurveToR:function(a,b,e,f){for(b=0;b<e.length;b+=4){var h="C"==
this.lastControl.type;a.push("bezierCurveTo",[h?2*this.last.x-this.lastControl.x:this.last.x,h?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+e[b],this.last.y+e[b+1],this.last.x+e[b+2],this.last.y+e[b+3]]);f&&(this._dashResidue=c(f,this,a[a.length-1],this._dashResidue));this.lastControl.x=this.last.x+e[b];this.lastControl.y=this.last.y+e[b+1];this.lastControl.type="C";this.last.x+=e[b+2];this.last.y+=e[b+3]}},_qCurveToA:function(a,b,e,f){for(b=0;b<e.length;b+=4)a.push("quadraticCurveTo",
e.slice(b,b+4));f&&(this._dashResidue=c(f,this,a[a.length-1],this._dashResidue));this.last.x=e[e.length-2];this.last.y=e[e.length-1];this.lastControl.x=e[e.length-4];this.lastControl.y=e[e.length-3];this.lastControl.type="Q"},_qCurveToR:function(a,b,e,f){for(b=0;b<e.length;b+=4)a.push("quadraticCurveTo",[this.lastControl.x=this.last.x+e[b],this.lastControl.y=this.last.y+e[b+1],this.last.x+e[b+2],this.last.y+e[b+3]]),f&&(this._dashResidue=c(f,this,a[a.length-1],this._dashResidue)),this.last.x+=e[b+
2],this.last.y+=e[b+3];this.lastControl.type="Q"},_qSmoothCurveToA:function(a,b,e,f){for(b=0;b<e.length;b+=2){var h="Q"==this.lastControl.type;a.push("quadraticCurveTo",[this.lastControl.x=h?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=h?2*this.last.y-this.lastControl.y:this.last.y,e[b],e[b+1]]);f&&(this._dashResidue=c(f,this,a[a.length-1],this._dashResidue));this.lastControl.type="Q"}this.last.x=e[e.length-2];this.last.y=e[e.length-1]},_qSmoothCurveToR:function(a,b,e,f){for(b=
0;b<e.length;b+=2){var h="Q"==this.lastControl.type;a.push("quadraticCurveTo",[this.lastControl.x=h?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=h?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+e[b],this.last.y+e[b+1]]);f&&(this._dashResidue=c(f,this,a[a.length-1],this._dashResidue));this.lastControl.type="Q";this.last.x+=e[b];this.last.y+=e[b+1]}},_arcTo:function(a,b,e,f){b="a"==b;for(var h=0;h<e.length;h+=7){var d=e[h+5],m=e[h+6];b&&(d+=this.last.x,m+=this.last.y);var y=
q.arcAsBezier(this.last,e[h],e[h+1],e[h+2],e[h+3]?1:0,e[h+4]?1:0,d,m);t.forEach(y,function(b){a.push("bezierCurveTo",b)});f&&(this._dashResidue=c(f,this,p,this._dashResidue));this.last.x=d;this.last.y=m}this.lastControl={}},_closePath:function(a,b,c,f){a.push("closePath",[]);f&&(this._dashResidue=e(f,this,this.last.x,this.last.y,f[1][0],f[1][1],this._dashResidue));this.lastControl={}}});t.forEach("moveTo lineTo hLineTo vLineTo curveTo smoothCurveTo qCurveTo qSmoothCurveTo arcTo closePath".split(" "),
function(a){K(h.Path,a)});h.TextPath=v("dojox.gfx.canvas.TextPath",[h.Shape,l.TextPath],{_renderShape:function(a){},_setText:function(){},_setFont:function(){}});h.Surface=v("dojox.gfx.canvas.Surface",d.Surface,{constructor:function(){d.Container._init.call(this);this.pendingImageCount=0;this.makeDirty()},destroy:function(){d.Container.clear.call(this,!0);this.inherited(arguments)},setDimensions:function(a,b){this.width=u.normalizedLength(a);this.height=u.normalizedLength(b);if(!this.rawNode)return this;
a=!1;this.rawNode.width!=this.width&&(this.rawNode.width=this.width,a=!0);this.rawNode.height!=this.height&&(this.rawNode.height=this.height,a=!0);a&&this.makeDirty();return this},getDimensions:function(){return this.rawNode?{width:this.rawNode.width,height:this.rawNode.height}:null},_render:function(a){!this.rawNode||!a&&this.pendingImageCount||(a=this.rawNode.getContext("2d"),a.clearRect(0,0,this.rawNode.width,this.rawNode.height),this.render(a),"pendingRender"in this&&(clearTimeout(this.pendingRender),
delete this.pendingRender))},render:function(a){a.save();for(var b=0;b<this.children.length;++b)this.children[b]._render(a);a.restore()},makeDirty:function(){this.pendingImagesCount||"pendingRender"in this||this._batch||(this.pendingRender=setTimeout(r.hitch(this,this._render),0))},downloadImage:function(a,b){var c=r.hitch(this,this.onImageLoad);!this.pendingImageCount++&&"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender);a.onload=c;a.onerror=c;a.onabort=c;a.src=
b},onImageLoad:function(){--this.pendingImageCount||(this.onImagesLoaded(),this._render())},onImagesLoaded:function(){},getEventSource:function(){return null},connect:function(){},disconnect:function(){},on:function(){}});h.createSurface=function(a,b,c){if(!b&&!c){var e=k.position(a);b=b||e.w;c=c||e.h}"number"==typeof b&&(b+="px");"number"==typeof c&&(c+="px");e=new h.Surface;a=g.byId(a);var f=a.ownerDocument.createElement("canvas");f.width=u.normalizedLength(b);f.height=u.normalizedLength(c);a.appendChild(f);
e.rawNode=f;e._parent=a;return e.surface=e};var U=d.Container;v={openBatch:function(){++this._batch;return this},closeBatch:function(){this._batch=0<this._batch?--this._batch:0;this._makeDirty();return this},_makeDirty:function(){this._batch||this.surface.makeDirty()},add:function(a){this._makeDirty();return U.add.apply(this,arguments)},remove:function(a,b){this._makeDirty();return U.remove.apply(this,arguments)},clear:function(){this._makeDirty();return U.clear.apply(this,arguments)},getBoundingBox:U.getBoundingBox,
_moveChildToFront:function(a){this._makeDirty();return U._moveChildToFront.apply(this,arguments)},_moveChildToBack:function(a){this._makeDirty();return U._moveChildToBack.apply(this,arguments)}};l={createObject:function(a,b){a=new a;a.surface=this.surface;a.setShape(b);this.add(a);return a}};b(h.Group,v);b(h.Group,d.Creator);b(h.Group,l);b(h.Surface,v);b(h.Surface,d.Creator);b(h.Surface,l);h.fixTarget=function(a,b){return!0};return h})},"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),
function(u,r,t,v,n,k,g,d,l,q){function x(a,b){for(var f=a.length-1;b<f;)a[b]=a[++b];a.length=f}var b=u.shape={};b.Shape=t("dojox.gfx.shape.Shape",null,{constructor:function(){this.parentMatrix=this.parent=this.bbox=this.strokeStyle=this.fillStyle=this.matrix=this.shape=this.rawNode=null;if(n("gfxRegistry")){var a=b.register(this);this.getUID=function(){return a}}},destroy:function(){n("gfxRegistry")&&b.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=
null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var a=this.getBoundingBox();if(!a)return null;var b=this._getRealMatrix();return[q.multiplyPoint(b,a.x,a.y),q.multiplyPoint(b,a.x+a.width,a.y),q.multiplyPoint(b,a.x+
a.width,a.y+a.height),q.multiplyPoint(b,a.x,a.y+a.height)]},getEventSource:function(){return this.rawNode},setClip:function(a){this.clip=a},getClip:function(){return this.clip},setShape:function(a){this.shape=u.makeParameters(this.shape,a);this.bbox=null;return this},setFill:function(a){if(!a)return this.fillStyle=null,this;var b=null;if("object"==typeof a&&"type"in a)switch(a.type){case "linear":b=u.makeParameters(u.defaultLinearGradient,a);break;case "radial":b=u.makeParameters(u.defaultRadialGradient,
a);break;case "pattern":b=u.makeParameters(u.defaultPattern,a)}else b=u.normalizeColor(a);this.fillStyle=b;return this},setStroke:function(a){if(!a)return this.strokeStyle=null,this;if("string"==typeof a||r.isArray(a)||a instanceof l)a={color:a};a=this.strokeStyle=u.makeParameters(u.defaultStroke,a);a.color=u.normalizeColor(a.color);return this},setTransform:function(a){this.matrix=q.clone(a?q.normalize(a):q.identity);return this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var a=
this.getParent();a&&(a._moveChildToFront(this),this._moveToFront());return this},moveToBack:function(){var a=this.getParent();a&&(a._moveChildToBack(this),this._moveToBack());return this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(a){return a?this.setTransform([this.matrix,a]):this},applyLeftTransform:function(a){return a?this.setTransform([a,this.matrix]):this},applyTransform:function(a){return a?this.setTransform([this.matrix,a]):this},removeShape:function(a){this.parent&&
this.parent.remove(this,a);return this},_setParent:function(a,b){this.parent=a;return this._updateParentMatrix(b)},_updateParentMatrix:function(a){this.parentMatrix=a?q.clone(a):null;return this._applyTransform()},_getRealMatrix:function(){for(var a=this.matrix,b=this.parent;b;)b.matrix&&(a=q.multiply(b.matrix,a)),b=b.parent;return a}});b._eventsProcessing={on:function(a,d){return k(this.getEventSource(),a,b.fixCallback(this,u.fixTarget,d))},connect:function(a,b,f){"on"==a.substring(0,2)&&(a=a.substring(2));
return this.on(a,f?r.hitch(b,f):b)},disconnect:function(a){return a.remove()}};b.fixCallback=function(a,b,f,c){c||(c=f,f=null);if(r.isString(c)){f=f||v.global;if(!f[c])throw['dojox.gfx.shape.fixCallback: scope["',c,'"] is null (scope\x3d"',f,'")'].join("");return function(e){return b(e,a)?f[c].apply(f,arguments||[]):void 0}}return f?function(e){return b(e,a)?c.apply(f,arguments||[]):void 0}:function(e){return b(e,a)?c.apply(f,arguments):void 0}};r.extend(b.Shape,b._eventsProcessing);b.Container={_init:function(){this.children=
[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(a){var b=a.getParent();b&&b.remove(a,!0);this.children.push(a);return a._setParent(this,this._getRealMatrix())},remove:function(a,b){for(var f=0;f<this.children.length;++f)if(this.children[f]==a){b||(a.parent=null,a.parentMatrix=null);x(this.children,f);break}return this},clear:function(a){for(var b,f=0;f<this.children.length;++f)b=this.children[f],b.parent=null,b.parentMatrix=null,a&&b.destroy();this.children=
[];return this},getBoundingBox:function(){if(this.children){var a=null;g.forEach(this.children,function(b){var f=b.getBoundingBox();f&&((b=b.getTransform())&&(f=q.multiplyRectangle(b,f)),a?(a.x=Math.min(a.x,f.x),a.y=Math.min(a.y,f.y),a.endX=Math.max(a.endX,f.x+f.width),a.endY=Math.max(a.endY,f.y+f.height)):a={x:f.x,y:f.y,endX:f.x+f.width,endY:f.y+f.height})});a&&(a.width=a.endX-a.x,a.height=a.endY-a.y);return a}return null},_moveChildToFront:function(a){for(var b=0;b<this.children.length;++b)if(this.children[b]==
a){x(this.children,b);this.children.push(a);break}return this},_moveChildToBack:function(a){for(var b=0;b<this.children.length;++b)if(this.children[b]==a){x(this.children,b);this.children.unshift(a);break}return this}};b.Surface=t("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){g.forEach(this._nodes,d.destroy);this._nodes=[];g.forEach(this._events,function(a){a&&a.remove()});this._events=[];this.rawNode=null;
if(n("ie"))for(;this._parent.lastChild;)d.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(a){},whenLoaded:function(a,b){var f=r.hitch(a,b);if(this.isLoaded)f(this);else k.once(this,"load",function(a){f(a)})}});r.extend(b.Surface,b._eventsProcessing);b.Rect=t("dojox.gfx.shape.Rect",b.Shape,{constructor:function(a){this.shape=u.getDefault("Rect");this.rawNode=
a},getBoundingBox:function(){return this.shape}});b.Ellipse=t("dojox.gfx.shape.Ellipse",b.Shape,{constructor:function(a){this.shape=u.getDefault("Ellipse");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:a.cx-a.rx,y:a.cy-a.ry,width:2*a.rx,height:2*a.ry}}return this.bbox}});b.Circle=t("dojox.gfx.shape.Circle",b.Shape,{constructor:function(a){this.shape=u.getDefault("Circle");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:a.cx-
a.r,y:a.cy-a.r,width:2*a.r,height:2*a.r}}return this.bbox}});b.Line=t("dojox.gfx.shape.Line",b.Shape,{constructor:function(a){this.shape=u.getDefault("Line");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:Math.min(a.x1,a.x2),y:Math.min(a.y1,a.y2),width:Math.abs(a.x2-a.x1),height:Math.abs(a.y2-a.y1)}}return this.bbox}});b.Polyline=t("dojox.gfx.shape.Polyline",b.Shape,{constructor:function(a){this.shape=u.getDefault("Polyline");this.rawNode=a},setShape:function(a,
b){a&&a instanceof Array?(this.inherited(arguments,[{points:a}]),b&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[a]);return this},_normalizePoints:function(){var a=this.shape.points,b=a&&a.length;if(b&&"number"==typeof a[0]){for(var f=[],c=0;c<b;c+=2)f.push({x:a[c],y:a[c+1]});this.shape.points=f}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var a=this.shape.points,b=a.length,f=a[0],c=f.x,e=f.y,h=f.x,d=f.y,g=1;g<b;++g)f=
a[g],c>f.x&&(c=f.x),h<f.x&&(h=f.x),e>f.y&&(e=f.y),d<f.y&&(d=f.y);this.bbox={x:c,y:e,width:h-c,height:d-e}}return this.bbox}});b.Image=t("dojox.gfx.shape.Image",b.Shape,{constructor:function(a){this.shape=u.getDefault("Image");this.rawNode=a},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}});b.Text=t(b.Shape,{constructor:function(a){this.fontStyle=null;this.shape=u.getDefault("Text");this.rawNode=a},getFont:function(){return this.fontStyle},
setFont:function(a){this.fontStyle="string"==typeof a?u.splitFontString(a):u.makeParameters(u.defaultFont,a);this._setFont();return this},getBoundingBox:function(){var a=null;this.getShape().text&&(a=u._base._computeTextBoundingBox(this));return a}});b.Creator={createShape:function(a){switch(a.type){case u.defaultPath.type:return this.createPath(a);case u.defaultRect.type:return this.createRect(a);case u.defaultCircle.type:return this.createCircle(a);case u.defaultEllipse.type:return this.createEllipse(a);
case u.defaultLine.type:return this.createLine(a);case u.defaultPolyline.type:return this.createPolyline(a);case u.defaultImage.type:return this.createImage(a);case u.defaultText.type:return this.createText(a);case u.defaultTextPath.type:return this.createTextPath(a)}return null},createGroup:function(){return this.createObject(u.Group)},createRect:function(a){return this.createObject(u.Rect,a)},createEllipse:function(a){return this.createObject(u.Ellipse,a)},createCircle:function(a){return this.createObject(u.Circle,
a)},createLine:function(a){return this.createObject(u.Line,a)},createPolyline:function(a){return this.createObject(u.Polyline,a)},createImage:function(a){return this.createObject(u.Image,a)},createText:function(a){return this.createObject(u.Text,a)},createPath:function(a){return this.createObject(u.Path,a)},createTextPath:function(a){return this.createObject(u.TextPath,{}).setText(a)},createObject:function(a,b){return null}};return b})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang",
"dojo/_base/declare","./matrix","./shape"],function(u,r,t,v,n){n=t("dojox.gfx.path.Path",n.Shape,{constructor:function(k){this.shape=r.clone(u.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=k;this.segmented=!1},setAbsoluteMode:function(k){this._confirmSegmented();this.absolute="string"==typeof k?"absolute"==k:k;return this},getAbsoluteMode:function(){this._confirmSegmented();return this.absolute},getBoundingBox:function(){this._confirmSegmented();return this.bbox&&
"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){this._confirmSegmented();if(this.tbbox)return this.tbbox;var k=this.bbox,g=this._getRealMatrix();this.bbox=null;for(var d=0,l=this.segments.length;d<l;++d)this._updateWithSegment(this.segments[d],g);g=this.bbox;this.bbox=k;return this.tbbox=g?[{x:g.l,y:g.t},{x:g.r,y:g.t},{x:g.r,y:g.b},{x:g.l,y:g.b}]:null},getLastPosition:function(){this._confirmSegmented();return"x"in
this.last?this.last:null},_applyTransform:function(){this.tbbox=null;return this.inherited(arguments)},_updateBBox:function(k,g,d){d&&(g=v.multiplyPoint(d,k,g),k=g.x,g=g.y);this.bbox&&"l"in this.bbox?(this.bbox.l>k&&(this.bbox.l=k),this.bbox.r<k&&(this.bbox.r=k),this.bbox.t>g&&(this.bbox.t=g),this.bbox.b<g&&(this.bbox.b=g)):this.bbox={l:k,b:g,r:k,t:g}},_updateWithSegment:function(k,g){var d=k.args,l=d.length,q;switch(k.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(q=0;q<l;q+=2)this._updateBBox(d[q],
d[q+1],g);this.last.x=d[l-2];this.last.y=d[l-1];this.absolute=!0;break;case "H":for(q=0;q<l;++q)this._updateBBox(d[q],this.last.y,g);this.last.x=d[l-1];this.absolute=!0;break;case "V":for(q=0;q<l;++q)this._updateBBox(this.last.x,d[q],g);this.last.y=d[l-1];this.absolute=!0;break;case "m":q=0;"x"in this.last||(this._updateBBox(this.last.x=d[0],this.last.y=d[1],g),q=2);for(;q<l;q+=2)this._updateBBox(this.last.x+=d[q],this.last.y+=d[q+1],g);this.absolute=!1;break;case "l":case "t":for(q=0;q<l;q+=2)this._updateBBox(this.last.x+=
d[q],this.last.y+=d[q+1],g);this.absolute=!1;break;case "h":for(q=0;q<l;++q)this._updateBBox(this.last.x+=d[q],this.last.y,g);this.absolute=!1;break;case "v":for(q=0;q<l;++q)this._updateBBox(this.last.x,this.last.y+=d[q],g);this.absolute=!1;break;case "c":for(q=0;q<l;q+=6)this._updateBBox(this.last.x+d[q],this.last.y+d[q+1],g),this._updateBBox(this.last.x+d[q+2],this.last.y+d[q+3],g),this._updateBBox(this.last.x+=d[q+4],this.last.y+=d[q+5],g);this.absolute=!1;break;case "s":case "q":for(q=0;q<l;q+=
4)this._updateBBox(this.last.x+d[q],this.last.y+d[q+1],g),this._updateBBox(this.last.x+=d[q+2],this.last.y+=d[q+3],g);this.absolute=!1;break;case "A":for(q=0;q<l;q+=7)this._updateBBox(d[q+5],d[q+6],g);this.last.x=d[l-2];this.last.y=d[l-1];this.absolute=!0;break;case "a":for(q=0;q<l;q+=7)this._updateBBox(this.last.x+=d[q+5],this.last.y+=d[q+6],g);this.absolute=!1}k=[k.action];for(q=0;q<l;++q)k.push(u.formatNumber(d[q],!0));if("string"==typeof this.shape.path)this.shape.path+=k.join("");else for(q=
0,l=k.length;q<l;++q)this.shape.path.push(k[q])},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(k,g){this.tbbox=null;var d=this._validSegments[k.toLowerCase()];"number"==typeof d&&(d?g.length>=d&&(k={action:k,args:g.slice(0,g.length-g.length%d)},this.segments.push(k),this._updateWithSegment(k)):(k={action:k,args:[]},this.segments.push(k),this._updateWithSegment(k)))},_collectArgs:function(k,g){for(var d=0;d<g.length;++d){var l=g[d];"boolean"==typeof l?k.push(l?1:0):
"number"==typeof l?k.push(l):l instanceof Array?this._collectArgs(k,l):"x"in l&&"y"in l&&k.push(l.x,l.y)}},moveTo:function(){this._confirmSegmented();var k=[];this._collectArgs(k,arguments);this._pushSegment(this.absolute?"M":"m",k);return this},lineTo:function(){this._confirmSegmented();var k=[];this._collectArgs(k,arguments);this._pushSegment(this.absolute?"L":"l",k);return this},hLineTo:function(){this._confirmSegmented();var k=[];this._collectArgs(k,arguments);this._pushSegment(this.absolute?
"H":"h",k);return this},vLineTo:function(){this._confirmSegmented();var k=[];this._collectArgs(k,arguments);this._pushSegment(this.absolute?"V":"v",k);return this},curveTo:function(){this._confirmSegmented();var k=[];this._collectArgs(k,arguments);this._pushSegment(this.absolute?"C":"c",k);return this},smoothCurveTo:function(){this._confirmSegmented();var k=[];this._collectArgs(k,arguments);this._pushSegment(this.absolute?"S":"s",k);return this},qCurveTo:function(){this._confirmSegmented();var k=
[];this._collectArgs(k,arguments);this._pushSegment(this.absolute?"Q":"q",k);return this},qSmoothCurveTo:function(){this._confirmSegmented();var k=[];this._collectArgs(k,arguments);this._pushSegment(this.absolute?"T":"t",k);return this},arcTo:function(){this._confirmSegmented();var k=[];this._collectArgs(k,arguments);this._pushSegment(this.absolute?"A":"a",k);return this},closePath:function(){this._confirmSegmented();this._pushSegment("Z",[]);return this},_confirmSegmented:function(){if(!this.segmented){var k=
this.shape.path;this.shape.path=[];this._setPath(k);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(k){k=r.isArray(k)?k:k.match(u.pathSvgRegExp);this.segments=[];this.absolute=!0;this.bbox={};this.last={};if(k){for(var g="",d=[],l=k.length,q=0;q<l;++q){var n=k[q],b=parseFloat(n);isNaN(b)?(g&&this._pushSegment(g,d),d=[],g=n):d.push(b)}this._pushSegment(g,d)}},setShape:function(k){this.inherited(arguments,["string"==typeof k?{path:k}:k]);this.segmented=!1;this.segments=
[];u.lazyPathSegmentation||this._confirmSegmented();return this},_2PI:2*Math.PI});t=t("dojox.gfx.path.TextPath",n,{constructor:function(k){"text"in this||(this.text=r.clone(u.defaultTextPath));"fontStyle"in this||(this.fontStyle=r.clone(u.defaultFont))},getText:function(){return this.text},setText:function(k){this.text=u.makeParameters(this.text,"string"==typeof k?{text:k}:k);this._setText();return this},getFont:function(){return this.fontStyle},setFont:function(k){this.fontStyle="string"==typeof k?
u.splitFontString(k):u.makeParameters(u.defaultFont,k);this._setFont();return this}});return u.path={Path:n,TextPath:t}})},"dojox/gfx/arc":function(){define(["./_base","dojo/_base/lang","./matrix"],function(u,r,t){function v(d){var g=Math.cos(d);d=Math.sin(d);var b={x:g+4/3*(1-g),y:d-4/3*g*(1-g)/d};return{s:{x:g,y:-d},c1:{x:b.x,y:-b.y},c2:b,e:{x:g,y:d}}}var n=2*Math.PI,k=Math.PI/4,g=Math.PI/8,d=k+g,l=v(g);return u.arc={unitArcAsBezier:v,curvePI4:l,arcAsBezier:function(q,r,b,a,m,f,c,e){m=!!m;f=!!f;
var h=t._degToRad(a);a=r*r;var B=b*b,E=t.multiplyPoint(t.rotate(-h),{x:(q.x-c)/2,y:(q.y-e)/2}),w=E.x*E.x,x=E.y*E.y;a=Math.sqrt((a*B-a*x-B*w)/(a*x+B*w));isNaN(a)&&(a=0);a={x:a*r*E.y/b,y:-a*b*E.x/r};m==f&&(a={x:-a.x,y:-a.y});a=t.multiplyPoint([t.translate((q.x+c)/2,(q.y+e)/2),t.rotate(h)],a);r=t.normalize([t.translate(a.x,a.y),t.rotate(h),t.scale(r,b)]);a=t.invert(r);q=t.multiplyPoint(a,q);e=t.multiplyPoint(a,c,e);c=Math.atan2(q.y,q.x);a=c-Math.atan2(e.y,e.x);f&&(a=-a);0>a?a+=n:a>n&&(a-=n);b=g;e=l;
b=f?b:-b;q=[];for(m=a;0<m;m-=k)m<d&&(b=m/2,e=v(b),b=f?b:-b,m=0),E=t.normalize([r,t.rotate(c+b)]),f?(a=t.multiplyPoint(E,e.c1),h=t.multiplyPoint(E,e.c2),E=t.multiplyPoint(E,e.e)):(a=t.multiplyPoint(E,e.c2),h=t.multiplyPoint(E,e.c1),E=t.multiplyPoint(E,e.s)),q.push([a.x,a.y,h.x,h.y,E.x,E.y]),c+=2*b;return q}}})},"dojox/gfx/decompose":function(){define(["./_base","dojo/_base/lang","./matrix"],function(u,r,t){function v(d,g){return Math.abs(d-g)<=1E-6*(Math.abs(d)+Math.abs(g))}function n(d,g,k,b){if(!isFinite(d))return k;
if(!isFinite(k))return d;g=Math.abs(g);b=Math.abs(b);return(g*d+b*k)/(g+b)}function k(d){d=t.normalize(d);var g=-d.xx-d.yy,l=d.xx*d.yy-d.xy*d.yx,b=Math.sqrt(g*g-4*l),g=-(g+(0>g?-b:b))/2,l=l/g,b=d.xy/(g-d.xx),a=1,m=d.xy/(l-d.xx),f=1;v(g,l)&&(b=1,m=a=0,f=1);isFinite(b)||(b=1,a=(g-d.xx)/d.xy,isFinite(a)||(b=(g-d.yy)/d.yx,a=1,isFinite(b)||(b=1,a=d.yx/(g-d.yy))));isFinite(m)||(m=1,f=(l-d.xx)/d.xy,isFinite(f)||(m=(l-d.yy)/d.yx,f=1,isFinite(m)||(m=1,f=d.yx/(l-d.yy))));d=Math.sqrt(b*b+a*a);var c=Math.sqrt(m*
m+f*f);isFinite(b/=d)||(b=0);isFinite(a/=d)||(a=0);isFinite(m/=c)||(m=0);isFinite(f/=c)||(f=0);return{value1:g,value2:l,vector1:{x:b,y:a},vector2:{x:m,y:f}}}function g(d,g){var l=0>d.xx*d.yy||0<d.xy*d.yx?-1:1,b=g.angle1=(Math.atan2(d.yx,d.yy)+Math.atan2(-l*d.xy,l*d.xx))/2,l=Math.cos(b),b=Math.sin(b);g.sx=n(d.xx/l,l,-d.xy/b,b);g.sy=n(d.yy/l,l,d.yx/b,b);return g}function d(d,g){var l=0>d.xx*d.yy||0<d.xy*d.yx?-1:1,b=g.angle2=(Math.atan2(l*d.yx,l*d.xx)+Math.atan2(-d.xy,d.yy))/2,l=Math.cos(b),b=Math.sin(b);
g.sx=n(d.xx/l,l,d.yx/b,b);g.sy=n(d.yy/l,l,-d.xy/b,b);return g}return u.decompose=function(l){var q=t.normalize(l);l={dx:q.dx,dy:q.dy,sx:1,sy:1,angle1:0,angle2:0};if(v(q.xy,0)&&v(q.yx,0))return r.mixin(l,{sx:q.xx,sy:q.yy});if(v(q.xx*q.yx,-q.xy*q.yy))return g(q,l);if(v(q.xx*q.xy,-q.yx*q.yy))return d(q,l);var n,b=new t.Matrix2D(q);n=r.mixin(b,{dx:0,dy:0,xy:b.yx,yx:b.xy});b=k([q,n]);n=k([n,q]);b=new t.Matrix2D({xx:b.vector1.x,xy:b.vector2.x,yx:b.vector1.y,yy:b.vector2.y});n=new t.Matrix2D({xx:n.vector1.x,
xy:n.vector1.y,yx:n.vector2.x,yy:n.vector2.y});q=new t.Matrix2D([t.invert(b),q,t.invert(n)]);g(n,l);q.xx*=l.sx;q.yy*=l.sy;d(b,l);q.xx*=l.sx;q.yy*=l.sy;return r.mixin(l,{sx:q.xx,sy:q.yy})}})},"dojox/gfx/bezierutils":function(){define(["./_base"],function(u){u=u.bezierutils={};u.tAtLength=function(g,d){var l=0,q=6==g.length,n=0,b=0,a=q?v:k,m=function(f,c){for(var e=0,h=0;h<f.length-2;h+=2)e+=t(f[h],f[h+1],f[h+2],f[h+3]);h=q?t(g[0],g[1],g[4],g[5]):t(g[0],g[1],g[6],g[7]);e-h>c||n+e>d+c?(++b,f=a(f,.5),
m(f[0],c),Math.abs(n-d)<=c||m(f[1],c)):(n+=e,l+=1/(1<<b))};d&&m(g,.5);return l};var r=u.computeLength=function(g){for(var d=6==g.length,l=0,q=0;q<g.length-2;q+=2)l+=t(g[q],g[q+1],g[q+2],g[q+3]);q=d?t(g[0],g[1],g[4],g[5]):t(g[0],g[1],g[6],g[7]);.1<l-q&&(g=d?v(g,.5):n(g,.5),l=r(g[0],d),l+=r(g[1],d));return l},t=u.distance=function(g,d,l,q){return Math.sqrt((l-g)*(l-g)+(q-d)*(q-d))},v=function(g,d){var l=1-d,q=l*l,k=d*d,b=g[0],a=g[1],m=g[2],f=g[3],c=g[4];g=g[5];var e=q*b+2*l*d*m+k*c,q=q*a+2*l*d*f+k*
g;return[[b,a,l*b+d*m,l*a+d*f,e,q],[e,q,l*m+d*c,l*f+d*g,c,g]]},n=function(g,d){var l=1-d,q=l*l,k=q*l,b=d*d,a=b*d,m=g[0],f=g[1],c=g[2],e=g[3],h=g[4],B=g[5],n=g[6];g=g[7];var w=k*m+3*q*d*c+3*l*b*h+a*n,k=k*f+3*q*d*e+3*l*b*B+a*g;return[[m,f,l*m+d*c,l*f+d*e,q*m+2*l*d*c+b*h,q*f+2*l*d*e+b*B,w,k],[w,k,q*c+2*l*d*h+b*n,q*e+2*l*d*B+b*g,l*h+d*n,l*B+d*g,n,g]]},k=u.splitBezierAtT=function(g,d){return 6==g.length?v(g,d):n(g,d)};return u})},"dojox/json/query":function(){define(["dojo/_base/kernel","dojo/_base/lang",
"dojox","dojo/_base/array"],function(u,r,t){r.getObject("json",!0,t);t.json._slice=function(r,n,k,g){var d=r.length,l=[];k=k||d;n=0>n?Math.max(0,n+d):Math.min(d,n);for(k=0>k?Math.max(0,k+d):Math.min(d,k);n<k;n+=g)l.push(r[n]);return l};t.json._find=function(r,n){function k(d){n&&(!0!==n||d instanceof Array?d[n]&&g.push(d[n]):g.push(d));for(var l in d){var r=d[l];n?r&&"object"==typeof r&&k(r):g.push(r)}}var g=[];if(n instanceof Array){if(1==n.length)return r[n[0]];for(var d=0;d<n.length;d++)g.push(r[n[d]])}else k(r);
return g};t.json._distinctFilter=function(r,n){for(var k=[],g={},d=0,l=r.length;d<l;++d){var q=r[d];n(q,d,r)&&("object"==typeof q&&q?q.__included||(q.__included=!0,k.push(q)):g[q+typeof q]||(g[q+typeof q]=!0,k.push(q)))}d=0;for(l=k.length;d<l;++d)k[d]&&delete k[d].__included;return k};return t.json.query=function(r,n){function k(b,a,g,f,c,e,h,l){return d[l].match(/[\*\?]/)||"~"==h?"/^"+d[l].substring(1,d[l].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,"[\\w\\W]$1")+
("~"==h?"$/i":"$/")+".test("+a+")":b}var g=0,d=[];r=r.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(b){g+="["==b?1:"]"==b?-1:0;return"]"==b&&0<g?"`]":'"'==b.charAt(0)||"'"==b.charAt(0)?"`"+(d.push(b)-1):b});var l="";r.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw Error("Unsafe function call");});r=r.replace(/([^<>=]=)([^=])/g,"$1\x3d$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(b){return"."==b.charAt(0)?b:"@"==b?"$obj":(b.match(/:|^(\$|Math|true|false|null)$/)?
"":"$obj.")+b}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(b,a,d){return(a=b.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/))?(d="",b.match(/^\./)&&(l="dojox.json._find("+l,d=",true)"),l=(a[1].match(/\=/)?"dojo.map":a[1].match(/\^/)?"dojox.json._distinctFilter":"dojo.filter")+"("+l,d+",function($obj){return "+a[2]+"})"):(a=b.match(/^\[\s*([\/\\].*)\]/))?".concat().sort(function(a,b){"+a[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(a,b,e){return"var av\x3d "+e.replace(/\$obj/,
"a")+",bv\x3d "+e.replace(/\$obj/,"b")+";if(av\x3ebv||bv\x3d\x3dnull){return "+("/"==b?1:-1)+";}\nif(bv\x3eav||av\x3d\x3dnull){return "+("/"==b?-1:1)+";}\n"})+"return 0;})":(a=b.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/))?(l="dojox.json._slice("+l,","+(a[1]||0)+","+(a[2]||0)+","+(a[3]||1)+")"):b.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)?(l="dojox.json._find("+l,("."==b.charAt(1)?",'"+d+"'":b.match(/,/)?","+b:"")+")"):b}).replace(/(\$obj\s*((\.\s*[\w_$]+\s*)|(\[\s*`([0-9]+)\s*`\]))*)(==|~)\s*`([0-9]+)/g,
k).replace(/`([0-9]+)\s*(==|~)\s*(\$obj\s*((\.\s*[\w_$]+)|(\[\s*`([0-9]+)\s*`\]))*)/g,function(b,a,d,f,c,e,h,g){return k(b,f,c,e,h,g,d,a)});r=l+("$"==r.charAt(0)?"":"$")+r.replace(/`([0-9]+|\])/g,function(b,a){return"]"==a?"]":d[a]});for(var q=eval("1\x26\x26function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj\x3d$;return "+r+"}"),x=0;x<arguments.length-1;x++)arguments[x]=arguments[x+1];return n?q.apply(this,arguments):q}})},"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),
function(u,r,t,v,n,k,g,d,l,q,x){u=u(q,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(b){this._geocodeHandler=r.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=r.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=r.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},
outSpatialReference:null,setOutSpatialReference:function(b){this.outSpatialReference=b},_geocodeHandler:function(b,a,d,f,c){try{var e=b.candidates,h;a=[];var g,m=e.length,l=b.spatialReference,q;for(g=0;g<m;g++){h=e[g];if(q=h.location)q.spatialReference=l;a[g]=new x(h)}this._successHandler([a],"onAddressToLocationsComplete",d,c)}catch(F){this._errorHandler(F,f,c)}},_geocodeAddressesHandler:function(b,a,d,f,c){try{var e=b.locations;a=[];var h,g=e.length,m=b.spatialReference,l;for(h=0;h<g;h++){if(l=
e[h].location)l.spatialReference=m;a[h]=new x(e[h])}this._successHandler([a],"onAddressesToLocationsComplete",d,c)}catch(z){this._errorHandler(z,f,c)}},addressToLocations:function(b,a,g,f,c){var e,h,m,q,k,z,x,t;b.address&&(f=g,g=a,a=b.outFields,c=b.searchExtent,t=b.countryCode,e=b.magicKey,h=b.distance,x=b.categories,b.location&&this.normalization&&(m=b.location.normalize()),q=b.locationType,k=b.maxLocations,z=b.forStorage,b=b.address);c&&(c=c.shiftCentralMeridian());var D=this.outSpatialReference;
b=this._encode(r.mixin({},this._url.query,b,{f:"json",outSR:D&&n.toJson(D.toJson()),outFields:a&&a.join(",")||null,searchExtent:c&&n.toJson(c.toJson()),category:x&&x.join(",")||null,countryCode:t||null,magicKey:e||null,distance:h||null,location:m||null,locationType:q||null,maxLocations:k||null,forStorage:z||null}));var u=this._geocodeHandler,S=this._errorHandler,I=new v(l._dfdCanceller);I._pendingDfd=d({url:this._url.path+"/findAddressCandidates",content:b,callbackParamName:"callback",load:function(a,
b){u(a,b,g,f,I)},error:function(a){S(a,f,I)}});return I},suggestLocations:function(b){var a;a=new v(l._dfdCanceller);b.hasOwnProperty("location")&&this.normalization&&(b.location=b.location.normalize());b.searchExtent&&(b.searchExtent=b.searchExtent.shiftCentralMeridian());b=this._encode(r.mixin({},this._url.query,{f:"json",text:b.text,maxSuggestions:b.maxSuggestions,searchExtent:b.searchExtent&&n.toJson(b.searchExtent.toJson()),category:b.categories&&b.categories.join(",")||null,countryCode:b.countryCode||
null,location:b.location||null,distance:b.distance||null},{f:"json"}));b=d({url:this._url.path+"/suggest",content:b,callbackParamName:"callback"});a._pendingDfd=b;b.then(r.hitch(this,function(b){b=b.suggestions||[];this.onSuggestLocationsComplete(b);a.resolve(b)}),r.hitch(this,function(b){this._errorHandler(b);a.reject(b)}));return a},addressesToLocations:function(b,a,g){var f=this.outSpatialReference,c=[],e=b.categories,h=b.locationType,m=b.countryCode;t.forEach(b.addresses,function(a,b){c.push({attributes:a})});
b=this._encode(r.mixin({},this._url.query,{category:e&&e.join(",")||null,locationType:h||null,sourceCountry:m||null},{addresses:n.toJson({records:c})},{f:"json",outSR:f&&n.toJson(f.toJson())}));var q=this._geocodeAddressesHandler,k=this._errorHandler,z=new v(l._dfdCanceller);z._pendingDfd=d({url:this._url.path+"/geocodeAddresses",content:b,callbackParamName:"callback",load:function(b,c){q(b,c,a,g,z)},error:function(a){k(a,g,z)}});return z},_reverseGeocodeHandler:function(b,a,d,f,c){try{var e=new x({address:b.address,
location:b.location,score:100});this._successHandler([e],"onLocationToAddressComplete",d,c)}catch(h){this._errorHandler(h,f,c)}},locationToAddress:function(b,a,g,f){b&&this.normalization&&(b=b.normalize());var c=this.outSpatialReference;b=this._encode(r.mixin({},this._url.query,{outSR:c&&n.toJson(c.toJson()),location:b&&n.toJson(b.toJson()),distance:a,f:"json"}));var e=this._reverseGeocodeHandler,h=this._errorHandler,m=new v(l._dfdCanceller);m._pendingDfd=d({url:this._url.path+"/reverseGeocode",content:b,
callbackParamName:"callback",load:function(a,b){e(a,b,g,f,m)},error:function(a){h(a,f,m)}});return m},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}});k("extend-esri")&&r.setObject("tasks.Locator",u,g);return u})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(u,r,t,v,n){u=u(null,{declaredClass:"esri.tasks.AddressCandidate",
constructor:function(k){r.mixin(this,k);this.location=new n(this.location)}});t("extend-esri")&&r.setObject("tasks.AddressCandidate",u,v);return u})},"esri/tasks/LegendLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(u,r,t,v){u=u(null,{declaredClass:"esri.tasks.LegendLayer",layerId:null,subLayerIds:null});t("extend-esri")&&r.setObject("tasks.LegendLayer",u,v);return u})},"esri/dijit/AttributeInspector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/sniff dojo/_base/kernel dojo/has dojo/dom-style dojo/dom-construct ../kernel ../lang ../domUtils ../layers/InheritedDomain ../layers/FeatureLayer dojo/i18n!../nls/jsapi dojo/fx dojox/gfx dijit/_Widget dijit/_Templated dijit/Editor dijit/_editor/plugins/LinkDialog dijit/_editor/plugins/TextColor ./_EventedWidget ./editing/AttachmentEditor ./editing/Util ../tasks/query dijit/form/DateTextBox dijit/form/TextBox dijit/form/NumberTextBox dijit/form/FilteringSelect dijit/form/NumberSpinner dijit/form/Button dijit/form/SimpleTextarea dijit/form/ValidationTextBox dijit/form/TimeTextBox dijit/Tooltip dojo/data/ItemFileReadStore dojox/date/islamic dojox/date/islamic/Date dojox/date/islamic/locale dojo/text!./templates/AttributeInspector.html".split(" "),
function(u,r,t,v,n,k,g,d,l,q,x,b,a,m,f,c,e,h,B,E,w,z,F,G,D,C,S,I,K,H,y,Q,U,J,A,R,O,Z,Y,M,N){var V=u([F,h,B],{declaredClass:"esri.dijit.AttributeInspector",widgetsInTemplate:!0,templateString:N,onUpdate:function(){},onDelete:function(){},onAttributeChange:function(){},onNext:function(){},onReset:function(){},onCancel:function(){},_navMessage:"( ${idx} ${of} ${numFeatures} )",_currentAttributeFieldName:null,_aiConnects:[],_selection:[],_toolTips:[],_numFeatures:0,_featureIdx:0,_currentLInfo:null,_currentFeature:null,
_rollbackInfo:null,_eventMap:{update:!0,"delete":["feature"],"attribute-change":["feature","fieldName","fieldValue"],next:["feature"],reset:!0,cancel:!0},_defaultRichTextPlugins:"bold italic underline foreColor hiliteColor | justifyLeft justifyCenter justifyRight justifyFull | insertOrderedList insertUnorderedList indent outdent | createLink".split(" "),css:{label:"atiLabel",field:"atiField",textArea:"atiTextAreaField",richText:"atiRichTextField",attachmentEditor:"atiAttachmentEditor",red:"atiRequiredField"},
constructor:function(a,b){r.mixin(this,f.widgets.attributeInspector);a=a||{};a.featureLayer||a.layerInfos||console.error("esri.AttributeInspector: please provide correct parameter in the constructor");this._datePackage=this._getDatePackage(a);this._layerInfos=a.layerInfos||[{featureLayer:a.featureLayer,options:a.options||[]}];this._layerInfos=t.filter(this._layerInfos,function(a){return!a.disableAttributeUpdate});this._hideNavButtons=a.hideNavButtons||!1},postCreate:function(){if(t.every(this._layerInfos,
function(a){return a.featureLayer.loaded}))this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature();else{var a=this._layerInfos.length;t.forEach(this._layerInfos,function(b){b=b.featureLayer;if(b.loaded)a--;else var c=v.connect(b,"onLoad",this,function(b){v.disconnect(c);c=null;a--;a||(this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature())})},this)}},destroy:function(){this._destroyAttributeTable();t.forEach(this._aiConnects,v.disconnect);delete this._aiConnects;
this._attachmentEditor&&(this._attachmentEditor.destroy(),delete this._attachmentEditor);delete this._layerInfos;this._selection=this._currentFeature=this._currentLInfo=this._attributes=this._layerInfos=null;this.inherited(arguments)},refresh:function(){this._updateSelection()},first:function(){this.onFirstFeature()},last:function(){this.onLastFeature()},next:function(){this.onNextFeature()},previous:function(){this.onPreviousFeature()},showFeature:function(a,b){b&&(this._createOnlyFirstTime=!0);
this._updateSelection([a],b);this._updateUI()},onLayerSelectionChange:function(a,b,c){this._createOnlyFirstTime=!1;this._featureIdx=c===m.SELECTION_NEW?0:this._featureIdx;this._updateSelection();this._updateUI()},onLayerSelectionClear:function(){!this._selection||0>=this._selection.length||(this._featureIdx=this._numFeatures=0,this._selection=[],this._currentLInfo=this._currentFeature=null,this._updateUI())},onLayerUpdateEnd:function(a,b,c,e){},onLayerError:function(a,b,c,e){},onLayerEditsError:function(a,
b,c,e){},onLayerEditsComplete:function(a,b,c,e){e=e||[];if(e.length){var f=this._selection,d=a.featureLayer.objectIdField;t.forEach(e,r.hitch(this,function(a){t.some(f,r.hitch(this,function(b,c){if(b.attributes[d]!==a.objectId)return!1;this._selection.splice(c,1);return!0}))}))}b=b||[];b.length&&(this._selection=D.findFeatures(b,a.featureLayer),this._featureIdx=0);e=this._numFeatures=(this._selection=D.sortFeaturesById(this._layerInfos,this._selection))?this._selection.length:0;if(b.length){if(b=
e?this._selection[this._featureIdx]:null)e=b.getLayer().getEditCapabilities(),e.canCreate&&!e.canUpdate||this._showFeature(b);this._updateUI()}c=c||[];if(c.length){var h=this._rollbackInfo;t.forEach(c,function(b){var e=D.findFeatures(c,a.featureLayer)[0];if(!b.success&&e.attributes[a.featureLayer.objectIdField]===b.objectId&&h){var f=h.field;b=h.graphic.attributes[f.name];var d=t.filter(this._currentLInfo.fieldInfos,function(a){return a.fieldName===f.name},this)[0].dijit;e.attributes[f.name]=b;"esriFieldTypeDate"===
f.type&&(b=new Date(b));this._setValue(d,b)}},this)}this._rollbackInfo=null},onFieldValueChange:function(a,b){var c=a.field,e=a.dijit,f=this._currentFeature,d=this._currentLInfo,h=c.name;a=this._isFieldRequired(c,a);if(""===e.displayedValue||"dijit.form.ValidationTextBox"!==e.declaredClass||e.isValid())if(""!==e.displayedValue&&e.displayedValue!==b&&e.isValid&&!e.isValid())this._setValue(e,f.attributes[c.name]);else{var g=!("esriFieldTypeInteger"!==c.type&&"esriFieldTypeSmallInteger"!==c.type&&"esriFieldTypeSingle"!==
c.type&&"esriFieldTypeDouble"!==c.type);if(a&&(null===b||""===b||"undefined"===typeof b||g&&isNaN(b))){h=f.attributes[c.name];if("esriFieldTypeDate"===c.type&&(h=new Date(h),e instanceof Array)){this._setValue(e[0],h);this._setValue(e[1],h);return}this._setValue(e,h)}else{if(g){if(isNaN(b)||""===b)b=null;g&&null!==b&&(b=Number(b))}"esriFieldTypeDate"===c.type&&(e instanceof Array?(b=e[0].getValue(),e=e[1].getValue(),b=b&&e?new Date(b.getFullYear(),b.getMonth(),b.getDate(),e.getHours(),e.getMinutes(),
e.getSeconds(),e.getMilliseconds()):b||e||null):(b=e.getValue(),c.domain&&(b=Number(b))),b=b&&b.getTime?b.getTime():b&&b.toGregorian?b.toGregorian().getTime():b);if(this._currentFeature.attributes[c.name]!==b){if(h===d.typeIdField){var y=this._findFirst(d.types,"id",b);t.forEach(d.fieldInfos,function(a){(c=a.field)&&c.name!==d.typeIdField&&(a=a.dijit,this._setFieldDomain(a,y,c)&&a&&(this._setValue(a,f.attributes[c.name]+""),!1===a.isValid()&&this._setValue(a,null)))},this)}this.onAttributeChange(f,
h,b)}}}else this._setValue(e,f.attributes[c.name])},onDeleteBtn:function(a){this._deleteFeature()},onNextFeature:function(a){this._onNextFeature(1)},onPreviousFeature:function(a){this._onNextFeature(-1)},onFirstFeature:function(a){this._onNextFeature(-1*this._featureIdx)},onLastFeature:function(a){this._onNextFeature(this._numFeatures-1-this._featureIdx)},_initLayerInfos:function(){var a=this._layerInfos;this._editorTrackingInfos={};t.forEach(a,this._initLayerInfo,this)},_initLayerInfo:function(a){var b=
a.featureLayer,c,e;this._userIds={};e=b.id;b.credential&&(this._userIds[e]=b.credential.userId);a.userId&&(this._userIds[e]=a.userId);this._connect(b,"onSelectionComplete",r.hitch(this,"onLayerSelectionChange",a));this._connect(b,"onSelectionClear",r.hitch(this,"onLayerSelectionClear",a));this._connect(b,"onEditsComplete",r.hitch(this,"onLayerEditsComplete",a));this._connect(b,"error",r.hitch(this,"onLayerError",a));this._connect(b,"onUpdateEnd",r.hitch(this,"onLayerUpdateEnd",a));a.showAttachments=
b.hasAttachments?x.isDefined(a.showAttachments)?a.showAttachments:!0:!1;a.hideFields=a.hideFields||[];a.htmlFields=a.htmlFields||[];a.isEditable=b.isEditable()?x.isDefined(a.isEditable)?a.isEditable:!0:!1;a.typeIdField=b.typeIdField;a.layerId=b.id;a.types=b.types;b.globalIdField&&((c=this._findFirst(a.fieldInfos,"fieldName",b.globalIdField))||a.showGlobalID||a.hideFields.push(b.globalIdField));(e=this._findFirst(a.fieldInfos,"fieldName",b.objectIdField))||a.showObjectID||a.hideFields.push(b.objectIdField);
var f=this._getFields(a.featureLayer);if(f){var d=a.fieldInfos||[],d=t.map(d,function(a){return r.mixin({},a)});d.length?a.fieldInfos=t.filter(t.map(d,r.hitch(this,function(b){var c=b.stringFieldOption||(this._isInFields(b.fieldName,a.htmlFields)?V.STRING_FIELD_OPTION_RICHTEXT:V.STRING_FIELD_OPTION_TEXTBOX);return r.mixin(b,{field:this._findFirst(f,"name",b.fieldName),stringFieldOption:c})})),"return item.field;"):(f=t.filter(f,r.hitch(this,function(b){return!this._isInFields(b.name,a.hideFields)})),
a.fieldInfos=t.map(f,r.hitch(this,function(b){var c=this._isInFields(b.name,a.htmlFields)?V.STRING_FIELD_OPTION_RICHTEXT:V.STRING_FIELD_OPTION_TEXTBOX;return{fieldName:b.name,field:b,stringFieldOption:c}})));a.showGlobalID&&!c&&d.push(this._findFirst(f,"name",b.globalIdField));a.showObjectID&&!e&&d.push(this._findFirst(f,"name",b.objectIdField));c=[];b.editFieldsInfo&&(b.editFieldsInfo.creatorField&&c.push(b.editFieldsInfo.creatorField),b.editFieldsInfo.creationDateField&&c.push(b.editFieldsInfo.creationDateField),
b.editFieldsInfo.editorField&&c.push(b.editFieldsInfo.editorField),b.editFieldsInfo.editDateField&&c.push(b.editFieldsInfo.editDateField));this._editorTrackingInfos[b.id]=c}},_createAttachmentEditor:function(){this._attachmentEditor=null;var a=t.filter(this._layerInfos,function(a){return a.showAttachments});a&&a.length&&(this._attachmentEditor=new G({"class":this.css.attachmentEditor},this.attachmentEditor),this._attachmentEditor.startup())},_setCurrentLInfo:function(a){var b=this._currentLInfo?this._currentLInfo.featureLayer:
null,c=a.featureLayer;if(b&&b.id===c.id&&!b.ownershipBasedAccessControlForFeatures&&(b=c.getEditCapabilities(),!b.canCreate||b.canUpdate))return;this._currentLInfo=a;this._createTable()},_updateSelection:function(a,b){this._selection=a||[];t.forEach(this._layerInfos,this._getSelection,this);this._selection=D.sortFeaturesById(this._layerInfos,this._selection);this._numFeatures=this._selection.length;this._showFeature(this._numFeatures?this._selection[this._featureIdx]:null,b)},_getSelection:function(a){a=
a.featureLayer.getSelectedFeatures();this._selection=this._selection.concat(a)},_updateUI:function(){var a=this._numFeatures,b=this._currentLInfo;this.layerName.innerHTML=b&&0!==a?b.featureLayer?b.featureLayer.name:"":this.NLS_noFeaturesSelected;d.set(this.attributeTable,"display",a?"":"none");d.set(this.editButtons,"display",a?"":"none");d.set(this.navButtons,"display",!this._hideNavButtons&&1<a?"":"none");this.navMessage.innerHTML=x.substitute({idx:this._featureIdx+1,of:this.NLS_of,numFeatures:this._numFeatures},
this._navMessage);this._attachmentEditor&&d.set(this._attachmentEditor.domNode,"display",b&&b.showAttachments&&a?"":"none");d.set(this.deleteBtn.domNode,"display",b&&!1===b.showDeleteButton||!this._canDelete?"none":"");this.domNode.parentNode&&0<this.domNode.parentNode.scrollTop&&(this.domNode.parentNode.scrollTop=0)},_onNextFeature:function(a){this._featureIdx+=a;0>this._featureIdx?this._featureIdx=this._numFeatures-1:this._featureIdx>=this._numFeatures&&(this._featureIdx=0);a=this._selection.length?
this._selection[this._featureIdx]:null;this._showFeature(a);this._updateUI();this.onNext(a)},_deleteFeature:function(){this.onDelete(this._currentFeature)},_showFeature:function(a,c){if(a){this._currentFeature=a;c=c?c:a.getLayer();var e=c.getEditCapabilities({feature:a,userId:this._userIds[c.id]});this._canUpdate=e.canUpdate;this._canDelete=e.canDelete;if(e=this._getLInfoFromFeatureLayer(c)){this._setCurrentLInfo(e);var f=a.attributes,d=this._findFirst(e.types,"id",f[e.typeIdField]),h=null;t.forEach(e.fieldInfos,
function(a){h=a.field;var b=[];a.dijit&&1<a.dijit.length?t.forEach(a.dijit,function(a){b.push(a)}):b.push(a.dijit);t.forEach(b,r.hitch(this,function(a){if(a){var b=this._setFieldDomain(a,d,h),c=f[h.name],c=c&&b&&b.codedValues&&b.codedValues.length?b.codedValues[c]?b.codedValues[c].name:c:c;x.isDefined(c)||(c="");"dijit.form.DateTextBox"===a.declaredClass||"dijit.form.TimeTextBox"===a.declaredClass?c=""===c?null:new Date(c):"dijit.form.FilteringSelect"===a.declaredClass&&(a._lastValueReported=null,
c=f[h.name]+"");try{this._setValue(a,c),"dijit.form.FilteringSelect"===a.declaredClass&&!1===a.isValid()&&this._setValue(a,null)}catch(fa){a.set("displayedValue",this.NLS_errorInvalid,!1)}}}))},this);this._attachmentEditor&&e.showAttachments&&this._attachmentEditor.showAttachments(this._currentFeature,c);(a=c.getEditSummary(a))?(this.editorTrackingInfoDiv.innerHTML=a,b.show(this.editorTrackingInfoDiv)):b.hide(this.editorTrackingInfoDiv)}}},_setFieldDomain:function(b,c,e){if(!b)return null;var f=e.domain;
c&&c.domains&&c.domains[e.name]&&!1===c.domains[e.name]instanceof a&&(f=c.domains[e.name]);if(!f)return null;f.codedValues&&0<f.codedValues.length?(b.set("store",this._toStore(t.map(f.codedValues,function(a){return{id:a.code+="",name:a.name}}))),this._setValue(b,f.codedValues[0].code)):(b.constraints={min:x.isDefined(f.minValue)?f.minValue:Number.MIN_VALUE,max:x.isDefined(f.maxValue)?f.maxValue:Number.MAX_VALUE},this._setValue(b,b.constraints.min));return f},_setValue:function(a,b){a.set&&(a._onChangeActive=
!1,a.set("value",b,!0),a._onChangeActive=!0)},_getFields:function(a){var b=a._getOutFields();if(!b)return null;a=a.fields;return"*"==b?a:t.filter(t.map(b,r.hitch(this,"_findFirst",a,"name")),x.isDefined)},_isInFields:function(a,b){return a&&(b||b.length)?t.some(b,function(b){return b.toLowerCase()===a.toLowerCase()}):!1},_isFieldNullable:function(a,b){return!(!1===a.nullable||b.field&&!1===b.field.nullable)},_isFieldRequired:function(a,b){return!1!==a.editable&&!1!==b.isEditable&&!this._isFieldNullable(a,
b)},_findFirst:function(a,b,c){return(a=t.filter(a,function(a){return a.hasOwnProperty(b)&&a[b]===c}))&&a.length?a[0]:null},_getLInfoFromFeatureLayer:function(a){return this._findFirst(this._layerInfos,"layerId",a?a.id:null)},_createTable:function(){this._destroyAttributeTable();this.attributeTable.innerHTML="";this._attributes=l.create("table",{cellspacing:"0",cellpadding:"0"},this.attributeTable);var a=l.create("tbody",null,this._attributes),b=this._currentLInfo,c=this._findFirst(b.types,"id",this._currentFeature.attributes[b.typeIdField]);
t.forEach(b.fieldInfos,r.hitch(this,"_createField",c,a),this);this._createOnlyFirstTime=!1},_createField:function(a,b,c){var e=this._currentLInfo,f=c.field;if(!this._isInFields(f.name,e.hideFields)&&!this._isInFields(f.name,this._editorTrackingInfos[e.featureLayer.id])){var d=!1,h,g,y;b=l.create("tr",null,b);h=l.create("td",{innerHTML:c.label||f.alias||f.name,"class":this.css.label,"data-fieldname":f.name},b);this._isFieldRequired(f,c)&&l.create("span",{"class":this.css.red,innerHTML:" *"},h);b=l.create("td",
null,b);if(c.customField)l.place(c.customField.domNode||c.customField,l.create("div",null,b),"first"),g=c.customField;else if(!1===e.isEditable||!1===f.editable||!1===c.isEditable||"esriFieldTypeOID"===f.type||"esriFieldTypeGlobalID"===f.type||!this._canUpdate&&!this._createOnlyFirstTime)d=!0;e=e.typeIdField&&f.name.toLowerCase()==e.typeIdField.toLowerCase();h=!!this._getDomainForField(f,a);!g&&e?g=this._createTypeField(f,c,b):!g&&h&&(g=this._createDomainField(f,c,a,b));if(!g)switch(f.type){case "esriFieldTypeString":g=
this._createStringField(f,c,b);break;case "esriFieldTypeDate":g=this._createDateField(f,c,b);c.format&&c.format.time&&(y=this._createTimeField(f,c,b));break;case "esriFieldTypeInteger":case "esriFieldTypeSmallInteger":g=this._createIntField(f,c,b);break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":g=this._createFltField(f,c,b);break;default:g=this._createStringField(f,c,b)}c.tooltip&&c.tooltip.length&&this._toolTips.push(new R({connectId:[g.id],label:c.tooltip}));g.onChange=r.hitch(this,
"onFieldValueChange",c);g.set("disabled",d);y?(c.dijit=[g,y],y.onChange=r.hitch(this,"onFieldValueChange",c),y.set("disabled",d)):c.dijit=g}},_createTypeField:function(a,b,c){c=l.create("div",null,c);var e=a.domain;return e&&"range"===e.type&&e.minValue===e.maxValue?new J({"class":this.css.field,trim:!0,maxLength:a.length,name:a.alias||a.name,required:this._isFieldRequired(a,b)},c):new H({"class":this.css.field,name:a.alias||a.name,required:this._isFieldRequired(a,b),store:this._toStore(t.map(this._currentLInfo.types,
function(a){return{id:a.id,name:a.name}})),searchAttr:"name"},c)},_getDomainForField:function(b,c){var e=b.domain;(b=b.name)&&c&&c.domains&&c.domains[b]&&!1===c.domains[b]instanceof a&&(e=c.domains[b]);return e||null},_createDomainField:function(a,b,c,e){c=this._getDomainForField(a,c);e=l.create("div",null,e);return c.codedValues?new H({"class":this.css.field,name:a.alias||a.name,searchAttr:"name",required:this._isFieldRequired(a,b)},e):new y({"class":this.css.field},e)},_createStringField:function(a,
b,c){c=l.create("div",null,c);var e={trim:!0,maxLength:a.length,required:this._isFieldRequired(a,b)};if(b.stringFieldOption===V.STRING_FIELD_OPTION_TEXTAREA)return e["class"]=this.css.field+" "+this.css.textArea,new U(e,c);if(b.stringFieldOption===V.STRING_FIELD_OPTION_RICHTEXT)return e["class"]=this.css.field+" "+this.css.richText,e.height="100%",e.width="100%",e.plugins=b.richTextPlugins||this._defaultRichTextPlugins,c=new E(e,c),c.startup(),c;var f=this;e.validator=function(c,e){this._maskValidSubsetError=
!1;this._hasBeenBlurred=!0;return f._isFieldNullable(a,b)||!(""===c||null===c)};return new J(e,c)},_createTimeField:function(a,b,c){c=l.create("div",null,c);a={"class":this.css.field,trim:!0,required:this._isFieldRequired(a,b),constraints:{formatLength:"medium"}};this._datePackage&&(a.datePackage=this._datePackage);return new A(a,c)},_createDateField:function(a,b,c){c=l.create("div",null,c);a={"class":this.css.field,trim:!0,required:this._isFieldRequired(a,b)};this._datePackage&&(a.datePackage=this._datePackage);
return new S(a,c)},_createIntField:function(a,b,c){c=l.create("div",null,c);return new K({"class":this.css.field,constraints:"esriFieldTypeSmallInteger"===a.type?{min:-32768,max:32767,places:0}:{places:0},trim:!0,invalidMessage:this.NLS_validationInt,required:this._isFieldRequired(a,b)},c)},_createFltField:function(a,b,c){c=l.create("div",null,c);return new K({"class":this.css.field,constraints:{max:Infinity,min:-Infinity,places:"0,20"},trim:!0,invalidMessage:this.NLS_validationFlt,required:this._isFieldRequired(a,
b)},c)},_toStore:function(a){return new O({data:{identifier:"id",label:"name",items:a}})},_connect:function(a,b,c){this._aiConnects.push(v.connect(a,b,c))},_getDatePackage:function(a){return null===a.datePackage?null:a.datePackage?a.datePackage:"ar"===k.locale?"dojox.date.islamic":null},_destroyAttributeTable:function(){t.forEach(this._layerInfos,function(a){t.forEach(a.fieldInfos,function(a){var b=a.dijit;if(b){b._onChangeHandle=null;if(a.customField)return;b instanceof Array?t.forEach(b,r.hitch(this,
function(a){a.destroyRecursive?a.destroyRecursive():a.destroy&&a.destroy();a._onChangeHandle=null})):b.destroyRecursive?b.destroyRecursive():b.destroy&&b.destroy()}a.dijit=null},this)},this);t.forEach(this._toolTips,function(a){a.destroy()});this._toolTips=[];this._attributes&&l.destroy(this._attributes)}});r.mixin(V,{STRING_FIELD_OPTION_RICHTEXT:"richtext",STRING_FIELD_OPTION_TEXTAREA:"textarea",STRING_FIELD_OPTION_TEXTBOX:"textbox"});g("extend-esri")&&r.setObject("dijit.AttributeInspector",V,q);
return V})},"dijit/Editor":function(){define("require dojo/_base/array dojo/_base/declare dojo/Deferred dojo/i18n dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/string dojo/topic ./_Container ./Toolbar ./ToolbarSeparator ./layout/_LayoutWidget ./form/ToggleButton ./_editor/_Plugin ./_editor/plugins/EnterKeyHandling ./_editor/html ./_editor/range ./_editor/RichText ./main dojo/i18n!./_editor/nls/commands".split(" "),function(u,r,t,v,n,k,g,d,
l,q,x,b,a,m,f,c,e,h,B,E,w,z,F,G,D){function C(a){return new E({command:a.name})}function S(a){return new E({buttonClass:B,command:a.name})}t=t("dijit.Editor",G,{plugins:null,extraPlugins:null,constructor:function(){x.isArray(this.plugins)||(this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull",w]);this._plugins=[];this._editInterval=
1E3*this.editActionInterval;if(b("ie")||b("trident")||b("edge"))this.events.push("onBeforeDeactivate"),this.events.push("onBeforeActivate")},postMixInProperties:function(){this.setValueDeferred=new v;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._steps=this._steps.slice(0);this._undoedSteps=this._undoedSteps.slice(0);x.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins));this.commands=n.getLocalization("dijit._editor","commands",this.lang);
b("webkit")&&l.set(this.domNode,"KhtmlUserSelect","none")},startup:function(){this.inherited(arguments);this.toolbar||(this.toolbar=new c({ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,"aria-label":this.id}),this.header.appendChild(this.toolbar.domNode));r.forEach(this.plugins,this.addPlugin,this);this.setValueDeferred.resolve(!0);g.add(this.iframe.parentNode,"dijitEditorIFrameContainer");g.add(this.iframe,"dijitEditorIFrame");k.set(this.iframe,"allowTransparency",!0);this.toolbar.startup();
this.onNormalizedDisplayChanged()},destroy:function(){r.forEach(this._plugins,function(a){a&&a.destroy&&a.destroy()});this._plugins=[];this.toolbar.destroyRecursive();delete this.toolbar;this.inherited(arguments)},addPlugin:function(a,b){var c=x.isString(a)?{name:a}:x.isFunction(a)?{ctor:a}:a;if(!c.setEditor){var e={args:c,plugin:null,editor:this};c.name&&(E.registry[c.name]?e.plugin=E.registry[c.name](c):m.publish(D._scopeName+".Editor.getPlugin",e));if(!e.plugin)try{var f=c.ctor||x.getObject(c.name)||
u(c.name);f&&(e.plugin=new f(c))}catch(U){throw Error(this.id+": cannot find plugin ["+c.name+"]");}if(!e.plugin)throw Error(this.id+": cannot find plugin ["+c.name+"]");a=e.plugin}1<arguments.length?this._plugins[b]=a:this._plugins.push(a);a.setEditor(this);x.isFunction(a.setToolbar)&&a.setToolbar(this.toolbar)},resize:function(a){a&&h.prototype.resize.apply(this,arguments)},layout:function(){var a=this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+d.getPadBorderExtents(this.iframe.parentNode).h+
d.getMarginExtents(this.iframe.parentNode).h);this.editingArea.style.height=a+"px";this.iframe&&(this.iframe.style.height="100%");this._layoutMode=!0},_onIEMouseDown:function(a){var b,c=this.document.body,e=c.clientWidth,f=c.clientHeight,d=c.clientLeft,h=c.offsetWidth,g=c.offsetHeight,m=c.offsetLeft;/^rtl$/i.test(c.dir||"")?e<h&&a.x>e&&a.x<h&&(b=!0):a.x<d&&a.x>m&&(b=!0);b||f<g&&a.y>f&&a.y<g&&(b=!0);b||(delete this._cursorToStart,delete this._savedSelection,"BODY"==a.target.tagName&&this.defer("placeCursorAtEnd"),
this.inherited(arguments))},onBeforeActivate:function(){this._restoreSelection()},onBeforeDeactivate:function(a){this.customUndo&&this.endEditing(!0);"BODY"!=a.target.tagName&&this._saveSelection()},customUndo:!0,editActionInterval:3,beginEditing:function(a){this._inEditing||(this._inEditing=!0,this._beginEditing(a));0<this.editActionInterval&&(this._editTimer&&this._editTimer.remove(),this._editTimer=this.defer("endEditing",this._editInterval))},_steps:[],_undoedSteps:[],execCommand:function(a){if(!this.customUndo||
"undo"!=a&&"redo"!=a){this.customUndo&&(this.endEditing(),this._beginEditing());var b=this.inherited(arguments);this.customUndo&&this._endEditing();return b}return this[a]()},_pasteImpl:function(){return this._clipboardCommand("paste")},_cutImpl:function(){return this._clipboardCommand("cut")},_copyImpl:function(){return this._clipboardCommand("copy")},_clipboardCommand:function(c){var e;try{if(e=this.document.execCommand(c,!1,null),b("webkit")&&!e)throw{};}catch(H){e=a.substitute,alert(e(this.commands.systemShortcut,
[this.commands[c],e(this.commands[b("mac")?"appleKey":"ctrlKey"],[{cut:"X",copy:"C",paste:"V"}[c]])])),e=!1}return e},queryCommandEnabled:function(a){return!this.customUndo||"undo"!=a&&"redo"!=a?this.inherited(arguments):"undo"==a?1<this._steps.length:0<this._undoedSteps.length},_moveToBookmark:function(a){var c=a.mark,e=a.mark;a=a.isCollapsed;var f,d,h;e&&(9>b("ie")||9===b("ie")&&b("quirks")?x.isArray(e)?(c=[],r.forEach(e,function(a){c.push(F.getNode(a,this.editNode))},this),this.selection.moveToBookmark({mark:c,
isCollapsed:a})):e.startContainer&&e.endContainer&&(h=F.getSelection(this.window))&&h.removeAllRanges&&(h.removeAllRanges(),a=F.create(this.window),f=F.getNode(e.startContainer,this.editNode),d=F.getNode(e.endContainer,this.editNode),f&&d&&(a.setStart(f,e.startOffset),a.setEnd(d,e.endOffset),h.addRange(a))):(h=F.getSelection(this.window))&&h.removeAllRanges&&(h.removeAllRanges(),a=F.create(this.window),f=F.getNode(e.startContainer,this.editNode),d=F.getNode(e.endContainer,this.editNode),f&&d&&(a.setStart(f,
e.startOffset),a.setEnd(d,e.endOffset),h.addRange(a))))},_changeToStep:function(a,b){this.setValue(b.text);(a=b.bookmark)&&this._moveToBookmark(a)},undo:function(){var a=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var b=this._steps.pop();b&&0<this._steps.length&&(this.focus(),this._changeToStep(b,this._steps[this._steps.length-1]),this._undoedSteps.push(b),this.onDisplayChanged(),delete this._undoRedoActive,a=!0);delete this._undoRedoActive}return a},redo:function(){var a=
!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var b=this._undoedSteps.pop();b&&0<this._steps.length&&(this.focus(),this._changeToStep(this._steps[this._steps.length-1],b),this._steps.push(b),this.onDisplayChanged(),a=!0);delete this._undoRedoActive}return a},endEditing:function(a){this._editTimer&&(this._editTimer=this._editTimer.remove());this._inEditing&&(this._endEditing(a),this._inEditing=!1)},_getBookmark:function(){var a=this.selection.getBookmark(),c=[];if(a&&a.mark){var e=
a.mark;if(9>b("ie")||9===b("ie")&&b("quirks")){var f=F.getSelection(this.window);if(x.isArray(e))r.forEach(a.mark,function(a){c.push(F.getIndex(a,this.editNode).o)},this),a.mark=c;else if(f){var d;f.rangeCount&&(d=f.getRangeAt(0));a.mark=d?d.cloneRange():this.selection.getBookmark()}}try{a.mark&&a.mark.startContainer&&(c=F.getIndex(a.mark.startContainer,this.editNode).o,a.mark={startContainer:c,startOffset:a.mark.startOffset,endContainer:a.mark.endContainer===a.mark.startContainer?c:F.getIndex(a.mark.endContainer,
this.editNode).o,endOffset:a.mark.endOffset})}catch(U){a.mark=null}}return a},_beginEditing:function(){0===this._steps.length&&this._steps.push({text:z.getChildrenHtml(this.editNode),bookmark:this._getBookmark()})},_endEditing:function(){var a=z.getChildrenHtml(this.editNode);this._undoedSteps=[];this._steps.push({text:a,bookmark:this._getBookmark()})},onKeyDown:function(a){b("ie")||this.iframe||a.keyCode!=q.TAB||this.tabIndent||this._saveSelection();if(this.customUndo){var c=a.keyCode;if(a.ctrlKey&&
!a.shiftKey&&!a.altKey){if(90==c||122==c){a.stopPropagation();a.preventDefault();this.undo();return}if(89==c||121==c){a.stopPropagation();a.preventDefault();this.redo();return}}this.inherited(arguments);switch(c){case q.ENTER:case q.BACKSPACE:case q.DELETE:this.beginEditing();break;case 88:case 86:if(a.ctrlKey&&!a.altKey&&!a.metaKey){this.endEditing();88==a.keyCode?this.beginEditing("cut"):this.beginEditing("paste");this.defer("endEditing",1);break}default:if(!a.ctrlKey&&!a.altKey&&!a.metaKey&&(a.keyCode<
q.F1||a.keyCode>q.F15)){this.beginEditing();break}case q.ALT:this.endEditing();break;case q.UP_ARROW:case q.DOWN_ARROW:case q.LEFT_ARROW:case q.RIGHT_ARROW:case q.HOME:case q.END:case q.PAGE_UP:case q.PAGE_DOWN:this.endEditing(!0);case q.CTRL:case q.SHIFT:case q.TAB:}}else this.inherited(arguments)},_onBlur:function(){this.inherited(arguments);this.endEditing(!0)},_saveSelection:function(){try{this._savedSelection=this._getBookmark()}catch(I){}},_restoreSelection:function(){this._savedSelection&&
(delete this._cursorToStart,this.selection.isCollapsed()&&this._moveToBookmark(this._savedSelection),delete this._savedSelection)},onClick:function(){this.endEditing(!0);this.inherited(arguments)},replaceValue:function(a){this.customUndo?this.isClosed?this.setValue(a):(this.beginEditing(),a||(a="\x26#160;"),this.setValue(a),this.endEditing()):this.inherited(arguments)},_setDisabledAttr:function(a){this.setValueDeferred.then(x.hitch(this,function(){!this.disabled&&a||!this._buttonEnabledPlugins&&a?
r.forEach(this._plugins,function(a){a.set("disabled",!0)}):this.disabled&&!a&&r.forEach(this._plugins,function(a){a.set("disabled",!1)})}));this.inherited(arguments)},_setStateClass:function(){try{this.inherited(arguments),this.document&&this.document.body&&(l.set(this.document.body,"color",l.get(this.iframe,"color")),l.set(this.document.body,"background-color",l.get(this.iframe,"background-color")))}catch(I){}}});x.mixin(E.registry,{undo:C,redo:C,cut:C,copy:C,paste:C,insertOrderedList:C,insertUnorderedList:C,
indent:C,outdent:C,justifyCenter:C,justifyFull:C,justifyLeft:C,justifyRight:C,"delete":C,selectAll:C,removeFormat:C,unlink:C,insertHorizontalRule:C,bold:S,italic:S,underline:S,strikethrough:S,subscript:S,superscript:S,"|":function(){return new E({setEditor:function(a){this.editor=a;this.button=new e({ownerDocument:a.ownerDocument})}})}});return t})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(u,r,t,v,n,k,g,d){t("dijit-legacy-requires")&&n(0,function(){u(["dijit/ToolbarSeparator"])});return r("dijit.Toolbar",[k,d,g],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"dijit/ToolbarSeparator":function(){define(["dojo/_base/declare","dojo/dom","./_Widget","./_TemplatedMixin"],
function(u,r,t,v){return u("dijit.ToolbarSeparator",[t,v],{templateString:'\x3cdiv class\x3d"dijitToolbarSeparator dijitInline" role\x3d"presentation"\x3e\x3c/div\x3e',buildRendering:function(){this.inherited(arguments);r.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/_editor/_Plugin":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","../Destroyable","../form/Button"],function(u,r,t,v,n){r=r("dijit._editor._Plugin",v,{constructor:function(k){this.params=
k||{};t.mixin(this,this.params);this._attrPairNames={}},editor:null,iconClassPrefix:"dijitEditorIcon",button:null,command:"",useDefaultCommand:!0,buttonClass:n,disabled:!1,getLabel:function(k){return this.editor.commands[k]},_initButton:function(){if(this.command.length){var k=this.getLabel(this.command),g=this.editor,d=this.iconClassPrefix+" "+this.iconClassPrefix+this.command.charAt(0).toUpperCase()+this.command.substr(1);this.button||(k=t.mixin({label:k,ownerDocument:g.ownerDocument,dir:g.dir,
lang:g.lang,showLabel:!1,iconClass:d,dropDown:this.dropDown,tabIndex:"-1"},this.params||{}),delete k.name,this.button=new this.buttonClass(k))}this.get("disabled")&&this.button&&this.button.set("disabled",this.get("disabled"))},destroy:function(){this.dropDown&&this.dropDown.destroyRecursive();this.inherited(arguments)},connect:function(k,g,d){this.own(u.connect(k,g,this,d))},updateState:function(){var k=this.editor,g=this.command,d,l;if(k&&k.isLoaded&&g.length){var q=this.get("disabled");if(this.button)try{var r=
k._implCommand(g);l=!q&&(this[r]?this[r](g):k.queryCommandEnabled(g));this.enabled!==l&&(this.enabled=l,this.button.set("disabled",!l));l&&"boolean"==typeof this.button.checked&&(d=k.queryCommandState(g),this.checked!==d&&(this.checked=d,this.button.set("checked",k.queryCommandState(g))))}catch(b){console.log(b)}}},setEditor:function(k){this.editor=k;this._initButton();this.button&&this.useDefaultCommand&&(this.editor.queryCommandAvailable(this.command)?this.own(this.button.on("click",t.hitch(this.editor,
"execCommand",this.command,this.commandArg))):this.button.domNode.style.display="none");this.own(this.editor.on("NormalizedDisplayChanged",t.hitch(this,"updateState")))},setToolbar:function(k){this.button&&k.addChild(this.button)},set:function(k,g){if("object"===typeof k){for(var d in k)this.set(d,k[d]);return this}d=this._getAttrNames(k);if(this[d.s])var l=this[d.s].apply(this,Array.prototype.slice.call(arguments,1));else this._set(k,g);return l||this},get:function(k){var g=this._getAttrNames(k);
return this[g.g]?this[g.g]():this[k]},_setDisabledAttr:function(k){this._set("disabled",k);this.updateState()},_getAttrNames:function(k){var g=this._attrPairNames;if(g[k])return g[k];var d=k.charAt(0).toUpperCase()+k.substr(1);return g[k]={s:"_set"+d+"Attr",g:"_get"+d+"Attr"}},_set:function(k,g){this[k]=g}});r.registry={};return r})},"dijit/_editor/plugins/EnterKeyHandling":function(){define("dojo/_base/declare dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ../_Plugin ../RichText ../range".split(" "),
function(u,r,t,v,n,k,g,d,l,q,x){return u("dijit._editor.plugins.EnterKeyHandling",l,{blockNodeForEnter:"BR",constructor:function(b){b&&("blockNodeForEnter"in b&&(b.blockNodeForEnter=b.blockNodeForEnter.toUpperCase()),v.mixin(this,b))},setEditor:function(b){if(this.editor!==b)if(this.editor=b,"BR"==this.blockNodeForEnter)this.editor.customUndo=!0,b.onLoadDeferred.then(v.hitch(this,function(a){this.own(n(b.document,"keydown",v.hitch(this,function(a){if(a.keyCode==t.ENTER){var b=v.mixin({},a);b.shiftKey=
!0;this.handleEnterKey(b)||(a.stopPropagation(),a.preventDefault())}})));9<=k("ie")&&10>=k("ie")&&this.own(n(b.document,"paste",v.hitch(this,function(a){setTimeout(v.hitch(this,function(){var a=this.editor.document.selection.createRange();a.move("character",-1);a.select();a.move("character",1);a.select()}),0)})));return a}));else if(this.blockNodeForEnter){var a=v.hitch(this,"handleEnterKey");b.addKeyHandler(13,0,0,a);b.addKeyHandler(13,0,1,a);this.own(this.editor.on("KeyPressed",v.hitch(this,"onKeyPressed")))}},
onKeyPressed:function(){if(this._checkListLater){if(this.editor.selection.isCollapsed()){var b=this.editor.selection.getAncestorElement("LI");if(b){k("mozilla")&&"LI"==b.parentNode.parentNode.nodeName&&(b=b.parentNode.parentNode);var a=b.firstChild;!a||1!=a.nodeType||"UL"!=a.nodeName&&"OL"!=a.nodeName||(b.insertBefore(a.ownerDocument.createTextNode("\u00a0"),a),a=x.create(this.editor.window),a.setStart(b.firstChild,0),b=x.getSelection(this.editor.window,!0),b.removeAllRanges(),b.addRange(a))}else q.prototype.execCommand.call(this.editor,
"formatblock",this.blockNodeForEnter),(b=this.editor.selection.getAncestorElement(this.blockNodeForEnter))?(b.innerHTML=this.bogusHtmlContent,9>=k("ie")&&(b=this.editor.document.selection.createRange(),b.move("character",-1),b.select())):console.error("onKeyPressed: Cannot find the new block node")}this._checkListLater=!1}this._pressedEnterInBlock&&(this._pressedEnterInBlock.previousSibling&&this.removeTrailingBr(this._pressedEnterInBlock.previousSibling),delete this._pressedEnterInBlock)},bogusHtmlContent:"\x26#160;",
blockNodes:/^(?:P|H1|H2|H3|H4|H5|H6|LI)$/,handleEnterKey:function(b){var a,g,f,c,e=this.editor.document,h,l,n;if(b.shiftKey){b=this.editor.selection.getParentElement();if(c=x.getAncestor(b,this.blockNodes)){if("LI"==c.tagName)return!0;b=x.getSelection(this.editor.window);a=b.getRangeAt(0);a.collapsed||(a.deleteContents(),b=x.getSelection(this.editor.window),a=b.getRangeAt(0));if(x.atBeginningOfContainer(c,a.startContainer,a.startOffset))h=e.createElement("br"),a=x.create(this.editor.window),c.insertBefore(h,
c.firstChild),a.setStartAfter(h),b.removeAllRanges(),b.addRange(a);else if(x.atEndOfContainer(c,a.startContainer,a.startOffset))a=x.create(this.editor.window),h=e.createElement("br"),c.appendChild(h),c.appendChild(e.createTextNode("\u00a0")),a.setStart(c.lastChild,0),b.removeAllRanges(),b.addRange(a);else return(l=a.startContainer)&&3==l.nodeType?(n=l.nodeValue,g=e.createTextNode(n.substring(0,a.startOffset)),f=e.createTextNode(n.substring(a.startOffset)),c=e.createElement("br"),""==f.nodeValue&&
k("webkit")&&(f=e.createTextNode("\u00a0")),r.place(g,l,"after"),r.place(c,g,"after"),r.place(f,c,"after"),r.destroy(l),a=x.create(this.editor.window),a.setStart(f,0),b.removeAllRanges(),b.addRange(a),!1):!0}else b=x.getSelection(this.editor.window),b.rangeCount?(a=b.getRangeAt(0))&&a.startContainer&&(a.collapsed||(a.deleteContents(),b=x.getSelection(this.editor.window),a=b.getRangeAt(0)),(l=a.startContainer)&&3==l.nodeType?(c=a.startOffset,l.length<c&&(f=this._adjustNodeAndOffset(l,c),l=f.node,c=
f.offset),n=l.nodeValue,g=e.createTextNode(n.substring(0,c)),f=e.createTextNode(n.substring(c)),c=e.createElement("br"),f.length||(f=e.createTextNode("\u00a0")),g.length?r.place(g,l,"after"):g=l,r.place(c,g,"after"),r.place(f,c,"after"),r.destroy(l)):(0<=a.startOffset&&(h=l.childNodes[a.startOffset]),c=e.createElement("br"),f=e.createTextNode("\u00a0"),h?(r.place(c,h,"before"),r.place(f,c,"after")):(l.appendChild(c),l.appendChild(f))),a=x.create(this.editor.window),a.setStart(f,0),a.setEnd(f,f.length),
b.removeAllRanges(),b.addRange(a),this.editor.selection.collapse(!0)):q.prototype.execCommand.call(this.editor,"inserthtml","\x3cbr\x3e");return!1}var w=!0;b=x.getSelection(this.editor.window);a=b.getRangeAt(0);a.collapsed||(a.deleteContents(),b=x.getSelection(this.editor.window),a=b.getRangeAt(0));h=x.getBlockAncestor(a.endContainer,null,this.editor.editNode);var z=h.blockNode;if(this._checkListLater=z&&("LI"==z.nodeName||"LI"==z.parentNode.nodeName))return k("mozilla")&&(this._pressedEnterInBlock=
z),/^(\s|&nbsp;|&#160;|\xA0|<span\b[^>]*\bclass=['"]Apple-style-span['"][^>]*>(\s|&nbsp;|&#160;|\xA0)<\/span>)?(<br>)?$/.test(z.innerHTML)&&(z.innerHTML="",k("webkit")&&(a=x.create(this.editor.window),a.setStart(z,0),b.removeAllRanges(),b.addRange(a)),this._checkListLater=!1),!0;if(!h.blockNode||h.blockNode===this.editor.editNode){try{q.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter)}catch(F){}h={blockNode:this.editor.selection.getAncestorElement(this.blockNodeForEnter),
blockContainer:this.editor.editNode};if(h.blockNode){if(h.blockNode!=this.editor.editNode&&!(h.blockNode.textContent||h.blockNode.innerHTML).replace(/^\s+|\s+$/g,"").length)return this.removeTrailingBr(h.blockNode),!1}else h.blockNode=this.editor.editNode;b=x.getSelection(this.editor.window);a=b.getRangeAt(0)}z=e.createElement(this.blockNodeForEnter);z.innerHTML=this.bogusHtmlContent;this.removeTrailingBr(h.blockNode);f=a.endOffset;w=a.endContainer;w.length<f&&(f=this._adjustNodeAndOffset(w,f),w=
f.node,f=f.offset);if(x.atEndOfContainer(h.blockNode,w,f))h.blockNode===h.blockContainer?h.blockNode.appendChild(z):r.place(z,h.blockNode,"after"),w=!1,a=x.create(this.editor.window),a.setStart(z,0),b.removeAllRanges(),b.addRange(a),this.editor.height&&d.scrollIntoView(z);else if(x.atBeginningOfContainer(h.blockNode,a.startContainer,a.startOffset))r.place(z,h.blockNode,h.blockNode===h.blockContainer?"first":"before"),z.nextSibling&&this.editor.height&&(a=x.create(this.editor.window),a.setStart(z.nextSibling,
0),b.removeAllRanges(),b.addRange(a),d.scrollIntoView(z.nextSibling)),w=!1;else{h.blockNode===h.blockContainer?h.blockNode.appendChild(z):r.place(z,h.blockNode,"after");w=!1;h.blockNode.style&&z.style&&h.blockNode.style.cssText&&(z.style.cssText=h.blockNode.style.cssText);if((l=a.startContainer)&&3==l.nodeType){f=a.endOffset;l.length<f&&(f=this._adjustNodeAndOffset(l,f),l=f.node,f=f.offset);n=l.nodeValue;g=e.createTextNode(n.substring(0,f));f=e.createTextNode(n.substring(f,n.length));r.place(g,l,
"before");r.place(f,l,"after");r.destroy(l);for(a=g.parentNode;a!==h.blockNode;){n=e.createElement(a.tagName);a.style&&n.style&&a.style.cssText&&(n.style.cssText=a.style.cssText);"FONT"===a.tagName&&(a.color&&(n.color=a.color),a.face&&(n.face=a.face),a.size&&(n.size=a.size));for(;f;)l=f.nextSibling,n.appendChild(f),f=l;r.place(n,a,"after");g=a;f=n;a=a.parentNode}if(1==f.nodeType||3==f.nodeType&&f.nodeValue)z.innerHTML="";for(g=f;f;)l=f.nextSibling,z.appendChild(f),f=l}a=x.create(this.editor.window);
e=g;if("BR"!==this.blockNodeForEnter){for(;e;)c=e,e=l=e.firstChild;c&&c.parentNode?(z=c.parentNode,a.setStart(z,0),b.removeAllRanges(),b.addRange(a),this.editor.height&&d.scrollIntoView(z),k("mozilla")&&(this._pressedEnterInBlock=h.blockNode)):w=!0}else a.setStart(z,0),b.removeAllRanges(),b.addRange(a),this.editor.height&&d.scrollIntoView(z),k("mozilla")&&(this._pressedEnterInBlock=h.blockNode)}return w},_adjustNodeAndOffset:function(b,a){for(;b.length<a&&b.nextSibling&&3==b.nextSibling.nodeType;)a-=
b.length,b=b.nextSibling;return{node:b,offset:a}},removeTrailingBr:function(b){if(b=/P|DIV|LI/i.test(b.tagName)?b:this.editor.selection.getParentOfType(b,["P","DIV","LI"]))b.lastChild&&(1<b.childNodes.length&&3==b.lastChild.nodeType&&/^[\s\xAD]*$/.test(b.lastChild.nodeValue)||"BR"==b.lastChild.tagName)&&r.destroy(b.lastChild),b.childNodes.length||(b.innerHTML=this.bogusHtmlContent)}})})},"dijit/_editor/RichText":function(){define("dojo/_base/array dojo/_base/config dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/query dojo/domReady dojo/sniff dojo/string dojo/topic dojo/_base/unload dojo/_base/url dojo/window ../_Widget ../_CssStateMixin ../selection ./range ./html ../focus ../main".split(" "),
function(u,r,t,v,n,k,g,d,l,q,x,b,a,m,f,c,e,h,B,E,w,z,F,G,D,C,S,I,K){var H=t("dijit._editor.RichText",[F,G],{constructor:function(b){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this.events=[].concat(this.events);this._keyHandlers={};b&&a.isString(b.value)&&(this.value=b.value);this.onLoadDeferred=new v},baseClass:"dijitEditor",inheritWidth:!1,focusOnLoad:!1,name:"",styleSheets:"",height:"300px",minHeight:"1em",
isClosed:!0,isLoaded:!1,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:!1,disableSpellCheck:!1,postCreate:function(){"textarea"===this.domNode.tagName.toLowerCase()&&console.warn("RichText should not be used with the TEXTAREA tag.  See dijit._editor.RichText docs.");this.contentPreFilters=[a.trim,a.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters);e("mozilla")&&(this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters),
this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters));e("webkit")&&(this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters),this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters));if(e("ie")||e("trident"))this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters),this.contentDomPostFilters=[a.hitch(this,"_stripBreakerNodes")].concat(this.contentDomPostFilters);this.contentDomPostFilters=[a.hitch(this,
"_stripTrailingEmptyNodes")].concat(this.contentDomPostFilters);this.inherited(arguments);B.publish(K._scopeName+"._editor.RichText::init",this)},startup:function(){this.inherited(arguments);this.open();this.setupDefaultShortcuts()},setupDefaultShortcuts:function(){var b=a.hitch(this,function(a,b){return function(){return!this.execCommand(a,b)}}),c={b:b("bold"),i:b("italic"),u:b("underline"),a:b("selectall"),s:function(){this.save(!0)},m:function(){this.isTabIndent=!this.isTabIndent},1:b("formatblock",
"h1"),2:b("formatblock","h2"),3:b("formatblock","h3"),4:b("formatblock","h4"),"\\":b("insertunorderedlist")};e("ie")||(c.Z=b("redo"));for(var f in c)this.addKeyHandler(f,!0,!1,c[f])},events:["onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:!1,_localizeEditorCommands:function(){if(H._editorCommandsLocalized)this._local2NativeFormatNames=H._local2NativeFormatNames,this._native2LocalFormatNames=H._native2LocalFormatNames;else{H._editorCommandsLocalized=!0;H._local2NativeFormatNames={};
H._native2LocalFormatNames={};this._local2NativeFormatNames=H._local2NativeFormatNames;this._native2LocalFormatNames=H._native2LocalFormatNames;for(var b="div p pre h1 h2 h3 h4 h5 h6 ol ul address".split(" "),c="",e,f=0;e=b[f++];)c="l"!==e.charAt(1)?c+("\x3c"+e+"\x3e\x3cspan\x3econtent\x3c/span\x3e\x3c/"+e+"\x3e\x3cbr/\x3e"):c+("\x3c"+e+"\x3e\x3cli\x3econtent\x3c/li\x3e\x3c/"+e+"\x3e\x3cbr/\x3e");var h=d.create("div",{style:{position:"absolute",top:"0px",zIndex:10,opacity:.01},innerHTML:c});this.ownerDocumentBody.appendChild(h);
b=a.hitch(this,function(){for(var a=h.firstChild;a;)try{this.selection.selectElement(a.firstChild);var b=a.tagName.toLowerCase();this._local2NativeFormatNames[b]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[b]]=b;a=a.nextSibling.nextSibling}catch(Z){}d.destroy(h)});this.defer(b)}},open:function(b){if(!this.onLoadDeferred||0<=this.onLoadDeferred.fired)this.onLoadDeferred=new v;this.isClosed||this.close();B.publish(K._scopeName+"._editor.RichText::open",
this);1===arguments.length&&b.nodeName&&(this.domNode=b);var c=this.domNode,f;if(a.isString(this.value))f=this.value,c.innerHTML="";else if(c.nodeName&&"textarea"==c.nodeName.toLowerCase()){var h=this.textarea=c;this.name=h.name;f=h.value;c=this.domNode=this.ownerDocument.createElement("div");c.setAttribute("widgetId",this.id);h.removeAttribute("widgetId");c.cssText=h.cssText;c.className+=" "+h.className;d.place(c,h,"before");var y=a.hitch(this,function(){q.set(h,{display:"block",position:"absolute",
top:"-1000px"});if(e("ie")){var a=h.style;this.__overflow=a.overflow;a.overflow="hidden"}});e("ie")?this.defer(y,10):y();if(h.form){var l=h.value;this.reset=function(){this.getValue()!==l&&this.replaceValue(l)};m(h.form,"submit",a.hitch(this,function(){k.set(h,"disabled",this.disabled);h.value=this.getValue()}))}}else f=S.getChildrenHtml(c),c.innerHTML="";this.value=f;c.nodeName&&"LI"===c.nodeName&&(c.innerHTML=" \x3cbr\x3e");this.header=c.ownerDocument.createElement("div");c.appendChild(this.header);
this.editingArea=c.ownerDocument.createElement("div");c.appendChild(this.editingArea);this.footer=c.ownerDocument.createElement("div");c.appendChild(this.footer);this.name||(this.name=this.id+"_AUTOGEN");if(""!==this.name&&(!r.useXDomain||r.allowXdRichTextSave)){if((f=n.byId(K._scopeName+"._editor.RichText.value"))&&""!==f.value)for(var y=f.value.split(this._SEPARATOR),w=0,z;z=y[w++];)if(z=z.split(this._NAME_CONTENT_SEP),z[0]===this.name){this.value=z[1];y=y.splice(w,1);f.value=y.join(this._SEPARATOR);
break}H._globalSaveHandler||(H._globalSaveHandler={},E.addOnUnload(function(){for(var b in H._globalSaveHandler){var c=H._globalSaveHandler[b];a.isFunction(c)&&c()}}));H._globalSaveHandler[this.id]=a.hitch(this,"_saveContent")}this.isClosed=!1;f=this.editorObject=this.iframe=this.ownerDocument.createElement("iframe");f.id=this.id+"_iframe";f.style.border="none";f.style.width="100%";this._layoutMode?f.style.height="100%":7<=e("ie")?(this.height&&(f.style.height=this.height),this.minHeight&&(f.style.minHeight=
this.minHeight)):f.style.height=this.height?this.height:this.minHeight;f.frameBorder=0;f._loadFunc=a.hitch(this,function(a){this.window=a;this.document=a.document;this.selection=new D.SelectionManager(a);e("ie")&&this._localizeEditorCommands();this.onLoad(this.get("value"))});y=this._getIframeDocTxt().replace(/\\/g,"\\\\").replace(/'/g,"\\'");y=11>e("ie")?'javascript:document.open();try{parent.window;}catch(e){document.domain\x3d"'+document.domain+"\";}document.write('"+y+"');document.close()":"javascript: '"+
y+"'";this.editingArea.appendChild(f);f.src=y;"LI"===c.nodeName&&(c.lastChild.style.marginTop="-1.2em");g.add(this.domNode,this.baseClass)},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var b=q.getComputedStyle(this.domNode),c;if(this["aria-label"])c=this["aria-label"];else{var d=f('label[for\x3d"'+this.id+'"]',this.ownerDocument)[0]||n.byId(this["aria-labelledby"],this.ownerDocument);d&&(c=d.textContent||d.innerHTML||"")}var d="\x3cdiv id\x3d'dijitEditorBody' role\x3d'textbox' aria-multiline\x3d'true' "+
(c?" aria-label\x3d'"+h.escape(c)+"'":"")+"\x3e\x3c/div\x3e",g=[b.fontWeight,b.fontSize,b.fontFamily].join(" "),m=b.lineHeight,m=0<=m.indexOf("px")?parseFloat(m)/parseFloat(b.fontSize):0<=m.indexOf("em")?parseFloat(m):"normal",l="",k=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/ig,function(b){b=b.replace(/^;/ig,"")+";";var c=b.split(":")[0];if(c){var c=a.trim(c),c=c.toLowerCase(),e,f="";for(e=0;e<c.length;e++){var d=c.charAt(e);switch(d){case "-":e++,d=c.charAt(e).toUpperCase();default:f+=
d}}q.set(k.domNode,f,"")}l+=b+";"});this.iframe.setAttribute("title",c);return["\x3c!DOCTYPE html\x3e","\x3chtml lang\x3d'"+(this.lang||x.locale.replace(/-.*/,""))+"'"+(this.isLeftToRight()?"":" dir\x3d'rtl'")+"\x3e\n","\x3chead\x3e\n\x3cmeta http-equiv\x3d'Content-Type' content\x3d'text/html'\x3e\n",c?"\x3ctitle\x3e"+h.escape(c)+"\x3c/title\x3e":"","\x3cstyle\x3e\n\tbody,html {\n\t\tbackground:transparent;\n\t\tpadding: 1px 0 0 0;\n\t\tmargin: -1px 0 0 0;\n\t}\n\tbody,html,#dijitEditorBody { outline: none; }html { height: 100%; width: 100%; overflow: hidden; }\n",
this.height?"\tbody,#dijitEditorBody { height: 100%; width: 100%; overflow: auto; }\n":"\tbody,#dijitEditorBody { min-height: "+this.minHeight+"; width: 100%; overflow-x: auto; overflow-y: hidden; }\n","\tbody{\n\t\ttop:0px;\n\t\tleft:0px;\n\t\tright:0px;\n\t\tfont:",g,";\n",this.height||e("opera")?"":"\t\tposition: fixed;\n","\t\tline-height:",m,";\n\t}\n\tp{ margin: 1em 0; }\n\tli \x3e ul:-moz-first-node, li \x3e ol:-moz-first-node{ padding-top: 1.2em; }\n",e("ie")||e("trident")||e("edge")?"":"\tli{ min-height:1.2em; }\n",
"\x3c/style\x3e\n",this._applyEditingAreaStyleSheets(),"\n\x3c/head\x3e\n\x3cbody role\x3d'application'",c?" aria-label\x3d'"+h.escape(c)+"'":"","onload\x3d'try{frameElement \x26\x26 frameElement._loadFunc(window,document)}catch(e){document.domain\x3d\""+document.domain+"\";frameElement._loadFunc(window,document)}' ","style\x3d'"+l+"'\x3e",d,"\x3c/body\x3e\n\x3c/html\x3e"].join("")},_applyEditingAreaStyleSheets:function(){var a=[];this.styleSheets&&(a=this.styleSheets.split(";"),this.styleSheets=
"");a=a.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];for(var b="",c=0,e,f=z.get(this.ownerDocument);e=a[c++];)e=(new w(f.location,e)).toString(),this.editingAreaStyleSheets.push(e),b+='\x3clink rel\x3d"stylesheet" type\x3d"text/css" href\x3d"'+e+'"/\x3e';return b},addStyleSheet:function(b){var c=b.toString(),e=z.get(this.ownerDocument);if("."===c.charAt(0)||"/"!==c.charAt(0)&&!b.host)c=(new w(e.location,c)).toString();-1<u.indexOf(this.editingAreaStyleSheets,c)||(this.editingAreaStyleSheets.push(c),
this.onLoadDeferred.then(a.hitch(this,function(){if(this.document.createStyleSheet)this.document.createStyleSheet(c);else{var a=this.document.getElementsByTagName("head")[0],b=this.document.createElement("link");b.rel="stylesheet";b.type="text/css";b.href=c;a.appendChild(b)}})))},removeStyleSheet:function(a){var b=a.toString(),c=z.get(this.ownerDocument);if("."===b.charAt(0)||"/"!==b.charAt(0)&&!a.host)b=(new w(c.location,b)).toString();a=u.indexOf(this.editingAreaStyleSheets,b);-1!==a&&(delete this.editingAreaStyleSheets[a],
f('link[href\x3d"'+b+'"]',this.window.document).orphan())},disabled:!1,_mozSettingProps:{styleWithCSS:!1},_setDisabledAttr:function(a){a=!!a;this._set("disabled",a);if(this.isLoaded){var b=e("ie")&&(this.isLoaded||!this.focusOnLoad);b&&(this.editNode.unselectable="on");this.editNode.contentEditable=!a;this.editNode.tabIndex=a?"-1":this.tabIndex;b&&this.defer(function(){this.editNode&&(this.editNode.unselectable="off")});if(e("mozilla")&&!a&&this._mozSettingProps){a=this._mozSettingProps;for(var c in a)if(a.hasOwnProperty(c))try{this.document.execCommand(c,
!1,a[c])}catch(J){}}this._disabledOK=!0}},onLoad:function(b){this.window.__registeredWindow||(this.window.__registeredWindow=!0,this._iframeRegHandle=I.registerIframe(this.iframe));this.editNode=this.document.body.firstChild;var f=this;this.beforeIframeNode=d.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"before");this.afterIframeNode=d.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"after");this.iframe.onfocus=this.document.onfocus=function(){f.editNode.focus()};this.focusNode=
this.editNode;var h=this.events.concat(this.captureEvents),g=this.iframe?this.document:this.editNode;this.own.apply(this,u.map(h,function(b){var c=b.toLowerCase().replace(/^on/,"");return m(g,c,a.hitch(this,b))},this));this.own(m(g,"mouseup",a.hitch(this,"onClick")));e("ie")&&(this.own(m(this.document,"mousedown",a.hitch(this,"_onIEMouseDown"))),this.editNode.style.zoom=1);e("webkit")&&(this._webkitListener=this.own(m(this.document,"mouseup",a.hitch(this,"onDisplayChanged")))[0],this.own(m(this.document,
"mousedown",a.hitch(this,function(a){a=a.target;!a||a!==this.document.body&&a!==this.document||this.defer("placeCursorAtEnd")}))));if(e("ie"))try{this.document.execCommand("RespectVisibilityInDesign",!0,null)}catch(A){}this.isLoaded=!0;this.set("disabled",this.disabled);h=a.hitch(this,function(){this.setValue(b);this.onLoadDeferred&&!this.onLoadDeferred.isFulfilled()&&this.onLoadDeferred.resolve(!0);this.onDisplayChanged();this.focusOnLoad&&c(a.hitch(this,"defer","focus",this.updateInterval));this.value=
this.getValue(!0)});this.setValueDeferred?this.setValueDeferred.then(h):h()},onKeyDown:function(a){if(a.keyCode===b.SHIFT||a.keyCode===b.ALT||a.keyCode===b.META||a.keyCode===b.CTRL)return!0;a.keyCode===b.TAB&&this.isTabIndent&&(a.stopPropagation(),a.preventDefault(),this.queryCommandEnabled(a.shiftKey?"outdent":"indent")&&this.execCommand(a.shiftKey?"outdent":"indent"));if(a.keyCode==b.TAB&&!this.isTabIndent&&!a.ctrlKey&&!a.altKey)return a.shiftKey?this.beforeIframeNode.focus():this.afterIframeNode.focus(),
!0;9>e("ie")&&a.keyCode===b.BACKSPACE&&"Control"===this.document.selection.type&&(a.stopPropagation(),a.preventDefault(),this.execCommand("delete"));e("ff")&&(a.keyCode===b.PAGE_UP||a.keyCode===b.PAGE_DOWN)&&this.editNode.clientHeight>=this.editNode.scrollHeight&&a.preventDefault();var c=this._keyHandlers[a.keyCode],f=arguments;c&&!a.altKey&&u.some(c,function(b){if(!(b.shift^a.shiftKey||b.ctrl^(a.ctrlKey||a.metaKey)))return b.handler.apply(this,f)||a.preventDefault(),!0},this);this.defer("onKeyPressed",
1);return!0},onKeyUp:function(){},setDisabled:function(a){x.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2);this.set("disabled",a)},_setValueAttr:function(a){this.setValue(a)},_setDisableSpellCheckAttr:function(b){this.document?k.set(this.document.body,"spellcheck",!b):this.onLoadDeferred.then(a.hitch(this,function(){k.set(this.document.body,"spellcheck",!b)}));this._set("disableSpellCheck",b)},addKeyHandler:function(b,c,e,f){"string"==
typeof b&&(b=b.toUpperCase().charCodeAt(0));a.isArray(this._keyHandlers[b])||(this._keyHandlers[b]=[]);this._keyHandlers[b].push({shift:e||!1,ctrl:c||!1,handler:f})},onKeyPressed:function(){this.onDisplayChanged()},onClick:function(a){this.onDisplayChanged(a)},_onIEMouseDown:function(){this.focused||this.disabled||this.focus()},_onBlur:function(a){(e("ie")||e("trident"))&&this.defer(function(){I.curNode||this.ownerDocumentBody.focus()});this.inherited(arguments);var b=this.getValue(!0);if(b!==this.value)this.onChange(b);
this._set("value",b)},_onFocus:function(a){this.disabled||(this._disabledOK||this.set("disabled",!1),this.inherited(arguments))},blur:function(){!e("ie")&&this.window.document.documentElement&&this.window.document.documentElement.focus?this.window.document.documentElement.focus():this.ownerDocumentBody.focus&&this.ownerDocumentBody.focus()},focus:function(){this.isLoaded?9>e("ie")?this.iframe.fireEvent("onfocus",document.createEventObject()):this.editNode.focus():this.focusOnLoad=!0},updateInterval:200,
_updateTimer:null,onDisplayChanged:function(){this._updateTimer&&this._updateTimer.remove();this._updateTimer=this.defer("onNormalizedDisplayChanged",this.updateInterval)},onNormalizedDisplayChanged:function(){delete this._updateTimer},onChange:function(){},_normalizeCommand:function(a,b){a=a.toLowerCase();"formatblock"===a?e("safari")&&void 0===b&&(a="heading"):"hilitecolor"!==a||e("mozilla")||(a="backcolor");return a},_implCommand:function(a){return"_"+this._normalizeCommand(a)+"EnabledImpl"},_qcaCache:{},
queryCommandAvailable:function(a){var b=this._qcaCache[a];return void 0!==b?b:this._qcaCache[a]=this._queryCommandAvailable(a)},_queryCommandAvailable:function(a){switch(a.toLowerCase()){case "bold":case "italic":case "underline":case "subscript":case "superscript":case "fontname":case "fontsize":case "forecolor":case "hilitecolor":case "justifycenter":case "justifyfull":case "justifyleft":case "justifyright":case "delete":case "selectall":case "toggledir":case "createlink":case "unlink":case "removeformat":case "inserthorizontalrule":case "insertimage":case "insertorderedlist":case "insertunorderedlist":case "indent":case "outdent":case "formatblock":case "inserthtml":case "undo":case "redo":case "strikethrough":case "tabindent":case "cut":case "copy":case "paste":return!0;
case "blockdirltr":case "blockdirrtl":case "dirltr":case "dirrtl":case "inlinedirltr":case "inlinedirrtl":return e("ie")||e("trident")||e("edge");case "inserttable":case "insertcell":case "insertcol":case "insertrow":case "deletecells":case "deletecols":case "deleterows":case "mergecells":case "splitcell":return!e("webkit");default:return!1}},execCommand:function(a,b){var c;this.focused&&this.focus();a=this._normalizeCommand(a,b);if(void 0!==b){if("heading"===a)throw Error("unimplemented");"formatblock"===
a&&(e("ie")||e("trident"))&&(b="\x3c"+b+"\x3e")}var f="_"+a+"Impl";if(this[f])c=this[f](b);else if((b=1<arguments.length?b:null)||"createlink"!==a)c=this.document.execCommand(a,!1,b);this.onDisplayChanged();return c},queryCommandEnabled:function(a){if(this.disabled||!this._disabledOK)return!1;a=this._normalizeCommand(a);var b=this._implCommand(a);return this[b]?this[b](a):this._browserQueryCommandEnabled(a)},queryCommandState:function(a){if(this.disabled||!this._disabledOK)return!1;a=this._normalizeCommand(a);
try{return this.document.queryCommandState(a)}catch(Q){return!1}},queryCommandValue:function(a){if(this.disabled||!this._disabledOK)return!1;a=this._normalizeCommand(a);if(e("ie")&&"formatblock"===a)a=this._native2LocalFormatNames[this.document.queryCommandValue(a)];else if(e("mozilla")&&"hilitecolor"===a){var b;try{b=this.document.queryCommandValue("styleWithCSS")}catch(U){b=!1}this.document.execCommand("styleWithCSS",!1,!0);a=this.document.queryCommandValue(a);this.document.execCommand("styleWithCSS",
!1,b)}else a=this.document.queryCommandValue(a);return a},_sCall:function(a,b){return this.selection[a].apply(this.selection,b)},placeCursorAtStart:function(){this.focus();var a=!1;if(e("mozilla"))for(var b=this.editNode.firstChild;b;){if(3===b.nodeType){if(0<b.nodeValue.replace(/^\s+|\s+$/g,"").length){a=!0;this.selection.selectElement(b);break}}else if(1===b.nodeType){var a=!0,c=b.tagName?b.tagName.toLowerCase():"";/br|input|img|base|meta|area|basefont|hr|link/.test(c)?this.selection.selectElement(b):
this.selection.selectElementChildren(b);break}b=b.nextSibling}else a=!0,this.selection.selectElementChildren(this.editNode);a&&this.selection.collapse(!0)},placeCursorAtEnd:function(){this.focus();var a=!1;if(e("mozilla"))for(var b=this.editNode.lastChild;b;){if(3===b.nodeType){if(0<b.nodeValue.replace(/^\s+|\s+$/g,"").length){a=!0;this.selection.selectElement(b);break}}else if(1===b.nodeType){a=!0;this.selection.selectElement(b.lastChild||b);break}b=b.previousSibling}else a=!0,this.selection.selectElementChildren(this.editNode);
a&&this.selection.collapse(!1)},getValue:function(a){return!this.textarea||!this.isClosed&&this.isLoaded?this.isLoaded?this._postFilterContent(null,a):this.value:this.textarea.value},_getValueAttr:function(){return this.getValue(!0)},setValue:function(b){if(this.isLoaded){if(!this.textarea||!this.isClosed&&this.isLoaded){b=this._preFilterContent(b);var c=this.isClosed?this.domNode:this.editNode;c.innerHTML=b;this._preDomFilterContent(c)}else this.textarea.value=b;this.onDisplayChanged();this._set("value",
this.getValue(!0))}else this.onLoadDeferred.then(a.hitch(this,function(){this.setValue(b)}))},replaceValue:function(a){this.isClosed?this.setValue(a):this.window&&this.window.getSelection&&!e("mozilla")?this.setValue(a):this.window&&this.window.getSelection?(a=this._preFilterContent(a),this.execCommand("selectall"),this.execCommand("inserthtml",a),this._preDomFilterContent(this.editNode)):this.document&&this.document.selection&&this.setValue(a);this._set("value",this.getValue(!0))},_preFilterContent:function(a){var b=
a;u.forEach(this.contentPreFilters,function(a){a&&(b=a(b))});return b},_preDomFilterContent:function(b){b=b||this.editNode;u.forEach(this.contentDomPreFilters,function(c){c&&a.isFunction(c)&&c(b)},this)},_postFilterContent:function(b,c){var e;a.isString(b)?e=b:(b=b||this.editNode,this.contentDomPostFilters.length&&(c&&(b=a.clone(b)),u.forEach(this.contentDomPostFilters,function(a){b=a(b)})),e=S.getChildrenHtml(b));a.trim(e.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length||(e="");u.forEach(this.contentPostFilters,
function(a){e=a(e)});return e},_saveContent:function(){var a=n.byId(K._scopeName+"._editor.RichText.value");a&&(a.value&&(a.value+=this._SEPARATOR),a.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(!0))},escapeXml:function(a,b){a=a.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");b||(a=a.replace(/'/gm,"\x26#39;"));return a},getNodeHtml:function(a){x.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit/_editor/html::getNodeHtml instead",
2);return S.getNodeHtml(a)},getNodeChildrenHtml:function(a){x.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit/_editor/html::getChildrenHtml instead",2);return S.getChildrenHtml(a)},close:function(a){if(!this.isClosed){arguments.length||(a=!0);a&&this._set("value",this.getValue(!0));this.interval&&clearInterval(this.interval);this._webkitListener&&(this._webkitListener.remove(),delete this._webkitListener);e("ie")&&(this.iframe.onfocus=null);this.iframe._loadFunc=null;this._iframeRegHandle&&
(this._iframeRegHandle.remove(),delete this._iframeRegHandle);if(this.textarea){var b=this.textarea.style;b.position="";b.left=b.top="";e("ie")&&(b.overflow=this.__overflow,this.__overflow=null);this.textarea.value=this.value;d.destroy(this.domNode);this.domNode=this.textarea}else this.domNode.innerHTML=this.value;delete this.iframe;g.remove(this.domNode,this.baseClass);this.isClosed=!0;this.isLoaded=!1;delete this.editNode;delete this.focusNode;this.window&&this.window._frameElement&&(this.window._frameElement=
null);this.editorObject=this.editingArea=this.document=this.window=null}},destroy:function(){this.isClosed||this.close(!1);this._updateTimer&&this._updateTimer.remove();this.inherited(arguments);H._globalSaveHandler&&delete H._globalSaveHandler[this.id]},_removeMozBogus:function(a){return a.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"")},_removeWebkitBogus:function(a){a=a.replace(/\sclass="webkit-block-placeholder"/gi,"");a=a.replace(/\sclass="apple-style-span"/gi,
"");return a=a.replace(/<meta charset=\"utf-8\" \/>/gi,"")},_normalizeFontStyle:function(a){return a.replace(/<(\/)?strong([ \>])/gi,"\x3c$1b$2").replace(/<(\/)?em([ \>])/gi,"\x3c$1i$2")},_preFixUrlAttributes:function(a){return a.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2")},_browserQueryCommandEnabled:function(a){if(!a)return!1;
if(e("ie")||e("trident")||e("edge"))return this.focused&&!this.disabled;var b=9>e("ie")?this.document.selection.createRange():this.document;try{return b.queryCommandEnabled(a)}catch(U){return!1}},_createlinkEnabledImpl:function(){var a=!0;return a=e("opera")?this.window.getSelection().isCollapsed?!0:this.document.queryCommandEnabled("createlink"):this._browserQueryCommandEnabled("createlink")},_unlinkEnabledImpl:function(){var a=!0;return a=e("mozilla")||e("webkit")||e("ie")||e("trident")||e("edge")?
this.selection.hasAncestorElement("a"):this._browserQueryCommandEnabled("unlink")},_inserttableEnabledImpl:function(){var a=!0;return a=e("mozilla")||e("webkit")?!0:this._browserQueryCommandEnabled("inserttable")},_cutEnabledImpl:function(){var a=!0;e("webkit")?((a=this.window.getSelection())&&(a=a.toString()),a=!!a):a=this._browserQueryCommandEnabled("cut");return a},_copyEnabledImpl:function(){var a=!0;e("webkit")?((a=this.window.getSelection())&&(a=a.toString()),a=!!a):a=this._browserQueryCommandEnabled("copy");
return a},_pasteEnabledImpl:function(){var a=!0;return e("webkit")?!0:a=this._browserQueryCommandEnabled("paste")},_inserthorizontalruleImpl:function(a){return e("ie")?this._inserthtmlImpl("\x3chr\x3e"):this.document.execCommand("inserthorizontalrule",!1,a)},_unlinkImpl:function(a){return this.queryCommandEnabled("unlink")&&(e("mozilla")||e("webkit"))?(a=this.selection.getAncestorElement("a"),this.selection.selectElement(a),this.document.execCommand("unlink",!1,null)):this.document.execCommand("unlink",
!1,a)},_hilitecolorImpl:function(a){var b;this._handleTextColorOrProperties("hilitecolor",a)||(e("mozilla")?(this.document.execCommand("styleWithCSS",!1,!0),console.log("Executing color command."),b=this.document.execCommand("hilitecolor",!1,a),this.document.execCommand("styleWithCSS",!1,!1)):b=this.document.execCommand("hilitecolor",!1,a));return b},_backcolorImpl:function(a){e("ie")&&(a=a?a:null);var b=this._handleTextColorOrProperties("backcolor",a);b||(b=this.document.execCommand("backcolor",
!1,a));return b},_forecolorImpl:function(a){e("ie")&&(a=a?a:null);var b=!1;(b=this._handleTextColorOrProperties("forecolor",a))||(b=this.document.execCommand("forecolor",!1,a));return b},_inserthtmlImpl:function(a){a=this._preFilterContent(a);var b=!0;if(9>e("ie")){var c=this.document.selection.createRange();if("CONTROL"===this.document.selection.type.toUpperCase()){for(var f=c.item(0);c.length;)c.remove(c.item(0));f.outerHTML=a}else c.pasteHTML(a);c.select()}else if(8>e("trident")){var h=C.getSelection(this.window);
if(h&&h.rangeCount&&h.getRangeAt){c=h.getRangeAt(0);c.deleteContents();var g=d.create("div");g.innerHTML=a;for(var m,f=this.document.createDocumentFragment();a=g.firstChild;)m=f.appendChild(a);c.insertNode(f);m&&(c=c.cloneRange(),c.setStartAfter(m),c.collapse(!1),h.removeAllRanges(),h.addRange(c))}}else e("mozilla")&&!a.length?this.selection.remove():b=this.document.execCommand("inserthtml",!1,a);return b},_boldImpl:function(a){var b=!1;if(e("ie")||e("trident"))this._adaptIESelection(),b=this._adaptIEFormatAreaAndExec("bold");
b||(b=this.document.execCommand("bold",!1,a));return b},_italicImpl:function(a){var b=!1;if(e("ie")||e("trident"))this._adaptIESelection(),b=this._adaptIEFormatAreaAndExec("italic");b||(b=this.document.execCommand("italic",!1,a));return b},_underlineImpl:function(a){var b=!1;if(e("ie")||e("trident"))this._adaptIESelection(),b=this._adaptIEFormatAreaAndExec("underline");b||(b=this.document.execCommand("underline",!1,a));return b},_strikethroughImpl:function(a){var b=!1;if(e("ie")||e("trident"))this._adaptIESelection(),
b=this._adaptIEFormatAreaAndExec("strikethrough");b||(b=this.document.execCommand("strikethrough",!1,a));return b},_superscriptImpl:function(a){var b=!1;if(e("ie")||e("trident"))this._adaptIESelection(),b=this._adaptIEFormatAreaAndExec("superscript");b||(b=this.document.execCommand("superscript",!1,a));return b},_subscriptImpl:function(a){var b=!1;if(e("ie")||e("trident"))this._adaptIESelection(),b=this._adaptIEFormatAreaAndExec("subscript");b||(b=this.document.execCommand("subscript",!1,a));return b},
_fontnameImpl:function(a){var b;if(e("ie")||e("trident"))b=this._handleTextColorOrProperties("fontname",a);b||(b=this.document.execCommand("fontname",!1,a));return b},_fontsizeImpl:function(a){var b;if(e("ie")||e("trident"))b=this._handleTextColorOrProperties("fontsize",a);b||(b=this.document.execCommand("fontsize",!1,a));return b},_insertorderedlistImpl:function(a){var b=!1;if(e("ie")||e("trident")||e("edge"))b=this._adaptIEList("insertorderedlist",a);b||(b=this.document.execCommand("insertorderedlist",
!1,a));return b},_insertunorderedlistImpl:function(a){var b=!1;if(e("ie")||e("trident")||e("edge"))b=this._adaptIEList("insertunorderedlist",a);b||(b=this.document.execCommand("insertunorderedlist",!1,a));return b},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header)},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer)},_getNodeChildrenHeight:function(a){var b=0;if(a&&a.childNodes){var c;for(c=0;c<a.childNodes.length;c++)var e=l.position(a.childNodes[c]),
b=b+e.h}return b},_isNodeEmpty:function(a,b){return 1===a.nodeType?0<a.childNodes.length?this._isNodeEmpty(a.childNodes[0],b):!0:3===a.nodeType?""===a.nodeValue.substring(b):!1},_removeStartingRangeFromRange:function(a,b){if(a.nextSibling)b.setStart(a.nextSibling,0);else{for(a=a.parentNode;a&&null==a.nextSibling;)a=a.parentNode;a&&b.setStart(a.nextSibling,0)}return b},_adaptIESelection:function(){var a=C.getSelection(this.window);if(a&&a.rangeCount&&!a.isCollapsed){for(var b=a.getRangeAt(0),c=b.startContainer,
e=b.startOffset;3===c.nodeType&&e>=c.length&&c.nextSibling;)e-=c.length,c=c.nextSibling;for(var f=null;this._isNodeEmpty(c,e)&&c!==f;)f=c,b=this._removeStartingRangeFromRange(c,b),c=b.startContainer,e=0;a.removeAllRanges();a.addRange(b)}},_adaptIEFormatAreaAndExec:function(a){var b=C.getSelection(this.window),c=this.document,e,f,h,g,m,l,q;if(a&&b&&b.isCollapsed){if(this.queryCommandValue(a)){a=this._tagNamesForCommand(a);h=b.getRangeAt(0);g=h.startContainer;3===g.nodeType&&(f=h.endOffset,g.length<
f&&(f=this._adjustNodeAndOffset(e,f),g=f.node,f=f.offset));for(;g&&g!==this.editNode;){e=g.tagName?g.tagName.toLowerCase():"";if(-1<u.indexOf(a,e)){q=g;break}g=g.parentNode}if(q&&(e=h.startContainer,a=c.createElement(q.tagName),d.place(a,q,"after"),e&&3===e.nodeType)){f=h.endOffset;e.length<f&&(f=this._adjustNodeAndOffset(e,f),e=f.node,f=f.offset);g=e.nodeValue;h=c.createTextNode(g.substring(0,f));var k=g.substring(f,g.length);k&&(m=c.createTextNode(k));d.place(h,e,"before");m&&(l=c.createElement("span"),
l.className="ieFormatBreakerSpan",d.place(l,e,"after"),d.place(m,l,"after"),m=l);d.destroy(e);f=h.parentNode;for(e=[];f!==q;){g=f.tagName;h={tagName:g};e.push(h);g=c.createElement(g);f.style&&g.style&&f.style.cssText&&(g.style.cssText=f.style.cssText,h.cssText=f.style.cssText);"FONT"===f.tagName&&(f.color&&(g.color=f.color,h.color=f.color),f.face&&(g.face=f.face,h.face=f.face),f.size&&(g.size=f.size,h.size=f.size));f.className&&(g.className=f.className,h.className=f.className);if(m)for(;m;)h=m.nextSibling,
g.appendChild(m),m=h;g.tagName==f.tagName?(l=c.createElement("span"),l.className="ieFormatBreakerSpan",d.place(l,f,"after"),d.place(g,l,"after")):d.place(g,f,"after");h=f;m=g;f=f.parentNode}if(m){if(1===m.nodeType||3===m.nodeType&&m.nodeValue)a.innerHTML="";for(;m;)h=m.nextSibling,a.appendChild(m),m=h}if(e.length){h=e.pop();m=c.createElement(h.tagName);h.cssText&&m.style&&(m.style.cssText=h.cssText);h.className&&(m.className=h.className);"FONT"===h.tagName&&(h.color&&(m.color=h.color),h.face&&(m.face=
h.face),h.size&&(m.size=h.size));for(d.place(m,a,"before");e.length;)h=e.pop(),q=c.createElement(h.tagName),h.cssText&&q.style&&(q.style.cssText=h.cssText),h.className&&(q.className=h.className),"FONT"===h.tagName&&(h.color&&(q.color=h.color),h.face&&(q.face=h.face),h.size&&(q.size=h.size)),m.appendChild(q),m=q;q=c.createTextNode(".");l.appendChild(q);m.appendChild(q)}else l=c.createElement("span"),l.className="ieFormatBreakerSpan",q=c.createTextNode("."),l.appendChild(q),d.place(l,a,"before");m=
C.create(this.window);m.setStart(q,0);m.setEnd(q,q.length);b.removeAllRanges();b.addRange(m);this.selection.collapse(!1);q.parentNode.innerHTML="";a.firstChild||d.destroy(a);return!0}return!1}h=b.getRangeAt(0);if((e=h.startContainer)&&3===e.nodeType)return f=h.startOffset,e.length<f&&(f=this._adjustNodeAndOffset(e,f),e=f.node,f=f.offset),g=e.nodeValue,h=c.createTextNode(g.substring(0,f)),k=g.substring(f),""!==k&&(m=c.createTextNode(g.substring(f))),l=c.createElement("span"),q=c.createTextNode("."),
l.appendChild(q),h.length?d.place(h,e,"after"):h=e,d.place(l,h,"after"),m&&d.place(m,l,"after"),d.destroy(e),m=C.create(this.window),m.setStart(q,0),m.setEnd(q,q.length),b.removeAllRanges(),b.addRange(m),c.execCommand(a),d.place(l.firstChild,l,"before"),d.destroy(l),m.setStart(q,0),m.setEnd(q,q.length),b.removeAllRanges(),b.addRange(m),this.selection.collapse(!1),q.parentNode.innerHTML="",!0}else return!1},_adaptIEList:function(a){var b=C.getSelection(this.window);if(b.isCollapsed&&b.rangeCount&&
!this.queryCommandValue(a)){var c=b.getRangeAt(0),e=c.startContainer;if(e&&3==e.nodeType&&!c.startOffset)return c="ul","insertorderedlist"===a&&(c="ol"),a=this.document.createElement(c),c=d.create("li",null,a),d.place(a,e,"before"),c.appendChild(e),d.create("br",null,a,"after"),a=C.create(this.window),a.setStart(e,0),a.setEnd(e,e.length),b.removeAllRanges(),b.addRange(a),this.selection.collapse(!0),!0}return!1},_handleTextColorOrProperties:function(a,b){var c=C.getSelection(this.window),f=this.document,
h,g,m,l,k;b=b||null;if(a&&c&&c.isCollapsed&&c.rangeCount&&(g=c.getRangeAt(0),(h=g.startContainer)&&3===h.nodeType)){k=g.startOffset;h.length<k&&(g=this._adjustNodeAndOffset(h,k),h=g.node,k=g.offset);m=h.nodeValue;g=f.createTextNode(m.substring(0,k));""!==m.substring(k)&&(l=f.createTextNode(m.substring(k)));m=f.createElement("span");k=f.createTextNode(".");m.appendChild(k);f=f.createElement("span");m.appendChild(f);g.length?d.place(g,h,"after"):g=h;d.place(m,g,"after");l&&d.place(l,m,"after");d.destroy(h);
h=C.create(this.window);h.setStart(k,0);h.setEnd(k,k.length);c.removeAllRanges();c.addRange(h);if(e("webkit")){c="color";if("hilitecolor"===a||"backcolor"===a)c="backgroundColor";q.set(m,c,b);this.selection.remove();d.destroy(f);m.innerHTML="\x26#160;";this.selection.selectElement(m);this.focus()}else this.execCommand(a,b),d.place(m.firstChild,m,"before"),d.destroy(m),h.setStart(k,0),h.setEnd(k,k.length),c.removeAllRanges(),c.addRange(h),this.selection.collapse(!1),k.parentNode.removeChild(k);return!0}return!1},
_adjustNodeAndOffset:function(a,b){for(;a.length<b&&a.nextSibling&&3===a.nextSibling.nodeType;)b-=a.length,a=a.nextSibling;return{node:a,offset:b}},_tagNamesForCommand:function(a){return"bold"===a?["b","strong"]:"italic"===a?["i","em"]:"strikethrough"===a?["s","strike"]:"superscript"===a?["sup"]:"subscript"===a?["sub"]:"underline"===a?["u"]:[]},_stripBreakerNodes:function(a){if(this.isLoaded)return f(".ieFormatBreakerSpan",a).forEach(function(a){for(;a.firstChild;)d.place(a.firstChild,a,"before");
d.destroy(a)}),a},_stripTrailingEmptyNodes:function(a){function b(a){return/^(p|div|br)$/i.test(a.nodeName)&&0==a.children.length&&/^[\s\xA0]*$/.test(a.textContent||a.innerText||"")||3===a.nodeType&&/^[\s\xA0]*$/.test(a.nodeValue)}for(;a.lastChild&&b(a.lastChild);)d.destroy(a.lastChild);return a},_setTextDirAttr:function(b){this._set("textDir",b);this.onLoadDeferred.then(a.hitch(this,function(){this.editNode.dir=b}))}});return H})},"dijit/_editor/range":function(){define(["dojo/_base/array","dojo/_base/declare",
"dojo/_base/lang"],function(u,r,t){var v={getIndex:function(g,d){for(var l=[],q=[],k=g,b,a;g!=d;){var m=0;for(b=g.parentNode;a=b.childNodes[m++];)if(a===g){--m;break}l.unshift(m);q.unshift(m-b.childNodes.length);g=b}if(0<l.length&&3==k.nodeType){for(a=k.previousSibling;a&&3==a.nodeType;)l[l.length-1]--,a=a.previousSibling;for(a=k.nextSibling;a&&3==a.nodeType;)q[q.length-1]++,a=a.nextSibling}return{o:l,r:q}},getNode:function(g,d){if(!t.isArray(g)||0==g.length)return d;var l=d;u.every(g,function(d){if(0<=
d&&d<l.childNodes.length)l=l.childNodes[d];else return l=null,!1;return!0});return l},getCommonAncestor:function(g,d,l){l=l||g.ownerDocument.body;var q=function(a){for(var b=[];a;)if(b.unshift(a),a!==l)a=a.parentNode;else break;return b};g=q(g);d=q(d);for(var q=Math.min(g.length,d.length),k=g[0],b=1;b<q;b++)if(g[b]===d[b])k=g[b];else break;return k},getAncestor:function(g,d,l){for(l=l||g.ownerDocument.body;g&&g!==l;){var q=g.nodeName.toUpperCase();if(d.test(q))return g;g=g.parentNode}return null},
BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(g,d,l){l=l||g.ownerDocument.body;d=d||v.BlockTagNames;for(var q=null,k;g&&g!==l;){var b=g.nodeName.toUpperCase();!q&&d.test(b)&&(q=g);!k&&/^(?:BODY|TD|TH|CAPTION)$/.test(b)&&(k=g);g=g.parentNode}return{blockNode:q,blockContainer:k||g.ownerDocument.body}},atBeginningOfContainer:function(g,d,l){var k=!1,n=0==l;n||3!=d.nodeType||/^[\s\xA0]+$/.test(d.nodeValue.substr(0,l))&&(n=!0);if(n)for(k=!0;d&&d!==g;){if(d.previousSibling){k=
!1;break}d=d.parentNode}return k},atEndOfContainer:function(g,d,l){var k=!1,n=l==(d.length||d.childNodes.length);n||3!=d.nodeType||/^[\s\xA0]+$/.test(d.nodeValue.substr(l))&&(n=!0);if(n)for(k=!0;d&&d!==g;){if(d.nextSibling){k=!1;break}d=d.parentNode}return k},adjacentNoneTextNode:function(g,d){var l=g;g=0-g.length||0;for(d=d?"nextSibling":"previousSibling";l&&3==l.nodeType;)g+=l.length,l=l[d];return[l,g]},create:function(g){g=g||window;return g.getSelection?g.document.createRange():new k},getSelection:function(g,
d){if(g.getSelection)return g.getSelection();g=new n.selection(g);d||g._getCurrentSelection();return g}};if(!window.getSelection)var n=v.ie={cachedSelection:{},selection:function(g){this._ranges=[];this.addRange=function(d,g){this._ranges.push(d);g||d._select();this.rangeCount=this._ranges.length};this.removeAllRanges=function(){this._ranges=[];this.rangeCount=0};this.getRangeAt=function(d){return this._ranges[d]};this._getCurrentSelection=function(){this.removeAllRanges();var d;d=g.document.selection.createRange();
d="CONTROL"==g.document.selection.type.toUpperCase()?new k(n.decomposeControlRange(d)):new k(n.decomposeTextRange(d));this.addRange(d,!0),this.isCollapsed=d.collapsed}},decomposeControlRange:function(g){var d=g.item(0),l=g.item(g.length-1);g=d.parentNode;var k=l.parentNode,d=v.getIndex(d,g).o[0],l=v.getIndex(l,k).o[0]+1;return[g,d,k,l]},getEndPoint:function(g,d){var l=g.duplicate();l.collapse(!d);var k="EndTo"+(d?"End":"Start"),n=l.parentElement(),b,a,m;0<n.childNodes.length?u.every(n.childNodes,
function(f,c){var e;if(3!=f.nodeType)if(l.moveToElementText(f),0<l.compareEndPoints(k,g))if(m&&3==m.nodeType)b=m,e=!0;else return b=n,a=c,!1;else{if(c==n.childNodes.length-1)return b=n,a=n.childNodes.length,!1}else c==n.childNodes.length-1&&(b=f,e=!0);if(e&&b)return b=(f=v.adjacentNoneTextNode(b)[0])?f.nextSibling:n.firstChild,c=v.adjacentNoneTextNode(b),f=c[0],c=c[1],f?(l.moveToElementText(f),l.collapse(!1)):l.moveToElementText(n),l.setEndPoint(k,g),a=l.text.length-c,!1;m=f;return!0}):(b=n,a=0);
d||1!=b.nodeType||a!=b.childNodes.length||(d=b.nextSibling)&&3==d.nodeType&&(b=d,a=0);return[b,a]},setEndPoint:function(g,d,l){g=g.duplicate();var k;if(3!=d.nodeType)if(0<l){if(k=d.childNodes[l-1])if(3==k.nodeType)d=k,l=k.length;else if(k.nextSibling&&3==k.nextSibling.nodeType)d=k.nextSibling,l=0;else{g.moveToElementText(k.nextSibling?k:d);var n=k.parentNode;k=n.insertBefore(k.ownerDocument.createTextNode(" "),k.nextSibling);g.collapse(!1);n.removeChild(k)}}else g.moveToElementText(d),g.collapse(!0);
3==d.nodeType&&(k=v.adjacentNoneTextNode(d),n=k[0],k=k[1],n?(g.moveToElementText(n),g.collapse(!1),"inherit"!=n.contentEditable&&k++):(g.moveToElementText(d.parentNode),g.collapse(!0),g.move("character",1),g.move("character",-1)),l+=k,0<l&&g.move("character",l)!=l&&console.error("Error when moving!"));return g},decomposeTextRange:function(g){var d=n.getEndPoint(g),l=d[0],k=d[1],r=d[0],d=d[1];g.htmlText.length&&(g.htmlText==g.text?d=k+g.text.length:(d=n.getEndPoint(g,!0),r=d[0],d=d[1]));return[l,k,
r,d]},setRange:function(g,d,l,k,r,b){d=n.setEndPoint(g,d,l);g.setEndPoint("StartToStart",d);if(!b)var a=n.setEndPoint(g,k,r);g.setEndPoint("EndToEnd",a||d);return g}},k=v.W3CRange=r(null,{constructor:function(){0<arguments.length?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.startContainer=this.commonAncestorContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.commonAncestorContainer=
this.startContainer!==this.endContainer?v.getCommonAncestor(this.startContainer,this.endContainer):this.startContainer;this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(g,d){d=parseInt(d);if(this.startContainer!==g||this.startOffset!=d)delete this._cachedBookmark,this.startContainer=g,this.startOffset=d,this.endContainer?this._updateInternal():this.setEnd(g,d)},setEnd:function(g,d){d=parseInt(d);if(this.endContainer!==g||this.endOffset!=d)delete this._cachedBookmark,
this.endContainer=g,this.endOffset=d,this.startContainer?this._updateInternal():this.setStart(g,d)},setStartAfter:function(g,d){this._setPoint("setStart",g,d,1)},setStartBefore:function(g,d){this._setPoint("setStart",g,d,0)},setEndAfter:function(g,d){this._setPoint("setEnd",g,d,1)},setEndBefore:function(g,d){this._setPoint("setEnd",g,d,0)},_setPoint:function(g,d,l,k){l=v.getIndex(d,d.parentNode).o;this[g](d.parentNode,l.pop()+k)},_getIERange:function(){var g=(this._body||this.endContainer.ownerDocument.body).createTextRange();
n.setRange(g,this.startContainer,this.startOffset,this.endContainer,this.endOffset,this.collapsed);return g},getBookmark:function(){this._getIERange();return this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var g=this.startContainer,d=this._getIERange();3!==g.nodeType||this.startOffset||this.setStartBefore(g);d.pasteHTML("");this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.collapsed=!0},cloneRange:function(){var g=new k([this.startContainer,
this.startOffset,this.endContainer,this.endOffset]);g._body=this._body;return g},detach:function(){this.startContainer=this.commonAncestorContainer=this._body=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=!0}});t.setObject("dijit.range",v);return v})},"dijit/_editor/html":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/sniff"],function(u,r,t){var v={};r.setObject("dijit._editor.html",v);var n=v.escapeXml=function(k,g){k=k.replace(/&/gm,"\x26amp;").replace(/</gm,
"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");g||(k=k.replace(/'/gm,"\x26#39;"));return k};v.getNodeHtml=function(k){var g=[];v.getNodeHtmlHelper(k,g);return g.join("")};v.getNodeHtmlHelper=function(k,g){switch(k.nodeType){case 1:var d=k.nodeName.toLowerCase();if(!d||"/"==d.charAt(0))return"";g.push("\x3c",d);var l=[],q={},r;if(t("dom-attributes-explicit")||t("dom-attributes-specified-flag"))for(var b=0;r=k.attributes[b++];){var a=r.name;"_dj"===a.substr(0,3)||t("dom-attributes-specified-flag")&&
!r.specified||a in q||(r=r.value,("src"==a||"href"==a)&&k.getAttribute("_djrealurl")&&(r=k.getAttribute("_djrealurl")),8===t("ie")&&"style"===a&&(r=r.replace("HEIGHT:","height:").replace("WIDTH:","width:")),l.push([a,r]),q[a]=r)}else{var m=(/^input$|^img$/i.test(k.nodeName)?k:k.cloneNode(!1)).outerHTML,q=m.match(/[\w-]+=("[^"]*"|'[^']*'|\S*)/gi),m=m.substr(0,m.indexOf("\x3e"));u.forEach(q,function(a){if(a){var b=a.indexOf("\x3d");if(0<b&&(a=a.substring(0,b),"_dj"!=a.substr(0,3)))if("src"!=a&&"href"!=
a||!k.getAttribute("_djrealurl")){var e;switch(a){case "style":e=k.style.cssText.toLowerCase();break;case "class":e=k.className;break;case "width":if("img"===d){(b=/width=(\S+)/i.exec(m))&&(e=b[1]);break}case "height":if("img"===d){(b=/height=(\S+)/i.exec(m))&&(e=b[1]);break}default:e=k.getAttribute(a)}null!=e&&l.push([a,e.toString()])}else l.push([a,k.getAttribute("_djrealurl")])}},this)}l.sort(function(a,b){return a[0]<b[0]?-1:a[0]==b[0]?0:1});for(q=0;r=l[q++];)g.push(" ",r[0],'\x3d"',"string"===
typeof r[1]?n(r[1],!0):r[1],'"');switch(d){case "br":case "hr":case "img":case "input":case "base":case "meta":case "area":case "basefont":g.push(" /\x3e");break;case "script":g.push("\x3e",k.innerHTML,"\x3c/",d,"\x3e");break;default:g.push("\x3e"),k.hasChildNodes()&&v.getChildrenHtmlHelper(k,g),g.push("\x3c/",d,"\x3e")}break;case 4:case 3:g.push(n(k.nodeValue,!0));break;case 8:g.push("\x3c!--",n(k.nodeValue,!0),"--\x3e");break;default:g.push("\x3c!-- Element not recognized - Type: ",k.nodeType," Name: ",
k.nodeName,"--\x3e")}};v.getChildrenHtml=function(k){var g=[];v.getChildrenHtmlHelper(k,g);return g.join("")};v.getChildrenHtmlHelper=function(k,g){if(k)for(var d=k.childNodes||k,l=!t("ie")||d!==k,q,n=0;q=d[n++];)l&&q.parentNode!=k||v.getNodeHtmlHelper(q,g)};return v})},"dijit/_editor/plugins/LinkDialog":function(){define("require dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/query dojo/string ../_Plugin ../../form/DropDownButton ../range".split(" "),function(u,
r,t,v,n,k,g,d,l,q,x,b){var a=r("dijit._editor.plugins.LinkDialog",q,{buttonClass:x,useDefaultCommand:!1,urlRegExp:"((https?|ftps?|file)\\://|./|../|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)*(?:[a-zA-Z](?:[-\\da-zA-Z]{0,80}[\\da-zA-Z])?)\\.?)|(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])|(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]|(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])|0[xX]0*[\\da-fA-F]{1,8}|([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}|([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])))(\\:\\d+)?(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]{0,}(?:\\?[^?#\\s/]*)?(?:#.*)?)?)?",
emailRegExp:"\x3c?(mailto\\:)([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)|localhost|^[^-][a-zA-Z0-9_-]*\x3e?",htmlTemplate:'\x3ca href\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" target\x3d"${targetSelect}"\x3e${textInput}\x3c/a\x3e',tag:"a",_hostRxp:/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,_userAtRxp:/^([!#-'*+\-\/-9=?A-Z^-~]+[.])*[!#-'*+\-\/-9=?A-Z^-~]+@/i,
linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_targetSelect'\x3e${target}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cselect id\x3d'${id}_targetSelect' name\x3d'targetSelect' data-dojo-type\x3d'dijit.form.Select'\x3e\x3coption selected\x3d'selected' value\x3d'_self'\x3e${currentWindow}\x3c/option\x3e\x3coption value\x3d'_blank'\x3e${newWindow}\x3c/option\x3e\x3coption value\x3d'_top'\x3e${topWindow}\x3c/option\x3e\x3coption value\x3d'_parent'\x3e${parentWindow}\x3c/option\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
_initButton:function(){this.inherited(arguments);this.button.loadDropDown=n.hitch(this,"_loadDropDown");this._connectTagEvents()},_loadDropDown:function(a){u("dojo/i18n ../../TooltipDialog ../../registry ../../form/Button ../../form/Select ../../form/ValidationTextBox dojo/i18n!../../nls/common dojo/i18n!../nls/LinkDialog".split(" "),n.hitch(this,function(b,e,f){var c=this;this.tag="insertImage"==this.command?"img":"a";b=n.delegate(b.getLocalization("dijit","common",this.lang),b.getLocalization("dijit._editor",
"LinkDialog",this.lang));var h=this.dropDown=this.button.dropDown=new e({title:b[this.command+"Title"],ownerDocument:this.editor.ownerDocument,dir:this.editor.dir,execute:n.hitch(this,"setValue"),onOpen:function(){c._onOpenDialog();e.prototype.onOpen.apply(this,arguments)},onCancel:function(){setTimeout(n.hitch(c,"_onCloseDialog"),0)}});b.urlRegExp=this.urlRegExp;b.id=f.getUniqueId(this.editor.id);this._uniqueId=b.id;this._setContent(h.title+"\x3cdiv style\x3d'border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'\x3e\x3c/div\x3e"+
l.substitute(this.linkDialogTemplate,b));h.startup();this._urlInput=f.byId(this._uniqueId+"_urlInput");this._textInput=f.byId(this._uniqueId+"_textInput");this._setButton=f.byId(this._uniqueId+"_setButton");this.own(f.byId(this._uniqueId+"_cancelButton").on("click",n.hitch(this.dropDown,"onCancel")));this._urlInput&&this.own(this._urlInput.on("change",n.hitch(this,"_checkAndFixInput")));this._textInput&&this.own(this._textInput.on("change",n.hitch(this,"_checkAndFixInput")));this._urlRegExp=new RegExp("^"+
this.urlRegExp+"$","i");this._emailRegExp=new RegExp("^"+this.emailRegExp+"$","i");this._urlInput.isValid=n.hitch(this,function(){var a=this._urlInput.get("value");return this._urlRegExp.test(a)||this._emailRegExp.test(a)});this.own(k(h.domNode,"keydown",n.hitch(this,n.hitch(this,function(a){!a||a.keyCode!=v.ENTER||a.shiftKey||a.metaKey||a.ctrlKey||a.altKey||this._setButton.get("disabled")||(h.onExecute(),h.execute(h.get("value")))}))));a()}))},_checkAndFixInput:function(){var a=this,b=this._urlInput.get("value");
this._delayedCheck&&(clearTimeout(this._delayedCheck),this._delayedCheck=null);this._delayedCheck=setTimeout(function(){var c=b,f=!1,d=!1;c&&1<c.length&&(c=n.trim(c),0!==c.indexOf("mailto:")&&(0<c.indexOf("/")?-1===c.indexOf("://")&&"/"!==c.charAt(0)&&c.indexOf("./")&&0!==c.indexOf("../")&&a._hostRxp.test(c)&&(f=!0):a._userAtRxp.test(c)&&(d=!0)));f&&a._urlInput.set("value","http://"+c);d&&a._urlInput.set("value","mailto:"+c);a._setButton.set("disabled",!a._isValid())},250)},_connectTagEvents:function(){this.editor.onLoadDeferred.then(n.hitch(this,
function(){this.own(k(this.editor.editNode,"mouseup",n.hitch(this,"_onMouseUp")));this.own(k(this.editor.editNode,"dblclick",n.hitch(this,"_onDblClick")))}))},_isValid:function(){return this._urlInput.isValid()&&this._textInput.isValid()},_setContent:function(a){this.dropDown.set({parserScope:"dojo",content:a})},_checkValues:function(a){a&&a.urlInput&&(a.urlInput=a.urlInput.replace(/"/g,"\x26quot;"));return a},_createlinkEnabledImpl:function(){return!0},setValue:function(a){this._onCloseDialog();
if(9>g("ie")){var c=b.getSelection(this.editor.window).getRangeAt(0).endContainer;3===c.nodeType&&(c=c.parentNode);c&&c.nodeName&&c.nodeName.toLowerCase()!==this.tag&&(c=this.editor.selection.getSelectedElement(this.tag));c&&c.nodeName&&c.nodeName.toLowerCase()===this.tag&&this.editor.queryCommandEnabled("unlink")&&(this.editor.selection.selectElementChildren(c),this.editor.execCommand("unlink"))}a=this._checkValues(a);this.editor.execCommand("inserthtml",l.substitute(this.htmlTemplate,a));d("a",
this.editor.document).forEach(function(a){a.innerHTML||t.has(a,"name")||a.parentNode.removeChild(a)},this)},_onCloseDialog:function(){this.editor.focused&&this.editor.focus()},_getCurrentValues:function(a){var b,e,f;a&&a.tagName.toLowerCase()===this.tag?(b=a.getAttribute("_djrealurl")||a.getAttribute("href"),f=a.getAttribute("target")||"_self",e=a.textContent||a.innerText,this.editor.selection.selectElement(a,!0)):e=this.editor.selection.getSelectedText();return{urlInput:b||"",textInput:e||"",targetSelect:f||
""}},_onOpenDialog:function(){var a,c;if(g("ie")){if(c=b.getSelection(this.editor.window),c.rangeCount){var e=c.getRangeAt(0);a=e.endContainer;3===a.nodeType&&(a=a.parentNode);a&&a.nodeName&&a.nodeName.toLowerCase()!==this.tag&&(a=this.editor.selection.getSelectedElement(this.tag));if(!a||a.nodeName&&a.nodeName.toLowerCase()!==this.tag)(c=this.editor.selection.getAncestorElement(this.tag))&&c.nodeName&&c.nodeName.toLowerCase()==this.tag?(a=c,this.editor.selection.selectElement(a)):e.startContainer===
e.endContainer&&(c=e.startContainer.firstChild)&&c.nodeName&&c.nodeName.toLowerCase()==this.tag&&(a=c,this.editor.selection.selectElement(a))}}else a=this.editor.selection.getAncestorElement(this.tag);this.dropDown.reset();this._setButton.set("disabled",!0);this.dropDown.set("value",this._getCurrentValues(a))},_onDblClick:function(a){if(a&&a.target&&(a=a.target,(a.tagName?a.tagName.toLowerCase():"")===this.tag&&t.get(a,"href"))){var b=this.editor;this.editor.selection.selectElement(a);b.onDisplayChanged();
b._updateTimer&&(b._updateTimer.remove(),delete b._updateTimer);b.onNormalizedDisplayChanged();var e=this.button;setTimeout(function(){e.set("disabled",!1);e.loadAndOpenDropDown().then(function(){e.dropDown.focus&&e.dropDown.focus()})},10)}},_onMouseUp:function(){if(g("ff")){var a=this.editor.selection.getAncestorElement(this.tag);if(a){var c=b.getSelection(this.editor.window).getRangeAt(0);if(c.collapsed&&a.childNodes.length){var e=c.cloneRange();e.selectNodeContents(a.childNodes[a.childNodes.length-
1]);e.setStart(a.childNodes[0],0);1!==c.compareBoundaryPoints(e.START_TO_START,e)?c.setStartBefore(a):-1!==c.compareBoundaryPoints(e.END_TO_START,e)&&c.setStartAfter(a)}}}}}),m=r("dijit._editor.plugins.ImgLinkDialog",[a],{linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput dojoType\x3d'dijit.form.ValidationTextBox' regExp\x3d'${urlRegExp}' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'false' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
htmlTemplate:'\x3cimg src\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" alt\x3d"${textInput}" /\x3e',tag:"img",_getCurrentValues:function(a){var b,e;a&&a.tagName.toLowerCase()===this.tag?(b=a.getAttribute("_djrealurl")||a.getAttribute("src"),e=a.getAttribute("alt"),this.editor.selection.selectElement(a,!0)):e=this.editor.selection.getSelectedText();return{urlInput:b||"",textInput:e||""}},_isValid:function(){return this._urlInput.isValid()},_connectTagEvents:function(){this.inherited(arguments);this.editor.onLoadDeferred.then(n.hitch(this,
function(){this.own(k(this.editor.editNode,"mousedown",n.hitch(this,"_selectTag")))}))},_selectTag:function(a){a&&a.target&&(a=a.target,(a.tagName?a.tagName.toLowerCase():"")===this.tag&&this.editor.selection.selectElement(a))},_checkValues:function(a){a&&a.urlInput&&(a.urlInput=a.urlInput.replace(/"/g,"\x26quot;"));a&&a.textInput&&(a.textInput=a.textInput.replace(/"/g,"\x26quot;"));return a},_onDblClick:function(a){if(a&&a.target&&(a=a.target,(a.tagName?a.tagName.toLowerCase():"")===this.tag&&t.get(a,
"src"))){var b=this.editor;this.editor.selection.selectElement(a);b.onDisplayChanged();b._updateTimer&&(b._updateTimer.remove(),delete b._updateTimer);b.onNormalizedDisplayChanged();var e=this.button;setTimeout(function(){e.set("disabled",!1);e.loadAndOpenDropDown().then(function(){e.dropDown.focus&&e.dropDown.focus()})},10)}}});q.registry.createLink=function(){return new a({command:"createLink"})};q.registry.insertImage=function(){return new m({command:"insertImage"})};a.ImgLinkDialog=m;return a})},
"dijit/_editor/plugins/TextColor":function(){define("require dojo/colors dojo/_base/declare dojo/_base/lang ../_Plugin ../../form/DropDownButton".split(" "),function(u,r,t,v,n,k){var g=t("dijit._editor.plugins.TextColor",n,{buttonClass:k,colorPicker:"dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command=this.name;this.inherited(arguments);var d=this;this.button.loadDropDown=function(g){function l(l){d.button.dropDown=new l({dir:d.editor.dir,ownerDocument:d.editor.ownerDocument,
value:d.value,onChange:function(b){d.editor.execCommand(d.command,b)},onExecute:function(){d.editor.execCommand(d.command,this.get("value"))}});g()}"string"==typeof d.colorPicker?u([d.colorPicker],l):l(d.colorPicker)}},updateState:function(){var d=this.editor,g=this.command;if(d&&d.isLoaded&&g.length){if(this.button){var k=this.get("disabled");this.button.set("disabled",k);if(k)return;var n;try{n=d.queryCommandValue(g)||""}catch(b){n=""}}""==n&&(n="#000000");"transparent"==n&&(n="#ffffff");"string"==
typeof n?-1<n.indexOf("rgb")&&(n=r.fromRgb(n).toHex()):(n=((n&255)<<16|n&65280|(n&16711680)>>>16).toString(16),n="#000000".slice(0,7-n.length)+n);this.value=n;(d=this.button.dropDown)&&d.get&&n!==d.get("value")&&d.set("value",n,!1)}}});n.registry.foreColor=function(d){return new g(d)};n.registry.hiliteColor=function(d){return new g(d)};return g})},"esri/dijit/editing/AttachmentEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/io-query dojo/dom-attr dijit/_Widget dijit/_Templated dijit/ProgressBar ../../kernel ../../lang ../../domUtils dojo/text!./templates/AttachmentEditor.html dojo/i18n!../../nls/jsapi dojo/NodeList-dom".split(" "),
function(u,r,t,v,n,k,g,d,l,q,x,b,a,m,f,c,e){u=u([q,x],{declaredClass:"esri.dijit.editing.AttachmentEditor",widgetsInTemplate:!0,templateString:c,_listHtml:"\x3cspan id\x3d'node_${oid}_${attid}' style\x3d'display: flex;'\x3e\x3ca href\x3d'${href}' target\x3d'_blank'\x3e${name}\x3c/a\x3e",_deleteBtnHtml:"\x3cspan style\x3d'cursor:pointer;color:red;font-weight:bold;padding:0 2px;' class\x3d'deleteAttachment' id\x3d'${attid}');'\x3eX\x3c/span\x3e",_endHtml:"\x3cbr/\x3e\x3c/span\x3e",_aeConnects:[],_layerEditingCapChecked:{},
_layerEditingCap:{},constructor:function(a,b){r.mixin(this,e.widgets.attachmentEditor)},startup:function(){this.inherited(arguments);this._uploadField_connect=t.connect(this._uploadField,"onchange",this,function(){0<this._uploadField.value.length&&this._addAttachment()});this._uploadFieldFocus_connect=t.connect(this._uploadField,"onfocus",r.hitch(this,function(a){f.hide(this._attachmentError)}))},destroy:function(){v.forEach(this._aeConnects,t.disconnect);t.disconnect(this._uploadField_connect);t.disconnect(this._uploadFieldFocus_connect);
this.inherited(arguments)},showAttachments:function(a,b){this._attachmentList.innerHTML=this.NLS_none;this._uploadField.value="";v.forEach(this.domNode.children,function(a,b){f.show(a)});f.hide(this._attachmentError);a&&(this._featureLayer=a.getLayer()||b)&&("esri.layers.FeatureLayer"===this._featureLayer.declaredClass&&this._featureLayer.getEditCapabilities?(this._currentLayerId=this._featureLayer.id,this._layerEditingCapChecked[this._currentLayerId]||(this._layerEditingCap[this._currentLayerId]=
this._featureLayer.getEditCapabilities(),this._layerEditingCapChecked[this._currentLayerId]=!0),this._featureCanUpdate=this._featureLayer.getEditCapabilities({feature:a}).canUpdate,this._oid=a.attributes[this._featureLayer.objectIdField],this._getAttachments(a)):b&&b.getEditCapabilities()||(f.hide(this._uploadForm),v.forEach(this.domNode.children,function(a,b){f.hide(a)})))},_getAttachments:function(a){this._featureLayer&&this._featureLayer.queryAttachmentInfos&&this._featureLayer.queryAttachmentInfos(this._oid,
r.hitch(this,"_onQueryAttachmentInfosComplete"))},_addAttachment:function(){f.hide(this._attachmentError);this._featureLayer&&this._featureLayer.addAttachment?(f.show(this._attachmentProgress),this._featureLayer.addAttachment(this._oid,this._uploadForm,r.hitch(this,"_onAddAttachmentComplete"),r.hitch(this,"_onAddAttachmentError"))):this._tempUpload=this._uploadForm},_chainAttachment:function(a,b){this._tempUpload&&(f.show(this._attachmentProgress),b.addAttachment(a,this._tempUpload,r.hitch(this,"_onAddAttachmentComplete"),
r.hitch(this,"_onAddAttachmentError")));this._tempUpload=null},_deleteAttachment:function(a,b){f.show(this._attachmentProgress);this._featureLayer.deleteAttachments(a,[b],r.hitch(this,"_onDeleteAttachmentComplete"))},_onQueryAttachmentInfosComplete:function(a){var b=this._listHtml+this._deleteBtnHtml+this._endHtml;this._uploadForm.style.display="block";!this._featureCanUpdate&&this._layerEditingCap[this._currentLayerId].canUpdate||!this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate?
(b=this._listHtml+this._endHtml,this._uploadForm.style.display="none"):this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(b=this._listHtml+this._endHtml);var c=this._attachmentList;a=v.map(a,r.hitch(this,function(a){return m.substitute({href:a.url,name:a.name,oid:a.objectId,attid:a.id},b)}));c.innerHTML=a.join("")||this.NLS_none;this._updateConnects()},_onAddAttachmentComplete:function(a){f.hide(this._attachmentProgress.domNode);var b=this._attachmentList,
c=this._uploadField,e=c.value,h=e.lastIndexOf("\\");-1<h&&(e=e.substring(h+1,e.length));var e=e.replace(/\ /g,"_"),h=d.objectToQuery({gdbVersion:this._featureLayer.gdbVersion,token:this._featureLayer._getToken()}),g=this._listHtml+this._deleteBtnHtml+this._endHtml;this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(g=this._listHtml+this._endHtml);a=m.substitute({href:this._featureLayer._url.path+"/"+a.objectId+"/attachments/"+a.attachmentId+
(h?"?"+h:""),name:e,oid:a.objectId,attid:a.attachmentId},g);b.innerHTML=b.innerHTML==this.NLS_none?a:b.innerHTML+a;this._updateConnects();c.value=""},_onAddAttachmentError:function(a){f.hide(this._attachmentProgress.domNode);if(a&&m.isDefined(a.code)){var b=this._attachmentError;l.set(b,"innerHTML",(400===a.code?this.NLS_fileNotSupported:a.message||a.details&&a.details.length&&a.details[0])||this.NLS_error);f.show(b)}},_onDeleteAttachmentComplete:function(a){f.hide(this._attachmentProgress.domNode);
var b=this._attachmentList;v.every(a,function(a){return a.success})&&(n.query("#node_"+a[0].objectId+"_"+a[0].attachmentId).orphan(),b.children&&b.children.length||(b.innerHTML=this.NLS_none))},_updateConnects:function(){v.forEach(this._aeConnects,t.disconnect);n.query(".deleteAttachment").forEach(function(a){this._aeConnects.push(t.connect(a,"onclick",r.hitch(this,"_deleteAttachment",this._oid,a.id)))},this)}});k("extend-esri")&&r.setObject("dijit.editing.AttachmentEditor",u,a);return u})},"dijit/ProgressBar":function(){define("require dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/number ./_Widget ./_TemplatedMixin dojo/text!./templates/ProgressBar.html".split(" "),
function(u,r,t,v,n,k,g,d){return r("dijit.ProgressBar",[k,g],{progress:"0",value:"",maximum:100,places:0,indeterminate:!1,label:"",name:"",templateString:d,_indeterminateHighContrastImagePath:u.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);this.params&&"value"in this.params||(this.value=this.indeterminate?Infinity:this.progress)},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());
this.update()},_setDirAttr:function(d){var g="rtl"==d.toLowerCase();t.toggle(this.domNode,"dijitProgressBarRtl",g);t.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&g);this.inherited(arguments)},update:function(d){v.mixin(this,d||{});d=this.internalProgress;var g=this.domNode,k=1;this.indeterminate?g.removeAttribute("aria-valuenow"):(-1!=String(this.progress).indexOf("%")?(k=Math.min(parseFloat(this.progress)/100,1),this.progress=k*this.maximum):(this.progress=Math.min(this.progress,
this.maximum),k=this.maximum?this.progress/this.maximum:0),g.setAttribute("aria-valuenow",this.progress));g.setAttribute("aria-labelledby",this.labelNode.id);g.setAttribute("aria-valuemin",0);g.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(k);t.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);t.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&!this.isLeftToRight());d.style.width=100*k+"%";this.onChange()},_setValueAttr:function(d){this._set("value",
d);Infinity==d?this.update({indeterminate:!0}):this.update({indeterminate:!1,progress:d})},_setLabelAttr:function(d){this._set("label",d);this.update()},_setIndeterminateAttr:function(d){this._set("indeterminate",d);this.update()},report:function(d){return this.label?this.label:this.indeterminate?"\x26#160;":n.format(d,{type:"percent",places:this.places,locale:this.lang})},onChange:function(){}})})},"esri/dijit/editing/Util":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/has","../../kernel"],
function(u,r,t,v){var n={},n={findFeatures:function(k,g,d){var l=g.objectIdField;g=r.filter(g.graphics,function(d){return r.some(k,function(g){return d.attributes[l]===g.objectId})});if(d)d(g);else return g},getSelection:function(k){var g=[];r.forEach(k,function(d){d=d.getSelectedFeatures();r.forEach(d,function(d){g.push(d)})});return g},sortFeaturesById:function(k,g){var d=r.map(k,function(d){return d.featureLayer});g.sort(function(g,k){var l=g.getLayer(),b=k.getLayer();if(!l)return-1;if(!b)return 1;
var a=r.indexOf(d,l),b=r.indexOf(d,b),a=a-b;a||(l=l.objectIdField,a=g.attributes[l]-k.attributes[l]);return a});return g}};t("extend-esri")&&u.setObject("dijit.editing.Util.LayerHelper",n,v);return n})},"dojox/date/islamic":function(){define(["dojox/main","dojo/_base/lang","dojo/date","./islamic/Date"],function(u,r,t,v){var n=r.getObject("date.islamic",!0,u);n.getDaysInMonth=function(k){return k.getDaysInIslamicMonth(k.getMonth(),k.getFullYear())};n.compare=function(k,g,d){k instanceof v&&(k=k.toGregorian());
g instanceof v&&(g=g.toGregorian());return t.compare.apply(null,arguments)};n.add=function(k,g,d){var l=new v(k);switch(g){case "day":l.setDate(k.getDate()+d);break;case "weekday":var q=k.getDay();if(5>q+d&&0<q+d)l.setDate(k.getDate()+d);else{var n=g=0;5==q?(q=4,n=0<d?-1:1):6==q&&(q=4,n=0<d?-2:2);var q=0<d?5-q-1:-q,b=d-q,a=parseInt(b/5);0!=b%5&&(g=0<d?2:-2);g=g+7*a+b%5+q;l.setDate(k.getDate()+g+n)}break;case "year":l.setFullYear(k.getFullYear()+d);break;case "week":d*=7;l.setDate(k.getDate()+d);break;
case "month":k=k.getMonth();l.setMonth(k+d);break;case "hour":l.setHours(k.getHours()+d);break;case "minute":l._addMinutes(d);break;case "second":l._addSeconds(d);break;case "millisecond":l._addMilliseconds(d)}return l};n.difference=function(k,g,d){g=g||new v;d=d||"day";var l=g.getFullYear()-k.getFullYear(),q=1;switch(d){case "weekday":l=Math.round(n.difference(k,g,"day"));q=parseInt(n.difference(k,g,"week"));if(0==l%7)l=5*q;else{d=0;var r=k.getDay(),b=g.getDay(),q=parseInt(l/7);g=l%7;k=new v(k);
k.setDate(k.getDate()+7*q);k=k.getDay();if(0<l)switch(!0){case 5==r:d=-1;break;case 6==r:d=0;break;case 5==b:d=-1;break;case 6==b:d=-2;break;case 5<k+g:d=-2}else if(0>l)switch(!0){case 5==r:d=0;break;case 6==r:d=1;break;case 5==b:d=2;break;case 6==b:d=1;break;case 0>k+g:d=2}l=l+d-2*q}q=l;break;case "year":q=l;break;case "month":d=g.toGregorian()>k.toGregorian()?g:k;r=g.toGregorian()>k.toGregorian()?k:g;q=d.getMonth();b=r.getMonth();if(0==l)q=d.getMonth()-r.getMonth();else for(q=12-b+q,l=r.getFullYear()+
1,d=d.getFullYear(),l;l<d;l++)q+=12;g.toGregorian()<k.toGregorian()&&(q=-q);break;case "week":q=parseInt(n.difference(k,g,"day")/7);break;case "day":q/=24;case "hour":q/=60;case "minute":q/=60;case "second":q/=1E3;case "millisecond":q*=g.toGregorian().getTime()-k.toGregorian().getTime()}return Math.round(q)};return n})},"dojox/date/islamic/Date":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/date"],function(u,r,t){var v=r("dojox.date.islamic.Date",null,{_date:0,_month:0,_year:0,_hours:0,
_minutes:0,_seconds:0,_milliseconds:0,_day:0,_GREGORIAN_EPOCH:1721425.5,_ISLAMIC_EPOCH:1948439.5,constructor:function(){var n=arguments.length;n?1==n?(n=arguments[0],"number"==typeof n&&(n=new Date(n)),n instanceof Date?this.fromGregorian(n):""==n?this._date=new Date(""):(this._year=n._year,this._month=n._month,this._date=n._date,this._hours=n._hours,this._minutes=n._minutes,this._seconds=n._seconds,this._milliseconds=n._milliseconds)):3<=n&&(this._year+=arguments[0],this._month+=arguments[1],this._date+=
arguments[2],this._hours+=arguments[3]||0,this._minutes+=arguments[4]||0,this._seconds+=arguments[5]||0,this._milliseconds+=arguments[6]||0):this.fromGregorian(new Date)},getDate:function(){return this._date},getMonth:function(){return this._month},getFullYear:function(){return this._year},getDay:function(){return this.toGregorian().getDay()},getHours:function(){return this._hours},getMinutes:function(){return this._minutes},getSeconds:function(){return this._seconds},getMilliseconds:function(){return this._milliseconds},
setDate:function(n){n=parseInt(n);if(!(0<n&&n<=this.getDaysInIslamicMonth(this._month,this._year))){var k;if(0<n)for(k=this.getDaysInIslamicMonth(this._month,this._year);n>k;n-=k,k=this.getDaysInIslamicMonth(this._month,this._year))this._month++,12<=this._month&&(this._year++,this._month-=12);else for(k=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1);0>=n;k=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:
this._year-1))this._month--,0>this._month&&(this._year--,this._month+=12),n+=k}this._date=n;return this},setFullYear:function(n){this._year=+n},setMonth:function(n){this._year+=Math.floor(n/12);this._month=0<n?Math.floor(n%12):Math.floor((n%12+12)%12)},setHours:function(){var n=arguments.length,k=0;1<=n&&(k=parseInt(arguments[0]));2<=n&&(this._minutes=parseInt(arguments[1]));3<=n&&(this._seconds=parseInt(arguments[2]));4==n&&(this._milliseconds=parseInt(arguments[3]));for(;24<=k;)this._date++,n=this.getDaysInIslamicMonth(this._month,
this._year),this._date>n&&(this._month++,12<=this._month&&(this._year++,this._month-=12),this._date-=n),k-=24;this._hours=k},_addMinutes:function(n){n+=this._minutes;this.setMinutes(n);this.setHours(this._hours+parseInt(n/60));return this},_addSeconds:function(n){n+=this._seconds;this.setSeconds(n);this._addMinutes(parseInt(n/60));return this},_addMilliseconds:function(n){n+=this._milliseconds;this.setMilliseconds(n);this._addSeconds(parseInt(n/1E3));return this},setMinutes:function(n){this._minutes=
n%60;return this},setSeconds:function(n){this._seconds=n%60;return this},setMilliseconds:function(n){this._milliseconds=n%1E3;return this},toString:function(){if(isNaN(this._date))return"Invalidate Date";var n=new Date;n.setHours(this._hours);n.setMinutes(this._minutes);n.setSeconds(this._seconds);n.setMilliseconds(this._milliseconds);return this._month+" "+this._date+" "+this._year+" "+n.toTimeString()},toGregorian:function(){var n=this._year,n=Math.floor(this._date+Math.ceil(29.5*this._month)+354*
(n-1)+Math.floor((3+11*n)/30)+this._ISLAMIC_EPOCH-1-.5)+.5,k=n-this._GREGORIAN_EPOCH,g=Math.floor(k/146097),d=this._mod(k,146097),k=Math.floor(d/36524),l=this._mod(d,36524),d=Math.floor(l/1461),l=this._mod(l,1461),l=Math.floor(l/365),g=400*g+100*k+4*d+l;4!=k&&4!=l&&g++;k=n-(this._GREGORIAN_EPOCH+365*(g-1)+Math.floor((g-1)/4)-Math.floor((g-1)/100)+Math.floor((g-1)/400));d=this._GREGORIAN_EPOCH-1+365*(g-1)+Math.floor((g-1)/4)-Math.floor((g-1)/100)+Math.floor((g-1)/400)+Math.floor(739/12+(t.isLeapYear(new Date(g,
3,1))?-1:-2)+1);d=n<d?0:t.isLeapYear(new Date(g,3,1))?1:2;k=Math.floor((12*(k+d)+373)/367);d=this._GREGORIAN_EPOCH-1+365*(g-1)+Math.floor((g-1)/4)-Math.floor((g-1)/100)+Math.floor((g-1)/400)+Math.floor((367*k-362)/12+(2>=k?0:t.isLeapYear(new Date(g,k-1,1))?-1:-2)+1);return new Date(g,k-1,n-d+1,this._hours,this._minutes,this._seconds,this._milliseconds)},fromGregorian:function(n){n=new Date(n);var k=n.getFullYear(),g=n.getMonth(),d=n.getDate(),k=this._GREGORIAN_EPOCH-1+365*(k-1)+Math.floor((k-1)/4)+
-Math.floor((k-1)/100)+Math.floor((k-1)/400)+Math.floor((367*(g+1)-362)/12+(2>=g+1?0:t.isLeapYear(n)?-1:-2)+d),k=Math.floor(k)+.5,k=k-this._ISLAMIC_EPOCH,g=Math.floor((30*k+10646)/10631),d=Math.ceil((k-29-this._yearStart(g))/29.5),d=Math.min(d,11);this._date=Math.ceil(k-this._monthStart(g,d))+1;this._month=d;this._year=g;this._hours=n.getHours();this._minutes=n.getMinutes();this._seconds=n.getSeconds();this._milliseconds=n.getMilliseconds();this._day=n.getDay();return this},valueOf:function(){return this.toGregorian().valueOf()},
_yearStart:function(n){return 354*(n-1)+Math.floor((3+11*n)/30)},_monthStart:function(n,k){return Math.ceil(29.5*k)+354*(n-1)+Math.floor((3+11*n)/30)},_civilLeapYear:function(n){return 11>(14+11*n)%30},getDaysInIslamicMonth:function(n,k){var g=0,g=29+(n+1)%2;11==n&&this._civilLeapYear(k)&&g++;return g},_mod:function(n,k){return n-k*Math.floor(n/k)}});v.getDaysInIslamicMonth=function(n){return(new v).getDaysInIslamicMonth(n.getMonth(),n.getFullYear())};return v})},"dojox/date/islamic/locale":function(){define("dojox/main dojo/_base/lang dojo/_base/array dojo/date dojo/i18n dojo/regexp dojo/string ./Date dojo/i18n!dojo/cldr/nls/islamic".split(" "),
function(u,r,t,v,n,k,g,d,l){function q(a,b,e,h,d){return d.replace(/([a-z])\1*/ig,function(c){var e,f,h=c.charAt(0);c=c.length;var m=["abbr","wide","narrow"];switch(h){case "G":e=b.eraAbbr[0];break;case "y":e=String(a.getFullYear());break;case "M":e=a.getMonth();3>c?(e+=1,f=!0):(h=["months-format",m[c-3]].join("-"),e=b[h][e]);break;case "d":e=a.getDate(!0);f=!0;break;case "E":e=a.getDay();3>c?(e+=1,f=!0):(h=["days-format",m[c-3]].join("-"),e=b[h][e]);break;case "a":e=12>a.getHours()?"am":"pm";e=b["dayPeriods-format-wide-"+
e];break;case "h":case "H":case "K":case "k":f=a.getHours();switch(h){case "h":e=f%12||12;break;case "H":e=f;break;case "K":e=f%12;break;case "k":e=f||24}f=!0;break;case "m":e=a.getMinutes();f=!0;break;case "s":e=a.getSeconds();f=!0;break;case "S":e=Math.round(a.getMilliseconds()*Math.pow(10,c-3));f=!0;break;case "z":if(e=v.getTimezoneName(a.toGregorian()))break;c=4;case "Z":e=a.toGregorian().getTimezoneOffset();e=[0>=e?"+":"-",g.pad(Math.floor(Math.abs(e)/60),2),g.pad(Math.abs(e)%60,2)];4==c&&(e.splice(0,
0,"GMT"),e.splice(3,0,":"));e=e.join("");break;default:throw Error("dojox.date.islamic.locale.formatPattern: invalid pattern char: "+d);}f&&(e=g.pad(e,c));return e})}function x(a,b,e,h){var c=function(a){return a};b=b||c;e=e||c;h=h||c;var f=a.match(/(''|[^'])+/g),d="'"==a.charAt(0);t.forEach(f,function(a,c){a?(f[c]=(d?e:b)(a),d=!d):f[c]=""});return h(f.join(""))}function b(a,b,e,h){h=k.escapeString(h);n.normalizeLocale(e.locale);return h.replace(/([a-z])\1*/ig,function(c){var f;f=c.charAt(0);var h=
c.length,d="";e.strict?1<h&&(d="0{"+(h-1)+"}"):d="0?";switch(f){case "y":f="\\d+";break;case "M":f=2<h?"\\S+ ?\\S+":d+"[1-9]|1[0-2]";break;case "d":f="[12]\\d|"+d+"[1-9]|3[01]";break;case "E":f="\\S+";break;case "h":f=d+"[1-9]|1[0-2]";break;case "k":f=d+"\\d|1[01]";break;case "H":f=d+"\\d|1\\d|2[0-3]";break;case "K":f=d+"[1-9]|1\\d|2[0-4]";break;case "m":case "s":f=d+"\\d|[0-5]\\d";break;case "S":f="\\d{"+h+"}";break;case "a":h=e.am||b["dayPeriods-format-wide-am"];d=e.pm||b["dayPeriods-format-wide-pm"];
e.strict?f=h+"|"+d:(f=h+"|"+d,h!=h.toLowerCase()&&(f+="|"+h.toLowerCase()),d!=d.toLowerCase()&&(f+="|"+d.toLowerCase()));break;default:f=".*"}a&&a.push(c);return"("+f+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var a=r.getObject("date.islamic.locale",!0,u);a.format=function(b,c){c=c||{};var e=n.normalizeLocale(c.locale),f=c.formatLength||"short",d=a._getIslamicBundle(e),g=[],e=r.hitch(this,q,b,d,e,c.fullYear);if("year"==c.selector)return b.getFullYear();"time"!=c.selector&&(b=c.datePattern||d["dateFormat-"+
f])&&g.push(x(b,e));"date"!=c.selector&&(c=c.timePattern||d["timeFormat-"+f])&&g.push(x(c,e));return g.join(" ")};a.regexp=function(b){return a._parseInfo(b).regexp};a._parseInfo=function(f){f=f||{};var c=n.normalizeLocale(f.locale),c=a._getIslamicBundle(c),e=f.formatLength||"short",d=f.datePattern||c["dateFormat-"+e],e=f.timePattern||c["timeFormat-"+e],g=[];return{regexp:x("date"==f.selector?d:"time"==f.selector?e:"undefined"==typeof e?d:d+" "+e,r.hitch(this,b,g,c,f)),tokens:g,bundle:c}};a.parse=
function(b,c){b=b.replace(/[\u200E\u200F\u202A\u202E]/g,"");c||(c={});var e=a._parseInfo(c),f=e.tokens,g=e.bundle,e=e.regexp.replace(/[\u200E\u200F\u202A\u202E]/g,"");b=(new RegExp("^"+e+"$")).exec(b);n.normalizeLocale(c.locale);if(!b)return null;var m=[1389,0,1,0,0,0,0],k="",l=["abbr","wide","narrow"];t.every(b,function(a,b){if(!b)return!0;b=f[b-1];var e=b.length;switch(b.charAt(0)){case "y":m[0]=Number(a);break;case "M":if(2<e){if(b=g["months-format-"+l[e-3]].concat(),c.strict||(a=a.replace(".",
"").toLowerCase(),b=t.map(b,function(a){return a?a.replace(".","").toLowerCase():a})),a=t.indexOf(b,a),-1==a)return!1}else a--;m[1]=Number(a);break;case "D":m[1]=0;case "d":m[2]=Number(a);break;case "a":b=c.am||g["dayPeriods-format-wide-am"];e=c.pm||g["dayPeriods-format-wide-pm"];if(!c.strict){var d=/\./g;a=a.replace(d,"").toLowerCase();b=b.replace(d,"").toLowerCase();e=e.replace(d,"").toLowerCase()}if(c.strict&&a!=b&&a!=e)return!1;k=a==e?"p":a==b?"a":"";break;case "K":24==a&&(a=0);case "h":case "H":case "k":m[3]=
Number(a);break;case "m":m[4]=Number(a);break;case "s":m[5]=Number(a);break;case "S":m[6]=Number(a)}return!0});b=+m[3];"p"===k&&12>b?m[3]=b+12:"a"===k&&12==b&&(m[3]=0);return new d(m[0],m[1],m[2],m[3],m[4],m[5],m[6])};var m=[];a.addCustomFormats=function(a,b){m.push({pkg:a,name:b})};a._getIslamicBundle=function(a){var b={};t.forEach(m,function(c){c=n.getLocalization(c.pkg,c.name,a);b=r.mixin(b,c)},this);return b};a.addCustomFormats("dojo.cldr","islamic");a.getNames=function(b,c,e,d,g){var f;d=a._getIslamicBundle(d);
b=[b,e,c];"standAlone"==e&&(e=b.join("-"),f=d[e],1==f[0]&&(f=void 0));b[1]="format";return(f||d[b.join("-")]).concat()};a.weekDays=a.getNames("days","wide","format");a.months=a.getNames("months","wide","format");return a})},"widgets/SituationAwareness/js/SummaryInfo":function(){define("dojo/_base/declare dojo/Evented dojo/_base/array dojo/DeferredList dojo/Deferred dojo/_base/lang dojo/dom-class dojo/dom-construct dojo/on dojo/keys jimu/utils jimu/dijit/Message esri/graphic esri/layers/FeatureLayer esri/tasks/query esri/tasks/QueryTask ./analysisUtils".split(" "),
function(u,r,t,v,n,k,g,d,l,q,x,b,a,m,f,c,e){return u("SummaryInfo",[r],{summaryLayer:null,summaryFields:[],summaryIds:[],summaryFeatures:[],tabNum:null,symbolField:null,graphicsLayer:null,lyrRenderer:null,lyrSymbol:null,featureCount:0,mapServiceLayer:!1,loading:!1,queryOnLoad:!1,incidentCount:0,allFields:!1,configuredPopUpFields:[],constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.config=c.config;this.graphicsLayer=null;this.baseLabel=""!==a.label?a.label:a.layerTitle?a.layerTitle:
a.layers;this.parentNode=c.domNode},queryTabCount:function(a,b,c,e){var f=new n;this.incidentCount=a.length;var d=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(d=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer")){this.mapServiceLayer=!0;var h;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded?
(this.summaryFields=this._getFields(this.summaryLayer),this._performQuery(a,b,c,e,d).then(function(a){f.resolve(a)})):(h=new m(this.summaryLayer.url),h.infoTemplate=this.tab.tabLayers[0].infoTemplate,d=[h],this.tab.tabLayers=d,l(h,"load",k.hitch(this,function(){this.summaryLayer=h;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(a,b,c,e,d).then(function(a){f.resolve(a)})})))):this.loading||(h=new m(this.tab.tabLayers[0].url),this.loading=!0,l(h,"load",k.hitch(this,function(){this.summaryLayer=
h;this.summaryFields=this._getFields(this.summaryLayer);for(var g=this.tab.tabLayers[0].url.split("MapServer/")[1],m=this.parent.map.itemInfo.itemData.operationalLayers,k=0;k<m.length;k++){var l=m[k];if(-1<this.tab.tabLayers[0].url.indexOf(l.url)&&"undefined"!==typeof l.layerObject)if(l.layerObject.infoTemplates){if(l=l.layerObject.infoTemplates[g]){h.infoTemplate=l.infoTemplate;break}}else if(l.layerObject.infoTemplate){h.infoTemplate=l.layerObject.infoTemplate;break}}d=[h];this.tab.tabLayers=d;
this.loading=!1;this._performQuery(a,b,c,e,d).then(function(a){f.resolve(a)})})))}this.mapServiceLayer||this._performQuery(a,b,c,e,d).then(function(a){f.resolve(a)});return f},_performQuery:function(a,b,c,f,d){var h=new n,g=[],m,l;0<b.length?l=e.getGeoms(b):0<a.length&&(l=e.getGeoms(a));this.summaryGeoms=l;if(0<l.length)for(a=0;a<l.length;a++)g=l[a],b=e.createDefArray(d,g,this.parent.opLayers,this.tab),m=0===a?g=b:g=m.concat(b);(new v(g)).then(k.hitch(this,function(a){for(var b=0,e=0;e<a.length;e++){var d=
a[e][1];isNaN(d)?d&&d.features?b+=d.features.length:d&&"undefined"!==typeof d.length&&(b+=d.length):b+=d}this.updateTabCount(b,c,f);this.queryOnLoad&&k.hitch(this,this._queryFeatures(this.summaryGeoms));h.resolve(b)}));return h},updateTabCount:function(a,b,c){this.featureCount=a;e.updateTabCount(this.featureCount,b,c,this.baseLabel,this.incidentCount)},updateForIncident:function(a,b,c,f,d,q,r){this.incidentCount=a.length;this.allFields="undefined"!==typeof q&&"undefined"!==typeof r?q?!0:r:!1;var h=
"undefined"!==typeof d,w;this.tabNum=f;h?w=new n:(this.container.innerHTML="",g.add(this.container,"loading"));this.summaryIds=[];this.summaryFeatures=[];if(0<this.tab.tabLayers.length){var B=this.summaryGeoms,t;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],t=new m(this.summaryLayer.url),t.infoTemplate=this.tab.tabLayers[0].infoTemplate,this.tab.tabLayers[1]=t,this.summaryFields=this._getFields(this.tab.tabLayers[0]),this.configuredPopUpFields=e.getPopupConfiguredFields(this.tab.tabLayers[0]),
h?this._queryFeatures(B,h).then(function(a){w.resolve(a)}):(this._initGraphicsLayer(c),k.hitch(this,this._queryFeatures(B)))):(t=new m(this.tab.tabLayers[0].url),l(t,"load",k.hitch(this,function(){this.summaryLayer=t;if(-1<this.tab.tabLayers[0].url.indexOf("MapServer"))for(var a=this.tab.tabLayers[0].url.split("MapServer/")[1],b=this.parent.map.itemInfo.itemData.operationalLayers,f=0;f<b.length;f++){var d=b[f];if(-1<this.tab.tabLayers[0].url.indexOf(d.url)&&"undefined"!==typeof d.layerObject&&d.layerObject.infoTemplates&&
(d=d.layerObject.infoTemplates[a])){t.infoTemplate=d.infoTemplate;break}}this.tab.tabLayers[1]=t;this.summaryLayer=this.tab.tabLayers[1];this.summaryFields=this._getFields(this.tab.tabLayers[1]);this.configuredPopUpFields=e.getPopupConfiguredFields(this.tab.tabLayers[1]);h?this._queryFeatures(B,h).then(function(a){w.resolve(a)}):(this._initGraphicsLayer(c),k.hitch(this,this._queryFeatures(B)))})));if(h)return w}},_initGraphicsLayer:function(a){null!==a&&(this.graphicsLayer=a,this.graphicsLayer.clear(),
this.summaryLayer&&this.summaryLayer.renderer&&(this.lyrRenderer=this.summaryLayer.renderer,this.graphicsLayer.renderer=this.lyrRenderer,"undefined"!==typeof this.summaryLayer.renderer.attributeField?this.symbolField=this.summaryLayer.renderer.attributeField:this.lyrSymbol=this.lyrRenderer.symbol))},_queryFeatures:function(a,c){var d;c&&(d=new n);for(var h=[],g=-1===[null,void 0,""].indexOf(this.tab.tabLayers[0].id)?this.tab.tabLayers[0].id:this.tab.layers,g=e.getFilter(g,this.parent.opLayers),m=
new f,l=0;l<a.length;l++)m.geometry=a[l],m.where=g,h.push(this.summaryLayer.queryIds(m));(new v(h)).then(k.hitch(this,function(a){for(var b,e,f=0;f<a.length;f++)a[f][0]&&(b=a[f][1],e=b=0===f?b:e.concat(b));b?(this.summaryIds=b,0<this.summaryIds.length?c?this._queryFeaturesByIds(c).then(function(a){d.resolve(a)}):this._queryFeaturesByIds():c||this._processResults()):c||this._processResults()}),k.hitch(this,function(a){console.error(a);new b({message:a})}));if(c)return d},_queryFeaturesByIds:function(a){var d,
h=[];a&&(d=new n);var m=this.summaryLayer.maxRecordCount||1E3,l=this.summaryIds.slice(0,m);this.summaryIds.splice(0,m);var q=new f;q.where=e.getFilter(this.summaryLayer.id,this.parent.opLayers);var r=!1;t.some(this.summaryFields,k.hitch(this,function(a){if("area"===a.type||"length"===a.type||this.graphicsLayer)return r=!0}));a&&(r=!0);q.returnGeometry=r;q.outSpatialReference=this.parent.map.spatialReference;q.outFields=["*"];q.objectIds=l;var u=new c(this.summaryLayer.url);for(h.push(u.execute(q));0<
this.summaryIds.length;)l=this.summaryIds.slice(0,m),this.summaryIds.splice(0,m),q.objectIds=l,h.push(u.execute(q));(new v(h)).then(k.hitch(this,function(b){this.summaryFeatures=[];for(var c=0;c<b.length;c++)if(b[c][0]){var e=b[c][1];e.features&&(this.summaryFeatures=this.summaryFeatures.concat(e.features))}a?this._processResults(a).then(k.hitch(this,function(a){this.SA_SAT_download&&g.replace(this.SA_SAT_download,"download","processing");d.resolve(a)})):(this._processResults(),this.SA_SAT_download&&
g.replace(this.SA_SAT_download,"download","processing"));this.SA_SAT_download&&g.replace(this.SA_SAT_download,"download","processing")}),k.hitch(this,function(a){console.error(a);new b({message:a})}));if(a)return d},_prepResults:function(){for(var a=0;a<this.summaryFields.length;a++){var b=this.summaryFields[a],c=b.field,f=b.total;switch(b.type){case "count":f=this.summaryFeatures.length;break;case "area":f=e.getArea(this.summaryFeatures,this.summaryGeoms,this.config.distanceSettings,this.config.distanceUnits,
this.tab.advStat);break;case "length":f=e.getLength(this.summaryFeatures,this.summaryGeoms,this.config.distanceSettings,this.config.distanceUnits,this.tab.advStat);break;case "sum":f=e.getSum(this.summaryFeatures,c);break;case "avg":f=e.getSum(this.summaryFeatures,c)/this.summaryFeatures.length;break;case "min":f=e.getMin(this.summaryFeatures,c);break;case "max":f=e.getMax(this.summaryFeatures,c)}b.total=f}},_processResults:function(b){this._prepResults();var c,f=this.summaryFields,h=0,m;if(b)c=new n;
else{this.container.innerHTML="";g.remove(this.container,"loading");if(0===this.summaryFeatures.length){this.container.innerHTML=this.parent.nls.noFeaturesFound;return}m=d.create("div",{style:"width:"+220*(f.length+1)+"px;"},this.container);g.add(m,"SAT_tabPanelContent");var r=d.create("div",{},m);g.add(r,"SATcolExport");g.add(r,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var t=d.create("div",{"data-dojo-attach-point":"SA_SAT_download",title:this.parent.nls.downloadCSV,tabindex:"0",
role:"button","aria-label":this.parent.nls.downloadCSV,"class":"summaryDownLoadCSVButton"},r);x.initFirstFocusNode(this.parentNode,t);x.initLastFocusNode(this.parentNode,t);g.add(t,[this.parent.isBlackTheme?"btnExportBlack":"btnExport","download"]);g.add(t,this.parent.lightTheme?"lightThemeBackground":"darkThemeBackground");t.focus();l(t,"click",k.hitch(this,this._exportToCSV,f));l(t,"keydown",k.hitch(this,function(a){if(!a.shiftKey||a.keyCode!==q.TAB)if(a.keyCode===q.TAB&&t.focus(),a.keyCode===q.ENTER||
a.keyCode===q.SPACE)this._exportToCSV(f,a),setTimeout(function(){t.focus()},500)}))}for(var r=[],u=0;u<f.length;u++){var C=f[u],v=x.stripHTML(C.alias?C.alias:"")+"\x3cbr/\x3e",C=e.formatNumber(C.total,C),h=C.total,C=C.num;if(b)r.push({num:C,info:v,total:h});else{h=d.create("div",{"class":"SATcol"},m);g.add(h,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var I=d.create("div",{style:"max-height: 60px;"},h);d.create("div",{"class":" SATcolWrap",style:"max-height: 30px; overflow: hidden;",
innerHTML:v},I);d.create("div",{"class":" colSummary",innerHTML:C},h)}}m=[];u=null!==this.graphicsLayer;!b&&u&&(this.graphicsLayer.clear(),this.tab.tabLayers[1].clear());if(this.summaryFeatures)for(v=0;v<this.summaryFeatures.length;v++)C=this.summaryFeatures[v],this.lyrSymbol?C.symbol=this.lyrSymbol:u&&this.graphicsLayer.renderer?(h=this.graphicsLayer.renderer.getSymbol(C),C.symbol=h):this.summaryLayer.renderer&&this.summaryLayer.renderer.getSymbol&&(C.symbol=this.summaryLayer.renderer.getSymbol(C)),
C=C.toJson?new a(C.toJson()):C,!b&&u?(this.graphicsLayer.add(C),this.tab.tabLayers[1].add(C)):m.push(C);!b&&u&&(this.graphicsLayer.setVisibility(!0),this.parent._toggleTabLayersNew(this.tabNum),this.tab.restore&&this.emit("summary-complete",{bubbles:!0,cancelable:!0,tab:this.tabNum}));if(b)return c.resolve({graphics:m,analysisResults:r,context:this}),c},_exportToCSV:function(a,b,c,f){var d;this.parent.config.hasOwnProperty("exportFieldsOptionForCSV")?d=this.parent.config.exportFieldsOptionForCSV:
this.parent.config.hasOwnProperty("csvAllFields")&&(d=this.parent.config.csvAllFields);a=e.exportToCSV(this.summaryFeatures,b,c,f,{type:"summary",baseLabel:this.baseLabel,csvAllFields:d,layer:this.summaryLayer,opLayers:this.parent.opLayers,nlsValue:this.parent.nls.summary,nlsCount:this.parent.nls.count,summaryFields:this.summaryFields,calcFields:this.calcFields,allFields:this.allFields,configuredPopUpFields:this.configuredPopUpFields});this.summaryLayer=a.summaryLayer;return a.details},_getFieldInfoByFieldInfo:function(a,
b,c){return this._getFieldInfo(a[b],b,c)},_getFieldInfoByName:function(a,b){var c=["count","area","length","tabCount"],e;for(e in a)if(-1===c.indexOf(e))return this._getFieldInfo(a[e],e,b)},_getFieldInfo:function(a,b,c){for(var e=0;e<a.length;e++){var f=a[e];if(f.expression&&f.expression===c)return{field:{field:f.expression,alias:f.label,type:b,modify:f.modify,round:f.round,roundPlaces:f.roundPlaces,truncate:f.truncate,truncatePlaces:f.truncatePlaces,total:0},index:e}}},_getFields:function(a){this.layerDefinition=
x.getFeatureLayerDefinition(a);this.layerObject=a;var b=e.getSkipFields(a),c=[];if("undefined"!==typeof this.tab.advStat){var f=k.clone(this.tab.advStat.stats);this.tab.advStat.fieldOrder&&t.forEach(this.tab.advStat.fieldOrder,k.hitch(this,function(a){if((a=a&&a.hasOwnProperty("fieldName")?this._getFieldInfoByFieldInfo(f,a.fieldType,a.fieldName):this._getFieldInfoByName(f,a))&&a.field){var b=f[a.field.type];b.splice(a.index,1);0===b.length&&delete f[a.field.type];c.push(a.field)}}));for(var d in f)0<
f[d].length&&t.forEach(f[d],function(a){c.push({field:a.expression,alias:a.label,type:d,modify:a.modify,round:a.round,roundPlaces:a.roundPlaces,truncate:a.truncate,truncatePlaces:a.truncatePlaces,total:0})})}else{var h;if(a.infoTemplate)h=a.infoTemplate.info.fieldInfos;else if(-1<this.tab.tabLayers[0].url.indexOf("MapServer")){var g=this.tab.tabLayers[0].url.split("MapServer/")[1],m=this.parent.map.itemInfo.itemData.operationalLayers;h=null;for(var l=0;l<m.length;l++){var q=m[l];if(q.layerObject.infoTemplates&&
(q=q.layerObject.infoTemplates[g])){h=q.infoTemplate.info.fieldInfos;break}}}else h=a.fields;h||(h=a.fields);for(g=0;g<h.length;g++)if(m=h[g],"undefined"!==typeof a.fields){var l=a.fields[g].type,n;m.name===a.objectIdField||"esriFieldTypeDouble"!==l&&"esriFieldTypeInteger"!==l&&"esriFieldTypeSmallInteger"!==l||("undefined"!==typeof m.visible?m.visible&&(n={field:m.fieldName,alias:m.label,type:"sum",total:0}):n={field:m.name,alias:m.alias,type:"sum",total:0},n&&-1===b.indexOf(n.field)&&c.push(n),n=
null)}}this.calcFields=k.clone(c);if(this.allFields)for(h=0;h<a.fields.length;h++){n=a.fields[h];g=!0;m=0;b:for(;m<c.length;m++)if(n.name===c[m].field){g=!1;break b}-1===b.indexOf(n.name)&&g&&c.push({field:n.name,alias:n.alias,type:n.type})}a=e.getSpecialFields(a);this.dateFields=a.dateFields;this.specialFields=a.specialFields;this.typeIdField=a.typeIdField;this.types=a.types;return c}})})},"widgets/SituationAwareness/js/analysisUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/dom-class dojo/dom-geometry dojo/dom-style esri/tasks/query esri/geometry/geometryEngine esri/geometry/Polyline ./CSVUtils jimu/utils".split(" "),
function(u,r,t,v,n,k,g,d,l,q){function x(b){return function(a,d){return a.attributes[b]<d.attributes[b]?-1:a.attributes[b]>d.attributes[b]?1:0}}return{getFields:function(b,a,d,f){var c=this.getSkipFields(b),e=[];if(!d&&a.advStat&&a.advStat.stats&&a.advStat.stats.outFields&&0<a.advStat.stats.outFields.length)u.forEach(a.advStat.stats.outFields,function(a){e.push(a.expression)});else{if(b.infoTemplate)a=b.infoTemplate.info.fieldInfos;else if(0<f.map.itemInfo.itemData.operationalLayers.length){f=f.map.itemInfo.itemData.operationalLayers;
a=null;var h=0;a:for(;h<f.length;h++){var g=f[h];if("ArcGISMapServiceLayer"===g.layerType&&"undefined"!==typeof g.layers)for(var m=0;m<g.layers.length;m++){var l=g.layers[m];if(l.id===b.layerId&&l.popupInfo){a=l.popupInfo.fieldInfos;break a}}}a||(a=b.fields)}else a=b.fields;if(a)for(f=0;f<a.length;f++)h=a[f],d||"undefined"===typeof h.visible?(h=h.name?h.name:h.fieldName,-1===c.indexOf(h)&&e.push(h)):h.visible&&-1===c.indexOf(h.fieldName)&&e.push(h.fieldName)}b=this.getSpecialFields(b);return{dateFields:b.dateFields,
specialFields:b.specialFields,typeIdField:b.typeIdField,types:b.types,fields:3<e.length&&!d?e.slice(0,3):e,allFields:e}},getField:function(b,a){for(var d=0;d<b.length;d++){var f=b[d];if(f.name===a||f.alias===a)return f}},getFieldValue:function(b,a,d,f,c,e,h,g,l,k){h=!1;var m=a;e="string"===typeof m?!0:!1;d[b]&&"esriFieldTypeDate"===d[b].type&&(h=!0,-1<Object.keys(f).indexOf(b)?(d=f[b],c="undefined"!==typeof d?{dateFormat:d}:{dateFormat:c}):c={dateFormat:c},m=q.fieldFormatter.getFormattedDate(new Date(a),
c));!h&&g&&l&&(m=(b=q.getDisplayValueForCodedValueOrSubtype(g,b,l))&&b.hasOwnProperty("displayValue")&&b.isCodedValueOrSubtype?b.displayValue:e?b.displayValue:this.formatNumber(m,k).num);return m},getSkipFields:function(b){var a=[];if(b.fields)for(var d=0;d<b.fields.length;d++){var f=b.fields[d];f&&f.type&&f.name&&"esriFieldTypeGeometry"===f.type&&a.push(f.name)}return a},getSpecialFields:function(b){var a={},d=[];b.fields&&u.forEach(b.fields,r.hitch(this,function(f){if("esriFieldTypeDate"===f.type||
f.domain||f.name===b.typeIdField){if("esriFieldTypeDate"===f.type&&b.infoTemplate)for(var c in b.infoTemplate._fieldsMap)"undefined"!==typeof b.infoTemplate._fieldsMap[c].fieldName&&b.infoTemplate._fieldsMap[c].fieldName===f.name&&b.infoTemplate._fieldsMap[c].format&&"undefined"!==typeof b.infoTemplate._fieldsMap[c].format.dateFormat&&(d[f.name]=b.infoTemplate._fieldsMap[c].format.dateFormat);a[f.name]=f}}));return{specialFields:a,dateFields:d,typeIdField:b.typeIdField,types:b.types}},getSummaryFields:function(){},
getPopupFields:function(b){var a=[];0<b.tabLayers.length&&u.forEach(b.tabLayers,r.hitch(this,function(b){var f=this.getSkipFields(b);"undefined"!==typeof b.popupInfo?u.forEach(b.popupInfo.fieldInfos,r.hitch(this,function(b){if(b.visible&&-1===f.indexOf(b.fieldName)){var c={value:0};c.expression=b.fieldName;c.label=b.label;a.push(c)}})):b.infoTemplate&&u.forEach(b.infoTemplate.info.fieldInfos,r.hitch(this,function(b){if(b.visible&&-1===f.indexOf(b.fieldName)){var c={value:0};c.expression=b.fieldName;
c.label=b.label;a.push(c)}}))}));return a},getDisplayFields:function(b){var a;"undefined"!==typeof b.advStat&&"undefined"!==typeof b.advStat.stats&&"undefined"!==typeof b.advStat.stats.outFields?a=b.advStat.stats.outFields:(a=[],0<b.tabLayers.length&&u.forEach(b.tabLayers,r.hitch(this,function(b){"undefined"!==typeof b.popupInfo?u.forEach(b.popupInfo.fieldInfos,r.hitch(this,function(b){if(b.visible){var c={value:0};c.expression=b.fieldName;c.label=b.label;a.push(c)}})):b.infoTemplate?u.forEach(b.infoTemplate.info.fieldInfos,
r.hitch(this,function(b){if(b.visible){var c={value:0};c.expression=b.fieldName;c.label=b.label;a.push(c)}})):u.forEach((b.layerObject?b.layerObject:b).fields,r.hitch(this,function(b){var c={value:0};c.expression=b.name;c.label=b.alias;a.push(c)}))})));return a},exportToCSV:function(b,a,d,f,c){if(0===b.length)return!1;var e=c.baseLabel,h=[],g=[];"proximity"===c.type&&b.sort(this.compareDistance);var m;"undefined"===typeof a.altKey?m=a:(m=!1,d=c.csvAllFields);u.forEach(b,r.hitch(this,function(a){"closest"===
c.type&&delete a.attributes.DISTANCE;"proximity"===c.type&&(a.attributes.DISTANCE=this.getDistanceLabel(a.attributes.DISTANCE,c.unit,c.approximateLabel));h.push(a.attributes)}));if("summary"===c.type||"grouped"===c.type)if(c.hasOwnProperty("csvAllFields")&&"allFields"===c.csvAllFields||c.hasOwnProperty("csvAllFields")&&(!0===c.csvAllFields||"true"===c.csvAllFields))for(var k in h[0])g.push(k);else if(c.hasOwnProperty("csvAllFields")&&"popUpFields"===c.csvAllFields)if(c.allFields)for(b=0;b<c.summaryFields.length;b++)g.push(c.summaryFields[b].field);
else if(0===c.configuredPopUpFields.length)h=[],h.push({});else for(b=0;b<c.configuredPopUpFields.length;b++)g.push(c.configuredPopUpFields[b]);else for(b=0;b<c.summaryFields.length;b++)g.push(c.summaryFields[b].field);else for(var q in h[0])g.push(q);b=c.layer;k=b.fields;if(b&&b.loaded&&k||m){q=a?[]:this.getSkipFields(b);var n={};if(c.opLayers&&c.opLayers._layerInfos){var t=c.opLayers.getLayerInfoById(b.id);t&&(n.popupInfo=t.getPopupInfo())}var t=[],D=0;for(;D<g.length;D++){var v=g[D];if(-1===q.indexOf(v)){var x=
!1,I,K=0;b:for(;K<k.length;K++)if(I=k[K],I.name===v){x=!0;break b}x?t.push(I):t.push({name:v,alias:v,show:!0,type:"esriFieldTypeString"})}}n.datas=h;n.fromClient=!1;n.withGeometry=!1;n.outFields=t;n.formatDate=!0;n.formatCodedValue=!0;n.formatNumber=!1;var H=[],y=[];if(!a&&d&&"undefined"!==typeof f)switch(c.type){case "proximity":H.push(c.nlsCount);y.push(f);break;case "closest":var Q=0;u.forEach(f,r.hitch(this,function(a){0===Q&&(u.forEach(a,function(a){H.push(a.label)}),Q+=1);var b=[];u.forEach(a,
function(a){b.push(a.value)});y.push(b)}));break;case "summary":u.forEach(f,r.hitch(this,function(a){var b=a.info.replace("\x3cbr/\x3e",""),e=!1,f=0;a:for(;f<c.calcFields.length;f++)if(b===c.calcFields[f].alias){e=!0;break a}e&&(H.push(b),y.push(a.total))}));break;case "grouped":u.forEach(f,function(a){H.push(a.info.replace("\x3cbr/\x3e",""));y.push(a.total)})}if(m)return{summaryLayer:b,details:t};l.exportCSVFromFeatureLayer(e,b,n);return{summaryLayer:b,details:{appendColumns:H,appendDatas:y,name:e,
type:c.nlsValue}}}l.exportCSV(e,h,g)},isURL:function(b){return/(https?:\/\/|ftp:)/g.test(b)},isEmail:function(b){return/\S+@\S+\.\S+/.test(b)},queryTabCount:function(){},performQuery:function(){},getFilter:function(b,a){var d="";a.traversal(function(a){if(b===a.id&&a.getFilter())return d=a.getFilter(),!0});return d},getGeoms:function(b){for(var a=[],d=[],f=0;f<b.length;f++){var c=b[f].geometry?b[f].geometry:b[f];if("polygon"===c.type&&-1===a.indexOf(f)){for(var e=0;e<b.length;e++)if(e!==f&&-1===a.indexOf(e)){var h=
b[e].geometry?b[e].geometry:b[e];"polygon"===h.type?g.intersects(c,h)&&(a.push(e),c=g.union(c,h)):a.push(e)}d.push(c)}}return d},createDefArray:function(b,a,d,f){for(var c=[],e=0;e<b.length;e++){var h=b[e];if(h){var g=new k;g.returnGeometry=!1;g.geometry=a;var m=-1===[null,void 0,""].indexOf(h.id)?h.id:f.layers;g.where=this.getFilter(m,d);"undefined"!==typeof h.queryCount?c.push(h.queryCount(g)):"undefined"!==typeof h.queryIds?c.push(h.queryIds(g)):"undefined"!==typeof h.queryFeatures&&c.push(h.queryFeatures(g))}}return c},
updateTabCount:function(b,a,d,f,c){var e="undefined"!==typeof c&&0<c?!0:!1;c=v.position(a).w;"undefined"!==typeof b&&0===b?(t.remove(a,"noFeatures"),t.remove(a,"noFeaturesActive"),t.add(a,e?"noFeaturesActive":"noFeatures")):(e&&t.contains(a,"noFeatures")&&t.remove(a,"noFeatures"),e&&t.contains(a,"noFeaturesActive")&&t.remove(a,"noFeaturesActive"));d&&(b="undefined"!==typeof b?f+" ("+q.localizeNumber(b).toString()+")":f,a.innerHTML=b);d=v.position(a).w;b=0;var h;d>c?(h=!0,b=d-c):c>d&&(h=!1,b=c-d);
c=v.position(a.parentNode).w;if(0<c){h=h?c+b:c-b;n.set(a.parentNode,"width",h+"px");a=a.parentNode.parentNode;c=a.parentNode;var g,m;if(c&&c.children&&0<c.children.length)for(b=0;b<c.children.length;b++)if(d=c.children[b],window.isRTL){if(-1<d.className.indexOf("SA_panelLeft")&&d){m=d;break}}else if(-1<d.className.indexOf("SA_panelRight")){g=d;break}m&&a&&(h>v.position(c).w?(n.set(a,"left","58px"),n.set(m,"display","block")):(n.set(a,"left","24px"),n.set(m,"display","none")));g&&a&&(h>v.position(c).w?
(n.set(a,"right","58px"),n.set(g,"display","block")):(n.set(a,"right","24px"),n.set(g,"display","none")))}},getDistanceLabel:function(b,a,d){return Math.round(100*b)/100+" "+a+" ("+d+")"},getSum:function(b,a){var d=0;u.forEach(b,function(b){d+=b.attributes[a]});return d},getMin:function(b,a){b.sort(x(a));return b[0].attributes[a]},getMax:function(b,a){b.sort(x(a));b.reverse();return b[0].attributes[a]},getArea:function(b,a,d,f,c){var e=0;d=r.clone(d);d.miles=109413;d.kilometers=109414;d.feet=109405;
d.meters=109404;d.yards=109442;d.nauticalMiles=109409;var h=d[f],m;c&&c.stats&&c.stats.area&&0<c.stats.area.length&&(m=c.stats.area[0]);u.forEach(b,function(b){for(var c=0;c<a.length;c++){var d=g.intersect(b.geometry,a[c]);if(null!==d){var f=d.spatialReference;e=4326===f.wkid||f.isWebMercator()||f.isGeographic&&f.isGeographic()?e+g.geodesicArea(d,h):e+g.planarArea(d,h)}}});return this.formatNumber(e,m).total},getLength:function(b,a,d,f,c){var e=0,h=d[f],m;c&&c.stats&&c.stats.length&&0<c.stats.length.length&&
(m=c.stats.length[0]);u.forEach(b,function(b){for(var c=0;c<a.length;c++){var d=g.intersect(b.geometry,a[c]);if(null!==d){var f=d.spatialReference;e=4326===f.wkid||f.isWebMercator()||f.isGeographic&&f.isGeographic()?e+g.geodesicLength(d,h):e+g.planarLength(d,h)}}});return this.formatNumber(e,m).total},getDistance:function(b,a,m){var f="point"!==b.type?b.getExtent().getCenter():b;a="point"!==a.type?a.getExtent().getCenter():a;f=new d([[f.x,f.y],[a.x,a.y]]);f.spatialReference=b.spatialReference;m="nauticalMiles"===
m?"nautical-miles":m;return 4326===b.spatialReference.wkid||b.spatialReference.isWebMercator()?g.geodesicLength(f,m):g.planarLength(f,m)},compareDistance:function(b,a){return b.attributes.DISTANCE<a.attributes.DISTANCE?-1:b.attributes.DISTANCE>a.attributes.DISTANCE?1:0},formatNumber:function(b,a){var d=b;if(!isNaN(b)&&null!==b&&""!==b){var d=a&&a.modify&&!isNaN(b),f;d&&"undefined"!==typeof a.truncatePlaces&&!isNaN(a.truncatePlaces)&&(f=new RegExp(0<a.truncatePlaces?"^\\d*[.]?\\d{0,"+a.truncatePlaces+
"}":"^\\d*"));d=d&&a.round?1*b.toFixed(a.roundPlaces):d&&a.truncate?1*f.exec(b)[0]:b;isNaN(d)&&(d=0)}return{total:d,num:isNaN(d)||null===d||""===d?d:q.localizeNumber(d)}},getPopupConfiguredFields:function(b){var a=[];"undefined"!==typeof b.popupInfo?u.forEach(b.popupInfo.fieldInfos,r.hitch(this,function(b){b.visible&&a.push(b.fieldName)})):b.infoTemplate&&u.forEach(b.infoTemplate.info.fieldInfos,r.hitch(this,function(b){b.visible&&a.push(b.fieldName)}));return a}}})},"widgets/SituationAwareness/js/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/has dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query".split(" "),
function(u,r,t,v,n,k,g,d,l,q){function x(b){var a=r.clone(b.attributes);(b=b.geometry)&&"point"===b.type&&("x"in a?a._x=b.x:a.x=b.x,"y"in a?a._y=b.y:a.y=b.y);return a}u.exportCSV=function(b,a,d,f,c){return u._createCSVStr(a,d,f,c).then(function(a){return u._download(b+".csv",a)})};u.exportCalculatedResultsCSV=function(b,a){var d="",f=0;t.forEach(a,function(c){d+=c.name+" ("+c.type+")\r\n";u._createCSVStr([],[],c.appendColumns,c.appendDatas).then(function(c){d+=c;f++;if(f===a.length)return u._download(b+
".csv",d);d+="\r\n\r\n"})})};u.exportCSVFromFeatureLayer=function(b,a,d){d=d||{};return u._getExportData(a,{datas:d.datas,fromClient:d.fromClient,withGeometry:d.withGeometry,outFields:d.outFields,filterExpression:d.filterExpression}).then(function(f){return u._formattedData(a,f,{formatNumber:d.formatNumber,formatDate:d.formatDate,formatCodedValue:d.formatCodedValue,popupInfo:d.popupInfo,appendColumns:d.appendColumns,appendDatas:d.appendDatas}).then(function(a){return u.exportCSV(b,a.datas,a.columns,
a.appendColumns,a.appendDatas)})})};u.exportCSVByAttributes=function(b,a,d,f){f=r.mixin({},f);f.datas=d;return u.exportCSVFromFeatureLayer(b,a,f)};u.exportCSVByGraphics=function(b,a,d,f){d=t.map(d,function(a){return a.attributes});return u.exportCSVByAttributes(b,a,d,f)};u._createCSVStr=function(b,a,d,f){var c=new k,e="",h=0,g=0,l="",m="";try{if(a&&0<a.length){t.forEach(a,function(a){e=e+l+a;l=","});for(var e=e+"\r\n",h=b.length,g=a.length,q=0;q<h;q++){for(var l="",n=0;n<g;n++)(m=b[q][a[n]])||"number"===
typeof m||(m=""),m&&/[",\r\n]/g.test(m)&&(m='"'+m.replace(/(")/g,'""')+'"'),e=e+l+m,l=",";e+="\r\n"}}"undefined"!==typeof d&&"undefined"!==typeof f&&0<d.length&&0<f.length&&(l="",t.forEach(d,function(a){e=e+l+a;l=","}),l="",e+="\r\n",t.forEach(f,function(a){Array.isArray(a)?(t.forEach(a,function(a){e=e+l+a;l=","}),l="",e+="\r\n"):(e=e+l+a,l=",")}));c.resolve(e)}catch(G){console.error(G),c.resolve("")}return c};u._isIE11=function(){return 11===g.has("ie")};u._isEdge=function(){return g.has("edge")};
u._getDownloadUrl=function(b){return window.Blob&&window.URL&&window.URL.createObjectURL?(b=new Blob(["\ufeff"+b],{type:"text/csv"}),URL.createObjectURL(b)):"data:attachment/csv;charset\x3dutf-8,\ufeff"+encodeURIComponent(b)};u._download=function(b,a){var d=new k;try{if(n("ie")&&10>n("ie")){var f=window.top.open("about:blank","_blank");f.document.write("sep\x3d,\r\n"+a);f.document.close();f.document.execCommand("SaveAs",!0,b);f.close()}else if(10===n("ie")||u._isIE11()||u._isEdge()){var c=new Blob(["\ufeff"+
a],{type:"text/csv"});navigator.msSaveBlob(c,b)}else{var e=v.create("a",{href:u._getDownloadUrl(a),target:"_blank",download:b},document.body);if(n("safari")){var h=document.createEvent("MouseEvents");h.initEvent("click",!0,!0);e.dispatchEvent(h)}else e.click();v.destroy(e)}d.resolve()}catch(B){d.reject(B)}return d};u._getExportData=function(b,a){var d=new k,f=null,c=a.datas,e=a.withGeometry,f=a.outFields;f&&f.length||(f=b.fields);f=r.clone(f);if(e&&!(c&&0<c.length)){var h="",h=-1!==f.indexOf("x")?
"_x":"x";f.push({name:h,alias:h,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});h=-1!==f.indexOf("y")?"_y":"y";f.push({name:h,alias:h,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"})}c&&0<c.length?d.resolve({data:c||[],outFields:f}):a.fromClient?(c=t.map(b.graphics,function(a){return e?x(a):r.clone(a)}),d.resolve({data:c||[],outFields:f})):u._getExportDataFromServer(b,f,a).then(function(a){d.resolve({data:a||[],outFields:f})});return d};u._getExportDataFromServer=
function(b,a,d){var f=new k;if("esri.layers.FeatureLayer"!==b.declaredClass)return f.resolve([]),f;var c=new l(b.url),e=new q;e.where=d.filterExpression||b.getDefinitionExpression&&b.getDefinitionExpression()||"1\x3d1";0<a.length?(b=t.map(a,function(a){return a.name}),e.outFields=b):e.outFields=["*"];e.returnGeometry=d.withGeometry;c.execute(e,function(a){a=t.map(a.features,function(a){return x(a)});f.resolve(a)},function(a){console.error(a);f.resolve([])});return f};u._formattedData=function(b,a,
d){var f=new k,c=[],e=a.data;a=a.outFields;for(var h=g.getFeatureLayerDefinition(b),l=0,m=e.length;l<m;l++){for(var q={},n=0;n<a.length;n++){var r=a[n];q[r.alias||r.name]=u._getExportValue(e[l][r.name],r,b.objectIdField,b.typeIdField,e[l][b.typeIdField],b.types,d,h,e[l],b)}c.push(q)}b=t.map(a,function(a){return a.alias||a.name});f.resolve({datas:c,columns:b,appendColumns:d.appendColumns,appendDatas:d.appendDatas});return f};u._getExportValue=function(b,a,l,f,c,e,h,k,q,n){function m(a){if(r&&d.isDefined(r.fieldInfos))for(var b=
0,c=r.fieldInfos.length;b<c;b++){var e=r.fieldInfos[b];if(e.fieldName===a)return e.format}return null}var r=h.popupInfo,u=!!a.domain&&h.formatCodedValue;h="esriFieldTypeDate"===a.type&&h.formatDate;var w=l&&a.name===l;f=f&&a.name===f;n=n&&n.renderer?n:k;return h?g.fieldFormatter.getFormattedDate(b,m(a.name)):(f||u)&&k&&q&&(k=g.getDisplayValueForCodedValueOrSubtype(n,a.name,q))&&k.hasOwnProperty("displayValue")?k.displayValue:u||h||w||f?b:(u=null,l&&e&&0<e.length&&(l=(l=t.filter(e,function(a){return a.id===
c}))&&l[0])&&l.domains&&l.domains[a.name]&&l.domains[a.name].codedValues&&(a=g.getDisplayValueForCodedValueOrSubtype(n,a.name,q))&&a.hasOwnProperty("displayValue")&&(u=a.displayValue),null!==u?u:b)}})},"widgets/SituationAwareness/js/GroupedCountInfo":function(){define("dojo/_base/declare dojo/Evented dojo/_base/array dojo/DeferredList dojo/Deferred dojo/_base/lang dojo/dom-class dojo/dom-construct dojo/on dojo/keys jimu/utils jimu/dijit/Message esri/graphic esri/layers/FeatureLayer esri/tasks/query ./analysisUtils".split(" "),
function(u,r,t,v,n,k,g,d,l,q,x,b,a,m,f,c){return u("GroupedCountInfo",[r],{summaryLayer:null,summaryFields:[],summaryIds:[],summaryFeatures:[],tabNum:null,popupFields:[],groupedResults:{},specialFields:null,dateFields:{},symbolField:null,graphicsLayer:null,lyrRenderer:null,lyrSymbol:null,featureCount:0,incidentCount:0,displayCount:!1,allFields:!1,configuredPopUpFields:[],constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.config=c.config;this.graphicsLayer=null;this.specialFields=
{};this.typeIdField="";this.types=[];this.dateFields={};this.baseLabel=""!==a.label?a.label:a.layerTitle?a.layerTitle:a.layers;this.parentNode=c.domNode},queryTabCount:function(a,b,c,d){var e=new n;this.displayCount=d;this.incidentCount=a.length;var f=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(f=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer")){this.mapServiceLayer=!0;var h;"undefined"!==
typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded?(this.summaryFields=this._getFields(this.summaryLayer),this._performQuery(a,b,c,d,f).then(function(a){e.resolve(a)})):(h=new m(this.summaryLayer.url),h.infoTemplate=this.tab.tabLayers[0].infoTemplate,f=[h],this.tab.tabLayers=f,l(h,"load",k.hitch(this,function(){this.summaryLayer=h;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(a,
b,c,d,f).then(function(a){e.resolve(a)})})))):this.loading||(h=new m(this.tab.tabLayers[0].url),this.loading=!0,l(h,"load",k.hitch(this,function(){this.summaryLayer=h;this.summaryFields=this._getFields(this.summaryLayer);for(var g=this.tab.tabLayers[0].url.split("MapServer/")[1],l=this.parent.map.itemInfo.itemData.operationalLayers,k=0;k<l.length;k++){var m=l[k];if(-1<this.tab.tabLayers[0].url.indexOf(m.url)&&"undefined"!==typeof m.layerObject)if(m.layerObject.infoTemplates){if(m=m.layerObject.infoTemplates[g]){h.infoTemplate=
m.infoTemplate;break}}else if(m.layerObject.infoTemplate){h.infoTemplate=m.layerObject.infoTemplate;break}}f=[h];this.tab.tabLayers=f;this.loading=!1;this._performQuery(a,b,c,d,f).then(function(a){e.resolve(a)})})))}this.mapServiceLayer||this._performQuery(a,b,c,d,f).then(function(a){e.resolve(a)});return e},_performQuery:function(a,b,d,f,g){var e=new n,h=[],l,m;0<b.length?m=c.getGeoms(b):0<a.length&&(m=c.getGeoms(a));this.summaryGeoms=m;if(0<m.length)for(a=0;a<m.length;a++)h=m[a],b=c.createDefArray(g,
h,this.parent.opLayers,this.tab),l=0===a?h=b:h=l.concat(b);(new v(h)).then(k.hitch(this,function(a){for(var b=0,c=0;c<a.length;c++){var h=a[c][1];isNaN(h)?h&&h.features?b+=h.features.length:h&&"undefined"!==typeof h.length&&(b+=h.length):b+=h}this.updateTabCount(b,d,f);this.queryOnLoad&&k.hitch(this,this._queryFeatures(this.summaryGeoms));e.resolve(b)}));return e},updateTabCount:function(a,b,d){this.displayCount=d;this.featureCount=a;c.updateTabCount(this.featureCount,b,d,this.baseLabel,this.incidentCount)},
updateForIncident:function(a,b,d,f,q,r,t){this.incidentCount=a.length;this.allFields="undefined"!==typeof r&&"undefined"!==typeof t?r?!0:t:!1;var e="undefined"!==typeof q,h;this.tabNum=f;e?h=new n:(this.container.innerHTML="",g.add(this.container,"loading"));this.summaryIds=[];this.summaryFeatures=[];this.groupedResults={};if(0<this.tab.tabLayers.length){var u=[];if(0<b.length)u=b;else for(b=0;b<a.length;b++)f=a[b].geometry?a[b].geometry:a[b],"polygon"===f.type&&u.push(f);var w;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?
(this.summaryLayer=this.tab.tabLayers[0],w=new m(this.summaryLayer.url),w.infoTemplate=this.tab.tabLayers[0].infoTemplate,this.tab.tabLayers[1]=w,this.summaryFields=this._getFields(this.tab.tabLayers[0]),this.configuredPopUpFields=c.getPopupConfiguredFields(this.tab.tabLayers[0]),e?this._queryFeatures(u,e).then(function(a){h.resolve(a)}):(this._initGraphicsLayer(d),k.hitch(this,this._queryFeatures(u)))):(w=new m(this.tab.tabLayers[0].url),l(w,"load",k.hitch(this,function(){this.summaryLayer=w;if(-1<
this.tab.tabLayers[0].url.indexOf("MapServer"))for(var a=this.tab.tabLayers[0].url.split("MapServer/")[1],b=this.parent.map.itemInfo.itemData.operationalLayers,f=0;f<b.length;f++){var g=b[f];if(-1<this.tab.tabLayers[0].url.indexOf(g.url)&&"undefined"!==typeof g.layerObject&&g.layerObject.infoTemplates&&(g=g.layerObject.infoTemplates[a])){w.infoTemplate=g.infoTemplate;break}}this.tab.tabLayers[1]=w;this.summaryLayer=this.tab.tabLayers[1];this.summaryFields=this._getFields(this.tab.tabLayers[1]);this.configuredPopUpFields=
c.getPopupConfiguredFields(this.tab.tabLayers[1]);e?this._queryFeatures(u,e).then(function(a){h.resolve(a)}):(this._initGraphicsLayer(d),k.hitch(this,this._queryFeatures(u)))})));if(e)return h}},_initGraphicsLayer:function(a){null!==a&&(this.graphicsLayer=a,this.graphicsLayer.clear(),this.summaryLayer&&this.summaryLayer.renderer&&(this.lyrRenderer=this.summaryLayer.renderer,this.graphicsLayer.renderer=this.lyrRenderer,"undefined"!==typeof this.summaryLayer.renderer.attributeField?this.symbolField=
this.summaryLayer.renderer.attributeField:this.lyrSymbol=this.lyrRenderer.symbol))},_queryFeatures:function(a,d){var e;d&&(e=new n);for(var h=[],g=-1===[null,void 0,""].indexOf(this.tab.tabLayers[0].id)?this.tab.tabLayers[0].id:this.tab.layers,g=c.getFilter(g,this.parent.opLayers),l=new f,m=0;m<a.length;m++)l.geometry=a[m],l.where=g,h.push(this.summaryLayer.queryIds(l));(new v(h)).then(k.hitch(this,function(a){for(var b,c,f=0;f<a.length;f++)a[f][0]&&(b=a[f][1],c=b=0===f?b:c.concat(b));b?(this.summaryIds=
b,0<this.summaryIds.length?d?this._queryFeaturesByIds(d).then(function(a){e.resolve(a)}):this._queryFeaturesByIds():d||this._processResults()):d||this._processResults()}),k.hitch(this,function(a){console.error(a);new b({message:a})}));if(d)return e},_queryFeaturesByIds:function(a){var e,d=[];a&&(e=new n);var l=this.summaryLayer.maxRecordCount||1E3,m=this.summaryIds.slice(0,l);this.summaryIds.splice(0,l);var q=new f,r=-1===[null,void 0,""].indexOf(this.summaryLayer.id)?this.summaryLayer.id:this.tab.layers;
q.where=c.getFilter(r,this.parent.opLayers);var u=!1;t.some(this.summaryFields,k.hitch(this,function(a){if("area"===a.type||"length"===a.type||this.graphicsLayer)return u=!0}));a&&(u=!0);this.summaryLayer.supportsAdvancedQueries&&(q.orderByFields=[this.summaryFields[0].field]);q.returnGeometry=u;q.outSpatialReference=this.parent.map.spatialReference;q.outFields=["*"];q.objectIds=m;for(d.push(this.summaryLayer.queryFeatures(q));0<this.summaryIds.length;)m=this.summaryIds.slice(0,l),this.summaryIds.splice(0,
l),q.objectIds=m,d.push(this.summaryLayer.queryFeatures(q));(new v(d)).then(k.hitch(this,function(b){this.summaryFeatures=[];for(var c=0;c<b.length;c++)if(b[c][0]){var d=b[c][1];d.features&&(this.summaryFeatures=this.summaryFeatures.concat(d.features))}a?this._processResults(a).then(k.hitch(this,function(a){this.SA_SAT_download&&g.replace(this.SA_SAT_download,"download","processing");e.resolve(a)})):(this._processResults(),this.SA_SAT_download&&g.replace(this.SA_SAT_download,"download","processing"));
this.SA_SAT_download&&g.replace(this.SA_SAT_download,"download","processing")}),k.hitch(this,function(a){console.error(a);new b({message:a})}));if(a)return e},_prepGroupedResults:function(){for(var a=0;a<this.summaryFeatures.length;a++){var b=this.summaryFeatures[a];if("undefined"!==typeof this.summaryFields&&0<this.summaryFields.length){var d=c.getFieldValue(this.summaryFields[0].field,b.attributes[this.summaryFields[0].field],this.specialFields,this.dateFields,"longMonthDayYear",this.typeIdField,
this.types,this.layerObject&&this.layerObject.renderer?this.layerObject:this.layerDefinition,b.attributes),d="undefined"!==typeof d&&null!==d?x.stripHTML(d.toString()):"";d in this.groupedResults?this.groupedResults[d].features.push(b):this.groupedResults[d]={features:[b]}}}},_prepResults:function(){for(var a in this.groupedResults){var b=this.summaryFields[0];b.total=this.groupedResults[a].features.length;this.groupedResults[a].total=b.total;this.groupedResults[a].type=b.type;this.groupedResults[a].label=
b.alias}},_processResults:function(b){this._prepGroupedResults();this._prepResults();var c=this.groupedResults,e=0,f,m;if(b)m=new n;else{this.container.innerHTML="";g.remove(this.container,"loading");if(0===Object.keys(this.groupedResults).length){this.container.innerHTML=this.parent.nls.noFeaturesFound;return}var r=Object.keys(this.groupedResults).length+1;f=d.create("div",{style:"width:"+220*r+"px;"},this.container);g.add(f,"SAT_tabPanelContent");r=d.create("div",{},f);g.add(r,"SATcolExport");g.add(r,
this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var t=d.create("div",{"data-dojo-attach-point":"SA_SAT_download",title:this.parent.nls.downloadCSV,tabindex:"0",role:"button","aria-label":this.parent.nls.downloadCSVdownloadCSV,"class":"grpSummaryDownLoadCSVButton"},r);g.add(t,[this.parent.isBlackTheme?"btnExportBlack":"btnExport","download"]);g.add(t,this.parent.lightTheme?"lightThemeBackground":"darkThemeBackground");t.focus();x.initFirstFocusNode(this.parentNode,t);x.initLastFocusNode(this.parentNode,
t);l(t,"click",k.hitch(this,this._exportToCSV,c));l(t,"keydown",k.hitch(this,function(a){if(!a.shiftKey||a.keyCode!==q.TAB)if(a.keyCode===q.ENTER||a.keyCode===q.SPACE)this._exportToCSV(c,a),setTimeout(function(){t.focus()},500)}))}var u=Object.keys(c).sort(),r=[];this.displayCount&&r.push({total:this.featureCount,a:void 0,info:this.parent.nls.count,c:void 0});for(var v in u){var e=u[v],C=c[e],S=x.stripHTML(e.toString()),e=C.total;isNaN(e)&&(e=0);var e=x.localizeNumber(e),I="pre"===C.type?C.label.trim():
S,S="pre"===C.type?S:C.label.trim(),C=""!==C.label?"colGroupedSummary":"colSummary";if(b)r.push({total:e,a:I,info:""===S?I:S,c:C});else{var K=d.create("div",{"class":"SATcol"},f);g.add(K,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var H=d.create("div",{style:"max-height: 45px;"},K);d.create("div",{"class":"SATcolWrap",style:"max-height: 30px; overflow: hidden;",innerHTML:I},H);d.create("div",{"class":"SATcolWrap",style:"max-height: 30px; overflow: hidden;",innerHTML:S},H);d.create("div",
{"class":C,innerHTML:e},K)}}v=[];f=null!==this.graphicsLayer;!b&&f&&(this.graphicsLayer.clear(),this.tab.tabLayers[1]&&this.tab.tabLayers[1].clear());if(this.summaryFeatures)for(u=0;u<this.summaryFeatures.length;u++)e=this.summaryFeatures[u],this.lyrSymbol?e.symbol=this.lyrSymbol:this.graphicsLayer?this.graphicsLayer.renderer&&(I=this.graphicsLayer.renderer.getSymbol(e),e.symbol=I):this.summaryLayer.renderer&&this.summaryLayer.renderer.getSymbol&&(e.symbol=this.summaryLayer.renderer.getSymbol(e)),
e=e.toJson?new a(e.toJson()):e,!b&&f?(this.graphicsLayer.add(e),this.tab.tabLayers[1].add(e)):v.push(e);!b&&f&&(this.graphicsLayer.setVisibility(!0),this.parent._toggleTabLayersNew(this.tabNum),this.tab.retsore&&this.emit("summary-complete",{bubbles:!0,cancelable:!0,tab:this.tabNum}));if(b)return m.resolve({graphics:v,analysisResults:r,context:this}),m},_exportToCSV:function(a,b,d,f){var e;this.parent.config.hasOwnProperty("exportFieldsOptionForCSV")?e=this.parent.config.exportFieldsOptionForCSV:
this.parent.config.hasOwnProperty("csvAllFields")&&(e=this.parent.config.csvAllFields);a=c.exportToCSV(this.summaryFeatures,b,d,f,{type:"grouped",baseLabel:this.baseLabel,csvAllFields:e,layer:this.summaryLayer,opLayers:this.parent.opLayers,nlsValue:this.parent.nls.groupedSummary,nlsCount:this.parent.nls.count,summaryFields:this.summaryFields,allFields:this.allFields,configuredPopUpFields:this.configuredPopUpFields});this.summaryLayer=a.summaryLayer;return a.details},_getFields:function(a){this.layerDefinition=
x.getFeatureLayerDefinition(a);this.layerObject=a;var b=c.getSkipFields(a),e,d=[];if("undefined"!==typeof this.tab.advStat){var f=this.tab.advStat.stats,g;for(g in f)0<f[g].length&&t.forEach(f[g],function(a){var b={field:a.expression,alias:a.label+"",type:g,total:0};e=a.expression;d.push(b)})}f=c.getSpecialFields(a);this.dateFields=f.dateFields;this.specialFields=f.specialFields;this.typeIdField=f.typeIdField;this.types=f.types;if(this.allFields)for(f=0;f<a.fields.length;f++){var l=a.fields[f];-1===
b.indexOf(l.name)&&e!==l.name&&d.push({field:l.name,alias:l.alias,type:l.type})}return d}})})},"widgets/SituationAwareness/js/ClosestInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/_base/array dojo/DeferredList dojo/Deferred dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/on dojo/keys jimu/utils esri/geometry/geometryEngine esri/graphic esri/Color esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query ./analysisUtils".split(" "),
function(u,r,t,v,n,k,g,d,l,q,x,b,a,m,f,c,e,h,B,E,w,z,F){return u("ClosestInfo",null,{featureCount:0,mapServiceLayer:!1,loading:!1,queryOnLoad:!1,incidentCount:0,constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.graphicsLayer=this.incident=null;this.map=c.map;this.specialFields={};this.typeIdField="";this.types=[];this.dateFields={};this.config=c.config;this.parentNode=c.domNode;this.baseLabel=""!==a.label?a.label:a.layerTitle?a.layerTitle:a.layers},queryTabCount:function(a,
b,c,d){var f=new k;this.incidentCount=a.length;var h=this.parent.config.distanceSettings[this.parent.config.distanceUnits],g=this.parent.config.maxDistance;b=[];for(var l=0;l<a.length;l++){var q=a[l].geometry;"4326"===q.spatialReference.wkid||q.spatialReference.isWebMercator()?b.push(m.geodesicBuffer(q,g,h)):b.push(m.buffer(q,g,h))}var n=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(n=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&
-1<this.tab.tabLayers[0].url.indexOf("MapServer")){this.mapServiceLayer=!0;var t;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded?(this.summaryFields=this._getFields(this.summaryLayer),this._performQuery(a,b,c,d,n).then(function(a){f.resolve(a)})):(t=new e(this.summaryLayer.url),t.infoTemplate=this.tab.tabLayers[0].infoTemplate,n=[t],this.tab.tabLayers=n,x(t,"load",r.hitch(this,function(){this.summaryLayer=
t;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(a,b,c,d,n).then(function(a){f.resolve(a)})})))):this.loading||(t=new e(this.tab.tabLayers[0].url),this.loading=!0,x(t,"load",r.hitch(this,function(){this.summaryLayer=t;this.summaryFields=this._getFields(this.summaryLayer);for(var e=this.tab.tabLayers[0].url.split("MapServer/")[1],h=this.parent.map.itemInfo.itemData.operationalLayers,g=0;g<h.length;g++){var l=h[g];if(-1<this.tab.tabLayers[0].url.indexOf(l.url)&&"undefined"!==
typeof l.layerObject&&l.layerObject.infoTemplates&&(l=l.layerObject.infoTemplates[e])){t.infoTemplate=l.infoTemplate;break}}n=[t];this.tab.tabLayers=n;this.loading=!1;this._performQuery(a,b,c,d,n).then(function(a){f.resolve(a)})})))}this.mapServiceLayer||this._performQuery(a,b,c,d,n).then(function(a){f.resolve(a)});return f},_performQuery:function(a,b,c,e,d){var f=new k,h=[],g,l;this.summaryGeoms=b;if(0<b.length)for(a=0;a<b.length;a++)h=b[a],l=F.createDefArray(d,h,this.parent.opLayers,this.tab),g=
0===a?h=l:h=g.concat(l);(new n(h)).then(r.hitch(this,function(a){for(var b=0,d=0;d<a.length;d++){var h=a[d][1];isNaN(h)?h&&h.features?0<h.features.length&&(b+=1):h&&"undefined"!==typeof h.length&&0<h.length&&(b+=1):0<h&&(b+=1)}this.updateTabCount(b,c,e);f.resolve(b)}));return f},updateTabCount:function(a,b,c){this.featureCount=0===parseInt(a,10)?0:a;F.updateTabCount(this.featureCount,b,c,this.baseLabel,this.incidentCount)},updateForIncident:function(a,b,c,d,f,h){this.incidentCount=a.length;this.allFields=
"undefined"!==typeof f&&"undefined"!==typeof h?f?!0:h:!1;var g="undefined"!==typeof d,l;v.forEach(this.tab.tabLayers,r.hitch(this,function(f){g&&(l=new k);if(f.url){var h=new e(f.url,{mode:e.MODE_ONDEMAND,infoTemplate:f.infoTemplate});x(h,"load",r.hitch(this,function(){this.tab.tabLayers=[h];g?this.processIncident(a,b,c,d).then(r.hitch(this,function(a){l.resolve(a)}),r.hitch(this,function(a){console.error(a);l.reject(a)})):this.processIncident(a,b,c,d)}))}else g?this.processIncident(a,b,c,d).then(r.hitch(this,
function(a){l.resolve(a)}),r.hitch(this,function(a){console.error(a);l.reject(a)})):this.processIncident(a,b,c,d)}));if(g)return l},processIncident:function(a,b,c,e){this.incidents=a;var d,h="undefined"!==typeof e;h?d=new k:(this.container.innerHTML="",g.add(this.container,"loading"));var l=[];e=this.parent.config.distanceSettings[this.parent.config.distanceUnits];for(var q=[],t=0;t<a.length;t++){var u=a[t].geometry,w;w="4326"===u.spatialReference.wkid||u.spatialReference.isWebMercator()?m.geodesicBuffer(u,
b,e):m.buffer(u,b,e);q.push({geometry:u,buffer:w})}(this.graphicsLayer=c)&&this.graphicsLayer.clear();a=[];b=this.tab.tabLayers[0];c=-1===[null,void 0,""].indexOf(b.id)?b.id:this.tab.layers;c=F.getFilter(c,this.parent.opLayers);var B=this._getFields(b),x=F.getPopupConfiguredFields(b);for(e=0;e<q.length;e++)t=new z,t.returnGeometry=!0,t.outSpatialReference=this.parent.map.spatialReference,t.geometry=q[e].buffer,t.where=c,t.outFields=["*"],"undefined"!==typeof b.queryFeatures&&a.push(b.queryFeatures(t));
(new n(a)).then(r.hitch(this,function(a){for(var b=0;b<a.length;b++)if(a[b][0]){var c=a[b][1].features,e=[],g=q[b].geometry;if(c&&0<c.length){for(var m=0;m<c.length;m++){var k=new f(c[m].toJson()),n=F.getDistance(g,k.geometry,this.parent.config.distanceUnits),t={DISTANCE:n};v.forEach(B,r.hitch(this,function(a){t[a]=k.attributes[a]}));this.config.hasOwnProperty("exportFieldsOptionForCSV")&&"allFields"===this.config.exportFieldsOptionForCSV||this.config.hasOwnProperty("csvAllFields")&&(!0===this.config.csvAllFields||
"true"===this.config.csvAllFields)?k.attributes.DISTANCE=n:(this.config.hasOwnProperty("exportFieldsOptionForCSV")&&"popUpFields"===this.config.exportFieldsOptionForCSV&&!this.allFields&&(t={DISTANCE:n},v.forEach(x,r.hitch(this,function(a){t[a]=k.attributes[a]}))),k.attributes=t);e.push(k)}e.sort(F.compareDistance);l.push(e[0])}}else a[b][1]&&a[b][1].message&&console.log(a[b][1].message);l.sort(F.compareDistance);h?this._processResults(l,!0).then(r.hitch(this,function(a){d.resolve(a)})):this._processResults(l)}),
r.hitch(this,function(a){console.error(a);d.reject(a)}));if(h)return d},_processResults:function(e,m){var n,u,v=e&&0<e.length;if(v&&"point"!==e[0].geometry.type)for(var D=e.length-1;0<=D;D--)"undefined"===typeof e[D].geometry.getExtent()&&e.splice(D,1);if(m)n=new k;else if(this.container.innerHTML="",g.remove(this.container,"loading"),v){u=d.create("div",{"class":"SAT_tabPanelContent"},this.container);D=d.create("div",{},u);g.add(D,"SATcolExport");g.add(D,this.parent.lightTheme?"lightThemeBorder":
"darkThemeBorder");var z=d.create("div",{title:this.parent.nls.downloadCSV,tabindex:"0",role:"button","aria-label":this.parent.nls.downloadCSV,"class":"closestDownLoadCSVButton"},D);a.initFirstFocusNode(this.parentNode,z);g.add(z,"btnExport");g.add(z,this.parent.lightTheme?"lightThemeBackground":"darkThemeBackground");x(z,"click",r.hitch(this,this._exportToCSV,e));x(z,"keydown",r.hitch(this,function(a){if(!a.shiftKey||a.keyCode!==b.TAB)if(a.keyCode===b.ENTER||a.keyCode===b.SPACE)this._exportToCSV(e,
a),setTimeout(function(){z.focus()},500)}));z.focus()}var D=this.parent.nls[this.parent.config.distanceUnits],y=[],G=220;if(v)for(var U=0;U<e.length;U++){var J=U+1,A=e[U],R=A.geometry,O=R;"point"!==R.type&&(O=R.getExtent().getCenter());var R=A.attributes,Z;"point"===this.incidents[0].geometry.type&&(Z=Math.round(100*R.DISTANCE)/100+" "+D+" ("+this.parent.nls.approximate+")");var Y="",M=0,N=[];if("undefined"!==typeof this.displayFields)for(var V=0;V<this.displayFields.length;V++){var W=this.displayFields[V],
aa;a:for(aa in R)if("DISTANCE"!==aa&&3>M&&W.expression===aa){var L=F.getFieldValue(aa,R[aa],this.specialFields,this.dateFields,"longMonthDayYear",this.typeIdField,this.types,this.layerObject&&this.layerObject.renderer?this.layerObject:this.layerDefinition,R,W),L="undefined"!==typeof L&&null!==L?a.stripHTML(L.toString()):"",T="undefined"!==typeof W.label&&""!==W.label?W.label:void 0,X=A._layer&&A._layer.fields?A._layer.fields:this.tab.tabLayers&&this.tab.tabLayers[0]?this.tab.tabLayers[0].fields:void 0;
X&&"undefined"===typeof T&&(X=F.getField(X,aa))&&(T=X.alias);if("undefined"===typeof T||T in[""," ",null,void 0])T=aa;F.isURL(L)?L='\x3ca href\x3d"'+L+'" target\x3d"_blank" style\x3d"color: inherit;"\x3e'+T+"\x3c/a\x3e":F.isEmail(L)&&(L='\x3ca href\x3d"mailto:'+L+'" style\x3d"color: inherit;"\x3e'+T+"\x3c/a\x3e");Y+=W.validLabel?("undefined"!==typeof W.label&&""!==W.label?T+" ":"")+L+"\x3cbr/\x3e":L+"\x3cbr/\x3e";M+=1;N.push({value:-1<L.indexOf(",")?L.replace(",",""):L,label:T});break a}}y.push(N);
m||(A=d.create("div",{},u),g.add(A,"SATcolRec"),g.add(A,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder"),M=d.create("div",{},A),g.add(M,"SATcolRecBar"),N=d.create("div",{innerHTML:J,tabindex:"0",role:"button","aria-label":this.parent.nls.zoomToFeature+" "+J},M),g.add(N,"SATcolRecNum"),q.set(N,"backgroundColor",this.parent.config.activeColor),x(N,"click",r.hitch(this,this._zoomToLocation,O,null)),x(N,"keydown",r.hitch(this,this._zoomToLocation,O,!0)),a.initLastFocusNode(this.parentNode,
N),Z&&(N=d.create("div",{innerHTML:Z},M),g.add(N,"SATcolDistance")),this.parent.config.enableRouting&&(M=d.create("div",{"class":"directionsButton",title:this.parent.nls.get_directions,tabindex:"0","aria-label":this.parent.nls.get_directions,role:"button"},M),g.add(M,"SATcolDir"),x(M,"click",r.hitch(this,this._routeToIncident,O,null)),x(M,"keydown",r.hitch(this,this._routeToIncident,O,!0)),a.initLastFocusNode(this.parentNode,M)),Y=d.create("div",{"class":"SATcolWrap",innerHTML:Y},A),g.add(Y,"SATcolInfo"),
G+=l.position(A).w,Y=new B(B.STYLE_SOLID,new t.fromRgb(this.parent.config.activeMapGraphicColor),1),Y=new h(h.STYLE_CIRCLE,24,Y,new t.fromRgb(this.parent.config.activeMapGraphicColor)),A=new E,A.family="Arial",A.size="12px",J=new w(J,A,new c(this.parent.config.fontColor)),J.setOffset(0,-4),this.graphicsLayer.add(new f(O,Y,R)),this.graphicsLayer.add(new f(O,J,R)))}if(!m&&v)q.set(u,"width",G);else if(v)return n.resolve({graphics:e,analysisResults:y,context:this}),n},_exportToCSV:function(a,b,c,e){var d;
this.parent.config.hasOwnProperty("exportFieldsOptionForCSV")?d=this.parent.config.exportFieldsOptionForCSV:this.parent.config.hasOwnProperty("csvAllFields")&&(d=this.parent.config.csvAllFields);a=F.exportToCSV(a,b,c,e,{type:"closest",baseLabel:this.baseLabel,csvAllFields:d,layer:this.tab.tabLayers[0],opLayers:this.parent.opLayers,nlsValue:this.parent.nls.closest,nlsCount:this.parent.nls.count});this.summaryLayer=a.summaryLayer;return a.details},_getFields:function(b){this.layerDefinition=a.getFeatureLayerDefinition(b);
this.layerObject=b;b=F.getFields(b,this.tab,this.allFields,this.parent);this.dateFields=b.dateFields;this.specialFields=b.specialFields;this.typeIdField=b.typeIdField;this.types=b.types;this.displayFields=F.getDisplayFields(this.tab);return b.fields},_zoomToLocation:function(a,c,e){e.shiftKey&&e.keyCode===b.TAB?(e.stopPropagation(),e.cancelBubble=!0):c&&e.keyCode!==b.ENTER&&e.keyCode!==b.SPACE||this.parent.zoomToLocation(a)},_routeToIncident:function(a,c,e){c&&e.keyCode!==b.ENTER&&e.keyCode!==b.SPACE||
this.parent.routeToIncident(a)}})})},"widgets/SituationAwareness/js/ProximityInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/_base/array dojo/DeferredList dojo/Deferred dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/on dojo/query dojo/keys esri/graphic esri/Color esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query esri/geometry/geometryEngine jimu/utils ./analysisUtils".split(" "),
function(u,r,t,v,n,k,g,d,l,q,x,b,a,m,f,c,e,h,B,E,w,z,F,G){return u("ProximityInfo",null,{featureCount:0,mapServiceLayer:!1,loading:!1,queryOnLoad:!1,incidentCount:0,constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.graphicsLayer=this.incident=null;this.specialFields={};this.typeIdField="";this.types=[];this.dateFields={};this.config=c.config;this.parentNode=c.domNode;this.baseLabel=""!==a.label?a.label:a.layerTitle?a.layerTitle:a.layers},queryTabCount:function(a,b,e,d){var f=
new k;this.incidentCount=a.length;var h=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(h=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer")){this.mapServiceLayer=!0;var g;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded?(this.summaryFields=this._getFields(this.summaryLayer),
this._performQuery(a,b,e,d,h).then(function(a){f.resolve(a)})):(g=new c(this.summaryLayer.url),g.infoTemplate=this.tab.tabLayers[0].infoTemplate,h=[g],this.tab.tabLayers=h,x(g,"load",r.hitch(this,function(){this.summaryLayer=g;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(a,b,e,d,h).then(function(a){f.resolve(a)})})))):this.loading||(g=new c(this.tab.tabLayers[0].url),this.loading=!0,x(g,"load",r.hitch(this,function(){this.summaryLayer=g;this.summaryFields=this._getFields(this.summaryLayer);
for(var c=this.tab.tabLayers[0].url.split("MapServer/")[1],h=this.parent.map.itemInfo.itemData.operationalLayers,l=0;l<h.length;l++){var m=h[l];if(-1<this.tab.tabLayers[0].url.indexOf(m.url)&&"undefined"!==typeof m.layerObject&&m.layerObject.infoTemplates&&(m=m.layerObject.infoTemplates[c])){g.infoTemplate=m.infoTemplate;break}}this.tab.tabLayers=[g];this.loading=!1;this._performQuery(a,b,e,d,this.tab.tabLayers).then(function(a){f.resolve(a)})})))}this.mapServiceLayer||this._performQuery(a,b,e,d,
h).then(function(a){f.resolve(a)});return f},_performQuery:function(a,b,c,e,d){var f=new k,h=[],g,l;0<b.length?l=G.getGeoms(b):0<a.length&&(l=G.getGeoms(a));this.summaryGeoms=l;if(0<l.length)for(a=0;a<l.length;a++)h=l[a],b=G.createDefArray(d,h,this.parent.opLayers,this.tab),g=0===a?h=b:h=g.concat(b);(new n(h)).then(r.hitch(this,function(a){for(var b=0,d=0;d<a.length;d++){var h=a[d][1];isNaN(h)?h&&h.features?b+=h.features.length:h&&"undefined"!==typeof h.length&&(b+=h.length):b+=h}this.updateTabCount(b,
c,e);f.resolve(b)}));return f},updateTabCount:function(a,b,c){this.featureCount=a;G.updateTabCount(this.featureCount,b,c,this.baseLabel,this.incidentCount)},updateForIncident:function(a,b,e,d,f,h){this.incidentCount=a.length;this.allFields="undefined"!==typeof f&&"undefined"!==typeof h?f?!0:h:!1;var g="undefined"!==typeof d,l;v.forEach(this.tab.tabLayers,r.hitch(this,function(h){g&&(l=new k);if(h.url){var m=new c(h.url,{mode:c.MODE_ONDEMAND,infoTemplate:h.infoTemplate});x(m,"load",r.hitch(this,function(){this.tab.tabLayers=
[m];g?this.processIncident(a,b,e,d,f).then(r.hitch(this,function(a){l.resolve(a)}),r.hitch(this,function(a){console.error(a);l.reject(a)})):this.processIncident(a,b,e,d,f)}))}else g?this.processIncident(a,b,e,d,f).then(r.hitch(this,function(a){l.resolve(a)}),r.hitch(this,function(a){console.error(a);l.reject(a)})):this.processIncident(a,b,e,d,f)}));if(g)return l},processIncident:function(a,b,c,e,d){this.incidents=a;var f=[],h;if(0===b.length)for(var l=0;l<a.length;l++)h=a[l],h=h.geometry?h.geometry:
h,"polygon"===h.type?(b.push(h),f.push({geometry:h,buffer:h})):f.push({geometry:void 0,buffer:void 0});else for(l=0;l<a.length;l++){h=a[l];var m=b[l].geometry?b[l].geometry:b[l];h=h.geometry?h.geometry:h;f.push({geometry:h,buffer:m})}if(0!==b.length){for(a=0;a<f.length;a++)if(b=f[a].buffer,"undefined"!==typeof b)for(h=0;h<f.length;h++)if(h!==a&&(l=f[h].buffer,"undefined"!==typeof l&&z.overlaps(b,l))){f[a].buffer=z.difference(b,l);f[h].buffer=z.difference(l,b);l=z.union(l,b);l=z.difference(l,f[a].buffer);
l=z.difference(l,f[h].buffer);if(Array.isArray(f[a].geometry)){if(Array.isArray(f[h].geometry))for(m=0;m<f[h].geometry.length;m++)f[a].geometry.push(f[h].geometry[m]);else f[a].geometry.push(f[h].geometry);m=f[a].geometry}else if(m=[],m.push(f[a].geometry),Array.isArray(f[h].geometry))for(var q=0;q<f[h].geometry.length;q++)m.push(f[h].geometry[q]);else m.push(f[h].geometry);f.push({geometry:m,buffer:l})}var t,u="undefined"!==typeof e;u?t=new k:(this.container.innerHTML="",g.add(this.container,"loading"));
var B=[];this.graphicsLayer=c;c=this.tab.tabLayers[0];var x=this._getFields(c),F=G.getPopupConfiguredFields(c);e=-1===[null,void 0,""].indexOf(c.id)?c.id:this.tab.layers;e=G.getFilter(e,this.parent.opLayers);a=[];for(b=0;b<f.length;b++)h=new w,h.returnGeometry=!0,h.outSpatialReference=this.parent.map.spatialReference,h.geometry=f[b].buffer,h.where=e,h.outFields=["*"],"undefined"!==typeof c.queryFeatures&&a.push(c.queryFeatures(h));(new n(a)).then(r.hitch(this,function(a){for(var b=0;b<a.length;b++){var c=
a[b][1];if(c&&c.features)for(var c=c.features,e=f[b].geometry,h=0;h<c.length;h++){var g=c[h],l=g.geometry,m;if(Array.isArray(e)){for(var k,q=0;q<e.length;q++){var n=G.getDistance(e[q],l,this.parent.config.distanceUnits);if("undefined"===typeof k||n<k)k=n}l=k;m={DISTANCE:k}}else l=G.getDistance(e,l,this.parent.config.distanceUnits),m={DISTANCE:l};v.forEach(x,r.hitch(this,function(a){m[a]=g.attributes[a]}));this.config.hasOwnProperty("exportFieldsOptionForCSV")&&"allFields"===this.config.exportFieldsOptionForCSV||
this.config.hasOwnProperty("csvAllFields")&&(!0===this.config.csvAllFields||"true"===this.config.csvAllFields)?g.attributes.DISTANCE=l:(this.config.hasOwnProperty("exportFieldsOptionForCSV")&&"popUpFields"===this.config.exportFieldsOptionForCSV&&!d&&(m={DISTANCE:l},v.forEach(F,r.hitch(this,function(a){m[a]=g.attributes[a]}))),g.attributes=m);B.push(g)}}B.sort(G.compareDistance);if(u){var w={graphics:B,analysisResults:B.length,context:this};this._processResults(B,!0).then(r.hitch(this,function(a){t.resolve(r.mixin(w,
a))}))}else this._processResults(B)}),r.hitch(this,function(a){console.error(a);t.reject(a)}));if(u)return t}},_processResults:function(b,c){var n,u,w=b&&0<b.length;if(w&&"point"!==b[0].geometry.type)for(var z=b.length-1;0<=z;z--)"undefined"===typeof b[z].geometry.getExtent()&&b.splice(z,1);if(c)n=new k;else if(this.container.innerHTML="",g.remove(this.container,"loading"),this.graphicsLayer.clear(),w){u=d.create("div",{"class":"SAT_tabPanelContent"},this.container);z=d.create("div",{},u);g.add(z,
"SATcolExport");g.add(z,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var y=d.create("div",{title:this.parent.nls.downloadCSV,tabindex:"0",role:"button","aria-label":this.parent.nls.downloadCSV,"class":"proximityDownLoadCSVButton"},z);g.add(y,"btnExport");g.add(y,this.parent.lightTheme?"lightThemeBackground":"darkThemeBackground");y.focus();F.initFirstFocusNode(this.parentNode,y);x(y,"click",r.hitch(this,this._exportToCSV,b));x(y,"keydown",r.hitch(this,function(c){if(!c.shiftKey||c.keyCode!==
a.TAB)if(c.keyCode===a.ENTER||c.keyCode===a.SPACE)this._exportToCSV(b,c),setTimeout(function(){y.focus()},500)}))}var z=this.parent.nls[this.parent.config.distanceUnits],D;"undefined"!==typeof this.tab.advStat&&"undefined"!==typeof this.tab.advStat.stats&&"undefined"!==typeof this.tab.advStat.stats.outFields?D=this.tab.advStat.stats.outFields:(D=[],0<this.tab.tabLayers.length&&v.forEach(this.tab.tabLayers,r.hitch(this,function(a){"undefined"!==typeof a.popupInfo?v.forEach(a.popupInfo.fieldInfos,r.hitch(this,
function(a){if(a.visible){var b={value:0};b.expression=a.fieldName;b.label=a.label;D.push(b)}})):a.infoTemplate?v.forEach(a.infoTemplate.info.fieldInfos,r.hitch(this,function(a){if(a.visible){var b={value:0};b.expression=a.fieldName;b.label=a.label;D.push(b)}})):v.forEach((a.layerObject?a.layerObject:a).fields,r.hitch(this,function(a){var b={value:0};b.expression=a.name;b.label=a.alias;D.push(b)}))})));var C=220,J=[];if(w)for(var A=0;A<b.length;A++){var R=A+1,O=b[A],Z=O.geometry,Y=Z;"point"!==Z.type&&
(Y=Z.getExtent().getCenter());var Z=O.attributes,M=G.getDistanceLabel(Z.DISTANCE,z,this.parent.nls.approximate),N="",V=0,W=[];if("undefined"!==typeof D){for(var aa=0;aa<D.length;aa++){var L=D[aa],T;for(T in Z)if("DISTANCE"!==T&&3>V&&L.expression===T){var X=G.getFieldValue(T,Z[T],this.specialFields,this.dateFields,"longMonthDayYear",this.typeIdField,this.types,this.layerObject&&this.layerObject.renderer?this.layerObject:this.layerDefinition,Z,L),X="undefined"!==typeof X&&null!==X?F.stripHTML(X.toString()):
"",ba="undefined"!==typeof L.label&&""!==L.label?L.label:void 0,ca=O._layer&&O._layer.fields?O._layer.fields:this.tab.tabLayers&&this.tab.tabLayers[0]?this.tab.tabLayers[0].fields:void 0;ca&&"undefined"===typeof ba&&(ca=G.getField(ca,T))&&(ba=ca.alias);if("undefined"===typeof ba||ba in[""," ",null,void 0])ba=T;G.isURL(X)?X='\x3ca href\x3d"'+X+'" target\x3d"_blank" style\x3d"color: inherit;"\x3e'+ba+"\x3c/a\x3e":G.isEmail(X)&&(X='\x3ca href\x3d"mailto:'+X+'" style\x3d"color: inherit;"\x3e'+ba+"\x3c/a\x3e");
N+=L.validLabel?("undefined"!==typeof L.label&&""!==L.label?ba+" ":"")+X+"\x3cbr/\x3e":X+"\x3cbr/\x3e";V+=1;W.push({label:ba,value:X})}}W.push({label:this.parent.nls.distance,value:M});0<W.length&&J.push(W)}c||(O=d.create("div",{},u),g.add(O,"SATcolRec"),g.add(O,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder"),V=d.create("div",{},O),g.add(V,"SATcolRecBar"),W=d.create("div",{innerHTML:R,tabindex:"0",role:"button","aria-label":this.parent.nls.zoomToFeature+" "+R,isLastElement:b.length-1===
A},V),g.add(W,"SATcolRecNum"),b.length-1===A&&F.initLastFocusNode(this.parentNode,W),q.set(W,"backgroundColor",this.parent.config.activeColor),x(W,"click",r.hitch(this,this._zoomToLocation,Y,null)),x(W,"keydown",r.hitch(this,this._zoomToLocation,Y,!0)),"point"===this.incidents[0].geometry.type&&(M=d.create("div",{innerHTML:M},V),g.add(M,"SATcolDistance")),this.parent.config.enableRouting&&(M=d.create("div",{"class":"directionsButton",title:this.parent.nls.get_directions,tabindex:"0","aria-label":this.parent.nls.get_directions,
role:"button"},V),g.add(M,"SATcolDir"),x(M,"click",r.hitch(this,this._routeToIncident,Y,null)),x(M,"keydown",r.hitch(this,this._routeToIncident,Y,!0)),F.initLastFocusNode(this.parentNode,M)),N=d.create("div",{"class":"SATcolWrap",innerHTML:N},O),g.add(N,"SATcolInfo"),C+=l.position(O).w,N=new h(h.STYLE_SOLID,new t.fromString(this.parent.config.activeMapGraphicColor),1),N=new e(e.STYLE_CIRCLE,24,N,new t.fromString(this.parent.config.activeMapGraphicColor)),M=new B,M.family="Arial",M.size="12px",R=new E(R,
M,new f(this.parent.lightTheme?"#111111":this.parent.config.fontColor)),R.setOffset(0,-4),this.graphicsLayer.add(new m(Y,N,Z)),this.graphicsLayer.add(new m(Y,R,Z)))}if(!c&&w)q.set(u,"width",C+"px");else return n.resolve({reportResults:J}),n},_exportToCSV:function(a,b,c,e){var d;this.parent.config.hasOwnProperty("exportFieldsOptionForCSV")?d=this.parent.config.exportFieldsOptionForCSV:this.parent.config.hasOwnProperty("csvAllFields")&&(d=this.parent.config.csvAllFields);a=G.exportToCSV(a,b,c,e,{type:"proximity",
baseLabel:this.baseLabel,csvAllFields:d,layer:this.tab.tabLayers[0],opLayers:this.parent.opLayers,nlsValue:this.parent.nls.proximity,nlsCount:this.parent.nls.count,unit:this.parent.nls[this.parent.config.distanceUnits],approximateLabel:this.parent.nls.approximate});this.summaryLayer=a.summaryLayer;return a.details},_getFields:function(a){this.layerDefinition=F.getFeatureLayerDefinition(a);this.layerObject=a;a=G.getFields(a,this.tab,this.allFields,this.parent);this.dateFields=a.dateFields;this.specialFields=
a.specialFields;this.typeIdField=a.typeIdField;this.types=a.types;this.displayFields=G.getDisplayFields(this.tab);return a.fields},_zoomToLocation:function(b,c,e){e.shiftKey&&e.keyCode===a.TAB||c&&e.keyCode!==a.ENTER&&e.keyCode!==a.SPACE||this.parent.zoomToLocation(b)},_routeToIncident:function(b,c,e){c&&e.keyCode!==a.ENTER&&e.keyCode!==a.SPACE||this.parent.routeToIncident(b)}})})},"widgets/SituationAwareness/js/SnapShotUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/DeferredList dojo/_base/array jimu/utils jimu/dijit/SnapShot ./CSVUtils".split(" "),
function(u,r,t,v,n,k,g,d){return u("SnapShotUtils",null,{portal:null,portalUrl:"",logo:"",originMapId:"",originAppId:"",credential:null,nls:null,layerArray:[],parent:null,downloadAll:!1,time:null,constructor:function(d){this.parent=d;this.snapshot=new g(d.appConfig,d.map);this.map=this.parent.map;this.extent=this.map.extent;this.nls=r.mixin({},d.nls,window.jimuNls.drawBox,window.jimuNls.snapshot)},createSnapShot:function(d){var g=new t,l=k.stripHTML(d.name),b=this._getTime(d.time);this.createLayerItems(d,
b,l).then(r.hitch(this,function(a){this.snapshot.createSnapShot({folderOptions:{folderName:l+"_"+b,title:l+"_"+b,description:l+" "+this.nls.snapshot},mapTitle:l+" ("+this.nls.snapshot_append+" "+b+")",name:l+" ("+b+")",shareWith:{everyone:!1,org:!1,groups:d.groups.join()},mapExtent:this.map.extent,data:a}).then(function(){g.resolve()})}));return g},_getTime:function(d){d=new Date(d);var g=d.getTimezoneOffset();return k.fieldFormatter.getFormattedDate(d,{dateFormat:"shortDateShortTime"})+" "+this.nls.utc+
(0>g?"+"+Math.abs(g)/60:"-"+g/60)},createLayerItems:function(d,g,k){var b=new t,a=d.layers.reverse();this.buffers=d.buffers;this.incidents=d.incidents;d=[];for(var l=0;l<a.length;l++){var f=!0;a[l].analysisObject&&"undefined"!==typeof a[l].analysisObject.featureCount&&0===a[l].analysisObject.featureCount&&(f=!1);a[l].graphics&&0===a[l].graphics.length&&(f=!1);f&&d.push(this.createItem(a[l],this.incidents,this.buffers,g,this.nls,k))}var c=[];(new v(d)).then(r.hitch(this,function(a){for(var e=0;e<a.length;e++){var d=
a[e][1];if(Array.isArray(d))for(var f=0;f<d.length;f++)c.push(d[f]);else c.push(d)}b.resolve(c)}),r.hitch(this,function(a){b.reject(a)}));return b},createItem:function(d,g,k,b,a,m){var f=new t,c={label:d.label,title:d.label+"_"+b,desc:a.snapshot_append+" "+a.of_append+" "+(d.type?d.type:d.label)+" "+a.layer_append+" "+d.label+" ("+b+")",name:d.label+"("+b+")",tags:[m+","+a.snapshot_append],originalLayerName:d.label};if(d.layerObject){var e=d.layerObject;m=d.analysisObject;var h;e.infoTemplate&&e.infoTemplate.info&&
(h=e.infoTemplate.info);c.popupInfo=h;"groupedSummary"===d.type||"summary"===d.type?m.updateForIncident(g,k,null,null,!0,!0,!0).then(r.hitch(this,function(d){d=this.createAnalysisLayerJSON(d,e,a,b,c);f.resolve(d)})):m.updateForIncident(g,"closest"===d.type?this.parent.config.maxDistance:k,null,!0,!0,!0).then(r.hitch(this,function(d){d=this.createAnalysisLayerJSON(d,e,a,b,c);f.resolve(d)}))}else d=this.createIncidentBufferLayerJSON(d.graphics,a,b,c),f.resolve(d);return f},createAnalysisLayerJSON:function(d,
g,k,b,a){k=d.graphics;b=d.context._exportToCSV(k,!0);d=[];for(var l=0;l<b.length;l++){var f=b[l];"esriFieldTypeOID"!==f.type&&d.push(f)}for(b=0;b<k.length;b++)l=k[b],l.geometry.cache&&(l.geometry.clearCache(),delete l.geometry.cahce);return{graphics:k,renderer:g.renderer,infoTemplate:a.popupInfo,fields:d,tags:a.tags,description:a.desc,name:a.name,visibleOnStartup:!1,typeIdField:g.typeIdField,types:g.types,minScale:g.minScale,maxScale:g.maxScale,originalLayerName:a.originalLayerName}},createIncidentBufferLayerJSON:function(d,
g,k,b){var a=[],l=[],f=[];g=[];n.forEach(d,function(b){switch(b.geometry.type){case "point":a.push(b);break;case "polyline":l.push(b);break;case "polygon":f.push(b)}});d=[];0<a.length&&d.push(a);0<l.length&&d.push(l);0<f.length&&d.push(f);k={point:this.nls.point,polyline:this.nls.line,polygon:this.nls.polygon};for(var c=0;c<d.length;c++){var e=d[c],h;0<e.length&&(h=e[0],h=k["undefined"!==typeof h.geometry?h.geometry.type:h.type],g.push({graphics:e,fields:[],tags:b.tags,description:b.desc,name:1===
d.length?b.name:h+" "+b.name,visibleOnStartup:!1,originalLayerName:b.originalLayerName}))}return g},createDownloadZip:function(g,k,n){var b=new t,a=this.nls.calculated_results;this._performAnalysis(g,k,n,this.downloadAll,!1).then(function(g){for(var f=[],c=0;c<g.length;c++){var e=g[c];(e=e.context._exportToCSV(e.graphics,!1,!0,e.analysisResults))&&f.push(e)}0<f.length&&d.exportCalculatedResultsCSV(a,f);b.resolve("success")},function(a){b.reject(a)});return b},_performAnalysis:function(d,g,k,b,a){for(var l=
new t,f=[],c=0;c<d.length;c++){var e=d[c];console.log("AO: "+e);var h=!0;e.analysisObject&&"undefined"!==typeof e.analysisObject.featureCount&&0===e.analysisObject.featureCount&&(h=!1);h&&("groupedSummary"===e.type||"summary"===e.type?f.push(e.analysisObject.updateForIncident(g,k,null,null,!0,a,b)):f.push(e.analysisObject.updateForIncident(g,"closest"===e.type?this.parent.config.maxDistance:k,null,!0,a,b)))}var n=[];(new v(f)).then(r.hitch(this,function(a){for(var b=0;b<a.length;b++)n.push(a[b][1]);
l.resolve(n)}),r.hitch(this,function(a){console.error(a);l.reject(a)}));return l}})})},"jimu/dijit/SnapShot":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/DeferredList jimu/utils esri/request esri/geometry/webMercatorUtils jimu/portalUtils jimu/tokenUtils jimu/dijit/Message esri/layers/FeatureLayer esri/graphic".split(" "),function(u,r,t,v,n,k,g,d,l,q,x,b,a){return u("Snapshot",null,{_portal:null,_portalUrl:"",_layerArray:[],_originMapId:"",_originAppId:"",
_credential:null,name:"",appendTimeStamp:null,baseMap:null,tags:"",description:"",shareWith:null,logo:"",time:null,constructor:function(a,b){this.map=b;this.appConfig=a;this._originAppId=a.appId;this._originMapId=b.itemId;this._mapItemInfo=b.itemInfo;this._portalUrl=a.portalUrl;this._portal=l.getPortal(this._portalUrl);this._baseUrl=this._portalUrl+"sharing/rest/";this.nls=r.mixin({},window.jimuNls.drawBox,window.jimuNls.snapshot)},createSnapShot:function(a){this.ids=[];this.layerArray=[];this.time=
this._getDateString(Date.now());this.name=(a.appendTimeStamp&&a.name?a.name+"_"+this.time:a.name)||this._mapItemInfo.item.title+"_"+this.time;this.extent=a.mapExtent||this.map.extent;this.logo=a.logo||this.appConfig.logo;this.mapName=a.mapTitle||this.name;this.shareWith=a.shareWith||{everyone:!1,org:!1,groups:""};var b=a.folderOptions;b.name=a.folderOptions.name||this.name;b.title=a.folderOptions.title||this.name;b.description=a.folderOptions.description||this.name;a=a.data.reverse();return this._createSnapshot(b,
a)},_createSnapshot:function(a,b){var c=new v;this._portal.getUser().then(r.hitch(this,this._processUser),function(a){c.reject(a)}).then(r.hitch(this,this._createFolder,a),function(a){c.reject(a)}).then(r.hitch(this,this._createItems,b),function(a){c.reject(a)}).then(r.hitch(this,this._addLayers),function(a){c.reject(a)}).then(r.hitch(this,this._createMap,this._mapItemInfo),function(a){c.reject(a)}).then(r.hitch(this,this._processMap),function(a){c.reject(a)}).then(r.hitch(this,this._shareItems),
function(a){c.reject(a)}).then(r.hitch(this,this._showMessage),function(a){c.reject(a)}).then(function(){c.resolve()});return c},_processUser:function(a){var b=new v;this.user=a;this.groups=a.groups;b.resolve();return b},_createFolder:function(a){var b=new v;a={url:this._baseUrl+"content/users/"+this.user.username+"/createFolder",content:r.mixin({f:"json"},a),handleAs:"json",callbackParamName:"callback"};this._isValidCredential()&&(a.content.token=this._credential.token);g(a,{usePost:!0}).then(r.hitch(this,
function(a){a.success?((this.folder=a.folder)&&this.folder.id&&this.ids.push(this.folder.id),b.resolve(a.folder)):(console.log(a),b.reject(a))}),r.hitch(this,function(a){b.reject(a)}));return b},_createItems:function(a){var b=new v,c=[];t.forEach(a,r.hitch(this,function(a){a.graphics&&0<a.graphics.length&&c.push(this._createLayerItem(a))}));var d=[];(new n(c)).then(r.hitch(this,function(a){for(var c=0;c<a.length;c++)!0===a[c][0]&&null!==a[c][1]&&d.push(a[c][1]);b.resolve(d)}),r.hitch(this,function(a){b.reject(a)}));
return b},_addLayers:function(a){for(var b=new v,c=[],d=0;d<a.length;d++)c.push(this.user.addItem(a[d],this.folder.id));var h=[];(new n(c)).then(r.hitch(this,function(a){for(var c=0;c<a.length;c++){var d=a[c][1];d.success&&(h.push(d.id),this.ids.push(d.id))}b.resolve(h)}),r.hitch(this,function(a){b.reject(a)}));return b},_createMap:function(a){for(var b=a.itemData,c=this.name,e=[],h=0;h<b.baseMap.baseMapLayers.length;h++){var g=b.baseMap.baseMapLayers[h];e.push({id:g.id,layerType:g.layerType,url:g.url,
visibility:g.visibility,opacity:g.opacity,title:g.title,styleUrl:g.styleUrl,itemId:g.itemId})}b={baseMapLayers:e};e=[];for(h=0;h<this.layerArray.length;h++)g=this.layerArray[h],e.push({id:g.layer.id,layerType:"ArcGISFeatureLayer",visibility:g.layer.visible,opacity:g.layer.opacity,title:g.layer.label,type:"feature",url:g.layer.url,popupInfo:g.layer.popupInfo});h=d.webMercatorToGeographic(this.extent);a={title:c,type:"Web Map",item:c,extent:h.xmin+","+h.ymin+","+h.xmax+","+h.ymax,text:JSON.stringify({operationalLayers:e,
baseMap:b,spatialReference:this.map.spatialReference,version:a&&a.itemData&&a.itemData.version?a.itemData.version:"2.4"}),tags:this.name+","+this.nls.snapshot_append,wabType:"HTML"};return this.user.addItem(a,this.folder.id)},_processMap:function(a){var b=new v;a.id&&this.ids.push(a.id);a.success?b.resolve(a.id):b.reject("fail");return b},_shareItems:function(a){var b=new v,c={url:this._baseUrl+"content/users/"+this.user.username+"/shareItems",content:{f:"json",everyone:this.shareWith.everyone,org:this.shareWith.org,
items:this.ids.join(),groups:this.shareWith.groups,confirmItemControl:this._validateGroupItemControl(this.shareWith.groups)},handleAs:"json",callbackParamName:"callback"};this._isValidCredential()&&(c.content.token=this._credential.token);g(c,{usePost:!0}).then(r.hitch(this,function(c){c.results&&0<c.results.length?b.resolve(this._portalUrl+"home/webmap/viewer.html?webmap\x3d"+a):b.reject("fail")}),r.hitch(this,function(a){b.reject(a)}));return b},_validateGroupItemControl:function(a){var b=a.split(",");
return 0<this.groups.filter(function(a){var c=a.capabilities||[];return-1<b.indexOf(a.id)&&-1<c.indexOf("updateitemcontrol")}).length},_showMessage:function(a){var b=new v;"fail"===a?(new x({message:this.nls.snapshot_failed}),b.reject(a)):(new x({message:'\x3ca href\x3d"'+a+'" target\x3d"_blank"\x3e'+this.nls.snapshot_complete+"\x3c/a\x3e"}),b.resolve("success"));return b},_getDateString:function(a){a=new Date(a);var b=a.getTimezoneOffset();return k.fieldFormatter.getFormattedDate(a,{dateFormat:"shortDateShortTime"})+
" "+this.nls.utc+(0>b?"+"+Math.abs(b)/60:"-"+b/60)},_checkCredential:function(){var a=q.isValidCredential(this._credential);a||this._clearCredential();return a},_isValidCredential:function(){this._updateCredential();return this._checkCredential()},_updateCredential:function(){this._checkCredential()||(this._credential=q.getPortalCredential(this._portalUrl))},_clearCredential:function(){this._credential=null},_createLayerItem:function(a){var d=new v,c={description:a.name,name:a.name,tags:[a.name],
type:"Feature Service",title:a.name};this._createFeatureService(a.originalLayerName).then(r.hitch(this,function(e){if(e.success){var f=e.serviceurl.replace(/rest/g,"rest/admin")+"/addToDefinition",g=this._createLayer(r.mixin(a,c));this._addDefinitionToService(f,g).then(r.hitch(this,function(f){f.success&&(f=new b(e.serviceurl+"/0?token\x3d"+this._credential.token,{id:c.name,outFields:["*"]}),c.url=e.serviceurl+"/0",this.layerArray.push({layer:{id:c.name,label:c.name,opacity:1,visible:!0,url:c.url,
popupInfo:a.infoTemplate&&a.infoTemplate.info?a.infoTemplate.info:a.infoTemplate?a.infoTemplate:void 0}}),this._applyEditsOnLayer(f,a.graphics,d,c))}),r.hitch(this,function(a){console.log(a.message);d.reject(null)}))}else d.reject(null)}),r.hitch(this,function(a){console.log(a.message);d.reject(null)}));return d},_applyEditsOnLayer:function(b,d,c,e){var f=[];t.forEach(d,function(b){b.attributes?f.push(new a(b.geometry,null,b.attributes)):f.push(new a(b.geometry,null,{}))},this);b.applyEdits(f,null,
null).then(r.hitch(this,function(){c.resolve(e)})).otherwise(r.hitch(this,function(a){console.log(a.message);c.reject(null)}))},_createFeatureService:function(a){return g({url:this._portalUrl+"sharing/content/users/"+this._credential.userId+"/createService",content:{f:"json",token:this._credential.token,typeKeywords:"ArcGIS Server,Data,Feature Access,Feature Service,Service,Hosted Service",createParameters:JSON.stringify(this._getFeatureServiceParams(a)),outputType:"featureService"},handleAs:"json",
callbackParamName:"callback"},{usePost:!0})},_getFeatureServiceParams:function(a){return{name:a+"_"+(new Date).getTime(),serviceDescription:"",hasStaticData:!1,maxRecordCount:1E3,supportedQueryFormats:"JSON",capabilities:"Create,Delete,Query,Update,Editing",tags:"",description:"",copyrightText:"",spatialReference:{wkid:102100},initialExtent:{xmin:this.map.extent.xmin,ymin:this.map.extent.ymin,xmax:this.map.extent.xmax,ymax:this.map.extent.ymax,spatialReference:{wkid:102100}},allowGeometryUpdates:!0,
units:"esriMeters",xssPreventionInfo:{xssPreventionEnabled:!0,xssPreventionRule:"InputOnly",xssInputRule:"rejectInvalid"}}},_addDefinitionToService:function(a,b){return g({url:a,content:{token:this._credential.token,addToDefinition:JSON.stringify(b),f:"json"},handleAs:"json",callbackParamName:"callback"},{usePost:!0})},_createLayer:function(a){var b=this.nls,c=a.graphics[0],d={point:"esriGeometryPoint",polyline:"esriGeometryPolyline",polygon:"esriGeometryPolygon"}["undefined"!==typeof c.geometry?
c.geometry.type:c.type],c=c.symbol?c.symbol.toJson():"",g=[{name:"ObjectID",alias:"ObjectID",type:"esriFieldTypeOID"},{name:b.snapshot_append,alias:b.snapshot_append,type:"esriFieldTypeString"}];a.fields&&0<a.fields.length&&t.forEach(a.fields,function(a){g.push({name:a.name,alias:a.alias,type:a.type,domain:a.domain})});b={xmin:this.extent.xmin,ymin:this.extent.ymin,xmax:this.extent.xmax,ymax:this.extent.ymax,spatialReference:this.extent.spatialReference};c=a.renderer&&a.renderer.toJson?a.renderer.toJson():
a.renderer?JSON.stringify(a.renderer):{type:"simple",label:"",description:"",symbol:c};return{layers:[{adminLayerInfo:{geometryField:{name:"Shape"},xssTrustedFields:""},id:0,name:a.name,type:"Feature Layer",displayField:"",description:a.description,tags:"SA",copyrightText:"",defaultVisibility:!0,ownershipBasedAccessControlForFeatures:{allowOthersToQuery:!1,allowOthersToDelete:!1,allowOthersToUpdate:!1},relationships:[],isDataVersioned:!1,supportsCalculate:!0,supportsAttachmentsByUploadId:!0,supportsRollbackOnFailureParameter:!0,
supportsStatistics:!0,supportsAdvancedQueries:!0,supportsValidateSql:!0,supportsCoordinatesQuantization:!0,supportsApplyEditsWithGlobalIds:!0,advancedQueryCapabilities:{supportsPagination:!0,supportsQueryWithDistance:!0,supportsReturningQueryExtent:!0,supportsStatistics:!0,supportsOrderBy:!0,supportsDistinct:!0,supportsQueryWithResultType:!0,supportsSqlExpression:!0,supportsReturningGeometryCentroid:!0},useStandardizedQueries:!1,geometryType:d,minScale:0,maxScale:0,extent:b,drawingInfo:{renderer:c},
allowGeometryUpdates:!0,hasAttachments:!1,htmlPopupType:"esriServerHTMLPopupTypeNone",hasM:!1,hasZ:!1,objectIdField:"OBJECTID",globalIdField:"",typeIdField:"",fields:this._getLayerFields(a.fields),indexes:[],types:[],templates:[{name:"New Feature",description:"",drawingTool:"esriFeatureEditToolPolygon",prototype:{attributes:{}}}],supportedQueryFormats:"JSON",hasStaticData:!1,maxRecordCount:1E4,standardMaxRecordCount:4E3,tileMaxRecordCount:4E3,maxRecordCountFactor:1,exceedsLimitFactor:1,capabilities:"Query,Editing,Create,Update,Delete"}]}},
_getLayerFields:function(a){var b=[{name:"OBJECTID",type:"esriFieldTypeOID",actualType:"int",alias:"OBJECTID",sqlType:"sqlTypeOther",nullable:!1,editable:!1,domain:null,defaultValue:null}];t.forEach(a,r.hitch(this,function(a){"esriFieldTypeString"===a.type&&(a.actualType="nvarchar",a.sqlType="sqlTypeNVarchar");b.push(a)}));return b}})})},"widgets/SituationAwareness/js/PropertyHelper":function(){define("dojo/_base/declare dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/dom-class dojo/on dojo/dom-attr dojo/keys dojo/query dojo/Deferred jimu/BaseWidget jimu/portalUtils dojo/Evented dojo/text!./PropertyHelper.html jimu/dijit/formSelect dijit/form/ValidationTextBox".split(" "),
function(u,r,t,v,n,k,g,d,l,q,x,b,a,m,f){return u([x,r,a],{templateString:m,baseClass:"jimu-widget-SAT-property-helper",constructor:function(){},postMixInProperties:function(){this.inherited(arguments);this.nls.common=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.windowResize=this.own(k(window,"resize",t.hitch(this,this._resize)));"report"===this.type?this.initReportControls():this.initSnapshotControls();this.startup()},_resize:function(){var a=!isNaN(window.innerWidth)&&
null!==window.innerWidth&&""!==window.innerWidth&&window.innerWidth?window.innerWidth:450;this.popup.width=450<=a?450:a},startup:function(){this.snapshotName.invalidMessage=this.invalidMessage;this.snapshotName.validator="report"===this.type?this.checkReportString:this.checkString;this.btnCancel.innerText=this.nls.common.cancel;g.set(this.btnCancel,"aria-label",this.nls.common.cancel);this.own(k(this.btnCancel,"click",t.hitch(this,function(){this.emit("cancel")})));this.own(k(this.btnCancel,"keydown",
t.hitch(this,function(a){a.keyCode!==d.ENTER&&a.keyCode!==d.SPACE||this.emit("cancel")})));this.btnOk.innerText=this.nls.common.ok;g.set(this.btnOk,"aria-label",this.nls.common.ok);this.own(k(this.btnOk,"click",t.hitch(this,function(){this.onOkButtonClicked()})));this.own(k(this.btnOk,"keydown",t.hitch(this,function(a){if(a.keyCode===d.ENTER||a.keyCode===d.SPACE)this.onOkButtonClicked()})))},onOkButtonClicked:function(){if(!n.contains(this.btnOk,"jimu-state-disabled")){var a={name:this.snapshotName.value.trim()};
"report"===this.type?a=t.mixin(a,{reportLayout:{orientation:this.pageUtils.Orientation[this.orientationSelect.selectControl.value],pageSize:this.pageUtils.PageSizes[this.pageSizeSelect.selectControl.value]},comments:this.commentTextArea.value}):a.groups=[this.shareSelect.selectControl.value!==this.nls.choose_group?this.shareSelect.selectControl.value:""];this.emit("ok",a)}},initWidth:function(){this._resize()},checkString:function(a){a=101>a.trim().length;var b=l(".snapshot-name-footer")[0];b&&(this.hasNoGroups?
(v.addClass(b.children[0],"jimu-state-disabled"),g.set(b.children[0],"tabindex","-1")):a?(v.removeClass(b.children[0],"jimu-state-disabled"),g.set(b.children[0],"tabindex","0")):(v.addClass(b.children[0],"jimu-state-disabled"),g.set(b.children[0],"tabindex","-1")));return a},checkReportString:function(a){a=0<a.trim().length?!0:!1;var b=l(".snapshot-name-footer")[0];b&&(a?(v.removeClass(b.children[0],"jimu-state-disabled"),g.set(b.children[0],"tabindex","0")):(v.addClass(b.children[0],"jimu-state-disabled"),
g.set(b.children[0],"tabindex","-1")));return a},getPageUtilValues:function(a,b,d){var c="A3 A4 Letter_ANSI_A Tabloid_ANSI_B Landscape Portrait".split(" "),e=["Letter ANSI A","Portrait"],f=Object.keys(a),g=[],h;for(h in f){var l=f[h],k=a[l];l&&k.hasOwnProperty(b)&&-1<c.indexOf(l)&&g.push({label:k[b],value:l,selected:k[b]===d||-1<e.indexOf(k[b])})}return g},getGroupValues:function(a){var c=new q;b.getPortal(this.portalUrl).getUser().then(t.hitch(this,function(b){var d=[],e;for(e in b.groups){var f=
b.groups[e];d.push({label:f.title,value:f.id,selected:f.title===a})}c.resolve(d)}),t.hitch(this,function(a){console.log(a);c.resolve([])}));return c},initSnapshotControls:function(){this.nameSpan.innerHTML=this.nls.common.name+":";this.shareSpan.innerHTML=this.nls.select_group+":";this.toggleRow(this.shareRow,!1);this.toggleRow(this.orientationRow,!0);this.toggleRow(this.pageSizeRow,!0);this.toggleRow(this.commentsRow,!0);var a;if(null!==this.storedProps){var b=JSON.parse(this.storedProps,!0);b.share&&
(a=b.share)}this.getGroupValues(a).then(t.hitch(this,function(a){this.snapshotName.hasNoGroups=0===a.length?!0:!1;this.addSelect(this.shareSpan.innerHTML,this.shareSelect,a)}))},initReportControls:function(){this.nameSpan.innerHTML=this.nls.common.title+":";this.toggleRow(this.orientationRow,!1);this.toggleRow(this.pageSizeRow,!1);this.toggleRow(this.commentsRow,!1);this.toggleRow(this.shareRow,!0);var a,b;if(null!==this.storedProps){var d=JSON.parse(this.storedProps,!0);d.reportLayout&&(b=d.reportLayout.pageSize,
a=d.reportLayout.orientation.Text,b=b.SizeName)}this.addSelect(this.nls.orientation,this.orientationSelect,this.getPageUtilValues(this.pageUtils.Orientation,"Text",a));this.addSelect(this.nls.pageSize,this.pageSizeSelect,this.getPageUtilValues(this.pageUtils.PageSizes,"SizeName",b))},addSelect:function(a,b,d){b.selectControl=new f({options:d,"aria-label":a,style:"width: 100%;"});b.selectControl.placeAt(b).startup()},toggleRow:function(a,b){n.contains(a,b?"display-on":"display-off")&&n.remove(a,b?
"display-on":"display-off");n.add(a,b?"display-off":"display-on")},destroy:function(){}})})},"esri/dijit/util/busyIndicator":function(){define("dijit/registry dojo/_base/lang dojo/_base/window dojo/dom dojo/dom-construct dojox/widget/Standby require".split(" "),function(u,r,t,v,n,k,g){var d={_defaultStandbyParams:{image:g.toUrl("../images/loading-throb.gif"),color:"#fff",opacity:.75,duration:200},create:function(g){if(g=this._normalizeParams(g))return g=new k(d._toStandbyParams(g)),n.place(g.domNode,
t.doc.body),d._createHandle(g)},_normalizeParams:function(d){if(d){if(d.target)return d;if("string"===typeof d){var g=u.byId(d);d=g?g.domNode:v.byId(d)}else d=d.domNode?d.domNode:v.byId(d);if(d)return{target:d}}},_toStandbyParams:function(g){g.imageUrl&&(g.image=g.imageUrl);g.backgroundColor&&(g.color=g.backgroundColor);g.backgroundOpacity&&(g.opacity=g.backgroundOpacity);g.fadeDuration&&(g.duration=g.fadeDuration);return r.mixin({},d._defaultStandbyParams,g)},_createHandle:function(d){return{show:function(){d&&
d.show()},hide:function(){d&&d.hide()},destroy:function(){d&&(d.destroy(),d=null)}}}};return d})},"dojox/widget/Standby":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/array dojo/_base/event dojo/_base/sniff dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/window dojo/_base/window dojo/_base/fx dojo/fx dijit/_Widget dijit/_TemplatedMixin dijit/registry".split(" "),function(u,r,t,v,n,k,g,d,l,q,x,b,a,m,f,c,e){u.experimental("dojox.widget.Standby");
return r("dojox.widget.Standby",[f,c],{image:require.toUrl("dojox/widget/Standby/images/loading.gif").toString(),imageText:"Please Wait...",text:"Please wait...",centerIndicator:"image",target:"",color:"#C0C0C0",duration:500,zIndex:"auto",opacity:.75,templateString:'\x3cdiv\x3e\x3cdiv style\x3d"display: none; opacity: 0; z-index: 9999; position: absolute; cursor:wait;" dojoAttachPoint\x3d"_underlayNode"\x3e\x3c/div\x3e\x3cimg src\x3d"${image}" style\x3d"opacity: 0; display: none; z-index: -10000; position: absolute; top: 0px; left: 0px; cursor:wait;" dojoAttachPoint\x3d"_imageNode"\x3e\x3cdiv style\x3d"opacity: 0; display: none; z-index: -10000; position: absolute; top: 0px;" dojoAttachPoint\x3d"_textNode"\x3e\x3c/div\x3e\x3c/div\x3e',
_underlayNode:null,_imageNode:null,_textNode:null,_centerNode:null,_displayed:!1,_resizeCheck:null,_started:!1,_parent:null,startup:function(a){if(!this._started){if("string"===typeof this.target){var c=e.byId(this.target);this.target=c?c.domNode:k.byId(this.target)}this.text&&(this._textNode.innerHTML=this.text);"image"===this.centerIndicator?(this._centerNode=this._imageNode,g.set(this._imageNode,"src",this.image),g.set(this._imageNode,"alt",this.imageText)):this._centerNode=this._textNode;q.set(this._underlayNode,
{display:"none",backgroundColor:this.color});q.set(this._centerNode,"display","none");this.connect(this._underlayNode,"onclick","_ignore");this.domNode.parentNode&&this.domNode.parentNode!=b.body()&&b.body().appendChild(this.domNode);7==n("ie")&&(this._ieFixNode=d.create("div"),q.set(this._ieFixNode,{opacity:"0",zIndex:"-1000",position:"absolute",top:"-1000px"}),b.body().appendChild(this._ieFixNode));this.inherited(arguments)}},show:function(){this._displayed||(this._anim&&(this._anim.stop(),delete this._anim),
this._displayed=!0,this._size(),this._disableOverflow(),this._fadeIn())},hide:function(){if(this._displayed)try{this._anim&&(this._anim.stop(),delete this._anim),this._size()}catch(h){console.error(h)}finally{this._fadeOut(),this._displayed=!1,null!==this._resizeCheck&&(clearInterval(this._resizeCheck),this._resizeCheck=null)}},isVisible:function(){return this._displayed},onShow:function(){},onHide:function(){},uninitialize:function(){this._displayed=!1;this._resizeCheck&&clearInterval(this._resizeCheck);
q.set(this._centerNode,"display","none");q.set(this._underlayNode,"display","none");7==n("ie")&&this._ieFixNode&&(b.body().removeChild(this._ieFixNode),delete this._ieFixNode);this._anim&&(this._anim.stop(),delete this._anim);this._centerNode=this._textNode=this._imageNode=this.target=null;this.inherited(arguments)},_size:function(){if(this._displayed){var a=g.get(b.body(),"dir");a&&(a=a.toLowerCase());var c,d=this._scrollerWidths(),e=this.target,f=q.get(this._centerNode,"display");q.set(this._centerNode,
"display","block");var k=l.position(e,!0);if(e===b.body()||e===b.doc)k=x.getBox(),k.x=k.l,k.y=k.t;var m=l.getMarginBox(this._centerNode);q.set(this._centerNode,"display",f);this._ieFixNode&&(c=-this._ieFixNode.offsetTop/1E3,k.x=Math.floor((k.x+.9)/c),k.y=Math.floor((k.y+.9)/c),k.w=Math.floor((k.w+.9)/c),k.h=Math.floor((k.h+.9)/c));var r=q.get(e,"zIndex"),t=f=r;if("auto"===this.zIndex)if("auto"!=r)f=parseInt(f,10),t=parseInt(t,10);else{var u=e;if(u&&u!==b.body()&&u!==b.doc)for(u=e.parentNode,c=-1E5;u&&
u!==b.body();)(r=q.get(u,"zIndex"))&&"auto"!==r&&(r=parseInt(r,10),c<r&&(c=r,f=r+1,t=r+1)),u=u.parentNode}else f=parseInt(this.zIndex,10),t=parseInt(this.zIndex,10);q.set(this._centerNode,"zIndex",t);q.set(this._underlayNode,"zIndex",f);if((f=e.parentNode)&&f!==b.body()&&e!==b.body()&&e!==b.doc){u=k.h;t=k.w;e=l.position(f,!0);this._ieFixNode&&(c=-this._ieFixNode.offsetTop/1E3,e.x=Math.floor((e.x+.9)/c),e.y=Math.floor((e.y+.9)/c),e.w=Math.floor((e.w+.9)/c),e.h=Math.floor((e.h+.9)/c));e.w-=f.scrollHeight>
f.clientHeight&&0<f.clientHeight?d.v:0;e.h-=f.scrollWidth>f.clientWidth&&0<f.clientWidth?d.h:0;"rtl"===a&&(n("opera")?(k.x+=f.scrollHeight>f.clientHeight&&0<f.clientHeight?d.v:0,e.x+=f.scrollHeight>f.clientHeight&&0<f.clientHeight?d.v:0):n("ie")?e.x+=f.scrollHeight>f.clientHeight&&0<f.clientHeight?d.v:0:n("webkit"));e.w<k.w&&(k.w-=e.w);e.h<k.h&&(k.h-=e.h);var v=e.y,K=e.y+e.h,H=k.y,y=k.y+u,a=e.x;c=e.x+e.w;var r=k.x,Q=k.x+t;if(y>v&&H<v)k.y=e.y,u-=v-H,k.h=u<e.h?u:k.h-2*(f.scrollWidth>f.clientWidth&&
0<f.clientWidth?d.h:0);else if(H<K&&y>K)k.h=K-H;else if(y<=v||H>=K)k.h=0;if(Q>a&&r<a)k.x=e.x,t-=a-r,k.w=t<e.w?t:k.w-2*(f.scrollHeight>f.clientHeight&&0<f.clientHeight?d.w:0);else if(r<c&&Q>c)k.w=c-r;else if(Q<=a||r>=c)k.w=0}0<k.h&&0<k.w?(q.set(this._underlayNode,{display:"block",width:k.w+"px",height:k.h+"px",top:k.y+"px",left:k.x+"px"}),d=["borderRadius","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"],this._cloneStyles(d),n("ie")||(d="MozBorderRadius MozBorderRadiusTopleft MozBorderRadiusTopright MozBorderRadiusBottomleft MozBorderRadiusBottomright WebkitBorderRadius WebkitBorderTopLeftRadius WebkitBorderTopRightRadius WebkitBorderBottomLeftRadius WebkitBorderBottomRightRadius".split(" "),
this._cloneStyles(d,this)),d=k.h/2-m.h/2,f=k.w/2-m.w/2,k.h>=m.h&&k.w>=m.w?q.set(this._centerNode,{top:d+k.y+"px",left:f+k.x+"px",display:"block"}):q.set(this._centerNode,"display","none")):(q.set(this._underlayNode,"display","none"),q.set(this._centerNode,"display","none"));if(null===this._resizeCheck){var U=this;this._resizeCheck=setInterval(function(){U._size()},100)}}},_cloneStyles:function(a){t.forEach(a,function(a){q.set(this._underlayNode,a,q.get(this.target,a))},this)},_fadeIn:function(){var b=
this,c=a.animateProperty({duration:b.duration,node:b._underlayNode,properties:{opacity:{start:0,end:b.opacity}}}),d=a.animateProperty({duration:b.duration,node:b._centerNode,properties:{opacity:{start:0,end:1}},onEnd:function(){b.onShow();delete b._anim}});this._anim=m.combine([c,d]);this._anim.play()},_fadeOut:function(){var b=this,c=a.animateProperty({duration:b.duration,node:b._underlayNode,properties:{opacity:{start:b.opacity,end:0}},onEnd:function(){q.set(this.node,{display:"none",zIndex:"-1000"})}}),
d=a.animateProperty({duration:b.duration,node:b._centerNode,properties:{opacity:{start:1,end:0}},onEnd:function(){q.set(this.node,{display:"none",zIndex:"-1000"});b.onHide();b._enableOverflow();delete b._anim}});this._anim=m.combine([c,d]);this._anim.play()},_ignore:function(a){a&&v.stop(a)},_scrollerWidths:function(){var a=d.create("div");q.set(a,{position:"absolute",opacity:0,overflow:"hidden",width:"50px",height:"50px",zIndex:"-100",top:"-200px",padding:"0px",margin:"0px"});var c=d.create("div");
q.set(c,{width:"200px",height:"10px"});a.appendChild(c);b.body().appendChild(a);c=l.getContentBox(a);q.set(a,"overflow","scroll");var e=l.getContentBox(a);b.body().removeChild(a);return{v:c.w-e.w,h:c.h-e.h}},_setTextAttr:function(a){this.text=this._textNode.innerHTML=a},_setColorAttr:function(a){q.set(this._underlayNode,"backgroundColor",a);this.color=a},_setImageTextAttr:function(a){g.set(this._imageNode,"alt",a);this.imageText=a},_setImageAttr:function(a){g.set(this._imageNode,"src",a);this.image=
a},_setCenterIndicatorAttr:function(a){this.centerIndicator=a;"image"===a?(this._centerNode=this._imageNode,q.set(this._textNode,"display","none")):(this._centerNode=this._textNode,q.set(this._imageNode,"display","none"))},_setTargetAttr:function(a){if("string"===typeof a){var b=e.byId(a);this._set("target",b?b.domNode:k.byId(a))}else this._set("target",a)},_disableOverflow:function(){if(this.target===b.body()||this.target===b.doc){this._overflowDisabled=!0;var a=b.body();this._oldOverflow=a.style&&
a.style.overflow?q.get(a,"overflow"):"";if(n("ie")&&!n("quirks")){if(a.parentNode&&a.parentNode.style&&a.parentNode.style.overflow)this._oldBodyParentOverflow=a.parentNode.style.overflow;else try{this._oldBodyParentOverflow=q.get(a.parentNode,"overflow")}catch(B){this._oldBodyParentOverflow="scroll"}q.set(a.parentNode,"overflow","hidden")}q.set(a,"overflow","hidden")}},_enableOverflow:function(){if(this._overflowDisabled){delete this._overflowDisabled;var a=b.body();n("ie")&&!n("quirks")&&(a.parentNode.style.overflow=
this._oldBodyParentOverflow,delete this._oldBodyParentOverflow);q.set(a,"overflow",this._oldOverflow);if(n("webkit")){var c=d.create("div",{style:{height:"2px"}});a.appendChild(c);setTimeout(function(){a.removeChild(c)},0)}delete this._oldOverflow}}})})},"widgets/SituationAwareness/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:jimu/dijit/templates/ReportTemplate.html":'\x3c!DOCTYPE HTML\x3e\r\n\x3chtml lang\x3d"en" dir\x3d"ltr"\x3e\r\n\r\n\x3chead id\x3d"reportHead"\x3e\r\n  \x3cmeta charset\x3d"utf-8"\x3e\r\n  \x3cmeta http-equiv\x3d"X-UA-Compatible" content\x3d"IE\x3dEdge,chrome\x3d1"\x3e\r\n  \x3ctitle\x3e\x3c/title\x3e\r\n  \x3cscript\x3e\r\n    // Show/hide text area controls based on the value\r\n    function onPrintButtonClicked() {\r\n      var notesContainer, i;\r\n      notesContainer \x3d document.getElementsByClassName("esriCTNotesContainer");\r\n      //process notes to show/hide based on contents\r\n      for (i \x3d 0; i \x3c notesContainer.length; i++) {\r\n        if (notesContainer[i]) {\r\n          //Hide the notes which are not having values\r\n          if (notesContainer[i].children[1].value.trim() \x3d\x3d\x3d "") {\r\n            notesContainer[i].className +\x3d " esriCTHideReportNotes";\r\n          }\r\n          else {\r\n            //Removes hidden class if available\r\n            notesContainer[i].className \x3d\r\n              notesContainer[i].className.replace("esriCTHideReportNotes", "");\r\n          }\r\n        }\r\n      }\r\n      //after processing notes, print the window\r\n      window.print();\r\n    }\r\n  \x3c/script\x3e\r\n  \x3c!-- Report prev page css --\x3e\r\n  \x3cstyle type\x3d"text/css"\x3e\r\n    .esriCTReportMapWait {\r\n      height: 5px;\r\n      width: 100%;\r\n      position: relative;\r\n      overflow: hidden;\r\n      background-color: #ddd;\r\n    }\r\n\r\n    .esriCTReportMapWait:before {\r\n      display: block;\r\n      position: absolute;\r\n      content: "";\r\n      left: -200px;\r\n      width: 200px;\r\n      height: 5px;\r\n      background-color: #2980b9;\r\n      animation: loading 2s linear infinite;\r\n    }\r\n\r\n    @keyframes loading {\r\n      from {\r\n        left: -200px;\r\n        width: 30%;\r\n      }\r\n      50% {\r\n        width: 30%;\r\n      }\r\n      70% {\r\n        width: 70%;\r\n      }\r\n      80% {\r\n        left: 50%;\r\n      }\r\n      95% {\r\n        left: 120%;\r\n      }\r\n      to {\r\n        left: 100%;\r\n      }\r\n    }\r\n\r\n    .esriCTHTMLData {\r\n      position: relative;\r\n      width: 100%;\r\n      height: auto;\r\n    }\r\n\r\n    .jimu-rtl .esriCTHTMLData {\r\n      direction: rtl;\r\n    }\r\n\r\n    .esriCTTable {\r\n      margin-top: 10px;\r\n      padding: 0;\r\n      border-collapse: collapse;\r\n      border-spacing: 0;\r\n      width: 100%;\r\n      page-break-inside: avoid;\r\n      table-layout: fixed;\r\n    }\r\n\r\n    .jimu-rtl .esriCTTable {\r\n      direction: rtl;\r\n    }\r\n\r\n    .esriCTTable th {\r\n      border: 1px solid gray;\r\n      background-color: #E4E4E4;\r\n      word-wrap: break-word;\r\n    }\r\n\r\n    .esriCTTable td {\r\n      border: 1px solid gray;\r\n      word-wrap: break-word;\r\n    }\r\n\r\n    .esriCTSectionTitle {\r\n      font-size: 18px;\r\n      color: #0f96cc;\r\n      font-weight: bold;\r\n      margin: 30px 0px;\r\n      width: calc(100% - 10px);\r\n      word-break: break-all;\r\n    }\r\n\r\n    .jimu-rtl .esriCTSectionTitle {\r\n      float: right;\r\n      direction: rtl;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportMap .esriCTSectionTitle {\r\n      float: none;\r\n    }\r\n\r\n    .esriCTReportLogo {\r\n      float: left;\r\n      max-width: calc(50% - 10px);\r\n      margin: auto 10px auto 0;\r\n      max-height: 90%;\r\n      position: absolute;\r\n      top: 0;\r\n      bottom: 0;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportLogo {\r\n      float: right;\r\n      margin: auto 0 auto 10px;\r\n    }\r\n\r\n    .esriCTPrintTitleDiv {\r\n      height: 56px;\r\n      float: right;\r\n      min-width: 50%;\r\n    }\r\n\r\n    .jimu-rtl .esriCTPrintTitleDiv {\r\n      float: left;\r\n      direction: rtl;\r\n    }\r\n\r\n    .esriCTInputTitle {\r\n      height: 55px;\r\n      line-height: 55px;\r\n      border: none;\r\n      font-size: 25px;\r\n      width: 100%;\r\n      padding: 0px;\r\n    }\r\n\r\n    .esriCTInputTitle::-ms-clear {\r\n      display: none;\r\n    }\r\n\r\n    .esriCTReportMain {\r\n      background: #FFF;\r\n      border: solid 1px #000;\r\n      margin: 0 auto;\r\n      padding: 20px;\r\n      width: 797px;\r\n    }\r\n\r\n    .esriCTReportMap {\r\n      text-align: center;\r\n    }\r\n\r\n    .esriCTReportMapImg {\r\n      max-width: 96%;\r\n      margin-top: 10px;\r\n    }\r\n\r\n    .esriCTReportLandscapeMapImg {\r\n      max-width: 80%;\r\n    }\r\n\r\n    .esriCTReportMapFail {\r\n      height: 50px;\r\n    }\r\n\r\n    .esriCTReportFooter {\r\n      text-align: center;\r\n      font-size: 80%;\r\n      padding: 10px 0;\r\n      white-space: pre-wrap;\r\n      word-wrap: break-word;\r\n    }\r\n\r\n    .esriCTPrintPage {\r\n      padding: 30px 0;\r\n      margin: 20px auto;\r\n      font-family: arial, sans-serif;\r\n      font-size: 13px;\r\n    }\r\n\r\n    .esriCTReportBar {\r\n      width: 100%;\r\n      position: fixed;\r\n      left: 0;\r\n      top: 0;\r\n      z-index: 6;\r\n      height: 50px;\r\n      background: #e2f1fc;\r\n      border-bottom: 1px solid #000;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportBar {\r\n      left: inherit;\r\n      right: 0;\r\n    }\r\n\r\n    .esriCTPrintButton,\r\n    .esriCTCloseButton {\r\n      color: #444;\r\n      font-family: Verdana, Helvetica, sans-serif;\r\n      font-size: 12px;\r\n      -moz-border-radius: 3px;\r\n      -webkit-border-radius: 3px;\r\n      border-radius: 3px;\r\n      border: 1px solid #8b8b8b;\r\n      box-shadow: none;\r\n      -webkit-box-shadow: none;\r\n      background: #F2F2F2;\r\n      background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlNWU1ZTUiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);\r\n      background: -moz-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\r\n      background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #F2F2F2), color-stop(100%, #D1D1D1));\r\n      background: -webkit-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\r\n      background: -o-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\r\n      background: -ms-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\r\n      background: linear-gradient(to bottom, #F2F2F2 0%, #D1D1D1 100%);\r\n      filter: progid: DXImageTransform.Microsoft.gradient(startColorstr\x3d\'#F2F2F2\', endColorstr\x3d\'#D1D1D1\', GradientType\x3d0);\r\n      margin: 10px 20px;\r\n      line-height: 16px;\r\n      display: block;\r\n      padding: 5px 10px;\r\n      outline: 0;\r\n      text-decoration: none;\r\n      cursor: pointer;\r\n      font-weight: 400;\r\n      white-space: nowrap;\r\n      float: right;\r\n    }\r\n\r\n    .jimu-rtl .esriCTPrintButton,\r\n    .jimu-rtl .esriCTCloseButton {\r\n      float: left;\r\n    }\r\n\r\n    .esriCTPrintButton:hover,\r\n    .esriCTPrintButton:focus,\r\n    .esriCTCloseButton:hover,\r\n    .esriCTCloseButton:focus {\r\n      background: #E5E6E6;\r\n      background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlNWU1ZTUiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);\r\n      background: -moz-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\r\n      background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #E5E6E6), color-stop(100%, #A0A1A1));\r\n      background: -webkit-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\r\n      background: -o-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\r\n      background: -ms-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\r\n      background: linear-gradient(to bottom, #E5E6E6 0%, #A0A1A1 100%);\r\n      filter: progid: DXImageTransform.Microsoft.gradient(startColorstr\x3d\'#E5E6E6\', endColorstr\x3d\'#A0A1A1\', GradientType\x3d0);\r\n    }\r\n\r\n    .esriCTReportHeader {\r\n      display: block;\r\n      width: 100%;\r\n      height: 60px;\r\n      border-bottom: 1px solid #000;\r\n      margin-bottom: 5px;\r\n      position: relative;\r\n    }\r\n\r\n    .esriCTReportBarMsg {\r\n      text-align: center;\r\n      margin-top: 16px;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportBarMsg {\r\n      direction: rtl;\r\n    }\r\n\r\n    .esriCTNotesContainer {\r\n      width: 100%;\r\n      margin-top: 30px;\r\n    }\r\n\r\n    .esriCTReportNotes {\r\n      resize: none;\r\n      width: calc(100% - 5px);\r\n      max-width: calc(100% - 5px);\r\n      font-family: "Arial";\r\n      font-size: 13px;\r\n      border: 1px solid gray;\r\n      overflow-y: hidden;\r\n      /* prevents scroll bar flash */\r\n    }\r\n\r\n    .esriCTReportNotesParagraph {\r\n      display: none;\r\n      white-space: pre-wrap;\r\n      word-wrap: break-word;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportNotesParagraph {\r\n      float: right;\r\n      direction: rtl;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportNotes {\r\n      direction: rtl;\r\n    }\r\n\r\n    .esriCTHidden {\r\n      display: none;\r\n    }\r\n  \x3c/style\x3e\r\n  \x3c!-- Media print css --\x3e\r\n  \x3cstyle type\x3d"text/css" media\x3d"print"\x3e\r\n    .esriCTPrintPage {\r\n      padding: 0;\r\n      color: #000;\r\n      margin: 0;\r\n      float: none;\r\n      background: #fff url(none);\r\n    }\r\n\r\n    .esriCTTable {\r\n      page-break-inside: avoid;\r\n      border-collapse: collapse;\r\n      border-spacing: 0;\r\n    }\r\n\r\n    .esriCTPageBreak {\r\n      page-break-after: always;\r\n    }\r\n\r\n    .esriCTReportFooter {\r\n      font-size: 75%;\r\n    }\r\n\r\n    .esriCTReportBar {\r\n      display: none;\r\n    }\r\n\r\n    .esriCTReportMain {\r\n      border: none;\r\n    }\r\n\r\n    .esriCTReportMapImg {\r\n      box-shadow: none;\r\n      border: none;\r\n    }\r\n\r\n    .esriCTReportNotes {\r\n      display: none;\r\n    }\r\n\r\n    .esriCTReportNotesParagraph {\r\n      display: block;\r\n    }\r\n\r\n    .esriCTHideReportNotes {\r\n      display: none;\r\n    }\r\n\r\n    .esriCTTable th {\r\n      border: 1px solid gray;\r\n    }\r\n\r\n    .esriCTTable td {\r\n      border: 1px solid gray;\r\n    }\r\n\r\n    .esriCTTable tr {\r\n      page-break-inside: avoid;\r\n      page-break-after: auto;\r\n    }\r\n\r\n  \x3c/style\x3e\r\n  \x3cscript\x3e\r\n    function showError(evt) {\r\n      alert(document.getElementById(\'showErrorButton\').innerHTML);\r\n    }\r\n  \x3c/script\x3e\r\n\x3c/head\x3e\r\n\r\n\x3cbody id\x3d"reportBody" class\x3d"esriCTPrintPage"\x3e\r\n  \x3cbutton id\x3d"showErrorButton" style\x3d"display: none" onclick\x3d"showError()"\x3e\x3c/button\x3e\r\n  \x3cdiv class\x3d"esriCTReportBar"\x3e\r\n    \x3cdiv id\x3d"closeButton" class\x3d"esriCTCloseButton" title\x3d"Close" onclick\x3d"window.close();"\x3eClose\x3c/div\x3e\r\n    \x3cdiv id\x3d"printButton" class\x3d"esriCTPrintButton" title\x3d"Print" onclick\x3d"onPrintButtonClicked();"\x3ePrint\x3c/div\x3e\r\n    \x3cdiv id\x3d"reportBarMsg" class\x3d"esriCTReportBarMsg"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"reportMain" class\x3d"esriCTReportMain"\x3e\r\n    \x3cdiv id\x3d"reportHeader" class\x3d"esriCTReportHeader"\x3e\r\n      \x3cimg id\x3d"reportLogo" class\x3d"esriCTReportLogo esriCTHidden" src\x3d""\x3e\r\n      \x3cdiv id\x3d"printTitleDiv" class\x3d"esriCTPrintTitleDiv"\x3e\r\n        \x3cinput id\x3d"reportTitle" type\x3d"text" class\x3d"esriCTInputTitle" tabindex\x3d"0" role\x3d"textbox"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"reportData"\x3e\x3c/div\x3e\r\n    \x3cdiv id\x3d"footNotes" class\x3d"esriCTReportFooter"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/body\x3e\r\n\r\n\x3c/html\x3e',
"url:dijit/templates/ProgressBar.html":'\x3cdiv class\x3d"dijitProgressBar dijitProgressBarEmpty" role\x3d"progressbar"\r\n\t\x3e\x3cdiv  data-dojo-attach-point\x3d"internalProgress" class\x3d"dijitProgressBarFull"\r\n\t\t\x3e\x3cdiv class\x3d"dijitProgressBarTile" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3cspan style\x3d"visibility:hidden"\x3e\x26#160;\x3c/span\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"labelNode" class\x3d"dijitProgressBarLabel" id\x3d"${id}_label"\x3e\x3c/div\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"indeterminateHighContrastImage"\r\n\t\t   class\x3d"dijitInline dijitProgressBarIndeterminateHighContrastImage"\x3e\x3c/span\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/AttachmentEditor.html":"\x3cdiv class\x3d\"attachmentEditor\"\x3e\r\n    \x3cbr /\x3e\r\n    \x3cdiv\x3e\r\n        \x3cb\x3e${NLS_attachments}\x3c/b\x3e\r\n        \x3chr /\x3e\r\n        \x3cdiv dojoAttachPoint\x3d\"_attachmentError\" style\x3d'color:red;display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e\r\n        \x3cspan dojoAttachPoint\x3d'_attachmentList' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-type\x3d\"dijit/ProgressBar\" dojoAttachPoint\x3d\"_attachmentProgress\" indeterminate\x3d\"true\" style\x3d'display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e        \r\n        \x3cform dojoAttachPoint\x3d'_uploadForm'\x3e ${NLS_add}:\x26nbsp;\x26nbsp;\x3cinput type\x3d'file' name\x3d'attachment' dojoAttachPoint\x3d'_uploadField' /\x3e \x3c/form\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e",
"url:esri/dijit/templates/AttributeInspector.html":'\x3cdiv class\x3d"esriAttributeInspector"\x3e\r\n    \x3cdiv class\x3d"atiLayerName" dojoAttachPoint\x3d"layerName"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiAttributes" dojoAttachPoint\x3d"attributeTable"\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"attachmentEditor"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiEditorTrackingInfo" dojoAttachPoint\x3d"editorTrackingInfoDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiButtons" dojoAttachPoint\x3d"editButtons"\x3e\r\n        \x3cbutton  dojoType\x3d"dijit.form.Button" class\x3d"atiButton atiDeleteButton"  dojoAttachPoint\x3d"deleteBtn" dojoAttachEvent\x3d"onClick: onDeleteBtn" showLabel\x3d"true" type\x3d"button"\x3e${NLS_deleteFeature}\x3c/button\x3e\r\n        \x3cdiv class\x3d"atiNavButtons" dojoAttachPoint\x3d"navButtons"\x3e\r\n            \x3cdiv class\x3d"atiNavMessage" dojoAttachPoint\x3d"navMessage"\x3e\x3c/div\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiFirstIcon" dojoAttachPoint\x3d"firstFeatureButton" dojoAttachEvent\x3d"onClick: onFirstFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_first}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiPrevIcon" dojoAttachPoint\x3d"prevFeatureButton" dojoAttachEvent\x3d"onClick: onPreviousFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiNextIcon" dojoAttachPoint\x3d"nextFeatureButton" dojoAttachEvent\x3d"onClick: onNextFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiLastIcon" dojoAttachPoint\x3d"lastFeatureButton" dojoAttachEvent\x3d"onClick: onLastFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_last}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SituationAwareness/js/PropertyHelper.html":'\x3cdiv\x3e  \r\n  \x3cdiv class\x3d"jimu-r-row"\x3e\r\n    \x3ctable class\x3d"width-all"\x3e\r\n      \x3c!--name--\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"nameRow"\x3e\r\n        \x3ctd class\x3d"col-1-2"\x3e\r\n          \x3cspan class\x3d"label" data-dojo-attach-point\x3d"nameSpan"\x3e\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2"\x3e\r\n          \x3cinput class\x3d"width-all" data-dojo-attach-point\x3d"snapshotName" data-dojo-type\x3d"dijit/form/ValidationTextBox" /\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3c!--share--\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"shareRow"\x3e\r\n        \x3ctd class\x3d"width-all pad-top-10"\x3e\r\n          \x3cspan class\x3d"hintText"\x3e${nls.select_group_instruction}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cspan class\x3d"label" data-dojo-attach-point\x3d"shareSpan"\x3e\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"shareSelect"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3c!--orientation--\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"orientationRow"\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cspan class\x3d"label" data-dojo-attach-point\x3d"orientationSpan"\x3e${nls.orientation}:\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"orientationSelect"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3c!--page size--\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"pageSizeRow"\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cspan class\x3d"label" data-dojo-attach-point\x3d"pageSizeSpan"\x3e${nls.pageSize}:\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"pageSizeSelect"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3c!--comments--\x3e\r\n  \x3cdiv class\x3d"display-off pad-top-10" data-dojo-attach-point\x3d"commentsRow"\x3e\r\n    \x3cdiv class\x3d"jimu-r-row pad-top-5"\x3e\r\n      \x3cdiv class\x3d"jimu-r-row"\x3e\r\n        \x3cspan class\x3d"label" data-dojo-attach-point\x3d"commentsSpan"\x3e${nls.comments}:\x3c/span\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-r-row pad-top-5"\x3e\r\n      \x3ctextarea aria-label\x3d"${nls.comments}" class\x3d"commentTextArea" data-dojo-attach-point\x3d"commentTextArea" rows\x3d"5"\x3e\x3c/textarea\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"snapshot-name-footer jimu-float-trailing pad-top-10"\x3e\r\n    \x3cdiv role\x3d"button" tabindex\x3d"-1" class\x3d"jimu-btn ok pad-right-5 jimu-state-disabled" data-dojo-attach-point\x3d"btnOk"\x3e\x3c/div\x3e\r\n    \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"jimu-btn cancel" data-dojo-attach-point\x3d"btnCancel"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SituationAwareness/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"panelBottom" class\x3d"panelBottom"\x3e\r\n\r\n    \x3c!-- Panel Footer --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"footerNode" class\x3d"SA_panelFooter dart-bgcolor box-bgcolor jimu-main-background"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"panelLeft" class\x3d"SA_panelLeft" data-dojo-attach-event\x3d"onclick:_navTabsLeft"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"footerContentNode" class\x3d"SA_panelFooterContent"\x3e\r\n        \x3c!-- Tabs --\x3e\r\n        \x3cdiv role\x3d"tablist" data-dojo-attach-point\x3d"tabsNode" class\x3d"SA_SAT_tabs"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"panelRight" class\x3d"SA_panelRight" data-dojo-attach-event\x3d"onclick:_navTabsRight"\x3e\x3c/div\x3e\r\n      \x3cdiv role\x3d"button" data-dojo-attach-point\x3d"closeButton" tabindex\x3d"-1" class\x3d"SA_panelClose" data-dojo-attach-event\x3d"onclick:_close"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3c!--Panel Container --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"panelContainer" class\x3d"panelContainer dart-bgcolor box-bgcolor jimu-main-background"\x3e\r\n      \x3c!-- Panel Incident --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"innerBL" class\x3d"innerBL" data-dojo-attach-event\x3d"onclick:_navLeft"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"SA_tabPanel0" role\x3d"tabpanel" class\x3d"SAT_tabPanel"\x3e\r\n        \x3cdiv class\x3d"SAT_tabPanelContent" style\x3d"min-width: 650px"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"incidentsLocate" class\x3d"SATcolLocate" style\x3d"width:auto; min-width:220px"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"locateIncident" class\x3d"label locateIncident"\x3e\x3c/div\x3e\r\n            \x3cdiv role\x3d"button" aria-label\x3d"${nls.clearIncident}" tabindex\x3d"0" data-dojo-attach-point\x3d"clearIncident"\r\n              class\x3d"label clearIncident" data-dojo-attach-event\x3d"onclick:_clear"\x3e\r\n              ${nls.clearIncident}\r\n            \x3c/div\x3e\r\n            \x3cbr /\x3e\r\n            \x3cdiv class\x3d"locateIncidentContainer"\x3e\r\n              \x3cdiv class\x3d"colBar SATdrawCol"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"imgContainer" class\x3d"imgContainer"\x3e\r\n                  \x3cspan class\x3d"btn32 displayTC"\x3e \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"btn32img"\r\n                      data-dojo-attach-point\x3d"SA_btn0"\x3e \x3c/div\x3e \x3c/span\x3e\r\n                  \x3cspan class\x3d"btn32 displayTC"\x3e \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"btn32img"\r\n                      data-dojo-attach-point\x3d"SA_btn1"\x3e \x3c/div\x3e \x3c/span\x3e\r\n                  \x3cspan class\x3d"btn32 displayTC"\x3e \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"btn32img"\r\n                      data-dojo-attach-point\x3d"SA_btn2"\x3e \x3c/div\x3e \x3c/span\x3e\r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n              \x3cdiv class\x3d"bufferIncidentContainer"\x3e\r\n                \x3cdiv class\x3d"bufferControlsContainer"\x3e\r\n                  \x3cdiv data-a11y-label-id\x3d"spinnerValue" data-dojo-attach-point\x3d"buffer_lbl" class\x3d"label bufferLabel"\x3e\x3c/div\x3e\r\n                  \x3cdiv class\x3d"spinnerValueDIV"\x3e\r\n                    \x3cinput data-a11y-label-by\x3d"spinnerValue" role\x3d"button" role\x3d"textbox" tabindex\x3d"0" data-dojo-attach-point\x3d"spinnerValue"\r\n                      data-dojo-type\x3d"dijit/form/NumberSpinner" class\x3d"spinnerValue" name\x3d"spinnerValue" /\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"buffer_lbl_unit" class\x3d"label bufferUnit"\x3e\x3c/div\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"saveOptions" class\x3d"SATcol2"\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"borderCol" class\x3d"borderCol display-off"\x3e\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"div_reverse_geocoding" class\x3d"SATcol reverseGeocodingDIV"\x3e\r\n            \x3cdiv class\x3d"label"\x3e\r\n              ${nls.reverse_geocoded_address}\r\n            \x3c/div\x3e\r\n            \x3c/br\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"div_reversed_address" class\x3d"label reversedAddressDIV"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"innerBR" class\x3d"innerBR" data-dojo-attach-event\x3d"onclick:_navRight"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Panel Message --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"messageNode" class\x3d"SA_panelMessage"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"messageTextNode"\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SituationAwareness/css/style.css":".jimu-widget-SAT {color: #ffffff !important; background-color: #4c4c4c; left: 0px; right: 0px; bottom: 0px; height: 155px !important; display: block; z-index: 100 !important;}.action2 {padding-left: 10px;}.jimu-widget-SAT .innerBL {display: none; width: 10px; height: 20px; background-image: url('images/nav_left.png'); background-repeat: no-repeat; background-size:cover; position: fixed; bottom: 45px; left: 0px; z-index: 2; background-size:cover; opacity: .6;}.jimu-rtl .jimu-widget-SAT .innerBL {right: 0px;}.jimu-widget-SAT .innerBL:hover {width: 20px; height: 35px; opacity: 1; cursor: pointer; bottom: 30px;}.jimu-widget-SAT .innerBR {display: none; width: 10px; height: 20px; background-image: url('images/nav_right.png'); background-repeat: no-repeat; background-size:cover; position: fixed; bottom: 45px; right: 0px; z-index: 2; opacity: .6;}.jimu-rtl .jimu-widget-SAT .innerBR {left: 0px;}.jimu-widget-SAT .innerBR:hover {width: 20px; height: 35px; opacity: 1; cursor: pointer; bottom: 30px;}.jimu-widget-SAT .rounded {-moz-border-radius: 5px 5px 5px 5px; -webkit-border-radius: 5px 5px 5px 5px; border-radius: 5px 5px 5px 5px;}.jimu-widget-SAT .roundedL {-moz-border-radius: 5px 0px 0px 5px; -webkit-border-radius: 5px 0px 0px 5px; border-radius: 5px 0px 0px 5px;}.jimu-widget-SAT .roundedR {-moz-border-radius: 0px 5px 5px 0px; -webkit-border-radius: 0px 5px 5px 0px; border-radius: 0px 5px 5px 0px;}.jimu-widget-SAT .reversedAddressDIV {width:100%;}.jimu-widget-SAT .spinnerValue {width: 80px; align: left;}.jimu-widget-SAT .panelBottom {position: absolute; width: 100%; height: 155px; left: 0px; top: 0px; text-align: center; color: #ffffff; padding: 0px;}.jimu-widget-SAT .SA_panelMessage {position: absolute; top: 0px; text-align: center; width: 100%; height: 40px; line-height: 40px; display: none;}.jimu-widget-SAT .SA_panelFooter {position: absolute; top: 0px; left: 0px; right: 0px; height: 30px; line-height: 30px; overflow: hidden; border-bottom: 1px solid #353535; border-bottom: 1px solid rgba(0, 0, 0, 0.3);}.jimu-widget-SAT .SA_panelFooterContent {position: absolute; left: 0px; right: 24px; height: 30px; overflow-x: hidden; overflow-y: hidden; display: block;}.jimu-rtl .jimu-widget-SAT .SA_panelFooterContent {position: absolute; left: 24px; right: 0px;}.jimu-widget-SAT .SA_panelClose {position: absolute; left: auto; right: 0px; width: 24px; height: 30px; line-height: 30px; text-align: center; display: block; cursor: pointer; background-image: url('images/x.png'); background-repeat: no-repeat; background-position: center center; background-size: 12px;}.jimu-widget-SAT .SA_panelRight {display: none; position: absolute; left: auto; right: 24px; width: 34px; height: 30px; line-height: 30px; cursor: pointer; background-image: url('images/nav_right.png'); background-repeat: no-repeat; background-position: center center; background-size: 10px; opacity: .4;}.jimu-widget-SAT .SA_panelRight:hover {opacity: 1; background-size: 16px;}.jimu-rtl .jimu-widget-SAT .SA_panelRight {right: 0px; left: auto; width: 0px;}.jimu-widget-SAT .SA_panelLeft {display: none; position: absolute; left: 0px; right: auto; height: 30px; line-height: 30px; cursor: pointer; background-image: url('images/nav_left.png'); background-repeat: no-repeat; background-position: center center; background-size: 10px; opacity: .4;}.jimu-rtl .jimu-widget-SAT .SA_panelLeft {left: 24px; width: 34px; right: auto;}.jimu-widget-SAT .SA_panelLeft:hover {opacity: 1; background-size: 16px;}.jimu-rtl .jimu-widget-SAT .SA_panelClose {position: absolute; left: 0px; right: auto;}.jimu-widget-SAT .panelContainer {position: absolute; top: 30px; width: 100%; height: 125px; overflow: hidden; display: block;}.jimu-widget-SAT .SAT_tabPanel {position: absolute; top: 10px; left: 0px; right: 0px; height: 115px; display: none; overflow: auto;}.jimu-widget-SAT .SAT_tabPanelContent {position: absolute; top: 0px; height: 100px; white-space: nowrap; display: block; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none;}.jimu-widget-SAT .locateIncidentContainer {display: flex; float: left; margin-top: 20px;}.jimu-rtl .jimu-widget-SAT .locateIncidentContainer {display: flex; float: right; margin-top: 20px;}.jimu-widget-SAT .bufferIncidentContainer {display: table-cell;}.jimu-widget-SAT .bufferControlsContainer {float: left; padding-left: 20px;}.jimu-widget-SAT .SA_SAT_tabs {white-space: nowrap; height: 30px; padding: 0px; overflow-x: visible; overflow-y: hidden;}@supports (-ms-ime-align:auto) {.SA_SAT_tabs {position: absolute; white-space: nowrap; height: 30px; padding: 0px; overflow-x: visible; overflow-y: hidden;}} _:-ms-fullscreen, :root .SA_SAT_tabs {position: absolute; white-space: nowrap; height: 30px; padding: 0px; overflow-x: visible; overflow-y: hidden;}.jimu-widget-SAT .SATTab {width: auto; max-width: 220px; overflow: hidden; text-overflow: ellipsis; height: 30px; float: left; line-height: 30px; font-size: 13px; padding: 0 30px 0 30px; cursor: pointer; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; opacity: .85; border-right: 1px solid #d2dae2; border-top: 2px solid transparent;}.jimu-widget-SAT .active .SATTab:focus {border-top: 2px solid #15a4fa; opacity: 1;}.jimu-rtl .jimu-widget-SAT .SATTab {float: right;}.jimu-widget-SAT .active {background-color: #353535; background-color: rgba(0, 0, 0, 0.3); opacity: 1; border-top: 2px solid #15a4fa;}.jimu-widget-SAT .activeBlack {background-color: #353535; opacity: 1; border-top: 2px solid #15a4fa;}.jimu-widget-SAT .SATcol {float: left; height: 100px; width: 220px; border-left: none; margin-left: 0; padding: 0 10px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden;}.jimu-rtl .jimu-widget-SAT .SATcol {float: right; border-right: none; overflow: hidden;}.jimu-widget-SAT .SATcolExport {float: left; height: 100px; width: 65px; border-left: none; margin-left: 0; padding: 0 10px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden;}.jimu-rtl .jimu-widget-SAT .SATcolExport {float: right; border-right: none; overflow: hidden;}.jimu-widget-SAT .lightThemeBorder{border-right: 1px solid #353535; border-right: 1px solid rgba(0, 0, 0, 0.3);}.jimu-widget-SAT .darkThemeBorder{border-right: 1px solid #ffffff; border-right: 1px solid rgba(255, 255, 255, 0.5);}.jimu-rtl .jimu-widget-SAT .lightThemeBorder{border-left: 1px solid #353535; border-left: 1px solid rgba(0, 0, 0, 0.3);}.jimu-rtl .jimu-widget-SAT .darkThemeBorder{border-left: 1px solid #ffffff; border-left: 1px solid rgba(255, 255, 255, 0.5);}.jimu-widget-SAT .SATcolLocate {float: left; height: 100px; width: 220px; border-left: none; margin-left: 0; padding: 0 30px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden;}.jimu-rtl .jimu-widget-SAT .SATcolLocate {float: right; border-right: none; overflow: hidden;}.jimu-widget-SAT .SATcolWrap {white-space: pre-wrap; white-space: -moz-pre-wrap; word-wrap: break-word;}.jimu-widget-SAT .SATcol2 {float: left; height: 100px; border-left: none; margin-left: 5px; padding: 0 10px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden; display: table;}.jimu-rtl .jimu-widget-SAT .SATcol2 {float: right; border-right: none; overflow: hidden; margin-right: 5px;}.jimu-widget-SAT .borderCol {height: 100px; float: left;}.jimu-rtl .jimu-widget-SAT .borderCol {float: right; border-right: none;}.jimu-widget-SAT .SATcolSmall {float: left; height: 90px; width: 165px; border-left: none; margin-left: 0; padding: 0 20px; overflow: hidden; text-overflow: ellipsis;}.jimu-rtl .jimu-widget-SAT .SATcolSmall {float: right; border-right: none;}.jimu-widget-SAT .SATcolLast {border-left: none; border-right: none;}.jimu-widget-SAT .SATcol .label,.jimu-widget-SAT .SATcolSmall .label {font-size: 13px; padding: 2px 0;}.jimu-widget-SAT .SATcol .colBar {height: 32px; display: table-cell; width: 130px;}.jimu-widget-SAT .SATdrawCol {display: block; float: left;}.jimu-rtl .jimu-widget-SAT .SATdrawCol {display: block; float: right;}.jimu-widget-SAT .displayTC{display: table-cell;}.jimu-widget-SAT .displayTR{display: table-row;}.jimu-widget-SAT .displayT{display: table;}.jimu-widget-SAT .display-on{display: block;}.jimu-widget-SAT .display-off{display: none;}.jimu-widget-SAT .btnOn {border: 1px solid #ffffff; border: 1px solid rgba(255, 255, 255, 0.75); background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-SAT .btn32 {width: 32px; height: 32px; border-radius: 2px; margin-right: 5px; cursor: pointer;}.jimu-widget-SAT .btn32img {padding: 8px; height: 32px; width: 32px; background-repeat: no-repeat; background-position: center;}.jimu-widget-SAT .lightThemeBackground{background-color: #353535; background-color: rgba(0, 0, 0, 0.3);}.jimu-widget-SAT .darkThemeBackground{}.jimu-widget-SAT .btn32img:hover {background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-SAT .btn32imgBlack {padding: 8px; height: 32px; width: 32px; background-repeat: no-repeat; background-position: center;}.jimu-widget-SAT .btn32imgBlack:hover {background-color: #262626;}.jimu-widget-SAT .dijitTextBox,.jimu-widget-SAT .dijitTextBoxHover,.jimu-widget-SAT .dijitTextBoxFocused,.jimu-widget-SAT .dijitTextBoxHoverFocused {background-color: #393939; background-color: rgba(0, 0, 0, 0.25) !important; color: #ffffff !important; border: 1px solid #a6a6a6; border: 1px solid rgba(255, 255, 255, 0.5) !important; height: 26px !important; line-height: 26px !important;}.jimu-widget-SAT .dijitInputInner,.jimu-widget-SAT .dijitInputContainer {background: transparent !important; color: #ffffff !important; height: 26px !important; line-height: 26px !important;}.jimu-widget-SAT .dijitInputField {padding: 0px 10px !important;}.jimu-widget-SAT .btnExport {border-radius: 2px; padding: 10px 10px 10px 10px; background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right center; cursor: pointer; height: 40px;}.jimu-widget-SAT .btnExport:hover {background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-SAT .btnExport:focus, .jimu-widget-SAT .directionsButton:focus {outline: #15a4fa solid 2px !important; outline-offset: -2px;}.jimu-widget-SAT .btnExportBlack {border-radius: 2px; padding: 10px 10px 10px 10px; background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right center; cursor: pointer; height: 40px;}.jimu-widget-SAT .btnExportBlack:hover {background-color: #262626;}.jimu-widget-SAT .download {background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right 0px center;}.jimu-widget-SAT .processing {background-image: url('images/processing.gif'); background-repeat: no-repeat; background-position: right 10px center;}.jimu-widget-SAT .loading {background-image: url('images/loading.gif'); background-repeat: no-repeat; background-position: center 10px;}.jimu-widget-SAT .btnDisabled {opacity: .5; cursor: default;}.jimu-widget-SAT .colSummary {font-size: 28px; padding-top: 10px;}.jimu-widget-SAT .colGroupedSummary {font-size: 28px; padding-top: 3px;}.jimu-widget-SAT .SATcolRec {float: left; height: 100%; border-left: none; margin-left: 0; padding: 0 10px; text-align: left; text-overflow: ellipsis; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; min-width: 220px; max-width: 300px;}.jimu-rtl .jimu-widget-SAT .SATcolRec {float: right; border-right: none; text-align: right;}.jimu-widget-SAT .SATcolRecBar {position: relative; height: 26px; width: 100%; display: block;}.jimu-widget-SAT .SATcolRecNum {position: absolute; width: 26px; height: 26px; background-color: #393939; background-color: rgba(0, 0, 0, 0.25); line-height: 26px; text-align: center; border-radius: 13px; font-size: 11px; cursor: pointer;}.jimu-widget-SAT .SATcolRecNum:focus{outline: #15a4fa solid 2px !important; outline-offset: -2px;}.jimu-widget-SAT .SATcolDir {position: absolute; right: 0px; width: 26px; height: 26px; background-image: url('images/car.png'); background-repeat: no-repeat; background-position: center center; cursor: pointer;}.jimu-rtl .jimu-widget-SAT .SATcolDir {position: absolute; left: 0px; right: auto;}.jimu-widget-SAT .SATcolDistance {position: absolute; left: 30px; right: 30px; height: 26px; font-size: 11px; line-height: 26px;}.jimu-widget-SAT .SATcolInfo {position: relative; margin-top: 5px; width: 100%; display: block; overflow: hidden;}.jimu-widget-SAT .noFeaturesActive {opacity: .5; cursor: default;}.jimu-widget-SAT .noFeatures {display: none;}.jimu-widget-SAT .locateIncident{float: left;}.jimu-rtl .jimu-widget-SAT .locateIncident{float: right;}.jimu-widget-SAT .clearIncident{float: right; text-decoration: underline; cursor: pointer;}.jimu-rtl .jimu-widget-SAT .clearIncident{float: left; text-decoration: underline; cursor: pointer;}.jimu-widget-SAT .imgContainer{display: table; width: 130px; padding-top: 10px;}.jimu-widget-SAT .bufferLabel{}.jimu-widget-SAT .spinnerValueDIV{float: right; margin-top: 8px; margin-left: 4px; display: table-row;}.jimu-rtl .jimu-widget-SAT .spinnerValueDIV{float: left; margin-top: 8px; margin-right: 4px; display: table-row;}.jimu-widget-SAT .bufferUnit{display: inline; margin-left: 4px; margin-top: 7px;}.jimu-widget-SAT .saveIncidentDiv{position: absolute; top: 0px; left: 270px; line-height: 26px; font-size: 13px;}.jimu-rtl .jimu-widget-SAT .saveIncidentDiv{position: absolute; top: 0px; right: 270px; line-height: 26px; font-size: 13px;}.jimu-widget-SAT .downlaodAllDiv{position: absolute; top: 35px; left: 270px; line-height: 26px; font-size: 13px;}.jimu-rtl .jimu-widget-SAT .downlaodAllDiv{position: absolute; top: 35px; right: 270px; line-height: 26px; font-size: 13px;}.jimu-widget-SAT .createSnapshotDiv{position: absolute; top: 70px; left: 270px; line-height: 26px; font-size: 13px;}.jimu-rtl .jimu-widget-SAT .createSnapshotDiv{position: absolute; top: 70px; right: 270px; line-height: 26px; font-size: 13px;}.jimu-widget-SAT .pad-top-5{padding-top: 5px;}.jimu-widget-SAT .pad-top-10{padding-top: 10px;}.jimu-popup .SAT-warning-icon {width: 25px; height: 25px; position: relative; background-size: contain; background-repeat: no-repeat; background-image: url('../images/warning.png'); margin-top: 8px;}.jimu-popup .SAT-warning-hint {color: #898989; font-size: 11px; margin-bottom: 10px;}.jimu-widget-SAT-property-helper .pad-top-5{padding-top: 5px;}.jimu-widget-SAT-property-helper .pad-top-10{padding-top: 10px;}.jimu-widget-SAT-property-helper .pad-right-5{padding-right: 5px;}.jimu-rtl .jimu-widget-SAT-property-helper .pad-right-5{padding-left: 5px;}.jimu-widget-SAT-property-helper .commentTextArea{width: 100%;}.jimu-widget-SAT-property-helper .width-all{width: 100%;}.jimu-widget-SAT-property-helper .display-on{display: block;}.jimu-widget-SAT-property-helper .display-off{display: none;}.jimu-widget-SAT-property-helper .dijitSelectLabel {text-align: left; text-overflow: ellipsis; overflow: hidden; max-width: 153px;}@media screen and (max-width: 420px ) {.jimu-widget-SAT-property-helper .dijitSelectLabel {max-width: 133px;}}@media screen and (max-width: 400px ) {.jimu-widget-SAT-property-helper .dijitSelectLabel {max-width: 113px;}}@media screen and (max-width: 360px ) {.jimu-widget-SAT-property-helper .dijitSelectLabel {max-width: 105px;}}@media screen and (max-width: 320px) {.jimu-widget-SAT-property-helper .dijitSelectLabel {max-width: 87px;}}.jimu-widget-SAT-property-helper .hintText {font-size: 12px; color: #a0acbf; font-style: oblique;}.esriMobileInfoViewItem .esriAttributeInspector .esriCTAIDeleteButtonWidth {width: 60px !important; background-image: none !important;}.jimu-rtl .esriMobileInfoViewItem .esriAttributeInspector .atiDeleteButton {float: right;}.jimu-widget-SAT-ai .esriAttributeInspector .atiRichTextField{}.jimu-widget-SAT-ai .esriAttributeInspector div.dijitEditorIFrameContainer {height: 78px; width: 100%;}.jimu-widget-SAT-ai .esriAttributeInspector .dijitTextBox.dijitTextArea {height: 32px;}.jimu-widget-SAT-ai .esriAttributeInspector .atiButton {padding-top:2px; margin-right: 10px; display: inline-table; background-image: none;}.jimu-widget-SAT-ai .esriAttributeInspector .atiButtons {height:30px; width:100%; display:inline-block; width:100%;}.jimu-widget-SAT-ai .esriAttributeInspector {display:inline-block;}.jimu-widget-SAT-ai .esriAttributeInspector .dijitArrowButtonContainer {margin-top:0px; margin-right:0px; margin-bottom:0px; width:18px;}.jimu-widget-SAT-ai .esriAttributeInspector .atiNavButtons {display:none; visibility:hidden; height: 0px;}.jimu-widget-SAT-ai .esriPopup .spinner {display: none;}.DashboardTheme.light .jimu-widget-SAT .panelBottom {color: #000000 !important;}",
"*now":function(u){u(['dojo/i18n!*preload*widgets/SituationAwareness/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin dijit/form/Button jimu/BaseWidget jimu/dijit/Message jimu/utils jimu/accessibleUtils jimu/LayerInfos/LayerInfos jimu/portalUtils jimu/dijit/Report jimu/dijit/PageUtils dojo/_base/Color dojo/_base/html dojo/dom dojo/on dojo/dom-style dojo/dom-class dojo/dom-construct dojo/dom-attr dojo/dom-geometry dojo/_base/lang dojo/_base/array dojo/_base/xhr dojo/query dojo/json dojo/topic dojo/aspect dojo/Deferred dojo/DeferredList dojo/string dojo/colors esri/geometry/geometryEngine esri/geometry/Point esri/geometry/webMercatorUtils esri/tasks/ProjectParameters esri/geometry/jsonUtils esri/graphic esri/graphicsUtils esri/geometry/geodesicUtils esri/Color esri/layers/GraphicsLayer esri/layers/FeatureLayer esri/SpatialReference esri/symbols/Font esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/TextSymbol esri/tasks/locator esri/tasks/GeometryService esri/tasks/PrintTemplate esri/tasks/LegendLayer esri/toolbars/draw esri/dijit/AttributeInspector jimu/dijit/Popup esri/tasks/query esri/request esri/lang ./js/SummaryInfo ./js/GroupedCountInfo ./js/ClosestInfo ./js/ProximityInfo ./js/SnapShotUtils ./js/PropertyHelper ./js/analysisUtils dojo/keys esri/dijit/util/busyIndicator dojo/domReady!".split(" "),function(u,
r,t,v,n,k,g,d,l,q,x,b,a,m,f,c,e,h,B,E,w,z,F,G,D,C,S,I,K,H,y,Q,U,J,A,R,O,Z,Y,M,N,V,W,aa,L,T,X,ba,ca,ia,ja,ka,da,fa,la,ma,na,ga,oa,pa,qa,ra,ea,sa,ha,P,ta){return u([v,r],{baseClass:"jimu-widget-SAT",name:"IncidentAnalysis",opLayers:null,curTab:0,lyrBuffer:null,lyrIncidents:null,lyrClosest:null,lyrProximity:null,lyrSummary:null,lyrEdit:null,toolbar:null,tool:-1,symPoint:null,symLine:null,symPoly:null,symBuffer:null,symRoute:null,incidents:[],buffers:[],gsvc:null,locator:null,stops:[],initalLayerVisibility:{},
startX:0,mouseDown:!1,btnNodes:[],panelNodes:[],tabNodes:[],currentSumLayer:null,currentGrpLayer:null,mapBottom:null,mapResize:null,geomExtent:void 0,selectedGraphic:!1,honorTemplate:!1,Incident_Local_Storage_Key:"SAT_Incident",SLIDER_MAX_VALUE:1E4,isInitialLoad:!0,busyIndicator:null,postCreate:function(){this.inherited(arguments);this.nls=w.mixin(this.nls,window.jimuNls.units);this.nls=w.mixin(this.nls,window.jimuNls.common);this.widgetActive=this.openAtStartAysn=!0;window.localStorage.setItem(this.Incident_Local_Storage_Key,
null);B.set(this.closeButton,"aria-label",this.nls.close);this.own(f(this.domNode,"keydown",w.hitch(this,function(a){a.keyCode===P.ESCAPE&&(a.stopPropagation(),this.closeButton.focus())})));this.own(f(this.panelContainer,"keydown",w.hitch(this,function(a){a.keyCode===P.ESCAPE&&(a.stopPropagation(),G(".SATTab.active",this.domNode)[0].focus())})));this.own(f(this.closeButton,"keydown",w.hitch(this,function(a){if(a.keyCode===P.ENTER||a.keyCode===P.SPACE)a.stopPropagation(),this._close()})));k.has("chrome")&&
c.set(this.tabsNode,"position","absolute");this.div_reverse_geocoding&&a.setStyle(this.div_reverse_geocoding,"display","none")},postMixInProperties:function(){this.inherited(arguments);this.isRenderIdForAttrs=!0},startup:function(){this.inherited(arguments);this.updateTabs();this.btnNodes=[];this.panelNodes=[];this.tabNodes=[];this.reportSrc=this.folderUrl+"css/images/report.png";this.saveSrc=this.folderUrl+"css/images/save.png";this.downloadAllSrc=this.folderUrl+"css/images/download_all.png";this.snapshotSrc=
this.folderUrl+"css/images/snapshot.png";this.processingSrc=this.folderUrl+"css/images/processing.gif";this.editTemplate=this.config.editTemplate;this.saveEnabled=this.config.saveEnabled;this.summaryDisplayEnabled=this.config.summaryDisplayEnabled;this.busyIndicator=ta.create({target:this.domNode,backgroundOpacity:0});this.snapshotEnabled="undefined"!==typeof this.config.snapshotEnabled?this.config.snapshotEnabled:!1;this.reportEnabled="undefined"!==typeof this.config.reportEnabled?this.config.reportEnabled:
!1;this.allEnabled=this.saveEnabled&&this.snapshotEnabled&&this.reportEnabled;this.SLIDER_MAX_VALUE=parseFloat(this.config.bufferRange.maximum.toString().replace(/,/g,""),10);this.SLIDER_MIN_VALUE=parseFloat(this.config.bufferRange.minimum.toString().replace(/,/g,""),10);"undefined"===typeof this.config.bufferRange._default&&(this.config.bufferRange._default=this.config.bufferRange.minimum);this.SLIDER_DEFAULT_VALUE=parseFloat(this.config.bufferRange._default.toString().replace(/,/g,""),10);d.getInstance(this.map,
this.map.itemInfo).then(w.hitch(this,function(a){this.opLayers=a;this._initJimuLayerInfos();this._getStyleColor();this._createUI();this._loadUI();this._initLayers();this._verifyRouting();this._getAttributeTable();this._mapLoaded();setTimeout(w.hitch(this,function(){this.isInitialLoad=!1}),500)}))},_togglePopupClass:function(a){if(this.map.infoWindow&&this.map.infoWindow.domNode&&this.saveEnabled){var b=G(".contentPane",this.map.infoWindow.domNode)[0];b&&(a?e.add:e.remove)(b,"jimu-widget-SAT-ai")}},
updateTabs:function(){if(this.config&&this.config.tabs&&this.config.tabs.length)for(var a=this.config.tabs,b=0;b<a.length;b++){var c=a[b];c.type&&"weather"===c.type&&a.splice(b,1)}},onOpen:function(){this.inherited(arguments);this.widgetActive=!0;this.map.infoWindow.isShowing&&this.map.infoWindow.hide();this.setPosition();this.windowResize=f(window,"resize",w.hitch(this,this._resize));null===this.mapResize&&(this.mapResize=this.map.on("resize",w.hitch(this,this._mapResize)));this._mapResize();this.own(C.subscribe("changeMapPosition",
w.hitch(this,this._onMapPositionChange)));(this.disableVisibilityManagement="undefined"!==typeof this.config.disableVisibilityManagement?this.config.disableVisibilityManagement:!1)||this._storeInitalVisibility();this._checkHideContainer();this._initEditInfo();this._clickTab(0);this._updateCounts(!0);this._restoreIncidents();!this.isInitialLoad&&k.isAutoFocusFirstNodeWidget(this)&&k.focusFirstFocusNode(this.domNode)},_checkHideContainer:function(){this.hideContainer=!1;var a=this.map.infoWindow;a.popupInfoView&&
a.popupInfoView.container&&(this.hideContainer=!0,this.own(f(a,"show",w.hitch(this,this._handlePopup))))},onClose:function(){this._storeIncidents();this._toggleTabLayersOld();this._resetInfoWindow();this.mapResize&&(this.mapResize.remove(),this.mapResize=null);this.windowResize&&(this.windowResize.remove(),this.windowResize=null);this._clear(!0);this.widgetActive=!1;this.saveEnabled&&(this.scSignal.remove(),this.sfSignal.remove());this._mapResize();this.disableVisibilityManagement||this._resetInitalVisibility();
this.inherited(arguments);this._resetMapPosition();this._togglePopupClass(!1)},onDeActive:function(){this._clickIncidentsButton(-1)},destroy:function(){this._clear(!0);this._toggleTabLayersOld();this.lyrBuffer&&this.map.removeLayer(this.lyrBuffer);this.lyrIncidents&&this.map.removeLayer(this.lyrIncidents);this.lyrClosest&&this.map.removeLayer(this.lyrClosest);this.lyrProximity&&this.map.removeLayer(this.lyrProximity);this.lyrSummary&&this.map.removeLayer(this.lyrSummary);this.lyrGroupedSummary&&this.map.removeLayer(this.lyrGroupedSummary);
this.inherited(arguments)},onAppConfigChanged:function(a,b){switch(b){case "themeChange":case "layoutChange":case "styleChange":this._updateUI(a);break;case "widgetPoolChange":this._verifyRouting();break;case "mapChange":window.localStorage.setItem(this.Incident_Local_Storage_Key,null);break;case "attributeChange":this._updateUI(a)}},_handlePopup:function(){this._clearMobileSetAsIncidentStyle();var a=m.byId("main-page"),b,c,d;this.map.infoWindow.popupInfoView?(b=this.map.infoWindow.popupInfoView.container,
c=".mainSection { overflow-y: auto; height: "+(a.clientHeight-60).toString()+"px; }",d=".atiAttributes {overflow: auto; height: "+(a.clientHeight-130).toString()+"px; }"):(b=G("div.atiAttributes",this.map.infoWindow.domNode)[0],c=".mainSection { overflow-y: none; }",d=".atiAttributes {overflow: none; }");a.clientHeight&&b&&(a=document.createElement("style"),a.type="text/css",a.id="_tempMainSectionOverride",b.appendChild(a),a.sheet.insertRule(c,0),a.sheet.insertRule(d,1))},_updateUI:function(a){this._getStyleColor(a)},
_updateFontColor:function(a){"undefined"===typeof a&&(a=this.appConfig);a=h.create("div",{id:"tempTitle",innerHTML:a.title}).getElementsByTagName("font");this.config.fontColor=a&&0<a.length?/^#[0-9A-F]{6}$/i.test(a[0].color)?a[0].color:"#ffffff":"#ffffff";h.destroy("tempTitle");a=document.querySelectorAll(".panelBottom ");for(var b=0;b<a.length;b++)a[b].style.color=this.config.fontColor},_updateButtonBackgrounds:function(a,b){z.forEach(this.imgContainer.children,function(c){e.contains(c.children[0],
a?"btn32img":"btn32imgBlack")&&e.remove(c.children[0],a?"btn32img":"btn32imgBlack");e.add(c.children[0],a?"btn32imgBlack":"btn32img");e.contains(c.children[0],b?"darkThemeBackground":"lightThemeBackground")&&e.remove(c.children[0],b?"darkThemeBackground":"lightThemeBackground");e.add(c.children[0],b?"lightThemeBackground":"darkThemeBackground")});var c=this.allEnabled;z.forEach(this.saveOptions.children,function(d){c?z.forEach(d.children,function(c){e.contains(c.children[0],a?"btn32img":"btn32imgBlack")&&
e.remove(c.children[0],a?"btn32img":"btn32imgBlack");e.add(c.children[0],a?"btn32imgBlack":"btn32img");e.contains(c.children[0],b?"darkThemeBackground":"lightThemeBackground")&&e.remove(c.children[0],b?"darkThemeBackground":"lightThemeBackground");e.add(c.children[0],b?"lightThemeBackground":"darkThemeBackground")}):(e.contains(d.children[0],a?"btn32img":"btn32imgBlack")&&e.remove(d.children[0],a?"btn32img":"btn32imgBlack"),e.add(d.children[0],a?"btn32imgBlack":"btn32img"),e.contains(d.children[0],
b?"darkThemeBackground":"lightThemeBackground")&&e.remove(d.children[0],b?"darkThemeBackground":"lightThemeBackground"),e.add(d.children[0],b?"lightThemeBackground":"darkThemeBackground"))})},_getStyleColor:function(a){this._updateFontColor(a);setTimeout(w.hitch(this,function(){if(this.footerNode){var a=window.getComputedStyle(this.footerNode,null).getPropertyValue("background-color");this.config.activeMapGraphicColor=a;a=b.fromRgb(a);this.lightTheme=210>.2126*a.r+.7152*a.g+.0722*a.b?!1:!0;this.config.color=
a.toHex();this.isBlackTheme="#000000"===this.config.color?!0:!1;this._updateButtonBackgrounds(this.isBlackTheme,this.lightTheme);this.updateActiveNodes(this.lightTheme,!0);this.updateActiveNodes(this.lightTheme,!1);this.isBlackTheme?(e.remove(this.tabNodes[this.curTab],"active"),e.add(this.tabNodes[this.curTab],"activeBlack"),this.config.activeColor="rgb(53, 53, 53)"):(e.remove(this.tabNodes[this.curTab],"activeBlack"),e.add(this.tabNodes[this.curTab],"active"),this.config.activeColor="rgba(39, 39, 39, 0.3)");
this._setupSymbols();this.dataValue?this._drawIncident(this.dataValue,void 0,void 0,!0).then(w.hitch(this,function(){this.dataValue=void 0})):this._bufferIncident()}}),300)},updateActiveNodes:function(a,b){var c,d;b?(b=[".SATcolLocate",".SATcol",".SATcolRec",".borderCol",".SATcolSmall"],c="lightThemeBorder",d="darkThemeBorder"):(b=".btn32img .innerBL .innerBR .SA_panelClose .SA_panelRight .SA_panelLeft".split(" "),c="lightThemeBackground",d="darkThemeBackground");z.forEach(b,function(b){b=G(b);for(var f=
0;f<b.length;f++){var g=b[f];e.remove(g,a?d:c);e.add(g,a?c:d)}})},setPosition:function(b,c){this.widgetActive&&(c=window.jimuConfig.layoutId,"TabTheme"===this.appConfig.theme.name?this.position={left:this.widgetManager.getControllerWidgets()[0].domNode.clientWidth,right:0,bottom:24,height:155,relativeTo:"browser"}:"DashboardTheme"===this.appConfig.theme.name?(this.position={left:0,right:0,bottom:0,height:155},c=this.map.id):this.position={left:0,right:0,bottom:0,height:155,relativeTo:"browser"},b=
k.getPositionStyle(this.position),b.position="absolute",a.place(this.domNode,c),a.setStyle(this.domNode,b),this.started&&this.resize(),C.publish("changeMapPosition",{bottom:155}))},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},_setEventLocation:function(b){var c=b.feature?b.feature:this.map.infoWindow.getSelectedFeature();if(b&&"add"===b.type)c={eventType:"IncidentLocationAdd",dataValue:c},this.incidents=
[],this.buffers=[],this.lyrIncidents.clear(),this.lyrBuffer.clear();else{for(var d=!0,f,g=0;g<this.lyrIncidents.graphics.length;g++){var h=this.lyrIncidents.graphics[g];if(h.geometry.type===c.geometry.type){var k=!Q.equals(h.geometry,c.geometry);h.attributes&&c.attributes&&!k&&(k=k&&D.stringify(h.attributes)===D.stringify(c.attributes));d=d&&k;k||(f=h)}}c={eventType:d?"IncidentLocationAdd":"IncidentLocationRemove",dataValue:c,removeGraphic:f}}this.onReceiveData("","",c);this.map.infoWindow.isShowing&&
this.map.infoWindow.hide();b&&(b=this.map.infoWindow,b.popupNavigationBar&&(c=G(".esriMobileNavigationBar",b.popupNavigationBar.domNode),0<c.length&&a.setStyle(c[0],"display","none")),b.popupInfoView&&(c=G(".esriMobileInfoView",b.popupInfoView.domNode),0<c.length&&a.setStyle(c[0],"display","none")));e.remove(this.panelContainer,"loading")},_initLayers:function(){this.gsvc=new ia(this.config.geometryService&&this.config.geometryService.url?this.config.geometryService.url:this.appConfig.geometryService);
this.locator=new ca(this.config.geocodeService.url);this.own(f(this.locator,"location-to-address-complete",w.hitch(this,this._showIncidentAddress)));this.own(f(this.locator,"error",w.hitch(this,this._onAddressError)));this.lyrIncidents=new N;this.map.addLayer(this.lyrIncidents);this.lyrClosest=new N;this.lyrClosest.setVisibility(!1);this.map.addLayer(this.lyrClosest);this.lyrProximity=new N;this.lyrProximity.setVisibility(!1);this.map.addLayer(this.lyrProximity);this.summaryDisplayEnabled&&(this.lyrSummary=
new N,this.lyrSummary.setVisibility(!1),this.map.addLayer(this.lyrSummary),this.lyrGroupedSummary=new N,this.lyrGroupedSummary.setVisibility(!1),this.map.addLayer(this.lyrGroupedSummary));this.lyrBuffer=new N;this.map.addLayer(this.lyrBuffer)},_mapLoaded:function(){G("[data-reference]").style("z-index",0);this._processOperationalLayers();this.saveEnabled&&this._initEdit();var a=this.map.itemInfo.itemData.baseMap.baseMapLayers[0];"ArcGISTiledMapServiceLayer"===a.layerType&&a.resourceInfo.singleFusedMapCache||
(this.config.defaultZoomLevel=.5);this._clickTab(0)},_initEdit:function(){var a=this.map.infoWindow;this.config.saveEnabled&&"undefined"===typeof this.config.savePolys&&"undefined"===typeof this.config.saveLines&&"undefined"===typeof this.config.savePoints&&(this.config.savePolys=!0,this.config.polyEditLayer=this.config.editLayer,this.polyTemplate=this.config.editTemplate,this.honorTemplate=!0);this.config.savePoints&&this._initEditLayer(this.config.pointEditLayer,"point");this.config.saveLines&&
this._initEditLayer(this.config.lineEditLayer,"line");this.config.savePolys&&this._initEditLayer(this.config.polyEditLayer,"poly");this.scSignal=f(a,"selection-change",w.hitch(this,this._selectionChanged));this.sfSignal=f(a,"set-features",w.hitch(this,this._setPopupFeature));var b=G(".esriPopupWrapper",a.domNode);0<b.length&&"undefined"!==typeof b[0].clientHeight&&"undefined"!==typeof b[0].clientWidth&&(this.defaultPopupSize={width:b[0].clientWidth});a.highlight=!0},_getLayerIDs:function(){var a=
[];z.forEach(this.opLayers._layerInfos,w.hitch(this,function(b){0<b.newSubLayers.length?this._recurseLayersIDs(b.newSubLayers,a):a.push({id:b.id,title:b.title})}));return a},_recurseLayersIDs:function(a,b){z.forEach(a,w.hitch(this,function(a){0<a.newSubLayers.length?this._recurseLayersIDs(a.newSubLayers,b):b.push({id:a.id,title:a.title})}))},_initJimuLayerInfos:function(){if(this.config&&this.config.tabs&&this.config.tabs.length){for(var a=this.config.tabs,b=[],c=this._getLayerIDs(),d=a.length-1;0<=
d;d--){var e=a[d],f=e.layerTitle?e.layerTitle:e.layers;if(e.layers&&(e.jimuLayerInfo=this.opLayers.getLayerInfoById(e.layers),!e.jimuLayerInfo)){if(c&&c.hasOwnProperty("length")&&0<c.length){var g=0;a:for(;g<c.length;g++){var k=c[g];if(k&&k.hasOwnProperty("title")&&k.title===f){e.jimuLayerInfo=this.opLayers.getLayerInfoById(k.id);break a}}}e.jimuLayerInfo||(this.config.tabs.splice(d,1),b.push(f))}}if(0<b.length){var l="";z.forEach(b,w.hitch(this,function(a){l+=ga.substitute({name:a},this.nls.missingLayer)+
"\x3c/br\x3e\x3c/br\x3e"}));a=h.create("div",{style:"max-height:500px;overflow:auto;"});h.create("div",{className:"SAT-warning-hint",innerHTML:this.nls.missingLayerHint},a);h.create("div",{innerHTML:l.substr(0,l.lastIndexOf("\x3c/br\x3e\x3c/br\x3e")),style:"padding-"+(window.isRTL?"right":"left")+": 10px;"},a);new n({titleLabel:"\x3cdiv class\x3d'SAT-warning-icon' style\x3d'float: "+(window.isRTL?"right; margin-left":"left; margin-right")+": 10px;'\x3e\x3c/div\x3e"+this.nls.layerNotAvalible,message:a,
maxWidth:350})}}},_initEditLayer:function(a,b){var c;"point"===b?(this.pointEditLayer=this.opLayers.getLayerInfoById(a).layerObject,this.isPointEditable=this._isEditable(this.pointEditLayer),c=this.pointEditLayer,c.templates&&0<c.templates.length?this.pointTemplate=c.templates[0]:c.types&&0<c.types.length&&(this.pointTemplate=c.types[0].templates[0]),this.pointTemplate&&(this.pointEditLayerPrototype=this.pointTemplate.prototype)):"line"===b?(this.lineEditLayer=this.opLayers.getLayerInfoById(a).layerObject,
this.isLineEditable=this._isEditable(this.lineEditLayer),c=this.lineEditLayer,c.templates&&0<c.templates.length?this.lineTemplate=c.templates[0]:c.types&&0<c.types.length&&(this.lineTemplate=c.types[0].templates[0]),this.lineTemplate&&(this.lineEditLayerPrototype=this.lineTemplate.prototype)):"poly"===b&&(this.polyEditLayer=this.opLayers.getLayerInfoById(a).layerObject,this.isPolyEditable=this._isEditable(this.polyEditLayer),c=this.polyEditLayer,this.honorTemplate||(c.templates&&0<c.templates.length?
this.polyTemplate=c.templates[0]:c.types&&0<c.types.length&&(this.polyTemplate=c.types[0].templates[0])),this.polyTemplate&&(this.polyEditLayerPrototype=this.polyTemplate.prototype));c&&this.own(f(c,"click",w.hitch(this,function(a){if(a.graphic)switch(a=a.graphic,a.geometry.type){case "point":this.pointUpdateFeature=a;break;case "polyline":this.lineUpdateFeature=a;break;case "polygon":this.polyUpdateFeature=a}})))},_isEditable:function(a){var b=!1;a.isEditable()&&a.getEditCapabilities&&(b=a.getEditCapabilities());
return b&&b.canUpdate&&b.canCreate},_initEditInfo:function(){if(this.saveEnabled){var a=!1;this.polyEditLayer&&this.isPolyEditable&&(a=!0,this.defaultPolyContent=this.polyEditLayer.infoTemplate?this.polyEditLayer.infoTemplate.content:void 0,this.polyEditLayer.infoTemplate.setContent(w.hitch(this,this._setEditLayerPopup)));this.lineEditLayer&&this.isLineEditable&&(a=!0,this.defaultLineContent=this.lineEditLayer.infoTemplate?this.lineEditLayer.infoTemplate.content:void 0,this.lineEditLayer.infoTemplate.setContent(w.hitch(this,
this._setEditLayerPopup)));this.pointEditLayer&&this.isPointEditable&&(a=!0,this.defaultPointContent=this.pointEditLayer.infoTemplate?this.pointEditLayer.infoTemplate.content:void 0,this.pointEditLayer.infoTemplate.setContent(w.hitch(this,this._setEditLayerPopup)));a&&this.map.infoWindow.resize(350,340)}},_setPopupFeature:function(){if(0<this.map.infoWindow.count){var a=this.map.infoWindow.getSelectedFeature();switch(a.geometry.type){case "point":this.pointUpdateFeature=a;break;case "polyline":this.lineUpdateFeature=
a;break;case "poly":this.polyUpdateFeature=a}}},_selectionChanged:function(){if(0<this.map.infoWindow.count){var a=this.map.infoWindow.getSelectedFeature();switch(a.geometry.type){case "point":this.pointUpdateFeature=a;break;case "polyline":this.lineUpdateFeature=a;break;case "poly":this.polyUpdateFeature=a}}},_setEditLayerPopup:function(a){var b;"polygon"===a.geometry.type&&(b=this.polyEditLayer);"polyline"===a.geometry.type&&(b=this.lineEditLayer);"point"===a.geometry.type&&(b=this.pointEditLayer);
for(var c=[],d=this._getPopupFields(b),g=0;g<d.length;g++){var l=d[g];l.isEditable&&l.isEditableOnLayer&&c.push({fieldName:l.fieldName,isEditable:l.isEditable})}this.attInspector=new fa({layerInfos:[{featureLayer:b,showAttachments:!1,isEditable:!0,fieldInfos:c}]},h.create("div"));c=new t({label:this.nls.update_btn,"class":"atiButton"},h.create("div"));h.place(c.domNode,this.attInspector.deleteBtn.domNode.parentNode);this._togglePopupClass(!0);k.isMobileUa()&&(d=G(".esriMobileInfoViewItem .esriAttributeInspector .atiDeleteButton"))&&
0<d.length&&e.add(this.attInspector.deleteBtn.domNode,"esriCTAIDeleteButtonWidth");this.own(f(c,"click",w.hitch(this,function(){b.applyEdits(null,[a],null,w.hitch(this,function(){this.map.infoWindow.hide();setTimeout(w.hitch(this,function(){this.saveButton.focus()}),100)}),function(a){var b="Error";"undefined"!==typeof a.details&&(b=a.details);"undefined"!==typeof a.message&&(b=a.message);new n({message:b})})})));this.own(f(this.attInspector,"attribute-change",w.hitch(this,function(a){switch(a.feature.geometry.type){case "point":this.pointUpdateFeature=
a.feature;this.pointUpdateFeature.attributes[a.fieldName]=a.fieldValue;break;case "polyline":this.lineUpdateFeature=a.feature;this.lineUpdateFeature.attributes[a.fieldName]=a.fieldValue;break;case "polygon":this.polyUpdateFeature=a.feature,this.polyUpdateFeature.attributes[a.fieldName]=a.fieldValue}})));this.own(f(this.attInspector,"next",w.hitch(this,function(a){switch(a.feature.geometry.type){case "point":this.pointUpdateFeature=a.feature;break;case "polyline":this.pointUpdateFeature=a.feature;
break;case "poly":this.pointUpdateFeature=a.feature}})));this.own(f(this.attInspector,"delete",w.hitch(this,function(a){var c=!1;if(0<this.incidents.length){for(var d=0;d<this.incidents.length;d++)Q.equals(a.feature.geometry,this.incidents[d].geometry)&&(c=!0);if(!c&&0<this.lyrBuffer.graphics.length)for(d=0;d<length;d++)Q.equals(a.feature.geometry,this.lyrBuffer.graphics[d].geometry)&&(c=!0)}b.applyEdits(null,null,[a.feature],function(){},function(a){var b="Error";"undefined"!==typeof a.details&&
(b=a.details);"undefined"!==typeof a.message&&(b=a.message);new n({message:b})});this.pointEditLayer&&(this.pointUpdateFeature=this.pointEditLayerPrototype);this.lineEditLayer&&(this.lineUpdateFeature=this.lineEditLayerPrototype);this.polyEditLayer&&(this.polyUpdateFeature=this.polyEditLayerPrototype);c&&this._clear(!1);this.map.infoWindow.hide();setTimeout(w.hitch(this,function(){k.focusFirstFocusNode(this.domNode)}),100)})));switch(a.geometry.type){case "point":this.pointUpdateFeature=a;break;case "polyline":this.lineUpdateFeature=
a;break;case "polygon":this.polyUpdateFeature=a}this.attInspector.showFeature(a);return this.attInspector.domNode},_getPopupFields:function(a){var b;if(a.infoTemplate)b=a.infoTemplate.info.fieldInfos;else if(-1<this.tab.tabLayers[0].url.indexOf("MapServer")){var c=this.tab.tabLayers[0].url.split("MapServer/")[1],d=this.parent.map.itemInfo.itemData.operationalLayers;b=null;for(var e=0;e<d.length;e++){var f=d[e];if(f.layerObject.infoTemplates&&(f=f.layerObject.infoTemplates[c])){b=f.infoTemplate.info.fieldInfos;
break}}}else b=a.fields;b||(b=a.fields);return b},_updatePopup:function(a,b,c){b=[];for(c=0;c<a.length;c++){var d=a[c],e=new ma;e.objectIds=[d.oid];b.push(d.layer.selectFeatures(e,V.SELECTION_NEW))}(new K(b)).then(w.hitch(this,function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];if(d[0]){d=d[1][0];b.push(d);switch(d.geometry.type){case "point":this.pointUpdateFeature=d;break;case "polyline":this.lineUpdateFeature=d;break;case "poly":this.polyUpdateFeature=d}this.attInspector||this._setEditLayerPopup(d);
this.attInspector&&this.attInspector.showFeature(d)}}}))},_processOperationalLayers:function(){for(var a=0;a<this.config.tabs.length;a++){var b=this.config.tabs[a];b.layers&&""!==b.layers&&(this.hasLayerTitle="undefined"!==typeof b.layerTitle,b.tabLayers=this._getTabLayers(b.layers))}},_goToNextTab:function(a,b){var c;if(a.keyCode===P.LEFT_ARROW||a.shiftKey&&a.keyCode===P.TAB)b=0===b?this.tabNodes.length-1:b-1;else if(a.keyCode===P.RIGHT_ARROW||a.keyCode===P.TAB)b=b===this.tabNodes.length-1?0:b+1;
else return;c=G("div[tabNum\x3d"+b+"]",this.domNode)[0];e.contains(c,"noFeaturesActive")&&(c=this._goToNextTab(a,b));return c},_createUI:function(){var a=k.stripHTML(this.config.bufferLabel?this.config.bufferLabel:"");this.buffer_lbl.innerHTML=a;this.buffer_lbl_unit.innerHTML=this.nls[this.config.distanceUnits];this.spinnerValue.isRenderIdForAttrs=!0;this.spinnerValue.constraints={min:this.SLIDER_MIN_VALUE,max:this.SLIDER_MAX_VALUE};this.spinnerValue.intermediateChanges=!0;a=ga.substitute({min:this.SLIDER_MIN_VALUE,
max:this.SLIDER_MAX_VALUE},this.nls.buffer_invalid);this.spinnerValue.invalidMessage=a;this.spinnerValue.rangeMessage=a;this.spinnerValue.set("value",this.SLIDER_DEFAULT_VALUE);this.locateIncident.innerHTML="undefined"!==typeof this.config.locateIncidentLabel?this.config.locateIncidentLabel:this.nls.locate_incident;this.config.tabs.splice(0,0,{type:"incidents",label:"undefined"!==typeof this.config.incidentLabel?this.config.incidentLabel:this.nls.incident,color:this.config.color});this.panelNodes.push(this.SA_tabPanel0);
for(var b=this.panelContainer,a=this.tabsNode,d=0,g=0;g<this.config.tabs.length;g++){var l=this.config.tabs[g],m=l.label;m&&""!==m||(m=l.layerTitle?l.layerTitle:l.layers);m=h.create("div",{"data-dojo-attach-point":"SA_tab"+g,tabindex:"0",tabNum:g,role:"tab","aria-label":k.stripHTML(m?m:""),"aria-selected":"false",innerHTML:k.stripHTML(m?m:"")},a);this.tabNodes.push(m);e.add(m,"SATTab");d+=E.position(m).w;f(m,"click",w.hitch(this,this._clickTab,g));f(m,"keydown",w.hitch(this,function(a){var b;b=parseInt(B.get(a.currentTarget,
"tabNum"),10);a.keyCode===P.TAB?(a.preventDefault(),a=this._goToNextTab(a,b),a.focus()):a.keyCode===P.LEFT_ARROW||a.keyCode===P.RIGHT_ARROW?(a=this._goToNextTab(a,b),a.focus()):a.keyCode===P.ENTER||a.keyCode===P.SPACE?(this._clickTab(parseInt(B.get(a.currentTarget,"tabNum"),10)),"0"===B.get(a.currentTarget,"tabNum")&&setTimeout(w.hitch(this,function(){this.clearIncident.focus()}),100)):a.keyCode===P.ESCAPE&&(this.closeButton.focus(),a.stopPropagation())}));0<g&&(m=h.create("div",{"data-dojo-attach-point":"SA_tabPanel"+
g,role:"tabpanel",innerHTML:""},b),this.panelNodes.push(m),f(this.panelNodes[g],"keydown",w.hitch(this,function(a){a.keyCode===P.ESCAPE&&(z.forEach(this.tabNodes,w.hitch(this,function(a){e.contains(a,"active")&&a.focus()})),a.stopPropagation(),a.cancelBubble=!0)})),e.add(m,"SAT_tabPanel"),"summary"===l.type&&(l.summaryInfo=new oa(l,m,this),this.own(f(l.summaryInfo,"summary-complete",w.hitch(this,this.restore)))),"groupedSummary"===l.type&&(l.groupedSummaryInfo=new pa(l,m,this),this.own(f(l.groupedSummaryInfo,
"summary-complete",w.hitch(this,this.restore)))),"closest"===l.type&&(l.closestInfo=new qa(l,m,this)),"proximity"===l.type&&(l.proximityInfo=new ra(l,m,this)))}d+=10;c.set(a,"width",d+"px");d>E.position(this.footerNode).w&&(b=this.footerContentNode,window.isRTL?(c.set(b,"left","58px"),c.set(this.panelLeft,"display","block"),c.set(this.panelRight,"display","none")):(c.set(b,"right","58px"),c.set(this.panelRight,"display","block")));f(a,"scroll",w.hitch(this,this._onPanelScroll));this.own(f(this.clearIncident,
"keydown",w.hitch(this,function(a){if(a.keyCode===P.ENTER||a.keyCode===P.SPACE)this._clear(),this.SA_btn0.focus(),this._getLastNodeForEachTab(0)})))},restore:function(a){a.tab===this.curTab&&this._clickTab(a.tab)},validateSavePrivileges:function(){var a=new I;l.getPortal(this.appConfig.portalUrl).getUser().then(w.hitch(this,function(b){b&&b.privileges?a.resolve(-1<b.privileges.indexOf("features:user:edit")?!0:!1):a.resolve(!0)}),w.hitch(this,function(b){console.log(b);a.resolve(!0)}));return a},validateSnapshotPrivileges:function(){var a=
new I;l.getPortal(this.appConfig.portalUrl).getUser().then(w.hitch(this,function(b){b&&b.privileges?a.resolve(-1<b.privileges.indexOf("portal:publisher:publishFeatures")&&-1<b.privileges.indexOf("portal:user:createItem")?!0:!1):a.resolve(!1)}),w.hitch(this,function(b){console.log(b);a.resolve(!1)}));return a},_loadUI:function(){var b=this.allEnabled?h.create("div",{"class":"displayT pad-top-5"},this.saveOptions):this.saveOptions,d=this.allEnabled?h.create("div",{"class":"displayT pad-top-10"},this.saveOptions):
this.saveOptions,e=this.allEnabled?"displayTC":"displayTR";this.reportEnabled&&(this.createReportButtonSpan=h.create("span",{"class":"btn32 "+e},b),this.createReportButton=h.create("div",{"class":"btn32img",title:this.nls.createReport,"aria-label":this.nls.createReport,tabindex:"0",role:"button"},this.createReportButtonSpan),c.set(this.createReportButton,"backgroundImage","url("+this.reportSrc+")"),this.own(f(this.createReportButton,"click",w.hitch(this,this._createReport))),this.own(f(this.createReportButton,
"keydown",w.hitch(this,function(a){a.keyCode!==P.ENTER&&a.keyCode!==P.SPACE||this._createReport()}))));this.saveEnabled&&(this.saveButtonSpan=h.create("span",{"class":"btn32 "+e},b),this.validateSavePrivileges().then(w.hitch(this,function(a){this.userCanSave=a;this.saveButton=h.create("div",{"class":a?"btn32img":"btn32img btnDisabled",title:a?this.nls.saveIncident:this.nls.user_credentials,"aria-label":a?this.nls.saveIncident:this.nls.user_credentials,tabindex:"0",role:"button"},this.saveButtonSpan);
c.set(this.saveButton,"backgroundImage","url("+this.saveSrc+")");a&&(this.own(f(this.saveButton,"click",w.hitch(this,this._saveIncident))),this.own(f(this.saveButton,"keydown",w.hitch(this,function(a){a.keyCode!==P.ENTER&&a.keyCode!==P.SPACE||this._saveIncident()}))))}),function(a){console.log(a)}));b=h.create("span",{"class":"btn32 "+e},d);this.downloadAllButon=h.create("div",{"class":"btn32img",title:this.nls.downloadAll,"aria-label":this.nls.downloadAll,tabindex:"0",role:"button"},b);c.set(this.downloadAllButon,
"backgroundImage","url("+this.downloadAllSrc+")");this.own(f(this.downloadAllButon,"click",w.hitch(this,this._downloadAll)));this.own(f(this.downloadAllButon,"keydown",w.hitch(this,function(a){a.keyCode!==P.ENTER&&a.keyCode!==P.SPACE||this._downloadAll()})));this.snapshotEnabled&&(this.createSnapshotButtonSpan=h.create("span",{"class":"btn32 "+e},d),this.validateSnapshotPrivileges().then(w.hitch(this,function(a){this.userCanSnapshot=a;this.createSnapshotButton=h.create("div",{"class":a?"btn32img":
"btn32img btnDisabled",title:a?this.nls.createSnapshot:this.nls.user_credentials,"aria-label":a?this.nls.createSnapshot:this.nls.user_credentials,tabindex:"0",role:"button"},this.createSnapshotButtonSpan);c.set(this.createSnapshotButton,"backgroundImage","url("+this.snapshotSrc+")");a&&(this.own(f(this.createSnapshotButton,"click",w.hitch(this,this._createSnapshot))),this.own(f(this.createSnapshotButton,"keydown",w.hitch(this,function(a){a.keyCode!==P.ENTER&&a.keyCode!==P.SPACE||this._createSnapshot()}))))}),
function(a){console.log(a)}));d={0:this.nls.drawPoint,1:this.nls.drawLine,2:this.nls.drawPolygon};this.btnNodes=[this.SA_btn0,this.SA_btn1,this.SA_btn2];for(e=0;3>e;e++)b=this.btnNodes[e],c.set(b,"backgroundImage","url("+this.folderUrl+"images/btn"+e+".png)"),a.setAttr(b,"title",d[e]),a.setAttr(b,"aria-label",d[e]),a.setAttr(b,"toolNum",e),a.setAttr(b,"aria-pressed","false"),this.own(f(b,"click",w.hitch(this,this._clickIncidentsButton,e))),this.own(f(b,"keydown",w.hitch(this,function(a){a.keyCode!==
P.ENTER&&a.keyCode!==P.SPACE||this._clickIncidentsButton(parseInt(B.get(a.currentTarget,"toolNum"),10))})));this.toolbar=new da(this.map,{tooltipOffset:20,drawTime:90});this.toolbar.on("draw-complete",w.hitch(this,this._drawIncident));this.own(f(this.spinnerValue,"change",w.hitch(this,function(){this._updateSpinnerValue(!1)})));this.own(f(this.spinnerValue,"blur",w.hitch(this,function(){this._updateSpinnerValue(!0)})));this.own(f(this.spinnerValue,"keyup",w.hitch(this,function(a){a.keyCode===P.ENTER?
this._updateSpinnerValue(!0):this._updateSpinnerValue(!1)})))},_locateBuffer:function(a){if(null!==a&&(a="extent"===a.type?a:a.getExtent(),null!==a)){a=a.expand(1.5);var b=80/this.map.height,c=a.getHeight();a.update(a.xmin,a.ymin-c*b,a.xmax,a.ymax-c*b,this.map.spatialReference);this.map.setExtent(a,!0)}},_clickIncidentsButton:function(b){var c;if(3>b){for(var d=0;3>d;d++)c=this.btnNodes[d],e.remove(c,"btnOn"),a.setAttr(c,"aria-pressed","false");-1<b&&b!==this.tool?(c=this.btnNodes[b],3>b&&(e.add(c,
"btnOn"),a.setAttr(c,"aria-pressed","true")),this.tool=b):this.tool=-1;switch(this.tool){case -1:this.toolbar.deactivate();this.enableWebMapPopup();break;case 0:this._clear(!1);this.toolbar.activate(da.POINT);this.disableWebMapPopup();break;case 1:this._clear(!1);this.toolbar.activate(da.POLYLINE);this.disableWebMapPopup();break;case 2:this._clear(!1),this.toolbar.activate(da.POLYGON),this.disableWebMapPopup()}}else this._clear(!0)},_saveIncident:function(){this.map.infoWindow.hide();this._updateProcessing(this.saveButton,
!0,this.saveSrc);var a=[];this.config.saveEnabled&&"undefined"===typeof this.config.savePolys&&"undefined"===typeof this.config.saveLines&&"undefined"===typeof this.config.savePoints&&(this.config.savePolys=!0);if(this.config.savePolys){var b=this._getIncidentGraphics("polygon",this.polyEditLayerPrototype);0<b.length&&a.push({layer:this.polyEditLayer,graphics:b})}this.config.saveLines&&(b=this._getIncidentGraphics("polyline",this.lineEditLayerPrototype),0<b.length&&a.push({layer:this.lineEditLayer,
graphics:b}));this.config.savePoints&&(b=this._getIncidentGraphics("point",this.pointEditLayerPrototype),0<b.length&&a.push({layer:this.pointEditLayer,graphics:b}));0<a.length?this._applyEdits(a):this._updateProcessing(this.saveButton,!1,this.saveSrc);this._clickIncidentsButton(-1)},_getIncidentGraphics:function(a,b){var c=[];b=D.parse(D.stringify(b));if("polygon"===a)for(var d=0;d<this.lyrBuffer.graphics.length;d++){var e=this.lyrBuffer.graphics[d],f=new O;f.geometry=e.geometry;f.setAttributes(b.attributes);
c.push(f)}for(d=0;d<this.incidents.length;d++)e=this.incidents[d],e.geometry.type===a&&(f=new O,f.geometry=e.geometry,f.setAttributes(b.attributes),c.push(f));return c},_applyEdits:function(a){for(var b=new I,c=[],d=[],e=0;e<a.length;e++){var f=a[e];f.layer.visible||f.layer.setVisibility(!0);var g=[];if(1<f.graphics.length&&"polygon"===f.graphics[0].geometry.type){var h=f.graphics[0],k=f.graphics.map(function(a){return a.geometry});if(k=Q.union(k))h.geometry=k,g.push(h)}c.push(f.layer.applyEdits(0<
g.length?g:f.graphics,null,null))}(new K(c)).then(w.hitch(this,function(c){for(var e=!1,f="",g=0;g<c.length;g++)f=c[g][1][0],f.success?(e=!0,f.hasOwnProperty("objectId")&&d.push({oid:f.objectId,layer:a[g].layer})):(f=c[g][1][0].error.message,new n({title:this.nls.saveIncident,message:this.nls.saveIncidentErrorMessage+f}));this._smartEdit();if(!this.map.infoWindow.isShowing){c=this.incidents[0].geometry;var h;switch(c.type){case "point":h=c;break;case "polyline":h=c.paths[0][parseInt(c.paths[0].length/
2,10)];h=new U(h[0],h[1],c.spatialReference);break;case "polygon":h=c.getCentroid()}c=this.map.toScreen(h);0<d.length&&this._updatePopup(d,h,c);this._updateProcessing(this.saveButton,!1,this.saveSrc);this.map.emit("click",{bubbles:!0,cancelable:!0,screenPoint:c,mapPoint:h})}b.resolve(e)}),w.hitch(this,function(a){console.error(a);this._updateProcessing(this.saveButton,!1,this.saveSrc);new n({message:a});b.reject(a)}));return b},_smartEdit:function(){if(!this.smartEditor){var a=this.appConfig.getConfigElementsByName("SmartEditor");
z.forEach(a,w.hitch(this,function(a){"SmartEditor"===a.name&&(this.smartEditor=this.widgetManager.getWidgetById(a.id))}))}this.smartEditor&&this.smartEditor.state&&"opened"===this.smartEditor.state&&this.smartEditor._mapClickHandler(!0)},_clear:function(b){this.map.graphics.clear();this.lyrIncidents.clear();this.lyrBuffer.clear();this.lyrProximity.clear();this.lyrClosest.clear();this.geomExtent=void 0;this.summaryDisplayEnabled&&this.lyrSummary&&this.lyrSummary.clear();this.summaryDisplayEnabled&&
this.lyrGroupedSummary&&this.lyrGroupedSummary.clear();this.saveOptions&&(e.remove(this.saveOptions,"displayT"),e.add(this.saveOptions,"display-off"));this.borderCol&&(e.remove(this.borderCol,"display-on"),e.add(this.borderCol,"display-off"));this.clearIncident&&(e.remove(this.clearIncident,"display-on"),e.add(this.clearIncident,"display-off"));this.smartEditor&&this.smartEditor._onCancelButtonClicked();this.incidents=[];this.buffers=[];this.div_reversed_address&&(this.div_reversed_address.innerHTML=
"");this.div_reverse_geocoding&&a.setStyle(this.div_reverse_geocoding,"display","none");this._updateCounts(!0);this._clearGraphics();b&&this.spinnerValue&&this.spinnerValue.set("value",this.SLIDER_DEFAULT_VALUE);this.pointEditLayer&&(this.pointUpdateFeature=this.pointEditLayerPrototype);this.lineEditLayer&&(this.lineUpdateFeature=this.lineEditLayerPrototype);this.polyEditLayer&&(this.polyUpdateFeature=this.polyEditLayerPrototype);this._clearMobileSetAsIncidentStyle()},_clearMobileSetAsIncidentStyle:function(){h.destroy(m.byId("_tempMainSectionOverride"))},
_updateSpinnerValue:function(a){if(this.spinnerValue.validate()){var b=this.spinnerValue.displayedValue;"string"===typeof b&&(b=parseFloat(b.toString().replace(/,/g,""),10));b<this.SLIDER_MIN_VALUE?this.spinnerValue.set("value",this.SLIDER_MIN_VALUE):b>this.SLIDER_MAX_VALUE&&this.spinnerValue.set("value",this.SLIDER_MAX_VALUE);a&&this._bufferIncident()}},_clickTab:function(a){this._validateFeatureCount(a)&&(B.set(this.tabNodes[a],"aria-selected","true"),z.forEach(this.tabNodes,w.hitch(this,function(b,
c){a!==c&&B.set(b,"aria-selected","false")})),this._toggleTabs(a),this._toggleTabLayers(a),this.curTab=a,this._clickIncidentsButton(-1),setTimeout(w.hitch(this,function(){this._getLastNodeForEachTab(a)}),100))},_getLastNodeForEachTab:function(a){var b=this._getLastFocusNodeInDom(a);b&&(0===a&&(e.contains(this.clearIncident,"display-off")?k.initFirstFocusNode(this.domNode,this.SA_btn0):k.initFirstFocusNode(this.domNode,this.clearIncident)),k.initLastFocusNode(this.domNode,b.domNode?b.domNode:b))},
_getLastFocusNodeInDom:function(a){if(0===a)return this._getLastFocusNodeInIncidentTab()},_getLastFocusNodeInIncidentTab:function(){var a;e.contains(this.saveOptions,"display-off")||(this.config.snapshotEnabled&&this.createSnapshotButton&&!e.contains(this.createSnapshotButton,"btnDisabled")&&(a=this.createSnapshotButton),a||!this.downloadAllButon||e.contains(this.downloadAllButon,"btnDisabled")||(a=this.downloadAllButon),!a&&this.config.saveEnabled&&this.saveButton&&!e.contains(this.saveButton,"btnDisabled")&&
(a=this.saveButton),!a&&this.config.reportEnabled&&this.createReportButton&&!e.contains(this.createReportButton,"btnDisabled")&&(a=this.createReportButton));!a&&this.spinnerValue&&(a=this.spinnerValue);return a},_validateFeatureCount:function(a){var b=!0;a=this.config.tabs[a];switch(a.type){case "summary":b=0<a.summaryInfo.featureCount;break;case "groupedSummary":b=0<a.groupedSummaryInfo.featureCount;break;case "closest":b=0<a.closestInfo.featureCount;break;case "proximity":b=0<a.proximityInfo.featureCount}return b},
_toggleTabs:function(a){for(var b=0;b<this.config.tabs.length;b++)b===a?(e.add(this.tabNodes[b],this.isBlackTheme?"activeBlack":"active"),c.set(this.panelNodes[b],"display","block")):(e.remove(this.tabNodes[b],"active"),e.remove(this.tabNodes[b],"activeBlack"),c.set(this.panelNodes[b],"display","none"));this._scrollToTab(a)},_toggleTabLayers:function(a){this._toggleTabLayersOld();this._toggleTabLayersNew(a)},_toggleTabLayersOld:function(){var a=this.config.tabs[this.curTab];a&&(this.lyrClosest.setVisibility(!1),
this.lyrProximity.setVisibility(!1),this.lyrSummary&&this.lyrSummary.setVisibility(!1),this.lyrGroupedSummary&&this.lyrGroupedSummary.setVisibility(!1),this._setLayerVisible(a,!1))},_toggleTabLayersNew:function(a){var b=this.config.tabs[a];switch(b.type){case "summary":var c=!1;this.lyrSummary&&(this.currentSumLayer!==a&&(c=!0),this.lyrSummary.clear());b.tabLayers&&1<b.tabLayers.length&&(this.lyrSummary&&(this.lyrSummary.infoTemplate=b.tabLayers[1].infoTemplate,z.forEach(b.tabLayers[1].graphics,w.hitch(this,
function(a){this.lyrSummary.add(a)})),b.tabLayers[0]&&b.tabLayers[0].hasOwnProperty("opacity")&&this.lyrSummary.setOpacity(b.tabLayers[0].opacity),this.lyrSummary.setVisibility(!0)),c&&(this.currentSumLayer=a,this._toggleTabLayersNew(a)));0<this.incidents.length&&!0===b.updateFlag?(b.summaryInfo.updateForIncident(this.incidents,this.buffers,this.summaryDisplayEnabled?this.lyrSummary:null,a),this.currentSumLayer=a):(a=G(".summaryDownLoadCSVButton",this.domNode))&&0<a.length&&(a[0].focus(),k.initFirstFocusNode(this.domNode,
a[0]),k.initLastFocusNode(this.domNode,a[0]));break;case "groupedSummary":this.lyrGroupedSummary&&(this.currentSumLayer!==a&&(c=!0),this.lyrGroupedSummary.clear());b.tabLayers&&1<b.tabLayers.length&&(this.lyrGroupedSummary&&(this.lyrGroupedSummary.infoTemplate=b.tabLayers[1].infoTemplate,z.forEach(b.tabLayers[1].graphics,w.hitch(this,function(a){this.lyrGroupedSummary.add(a)})),this.lyrGroupedSummary.setVisibility(!0)),c&&(this.currentSumLayer=a,this._toggleTabLayersNew(a)));0<this.incidents.length&&
!0===b.updateFlag?(b.groupedSummaryInfo.updateForIncident(this.incidents,this.buffers,this.summaryDisplayEnabled?this.lyrGroupedSummary:null,a),this.currentGrpLayer=a):(a=G(".grpSummaryDownLoadCSVButton",this.domNode))&&0<a.length&&(a[0].focus(),k.initFirstFocusNode(this.domNode,a[0]),k.initLastFocusNode(this.domNode,a[0]));break;case "closest":this._setLayerVisible(b,!0);this.lyrClosest.setVisibility(!0);0<this.incidents.length&&(b.closestInfo&&b.closestInfo.container&&(b.closestInfo.container.innerHTML=
"",e.add(b.closestInfo.container,"loading")),!1===b.updateFlag&&this.lyrClosest.clear(),b.closestInfo.updateForIncident(this.incidents,this.config.maxDistance,this.lyrClosest));break;case "proximity":this._setLayerVisible(b,!0),this.lyrProximity.setVisibility(!0),0<this.incidents.length&&(b.proximityInfo&&b.proximityInfo.container&&(b.proximityInfo.container.innerHTML="",e.add(b.proximityInfo.container,"loading")),!1===b.updateFlag&&this.lyrProximity.clear(),b.proximityInfo.updateForIncident(this.incidents,
this.buffers,this.lyrProximity))}b.updateFlag=!1},_setLayerVisible:function(a,b){this.disableVisibilityManagement||a.tabLayers&&z.forEach(a.tabLayers,function(c){"undefined"!==typeof c.visible&&c.setVisibility(b);a&&a.jimuLayerInfo&&a.jimuLayerInfo.setTopLayerVisible&&a.jimuLayerInfo.setTopLayerVisible(b)})},_drawIncident:function(a,b,c,d){var e=new I;a=Array.isArray(a)?a:[a];for(var f=!1,g=[],h=[],k=[],l=0;l<a.length;l++){var m=a[l],n=m.geometry.type;null===this.symPoint&&this._getStyleColor();"point"===
n&&(d=!0,this._getIncidentAddress(m.geometry));f="polyline"===n?this.isLineEditable:"polygon"===n?this.isPolyEditable:this.isPointEditable;d?k.push(m.geometry):g.push(this._updateGeom(m.geometry));h.push({symbol:"polyline"===n?this.symLine:"polygon"===n?this.symPoly:this.symPoint,attributes:m.attributes,infoTemplate:m.infoTemplate})}d?(this._drawIncidentComplete(k,h,f,b,c),e.resolve()):(new K(g)).then(w.hitch(this,function(a){z.forEach(a,function(a){k.push(a[1])});this._drawIncidentComplete(k,h,f,
b,c);e.resolve()}));return e},_drawIncidentComplete:function(a,b,c,d,e){for(var f=0;f<a.length;f++){var g=b[f],g=new O(a[f],g.symbol,g.attributes,g.infoTemplate);this.incidents.push(g);this.lyrIncidents.add(g)}this._updatePanel(c);this.toolbar.deactivate();this._clickIncidentsButton(-1);this._bufferIncident(d,e);this.clearIncident.focus()},_updatePanel:function(b){this.div_reversed_address.innerHTML="";a.setStyle(this.div_reverse_geocoding,"display","none");this.saveEnabled&&(e.remove(this.saveButton,
"display-off"),(b=b&&this.userCanSave)&&e.contains(this.saveButton,"btnDisabled")&&(e.remove(this.saveButton,"btnDisabled"),B.set(this.saveButton,"tabindex","0")),e.add(this.saveButton,b?"displayT":"displayT btnDisabled"));e.remove(this.saveOptions,"display-off");e.add(this.saveOptions,"displayT");e.remove(this.borderCol,"display-off");e.add(this.borderCol,"display-on");e.remove(this.clearIncident,"display-off");e.add(this.clearIncident,"display-on")},_updateGeom:function(a){var b=new I,c=a.spatialReference;
this.config.drawGeodesic?this._getGeographicGeom(a).then(w.hitch(this,function(d){d=Y.geodesicDensify(d,5E3);if(J.canProject(d,c))b.resolve(J.project(d,c));else if(this.transformation){var e=new A;e.outSR=c;e.geometries=[d];isNaN(this.transformation)||(e.transformForward=!1);e.transformation=this.transformation;try{this.gsvc.project(e,w.hitch(this,function(a){b.resolve(a[0])}))}catch(wa){console.log(wa),b.resolve(a)}}else b.resolve(a)}),w.hitch(this,function(c){console.log(c);b.resolve(a)})):b.resolve(a);
return b},_getIncidentAddress:function(a){this.incidentPoint=a;this.map.graphics.clear();this._getGeographicGeom(a).then(w.hitch(this,function(a){this.locator.locationToAddress(a,100)}),function(a){console.log(a)})},_getGeographicGeom:function(a){var b=new I,c=new W(3857);J.canProject(a,c)?b.resolve(J.webMercatorToGeographic(J.project(a,c))):(c=Q.buffer(a,100,9001),c={url:this.gsvc.url+"/findTransformations",content:{f:"json",inSR:a.spatialReference.wkid,outSR:4326,extentOfInterest:D.stringify(c.getExtent().toJson())},
handleAs:"json",callbackParamName:"callback"},na(c,{usePost:!1}).then(w.hitch(this,function(c){(c=c&&c.transformations?c.transformations:void 0)&&0<c.length&&(this.transformation=c[0].wkid?c[0].wkid:c[0].geoTransforms?c[0]:void 0);c=new A;c.outSR=new W(4326);c.geometries=[a];c.transformation=this.transformation;try{this.gsvc.project(c,w.hitch(this,function(a){b.resolve(a[0])}))}catch(va){console.log(va),b.resolve(a)}}),w.hitch(this,function(a){b.reject(a)})));return b},_showIncidentAddress:function(b){if(b.address.address){var c=
b.address.address.Address,d=new aa;d.family="Arial";d.size="18px";d=new ba(c,d,new M("#000000"));d.setOffset(20,-4);d.horizontalAlignment="left";this.map.graphics.add(new O(this.incidentPoint,d,{}));this.div_reversed_address.innerHTML=c+"\x3c/br\x3e"+b.address.address.City+", "+b.address.address.Region+" "+b.address.address.Postal;a.setStyle(this.div_reverse_geocoding,"display","block")}},_onAddressError:function(){this.div_reversed_address.innerHTML=this.nls.reverse_geocoded_error;a.setStyle(this.div_reverse_geocoding,
"display","block")},_bufferIncident:function(a,b){var c=new I;if(0!==this.incidents.length&&this.spinnerValue.validate()){for(var d=0;d<this.config.tabs.length;d++)this.config.tabs[d].updateFlag=!0;this.buffers=[];this.lyrBuffer.clear();for(var e=!1,d=[],f=0;f<this.incidents.length;f++){var g=this.incidents[f],h=this.spinnerValue.get("value"),k=this.config.distanceSettings[this.config.distanceUnits];if(0<h){var l=g.geometry.spatialReference.wkid,m;this.config.drawGeodesic?4326===l||g.geometry.spatialReference.isWebMercator()?
(m=Q.geodesicBuffer(g.geometry,h,k),this.buffers.push(m)):d.push(this._updateGeom(g.geometry)):(m=Q.buffer(g.geometry,h,k),this.buffers.push(m))}else a=!1,g=g.geometry.type,"polyline"!==g||e||(e=this.isLineEditable),"polygon"!==g||e||(e=this.isPolyEditable),"point"!==g||e||(e=this.isPointEditable)}0<d.length?(new K(d)).then(w.hitch(this,function(d){z.forEach(d,w.hitch(this,function(a){m=Q.geodesicBuffer(a[1],h,k);this.buffers.push(m)}));this._useBuffers(a,b,e);c.resolve()})):(this._useBuffers(a,b,
e),c.resolve());return c}},_useBuffers:function(a,b,c){0<this.buffers.length?(this.saveEnabled&&(e.remove(this.saveButton,"display-off"),e.contains(this.saveButton,"btnDisabled")&&this.isPolyEditable&&this.userCanSave&&(e.remove(this.saveButton,"btnDisabled"),B.set(this.saveButton,"tabindex","0")),e.add(this.saveButton,"displayT")),this._handleBuffers(this.symPoly,a)):(this.saveEnabled&&(c&&this.userCanSave?e.contains(this.saveButton,"btnDisabled")&&(e.remove(this.saveButton,"btnDisabled"),B.set(this.saveButton,
"tabindex","0")):(e.add(this.saveButton,"btnDisabled"),B.set(this.saveButton,"tabindex","-1"))),this.zoomToIncidents(b));setTimeout(w.hitch(this,function(){G(".noFeaturesActive",this.domNode).forEach(function(a){B.set(a,"tabindex","-1")});this._getLastNodeForEachTab(0)}),100)},_handleBuffers:function(a,b){this.bufferLookUp=[];for(var c=0;c<this.buffers.length;c++){var d=new O(this.buffers[c],a);this.lyrBuffer.add(d);this.bufferLookUp[c]=d}b||this._locateBuffer(Q.union(this.buffers));this._performAnalysis()},
_performAnalysis:function(){this._updateCounts(!1);this._toggleTabLayersNew(this.curTab)},_updateCounts:function(a){for(var b=[],c=0;c<this.config.tabs.length;c++){a&&0<c&&this.panelNodes[c]&&(this.panelNodes[c].innerHTML="");var d=this.config.tabs[c],e=this.tabNodes[c],f=null,g=!1;d.advStat&&d.advStat.stats&&("undefined"!==typeof d.advStat.stats.tabCount?g=d.advStat.stats.tabCount:d.advStat.stats.count&&(g=!0));"proximity"===d.type?f=d.proximityInfo:"closest"===d.type?f=d.closestInfo:"summary"===
d.type?f=d.summaryInfo:"groupedSummary"===d.type&&(f=d.groupedSummaryInfo);f&&(a?("undefined"!==typeof f.incidentCount&&(f.incidentCount=0),f.updateTabCount(0,e,g)):b.push(f.queryTabCount(this.incidents,this.buffers,e,g)))}(new K(b)).then(w.hitch(this,function(a){for(var b=0,c=0;c<a.length;c++){var d=a[c][1];isNaN(d)||(b+=d)}this._updateBtnState(this.downloadAllButon,"btnDisabled",b);this.userCanSnapshot&&this._updateBtnState(this.createSnapshotButton,"btnDisabled",b);this._getLastNodeForEachTab(0)}))},
_updateBtnState:function(a,b,c){a&&(0===c?(e.add(a,b),B.set(a,"tabindex","-1")):e.contains(a,b)&&(e.remove(a,b),B.set(a,"tabindex","0")))},_verifyRouting:function(){if(this.config.enableRouting){this.config.enableRouting=!1;var a=this.appConfig.getConfigElementsByName("Directions");z.forEach(a,w.hitch(this,function(a){"Directions"===a.name&&(this.dirConfig=a,this.config.enableRouting=!0)}))}},_getAttributeTable:function(){var a=this.appConfig.getConfigElementsByName("AttributeTable");z.forEach(a,
w.hitch(this,function(a){"AttributeTable"===a.name&&(this.attributeTable=a)}))},zoomToIncidents:function(a){var b,c=!1;if(0<this.incidents.length){var d;1<this.buffers.length?d=Q.union(this.buffers):1===this.buffers.length&&(d=this.buffers[0]);b=this.incidents;var e;d&&(c=!0,e=new O(d,d.spatialReference),b.push(e));this.geomExtent=Z.graphicsExtent(this.incidents);e&&e.destroy&&e.destroy()}"undefined"===typeof a&&(this.geomExtent?this.map.setExtent(this.geomExtent.expand(1.5)):b&&(a=b[0].geometry&&
"point"===b[0].geometry.type?b[0].geometry:b[0].geometry.getCentroid(),this.map.centerAndZoom(a,this.config.defaultZoomLevel)));if(!c){for(a=0;a<this.incidents.length;a++)if("polygon"===this.incidents[a].geometry.type){c=!0;break}this._performAnalysis()}c&&this._performAnalysis()},zoomToLocation:function(a){var b;if(.5===this.config.defaultZoomLevel){var c;if(0<this.buffers.length)c=Q.union(this.buffers)._extent;else if(0<this.incidents.length){for(var d=[],e=[],f=[],g=0;g<this.incidents.length;g++){var h=
this.incidents[g];switch(h.geometry.type){case "point":d.push(h.geometry._extent);break;case "polyline":e.push(h.geometry);break;case "polygon":f.push(h.geometry)}}g=[];0<d.length&&g.push(Q.union(d)._extent);0<e.length&&g.push(Q.union(e)._extent);0<f.length&&g.push(Q.union(f)._extent);1<g.length?c=Q.union(g)._extent:1===g.length&&(1<d.length||0<e.length||0<f.length)&&(c=g[0])}c&&(b=c.expand(.5))}"undefined"===typeof a&&(a=b.getCentroid());b&&this.map.setExtent(b);this.map.centerAt(a)},routeToIncident:function(a){var b=
this.incidents[0].geometry,c=b;"point"!==b.type&&(c=null);this.stops=[c,a];this.widgetManager.triggerWidgetOpen(this.dirConfig.id).then(w.hitch(this,function(a){if(a&&"closed"!==a.state){var b=a._dijitDirections;b?this._addStops(b):a.getDirectionsDijit().then(w.hitch(this,function(a){this._addStops(a)}))}}))},_addStops:function(a){a.clearDirections();a.removeStops();a.reset();a.addStops(this.stops)},_getTabLayers:function(a){var b=[];z.forEach(this.opLayers._layerInfos,w.hitch(this,function(c){if(0<
c.newSubLayers.length)this._recurseOpLayers(c.newSubLayers,b,a);else{var d=this.hasLayerTitle?c.id:c.title;if(Array.isArray(a)?-1<a.indexOf(d):a===d)b.push(c.layerObject),"undefined"===typeof c.layerObject.visible||c.layerObject.visible||(c.layerObject.setVisibility(!0),c.layerObject.setVisibility(!1))}}));return b},_recurseOpLayers:function(a,b,c){z.forEach(a,w.hitch(this,function(a){if(0<a.newSubLayers.length)this._recurseOpLayers(a.newSubLayers,b,c);else{var d=this.hasLayerTitle?a.id:a.title;(Array.isArray(c)?
-1<c.indexOf(d):c===d)&&b.push(a.layerObject)}}))},_setupSymbols:function(){var a;a=this.config.selectionColor?b.fromString(this.config.selectionColor):b.fromString(this.config.color);var c=a.toRgb();c.push(.2);var d=b.fromString("#000000");a=b.blendColors(a,d,.2).toRgb();d=new L(L.STYLE_SOLID,new b([255,255,255,.25]),1);this.symPoint=new X(X.STYLE_CIRCLE,20,d,new b([a[0],a[1],a[2],.7]));this.symLine=new L(L.STYLE_SOLID,new b([a[0],a[1],a[2],.7]),3);this.symPoly=new T(T.STYLE_SOLID,this.symLine,new b([a[0],
a[1],a[2],.3]));this.symBuffer=new T(T.STYLE_SOLID,d,new b(c));this.symSelection=new T(T.STYLE_NULL,new L(L.STYLE_SOLID,new b([0,255,255]),2),new b([0,0,0,0]))},onReceiveData:function(a,b,c){null!==c&&c.eventType&&("IncidentLocationAdd"===c.eventType?c.dataValue&&null!==c.dataValue&&(this._clickTab(0),null===this.symPoint?this.dataValue=c.dataValue:this._drawIncident(c.dataValue,void 0,void 0,!0)):"IncidentLocationRemove"===c.eventType?(a=this.incidents.indexOf(c.removeGraphic),this.incidents.splice(a,
1),this.lyrIncidents.remove(c.removeGraphic),this.bufferLookUp&&0<this.bufferLookUp.length&&(this.lyrBuffer.remove(this.bufferLookUp[a]),this.bufferLookUp.splice(a,1)),this.buffers&&0<this.buffers.length&&this.buffers.splice(a,1),this.incidents&&0<this.incidents.length?(this.config.tabs[this.curTab].updateFlag=!0,this._performAnalysis()):this._clear(!1)):"WebMapChanged"===c.eventType&&this._storeIncidents())},_storeIncidents:function(){if(0<this.incidents.length){for(var a=[],b=0;b<this.incidents.length;b++)a.push(D.stringify(this.incidents[b].geometry.toJson()));
a={location:D.stringify(a),hasBuffer:0<this.lyrBuffer.graphics.length,buffer_dist:this.spinnerValue.get("value"),unit:this.config.distanceUnits,curTab:this.curTab,extent:D.stringify(this.map.extent.toJson())};a=D.stringify(a);window.localStorage.setItem(this.Incident_Local_Storage_Key,a);console.log("Incident saved to storage")}},_restoreIncidents:function(){var a=window.localStorage.getItem(this.Incident_Local_Storage_Key);if(null!==a&&"null"!==a){window.localStorage.setItem(this.Incident_Local_Storage_Key,
null);var b=D.parse(a,!0),c=b.buffer_dist,d=D.parse(b.location);this.curTab=b.curTab;for(var a=[],f=0;f<d.length;f++)a.push({geometry:R.fromJson(D.parse(d[f]))});this.spinnerValue.set("value",c);for(c=0;c<this.config.tabs.length;c++)this.config.tabs[c].restore=!0;this._drawIncident(a,!0,!0,!0).then(w.hitch(this,function(){this._clickTab(0,!0);this._toggleTabs(b.curTab);this._toggleTabLayers(b.curTab);this.curTab=b.curTab;this._clickIncidentsButton(-1);this._updateW();var a=R.fromJson(D.parse(b.extent));
Q.equals(a,this.map.extent)||this.map.setExtent(a,!1)}))}else e.remove(this.saveOptions,"displayT"),e.add(this.saveOptions,"display-off"),e.remove(this.borderCol,"display-on"),e.add(this.borderCol,"display-off"),e.remove(this.clearIncident,"display-on"),e.add(this.clearIncident,"display-off")},_updateW:function(){for(var a=0,b=0;b<this.tabNodes.length;b++)a+=E.position(this.tabNodes[b]).w;a+=10;c.set(this.tabsNode,"width",a+"px");a>E.position(this.footerNode).w&&(c.set(this.footerContentNode,window.isRTL?
"left":"right","58px"),window.isRTL?(c.set(this.panelLeft,"display","block"),c.set(this.panelRight,"display","none")):c.set(this.panelRight,"display","block"))},_mapResize:function(){var a=c.getComputedStyle(this.map.container);if(a){var b=this._getSAPanelHeight(),a=parseFloat(a.bottom.replace("px",""));if("opened"===this.state||"active"===this.state){var d=this._getAttributeTableHeight();d>b&&(b=d);a<=b&&C.publish("changeMapPosition",{bottom:b})}}},_onMapPositionChange:function(a){a&&(this.left=
a.left,this.right=a.right,isFinite(this.left)&&"number"===typeof this.left&&c.set(this.domNode,window.isRTL?"right":"left",parseFloat(this.left)+"px"),isFinite(this.right)&&"number"===typeof this.right&&c.set(this.domNode,window.isRTL?"left":"right",parseFloat(this.right)+"px"));this._onPanelScroll()},_resetMapPosition:function(){C.publish("changeMapPosition",{bottom:this._getAttributeTableHeight()})},_getSAPanelHeight:function(){var a=parseInt(this.position.height.toString().replace("px",""),10),
b=parseInt(this.position.bottom.toString().replace("px",""),10);return a+b},_getAttributeTableHeight:function(){var a=parseInt(this.position.bottom.toString().replace("px",""),10);if(this.attributeTable){var b=m.byId(this.attributeTable.id);b&&(b=c.getComputedStyle(b))&&b.height&&(a+=parseInt(b.height.toString().replace("px",""),10))}return a},_resize:function(a){try{this._onPanelScroll(this.curTab),this.hideContainer&&this._handlePopup(),this._clearMobileSetAsIncidentStyle(),this._resetInfoWindow(),
this._initEditInfo(),this._checkHideContainer()}catch(ua){console.log(ua)}},_onPanelScroll:function(a){var b,d,f,g;a=this.footerContentNode.getBoundingClientRect();if(window.isRTL){for(var h=0;h<this.tabsNode.children.length;h++)if(g=this.tabsNode.children[h],g=g.getBoundingClientRect(),g=g.right,g=parseFloat(g.toString().split(".")[0]),g<=a.right){b=h;f=g;break}for(h=0;h<this.tabsNode.children.length;h++)if(g=this.tabsNode.children[h],g=g.getBoundingClientRect(),g=g.left,g<a.left){d=h;break}a=this.footerContentNode;
h=0;"TabTheme"===this.appConfig.theme.name&&(h+=this.right);h=1<=b||f<h;c.set(a,"right",h?"34px":"0px");c.set(this.panelRight,"display",h?"block":"none");c.set(this.panelRight,"width",h?"34px":"0px");b=d<=this.tabsNode.children.length;c.set(a,"left",b?"58px":"24px");c.set(this.panelLeft,"display",b?"block":"none");c.set(this.panelLeft,"width",b?"34px":"0px");e.contains(this.clearIncident,"display-off")&&(c.set(this.panelLeft,"display","none"),c.set(this.panelRight,"display","none"))}else{for(h=0;h<
this.tabsNode.children.length;h++)if(g=this.tabsNode.children[h],g=g.getBoundingClientRect(),g=window.isRTL?g.right:g.left,0<=g){b=h;f=g;break}for(h=0;h<this.tabsNode.children.length;h++)if(g=this.tabsNode.children[h],g=g.getBoundingClientRect(),g=window.isRTL?g.left:g.right,g>(window.isRTL?a.left:a.right)){d=h;break}a=this.footerContentNode;h=d<=this.tabsNode.children.length;c.set(a,window.isRTL?"left":"right",h?"58px":"24px");c.set(this.panelRight,"display",h?"block":"none");h=0;"TabTheme"===this.appConfig.theme.name&&
(h+=window.isRTL?this.right:this.left);b=1<=b||f<h;c.set(a,window.isRTL?"right":"left",b?"34px":"0px");c.set(this.panelLeft,"display",b?"block":"none");c.set(this.panelLeft,"width",b?"34px":"0px")}},_scrollToTab:function(a){var b=E.position(this.footerContentNode).w;if(E.position(this.tabsNode).w>b){var c=E.getMarginBox(this.tabNodes[a]);this.footerContentNode.scrollLeft=c.l-(b-c.w)/2}this._onPanelScroll(a)},_navLeft:function(a){},_navRight:function(a){},_navTabsLeft:function(a){this._navTabs(!1)},
_navTabsRight:function(a){this._navTabs(!0)},_navTabs:function(a){var b=this.footerContentNode.getBoundingClientRect();if(window.isRTL)for(var c=this.tabsNode.children.length-1;0<=c;c--){var d=this.tabsNode.children[c],d=d.getBoundingClientRect();if(a){if(d.right>b.right){this._scrollToTab(c);break}}else if(0<d.right){this._scrollToTab(c);break}}else for(c=0;c<this.tabsNode.children.length;c++)if(d=this.tabsNode.children[c],d=d.getBoundingClientRect(),a){if(d.right>b.right){this._scrollToTab(c);break}}else if(0<
d.right){this._scrollToTab(c);break}},_storeInitalVisibility:function(){z.forEach(this.config.tabs,w.hitch(this,function(a){z.forEach(a.tabLayers,w.hitch(this,function(b){"undefined"!==typeof b.visible&&(!b.id||b.id in this.initalLayerVisibility||(this.initalLayerVisibility[b.id]=b.visible),b.setVisibility(!1));a&&a.jimuLayerInfo&&a.jimuLayerInfo.setTopLayerVisible&&(b=a.jimuLayerInfo.isShowInMap(),this.initalLayerVisibility.hasOwnProperty(a.jimuLayerInfo.id)||(this.initalLayerVisibility[a.jimuLayerInfo.id]=
b),b&&a.jimuLayerInfo.setTopLayerVisible(!1))}))}))},_resetInitalVisibility:function(){z.forEach(this.config.tabs,w.hitch(this,function(a){z.forEach(a.tabLayers,w.hitch(this,function(b){"undefined"!==typeof b.visible&&b.id&&b.id in this.initalLayerVisibility&&(b.setVisibility(this.initalLayerVisibility[b.id]),b.hasOwnProperty("visible")&&(b.visible=this.initalLayerVisibility[b.id]),b.redraw?b.redraw():b.refresh&&b.refresh());a&&a.jimuLayerInfo&&a.jimuLayerInfo.setTopLayerVisible&&a.jimuLayerInfo.isShowInMap()!==
this.initalLayerVisibility[a.jimuLayerInfo.id]&&a.jimuLayerInfo.setTopLayerVisible(this.initalLayerVisibility[a.jimuLayerInfo.id])}))}));this.initalLayerVisibility=[]},_clearGraphics:function(){z.forEach(this.config.tabs,w.hitch(this,function(a){if("summary"===a.type&&a.tabLayers&&1<a.tabLayers.length)for(var b=1;b<a.tabLayers.length;b++)a.tabLayers.pop()}))},_resetInfoWindow:function(){this.defaultPointContent&&this.pointEditLayer.infoTemplate.setContent(this.defaultPointContent);this.defaultLineContent&&
this.lineEditLayer.infoTemplate.setContent(this.defaultLineContent);this.defaultPolyContent&&this.polyEditLayer.infoTemplate.setContent(this.defaultPolyContent);this.defaultPopupSize&&this.map.infoWindow.resize(this.defaultPopupSize.width,"auto");this.map.infoWindow.isShowing&&this.map.infoWindow.hide()},_close:function(){this.widgetManager.closeWidget(this.id)},_downloadAll:function(){for(var a=this.downloadAllButon.classList?this.downloadAllButon.classList:this.downloadAllButon.className.split(" "),
b=!0,c=0;c<a.length;c++)if("btnDisabled"===a[c]){b=!1;break}b&&(this._updateProcessing(this.downloadAllButon,!0,this.downloadAllSrc),this._verifyIncident(!1)&&(a=this._getAnalysisObjects(),(new ea(this)).createDownloadZip(a,this.incidents,this.buffers).then(w.hitch(this,function(a){this._updateProcessing(this.downloadAllButon,!1,this.downloadAllSrc);setTimeout(w.hitch(this,function(){this.downloadAllButon.focus()}),1E3)}),function(a){this._updateProcessing(this.downloadAllButon,!1,this.downloadAllSrc);
new n({message:a.message})})));setTimeout(w.hitch(this,function(){this.downloadAllButon.focus()}),1E3)},_updateProcessing:function(b,c,d){a.setAttr(b,"src",c?this.processingSrc:d)},_getAnalysisObjects:function(){var a=["proximity","closest","summary","groupedSummary"],b=[];z.forEach(this.config.tabs,function(c){if(-1<a.indexOf(c.type)){var d;switch(c.type){case "proximity":d=c.proximityInfo;break;case "closest":d=c.closestInfo;break;case "summary":d=c.summaryInfo;break;case "groupedSummary":d=c.groupedSummaryInfo}var e=
"undefined"!==typeof c.layerTitle?c.layerTitle:c.layers;b.push({layerObject:c.tabLayers[0],label:""!==c.label?c.label:e,analysisObject:d,type:c.type})}});return b.reverse()},_verifyIncident:function(a,b){if(0===this.buffers.length){for(var c=!1,d=0;d<this.incidents.length;d++)if("polygon"===this.incidents[d].geometry.type){c=!0;break}c||(c=0<this.config.tabs.filter(function(a){return"closest"===a.type}).length&&0<parseInt(this.config.maxDistance,10));c||(new n({message:a?this.nls.notPolySnapShot:
b?this.nls.notPolyReport:this.nls.notValidDownload}),this._updateProcessing(a?this.createSnapshotButton:b?this.createReportButton:this.downloadAllButon,!1,a?this.snapshotSrc:b?this.reportSrc:this.downloadAllSrc));return c}return!0},_createSnapshot:function(){for(var a=this.createSnapshotButton.classList?this.createSnapshotButton.classList:this.createSnapshotButton.className.split(" "),b=!0,c=0;c<a.length;c++)if("btnDisabled"===a[c]){b=!1;break}b&&this._verifyIncident(!0)&&this._getName("snapshot").then(w.hitch(this,
function(a){if(a&&"cancel"!==a){this._updateProcessing(this.createSnapshotButton,!0,this.snapshotSrc);var b=[];0<this.buffers.length&&b.push({graphics:this.lyrBuffer.graphics,label:1<this.buffers.length?this.nls.buffers:this.nls.buffer});b.push({graphics:this.incidents,label:1<this.incidents.length?this.nls.incidents:this.nls.incident});(new ea(this)).createSnapShot({layers:b.concat(this._getAnalysisObjects()),incidents:this.incidents,buffers:this.buffers,time:Date.now(),name:a.name,groups:a.groups}).then(w.hitch(this,
function(a){this.busyIndicator.hide();this._updateProcessing(this.createSnapshotButton,!1,this.snapshotSrc)}),w.hitch(this,function(a){this._updateProcessing(this.createSnapshotButton,!1,this.snapshotSrc);new n({message:a.message});this.busyIndicator.hide()}))}else this._updateProcessing(this.createSnapshotButton,!1,this.snapshotSrc);this.createSnapshotButton.focus()}))},_initReportDijit:function(a){var b="";a.logo&&(b=a.logo,b=-1<b.indexOf("${appPath}")?H.substitute(b,{appPath:this.folderUrl.slice(0,
this.folderUrl.lastIndexOf("widgets"))}):b);this.reportDijit=new q({alignNumbersToRight:window.isRTL,reportLogo:b,appConfig:this.appConfig,footNotes:a.footnote,printTaskUrl:a.printTaskURL,reportLayout:a.reportLayout,styleSheets:[this.folderUrl+"/css/reportDijitOverrides.css"],styleText:".esriCTTable th{background-color: "+a.textColor+"; color: "+this.getTextColor(a.textColor)+";} .esriCTSectionTitle{color: black;} .esriCTHTMLData{height:100%;}",maxNoOfCols:7});this.own(f(this.reportDijit,"reportError",
w.hitch(this,function(){new n({message:window.jimuNls.common.error})})))},getTextColor:function(a){a=(new y(a)).toRgb();return.5>1-(.299*a[0]+.587*a[1]+.114*a[2])/255?"#000":"#fff"},_getName:function(a){var b=new I,c=new sa({nls:this.nls,type:a,pageUtils:x,storedProps:this._getStoredPropData("SA-REPORT-PROPS"),portalUrl:this.appConfig.portalUrl}),d=new la({autoHeight:!0,content:c,titleLabel:"report"===a?this.nls.report_name:this.nls.snapshot_name,invalidMessage:"report"===a?this.nls.invalid_report_name:
this.nls.invalid_snapshot_name});c.initWidth();this.own(f(c,"ok",w.hitch(this,function(e){c.destroy();c=null;d.close();"report"!==a&&this.busyIndicator.show();this._storePropData("SA-REPORT-PROPS",e);b.resolve(e)})));this.own(f(c,"cancel",w.hitch(this,function(){c.destroy();c=null;d.close();b.resolve("cancel")})));return b},_storePropData:function(a,b){window.localStorage.setItem(a,D.stringify(b))},_getStoredPropData:function(a){return window.localStorage.getItem(a)},_createReport:function(){this.reportEnabled&&
this._verifyIncident(!1,!0)&&(this._updateProcessing(this.createReportButton,!0,this.reportSrc),this._getReportData().then(w.hitch(this,function(a){this._updateProcessing(this.createReportButton,!1,this.reportSrc);this._getName("report").then(w.hitch(this,function(b){if(b&&"cancel"!==b){this._updateProcessing(this.createReportButton,!0,this.reportSrc);this._initReportDijit(w.mixin(this.config.reportSettings,b));for(var c,d=0;d<a.length;d++){var e=a[d];if("map"===e.type){c=d;e.printTemplate=this._getPrintTemplate();
break}}b.comments&&""!==b.comments&&a.splice(c+1,0,{type:"html",data:"\x3cp style\x3d'white-space: pre-wrap;'\x3e"+b.comments+"\x3c/p\x3e"});this.reportDijit.maxNoOfCols="Landscape"===b.reportLayout.orientation.Type?12:7;this.reportDijit.print(b.name,a)}this._updateProcessing(this.createReportButton,!1,this.reportSrc);this.createReportButton.focus()}))})))},_getReportData:function(a){var b=new I,c=[];c.push({addPageBreak:!0,type:"map",map:this.map});a=this._getAnalysisObjects().reverse();var d=this.nls;
(new ea(this))._performAnalysis(a,this.incidents,this.buffers,!1,!0).then(function(a){z.forEach(a,w.hitch(this,function(a){if(a){var b=[],e=[],f=[];if(!a.context.tab.advStat.hasOwnProperty("analysisSummaryForReport")||a.context.tab.advStat.hasOwnProperty("analysisSummaryForReport")&&a.context.tab.advStat.analysisSummaryForReport){for(var g=a.context.tab.type,h="summary"===g?d.summary:"closest"===g?d.closest:"proximity"===g?d.proximity:d.groupedSummary,k="proximity"===g?a.reportResults:a.analysisResults,
l=0;l<k.length;l++){var m=k[l];if("summary"!==g&&"groupedSummary"!==g)f=[],0===l&&z.forEach(m,function(a){b.push(a.label)}),z.forEach(m,function(a){f.push(a.value)}),e.push(f);else if("summary"===g){var n=[];z.forEach(a.context.calcFields,function(a){n.push(a.alias?a.alias:a.field)});0<n.length&&-1<n.indexOf(m.info.replace("\x3cbr/\x3e",""))&&(b.push(m.info.replace("\x3cbr/\x3e","")),f.push(m.num))}else b.push(-1===["",null,void 0].indexOf(m.a)?m.a+" "+m.info:m.info),f.push(m.total)}"summary"!==g&&
"groupedSummary"!==g||e.push(f);c.push({title:a.context.baseLabel+" ("+h+")",addPageBreak:!1,type:"table",data:{cols:b,rows:e}})}if(!a.context.tab.advStat.hasOwnProperty("PopUpSummaryForReport")||a.context.tab.advStat.hasOwnProperty("PopUpSummaryForReport")&&a.context.tab.advStat.PopUpSummaryForReport){var q={},b=[],e=[],f=[],g=ha.getPopupFields(a.context.tab);if(0<g.length){z.forEach(g,function(a){q[a.expression]=a.label});for(g=0;g<a.graphics.length;g++){var f=[],r=a.graphics[g].attributes,h=Object.keys(r);
0===g&&z.forEach(h,function(a){q.hasOwnProperty(a)&&b.push(q[a])});z.forEach(h,function(b){q.hasOwnProperty(b)&&f.push(ha.getFieldValue(b,r[b],a.context.specialFields,a.context.dateFields,a.context.defaultDateFormat,a.context.typeIdField,a.context.types,a.context.layerObject&&a.context.layerObject.renderer?a.context.layerObject:a.context.layerDefinition,r))});e.push(f)}c.push({title:a.context.baseLabel,addPageBreak:!1,type:"table",data:{cols:b,rows:e}})}}}}));b.resolve(c)},function(a){this._updateProcessing(this.createReportButton,
!1,this.reportSrc);new n({message:a.message})});return b},_getPrintTemplate:function(){var a,b=[];a=new ja;this.reportDijit._printService.legendAll=!0;this.reportDijit._printService._getPrintDefinition(this.map,a);z.forEach(this.reportDijit._printService.allLayerslegend,w.hitch(this,function(a){var c;a.id!==this.lyrIncidents.id&&a.id!==this.lyrBuffer.id&&(c=new ka,c.layerId=a.id,a.subLayerIds&&(c.subLayerIds=a.subLayerIds),b.push(c))}));this.reportDijit._printService.legendAll=!1;a.layoutOptions=
{legendLayers:b,customTextElements:[{Date:(new Date).toLocaleString()}]};a=this.reportDijit.setMapLayout(a);a.preserveScale=!1;a.showAttribution=!0;a.format="jpg";return a}})});