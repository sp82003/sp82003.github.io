// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/ParcelDrafter/PlanInfo.html":'\x3cdiv class\x3d"esriCTFullWidth"\x3e\r\n    \x3c!-- Parcel Layer Attribute list Parent--\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth" data-dojo-attach-point\x3d"parcelLayerRowNode"\x3e\r\n        \x3c!-- Parcel layer attribute list toggle node --\x3e\r\n        \x3cdiv class\x3d"esriCTParcelLayerParent" data-dojo-attach-point\x3d"expandCollapseParentNode"\x3e\r\n            \x3cdiv class\x3d"esriCTParcelLayerContainer esriCTEllipsis" data-dojo-attach-point\x3d"attributeListTitle"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTExpandCollapseParceLayer" data-dojo-attach-point\x3d"expandCollapseNode" tabindex\x3d"0"\r\n                role\x3d"button" aria-label\x3d"${nls.planInfo.showAttributeList}" title\x3d"${nls.planInfo.showAttributeList}"\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Parcel Layer Attribute List Section--\x3e\r\n        \x3cdiv class\x3d"esriCTParcelAttributeList esriCTHidden" data-dojo-attach-point\x3d"attributeListNode"\x3e\r\n            \x3c!-- Attribute Inspector --\x3e\r\n            \x3cdiv class\x3d"esriCTAttributeInspectorContainer" data-dojo-attach-point\x3d"attributeInspectorContainer"\x3e\r\n            \x3c/div\x3e\r\n            \x3c!-- Parcel name input container --\x3e\r\n            \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow esriCTHidden" data-dojo-attach-point\x3d"parcelNameRow"\x3e\r\n                \x3cdiv class\x3d"esriCTFullWidth" data-dojo-attach-point\x3d"parcelName"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3c!-- DocumentType input container --\x3e\r\n            \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow esriCTHidden" data-dojo-attach-point\x3d"documentTypeRow"\x3e\r\n                \x3cdiv class\x3d"esriCTFullWidth" data-dojo-attach-point\x3d"documentType"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3c!-- Plan name input container --\x3e\r\n            \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow esriCTHidden" data-dojo-attach-point\x3d"planNameRow"\x3e\r\n                \x3cdiv class\x3d"esriCTFullWidth" data-dojo-attach-point\x3d"planName"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Save/Cancle button container --\x3e\r\n        \x3cdiv class\x3d"esriCTPlanInfoNode"\x3e\r\n            \x3cdiv class\x3d"esriCTPlanInfoButton jimu-btn jimu-trailing-margin1" title\x3d"${nls.common.save}"\r\n                data-dojo-attach-point\x3d"planInfoSaveButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.common.save}"\x3e\r\n                ${nls.common.save}\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTPlanInfoButton jimu-btn jimu-trailing-margin1 esriCTHidden"\r\n                title\x3d"${nls.common.deleteText}" data-dojo-attach-point\x3d"planInfoDeleteButton" tabindex\x3d"0"\r\n                role\x3d"button" aria-label\x3d"${nls.common.deleteText}"\x3e\r\n                ${nls.common.deleteText}\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTPlanInfoButton jimu-btn" title\x3d"${nls.common.cancel}"\r\n                data-dojo-attach-point\x3d"planInfoCancelButton" tabindex\x3d"0" role\x3d"button"\r\n                aria-label\x3d"${nls.common.cancel}"\x3e\r\n                ${nls.common.cancel}\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/text!./PlanInfo.html dojo/_base/lang dojo/_base/array dojo/Evented dojo/dom-attr dojo/dom-construct dojo/dom-class dojo/dom-style dojo/query dijit/registry dijit/form/ValidationTextBox dojo/store/Memory dijit/form/ComboBox dojo/on esri/geometry/Polyline esri/graphic esri/tasks/query esri/tasks/QueryTask esri/dijit/AttributeInspector esri/layers/FeatureLayer jimu/dijit/Message ./geometryUtils jimu/utils jimu/LayerInfos/LayerInfos dojo/keys dojo/aspect".split(" "),
function(t,A,B,C,d,g,D,h,u,k,v,w,r,E,F,G,l,H,p,x,I,J,y,K,L,q,M,m,z){return t([A,B,D],{baseClass:"jimu-widget-ParcelDrafter-PlanInfo",templateString:C,_itemList:null,_polygonLayer:null,parcelNameTextBox:null,planNameTextBox:null,documentTypeControl:null,planSettings:null,_savedPolygonObjectId:null,_savedPolyLines:null,fieldInfosForPolygonLayer:null,constructor:function(b){d.mixin(this,b)},postCreate:function(){this.inherited(arguments);M.getInstance(this.map,this.map.itemInfo).then(d.hitch(this,function(b){this._layerInfosObj=
b;this._init()}))},_init:function(){if(0<this._getFieldInfosForPolygonLayer().length)if(this._addGraphicToLocalLayer(),this.config.polygonLayer.attributeListTitle){var b=q.sanitizeHTML(this.config.polygonLayer.attributeListTitle);h.set(this.attributeListTitle,"innerHTML",b)}else b=this._layerInfosObj.getLayerInfoById(this.config.polygonLayer.id),h.set(this.attributeListTitle,"innerHTML",b.layerObject.name);else k.add(this.expandCollapseParentNode,"esriCTHidden");k.add(this.domNode,"esriCTFullWidth");
this.own(l(this.planInfoCancelButton,"click",d.hitch(this,function(){this.emit("cancelTraversedParcel")})));this.own(l(this.planInfoCancelButton,"keydown",d.hitch(this,function(a){a.keyCode!==m.ENTER&&a.keyCode!==m.SPACE||this.emit("cancelTraversedParcel")})));this.own(l(this.planInfoSaveButton,"click",d.hitch(this,function(){this.emit("saveTraversedParcel")})));this.own(l(this.planInfoSaveButton,"keydown",d.hitch(this,function(a){a.keyCode!==m.ENTER&&a.keyCode!==m.SPACE||this.emit("saveTraversedParcel")})));
this.own(l(this.planInfoDeleteButton,"click",d.hitch(this,this.deleteParcel)));this.own(l(this.planInfoDeleteButton,"keydown",d.hitch(this,function(a){a.keyCode!==m.ENTER&&a.keyCode!==m.SPACE||this.deleteParcel()})));this.own(l(this.expandCollapseNode,"click",d.hitch(this,this._onExpandCollapseClicked)));this.own(l(this.expandCollapseNode,"keydown",d.hitch(this,function(a){if(a.keyCode===m.ENTER||a.keyCode===m.SPACE)a.preventDefault(),this._onExpandCollapseClicked()})))},_onExpandCollapseClicked:function(){k.toggle(this.expandCollapseNode,
"esriCTCollapsedParceLayer");k.toggle(this.attributeListNode,"esriCTHidden");var b=this.nls.planInfo.showAttributeList;k.contains(this.expandCollapseNode,"esriCTCollapsedParceLayer")&&(b=this.nls.planInfo.hideAttributeList);h.set(this.expandCollapseNode,"aria-label",b);h.set(this.expandCollapseNode,"title",b)},resetValues:function(){k.contains(this.expandCollapseNode,"esriCTCollapsedParceLayer")&&this._onExpandCollapseClicked();this._addGraphicToLocalLayer();this.parcelNameTextBox&&this.parcelNameTextBox.set("value",
"");this.planNameTextBox&&this.planNameTextBox.set("value","");this.documentTypeControl&&(this.config.polygonLayer.documentType.domain?this.documentTypeControl.set("item",null):this.documentTypeControl.set("value",""));k.add(this.planInfoDeleteButton,"esriCTHidden")},_showMessage:function(b){this.emit("showMessage",b)},_createDocumentTypeControl:function(){this.config.polygonLayer.documentType.domain?(this.documentTypeControl=this._createFieldSelect(this.config.polygonLayer.documentType,this.documentType,
this.nls.planInfo.parcelDocumentTypeText,!this.config.polygonLayer.documentType.nullable),this.own(l(this.documentTypeControl,"change",d.hitch(this,function(b){""===b||null===b||void 0===b||this.documentTypeControl.store.data.some(function(a){return a.name===b})||(this.documentTypeControl.set("item",null),this._showMessage(this.nls.planInfo.enterValidDocumentTypeMessage))})))):this.documentTypeControl=this._createFieldInputs(this.config.polygonLayer.documentType,this.documentType,this.nls.planInfo.parcelDocumentTypeText,
!this.config.polygonLayer.documentType.nullable)},_createFieldInputs:function(b,a,c,e){b.alias&&(c=b.alias);c=e?c+" "+this.nls.planInfo.requiredText:c+" "+this.nls.planInfo.optionalText;c=new E({placeHolder:c,"class":"esriCTFullWidth",required:e,"aria-label":c});0<=this.numberFieldTypes.indexOf(b.type)&&(c.validator=d.hitch(this,function(a){return""===a||this.validateNumericField(a,b.type)?!0:!1}));c.placeAt(a);return c},_createFieldSelect:function(b,a,c,e){var f;f=this._createDocTypeDataArr();f=
new F({data:f});b&&b.alias&&(c=b.alias);c=e?c+" "+this.nls.planInfo.requiredText:c+" "+this.nls.planInfo.optionalText;this.selectBox=new G({placeHolder:c,"class":"esriCTFullWidth",required:e,store:f},a);h.set(this.selectBox.domNode,"aria-label",c);h.set(this.selectBox.domNode,"role","combobox");h.set(this.selectBox.domNode,"aria-expanded","false");z.after(this.selectBox,"loadAndOpenDropDown",d.hitch(this,function(){h.set(this.selectBox.domNode,"aria-expanded","true")}));z.after(this.selectBox,"closeDropDown",
d.hitch(this,function(){h.set(this.selectBox.domNode,"aria-expanded","false")}));return this.selectBox},_createDocTypeDataArr:function(){var b=[];this.config.polygonLayer.documentType.domain.codedValues&&g.forEach(this.config.polygonLayer.documentType.domain.codedValues,d.hitch(this,function(a){b.push({name:a.name,id:a.code})}));return b},saveData:function(b){if(b.miscloseDetails&&(0===b.miscloseDetails.LengthConversions.meters||b.appliedCompassRule))this._saveParcel(b);else{var a;a=new K({message:this.nls.planInfo.saveNonClosedParcelConfirmationMessage,
type:"question",buttons:[{label:this.nls.common.yes,onClick:d.hitch(this,function(){a.close();this._saveParcel(b)})},{label:this.nls.common.no}]})}},_saveParcel:function(b){this._itemList=b.itemList;this.planSettings=b.planSettings;b.miscloseDetails&&(0===b.miscloseDetails.LengthConversions.meters||b.appliedCompassRule)?0===b.polygonDeleteArr.length?this._createPolygonData(b):this._deletePolygonBeforeSaving(b):0<b.polygonDeleteArr.length?this._deletePolygonBeforeSaving(b):this._createPolylineData(null)},
_createParcelPolygon:function(){var b,a,c,e,f;c=[];e=this.parcelLinesGraphicsLayer.graphics;for(b=0;b<this._itemList.length;b++)if(this._itemList[b].LineSymbol.type===this.config.BoundaryLineType)for(a=0;a<this._itemList[b].graphic.geometry.paths.length;a++)c.push(this._itemList[b].graphic.geometry.paths[a]);0<c.length&&(f=L.getPolygonFromPolyLines(c,!1,!0,e[0].geometry.spatialReference))&&(this.parcelPolygonGraphicsLayer.clear(),b=new p(f),this.parcelPolygonGraphicsLayer.add(b),f=this.parcelPolygonGraphicsLayer.graphics[0].geometry);
return f},_createPolygonData:function(b){var a,c,e,f;b.miscloseDetails&&(0===b.miscloseDetails.LengthConversions.meters||b.appliedCompassRule)?(this.loading.show(),a=[],c={},f=this.polygonLayerUnit,this.documentTypeControl&&(this.config.polygonLayer.documentType.domain?this.documentTypeControl.hasOwnProperty("item")&&this.documentTypeControl.item&&this.documentTypeControl.item.hasOwnProperty("id"):""!==this.documentTypeControl.get("value")&&this.documentTypeControl.get("value")),(e=this._createParcelPolygon())?
(this._currentFeatureDetails&&this._currentFeatureDetails.attributes&&(c=d.clone(this._currentFeatureDetails.attributes)),c[this.config.polygonLayer.rotation.name]=b.rotation,c[this.config.polygonLayer.scale.name]=b.scale,c[this.config.polygonLayer.miscloseRatio.name]=b.miscloseDetails.miscloseValue,c[this.config.polygonLayer.miscloseDistance.name]=this._getValueAccToFeatureLayerUnit(f,b.miscloseDetails,"LengthConversions"),this.config.polygonLayer.statedArea.hasOwnProperty("name")&&(c[this.config.polygonLayer.statedArea.name]=
b.statedArea),b=new p(e,null,c),a.push(b),this._saveParcelPolygon(a)):this._showMessage(this.nls.planInfo.unableToCreatePolygonParcel)):this._createPolylineData(null)},setParcelInformation:function(b,a){var c=this.map.getLayer(this.config.polygonLayer.id).objectIdField;this._savedPolygonObjectId=b[0].attributes[c];var e=d.clone(b[0].attributes);e[c]=e[c]?e[c]:0;this._addGraphicToLocalLayer(e);this._savedPolyLines=a;k.remove(this.planInfoDeleteButton,"esriCTHidden");this.parcelNameTextBox&&this.parcelNameTextBox.set("value",
b[0].attributes[this.config.polygonLayer.parcelName.name]);this.planNameTextBox&&this.planNameTextBox.set("value",b[0].attributes[this.config.polygonLayer.planName.name]);this.documentTypeControl&&(b=b[0].attributes[this.config.polygonLayer.documentType.name],null!==b&&""!==b&&void 0!==b&&(this.config.polygonLayer.documentType.domain?this.documentTypeControl.set("item",this.documentTypeControl.store.get(b)):this.documentTypeControl.set("value",b)))},_rollbackSavedPolygon:function(){var b,a,c;a={attributes:{}};
(b=this.map.getLayer(this.config.polygonLayer.id))&&null!==this._savedPolygonObjectId&&(a.attributes[b.objectIdField]=this._savedPolygonObjectId,c=b.applyEdits(null,null,[a]));return c},_rollbackSavedPolyLines:function(b){var a,c,e,f;c=[];a=this.map.getLayer(this.config.polylineLayer.id);g.forEach(b,d.hitch(this,function(b){e={attributes:{}};b.hasOwnProperty("objectId")?(e.attributes[a.objectIdField]=b.objectId,c.push(e)):b.attributes.hasOwnProperty(a.objectIdField)&&(e.attributes[a.objectIdField]=
b.attributes[a.objectIdField],c.push(e))}));a&&0<c.length&&(f=a.applyEdits(null,null,c));return f},_deletePolygonBeforeSaving:function(b){(this._polygonLayer=this.map.getLayer(this.config.polygonLayer.id))?this._polygonLayer.applyEdits(null,null,b.polygonDeleteArr,d.hitch(this,function(){this._deleteLinesBeforeSaving(b)}),d.hitch(this,function(){this._showMessage(this.nls.planInfo.unableToSavePolygonParcel)})):this._showMessage(this.nls.planInfo.unableToSavePolygonParcel)},_deleteLinesBeforeSaving:function(b){var a;
(a=this.map.getLayer(this.config.polylineLayer.id))?a.applyEdits(null,null,b.polylineDeleteArr,d.hitch(this,function(){this._createPolygonData(b)}),d.hitch(this,function(){this._showMessage(this.nls.planInfo.unableToUpdateParcelLines)})):this._showMessage(this.nls.planInfo.unableToUpdateParcelLines)},_saveParcelPolygon:function(b){(this._polygonLayer=this.map.getLayer(this.config.polygonLayer.id))?(this._savedPolygonObjectId=null,this._polygonLayer.applyEdits(b,null,null,d.hitch(this,function(a){a&&
0<a.length&&a[0].success?(this._savedPolygonObjectId=a[0].objectId,this._polygonLayer.refresh(),a=new x,a.objectIds=[this._savedPolygonObjectId],a.returnGeometry=!1,a.outFields=[this.config.polygonLayer.relatedGUID.name],(new I(this._polygonLayer.url)).execute(a,d.hitch(this,function(a){this.loading.hide();this._createPolylineData(a.features[0].attributes[this.config.polygonLayer.relatedGUID.name])}),d.hitch(this,function(){this.loading.hide();this._showMessage(this.nls.planInfo.unableToSaveParcelLines)}))):
(this.loading.hide(),this._showMessage(this.nls.planInfo.unableToSavePolygonParcel))}),d.hitch(this,function(){this.loading.hide();this._showMessage(this.nls.planInfo.unableToSavePolygonParcel)}))):(this.loading.hide(),this._showMessage(this.nls.planInfo.unableToSavePolygonParcel))},_getValueAccToFeatureLayerUnit:function(b,a,c){if(a.hasOwnProperty(c)&&a[c])switch(b){case "meters":case "degrees":return a[c].meters;case "feet":return a[c].feet;case "uSSurveyFeet":return a[c].uSSurveyFeet;default:return null}else return null},
_getCurrentLineFeatures:function(){for(var b=[],a=0;a<this._itemList.length;a++)b.push(this._itemList[a].graphic);return b},_createPolylineData:function(b){var a,c,e,f,d,g;this.loading.show();d=this._getCurrentLineFeatures();e=this.polylineLayerUnit;g=this._itemList;f=[];for(var n=0;n<d.length;n++)a={},c=g[n],a[this.config.polylineLayer.bearing.name]=c.BearingConversions.naDD,a[this.config.polylineLayer.distance.name]=this._getValueAccToFeatureLayerUnit(e,c,"LengthConversions"),a[this.config.polylineLayer.lineType.name]=
c.LineSymbol.type,a[this.config.polylineLayer.radius.name]=this._getValueAccToFeatureLayerUnit(e,c,"RadiusConversions"),null!==a[this.config.polylineLayer.radius.name]&&""!==a[this.config.polylineLayer.radius.name]&&void 0!==a[this.config.polylineLayer.radius.name]?(a[this.config.polylineLayer.arcLength.name]=this._getValueAccToFeatureLayerUnit(e,c,"ArcLengthConversions"),c=this._getValueAccToFeatureLayerUnit(e,c,"ChordLengthConversions"),a[this.config.polylineLayer.chordLength.name]=c,a[this.config.polylineLayer.distance.name]=
c):(a[this.config.polylineLayer.arcLength.name]=null,a[this.config.polylineLayer.chordLength.name]=null),a[this.config.polylineLayer.relatedGUID.name]=b,a[this.config.polylineLayer.sequenceId.name]=n,c=d[n].geometry.toJson(),c=new H(c),a=new p(c,null,a,null),f.push(a);this._saveParcelLines(f)},_saveParcelLines:function(b){var a;(a=this.map.getLayer(this.config.polylineLayer.id))?a.applyEdits(b,null,null,d.hitch(this,function(a){var c=[],d=[];g.forEach(a,function(a){a.success?d.push(a):c.push(a)});
0<c.length?(this._rollbackSavedPolygon(),0<d.length&&c.length!==b.length&&this._rollbackSavedPolyLines(d),this._showMessage(this.nls.planInfo.unableToSaveParcelLines)):(this._showParcelSavedAndDeleteMsg(this.nls.planInfo.parcelSavedSuccessMessage),this._savedPolygonObjectId=null,this.emit("displayMainPageAfterSave",!1));this.loading.hide()}),d.hitch(this,function(){this._rollbackSavedPolygon();this.loading.hide();this._showMessage(this.nls.planInfo.unableToSaveParcelLines)})):(this._rollbackSavedPolygon(),
this.loading.hide(),this._showMessage(this.nls.planInfo.unableToSaveParcelLines))},_validateRequiredFields:function(){var b=[],a=this._currentFeatureDetails;if(!a)return b;var c=a.getLayer(),c=g.filter(c.fields,d.hitch(this,function(a){return!1===a.nullable&&!0===a.editable}));g.forEach(c,d.hitch(this,function(c){if(a.attributes.hasOwnProperty(c.name))if("undefined"===a.attributes[c.name])b.push(c.name);else if(null===a.attributes[c.name])b.push(c.name);else switch(c.type){case "esriFieldTypeString":(""===
a.attributes[c.name]||a.attributes[c.name]&&""===a.attributes[c.name].trim())&&b.push(c.name)}else b.push(c.name)}));return b},_validateAttributes:function(){var b=[],a,b=this._validateRequiredFields(),c=w("td.atiLabel",this._attributeInspector.domNode),e=[];this._clonedProjectPolygonLayerObject.globalIdField&&e.push(this._clonedProjectPolygonLayerObject.globalIdField);this._clonedProjectPolygonLayerObject.objectIdField&&e.push(this._clonedProjectPolygonLayerObject.objectIdField);c&&g.forEach(c,d.hitch(this,
function(c){var d=h.get(c,"data-fieldname");-1===e.indexOf(d)&&(d=this._getAttrInspectorRowInfo(c))&&(0>b.indexOf(d[1])?d[0].isValid&&!d[0].isValid()?(b.push(d[1]),a||(a=d[0])):1<c.parentNode.childNodes[1].childNodes.length&&(c=c.parentNode.childNodes[1].childNodes[1],c=r.getEnclosingWidget(c),c.isValid&&!c.isValid()&&(b.push(d[1]),a||(a=c))):a||(a=d[0]))}));a&&(k.contains(this.expandCollapseNode,"esriCTCollapsedParceLayer")||this._onExpandCollapseClicked(),a.focus());return b},validateParcelDetails:function(b){var a=
{};if(this._attributeInspector){var c=this._validateAttributes();if(c&&0<c.length)return a.status=!1,a.message="",a}if(this.config.polygonLayer.statedArea&&this.config.polygonLayer.statedArea.hasOwnProperty("name")&&(!this.config.polygonLayer.statedArea.nullable&&(null===b||""===b)||null!==b&&""!==b&&-1<this.numberFieldTypes.indexOf(this.config.polygonLayer.statedArea.type)&&!this.validateNumericField(b,this.config.polygonLayer.statedArea.type)))return a.status=!1,a.message=this.nls.planInfo.enterValidStatedAreaNameMessage,
a;a.status=!0;return a},deleteParcel:function(){this.loading.show();this._rollbackSavedPolygon().then(d.hitch(this,function(){this._rollbackSavedPolyLines(this._savedPolyLines).then(d.hitch(this,function(){this.loading.hide();this._showParcelSavedAndDeleteMsg(this.nls.planInfo.parcelDeletedSuccessMessage);this._savedPolygonObjectId=null;this.emit("displayMainPageAfterSave",!1)}),d.hitch(this,function(){this.loading.hide();this._savedPolygonObjectId=null;this._showParcelSavedAndDeleteMsg(this.nls.planInfo.parcelDeleteErrorMessage);
this.emit("displayMainPageAfterSave",!1)}))}),d.hitch(this,function(){this.loading.hide();this._savedPolygonObjectId=null;this._showParcelSavedAndDeleteMsg(this.nls.planInfo.parcelDeleteErrorMessage);this.emit("displayMainPageAfterSave",!1)}))},setPlanInfoCancelBtnAsLastNode:function(){q.initLastFocusNode(this.widgetDomNode,this.planInfoCancelButton)},_showParcelSavedAndDeleteMsg:function(b){this.emit("showParcelSavedAndDeleteMsg",b)},mergeFirstToLast:function(){for(var b={},a=arguments.length-1,
c;0<=a;a--)for(c in arguments[a])arguments[a].hasOwnProperty(c)&&(b[c]=arguments[a][c]);return b},_getFieldInfosFromLayer:function(b){var a=[];b&&b.layerObject&&g.forEach(b.layerObject.fields,function(b){var c=q.getDefaultPortalFieldInfo(b),c=this.mergeFirstToLast(c,b);c.format&&c.format.dateFormat&&c.format.dateFormat.toLowerCase()&&0<=c.format.dateFormat.toLowerCase().indexOf("time")&&(c.format.time=!0);c.visible=!0;a.push(c)},this);return a},_createFieldsDetailsObject:function(b){var a={};g.forEach(b,
d.hitch(this,function(b){a[b.name]=b.type}));return a},getFieldInfoByFieldName:function(b,a){var c={};g.some(b,function(b){if(b.name===a)return d.mixin(c,b),!0});return c},_getFieldInfosForPolygonLayer:function(){if(this.fieldInfosForPolygonLayer)return this.fieldInfosForPolygonLayer;var b,a,c=[],e=[this.config.polygonLayer.rotation.name,this.config.polygonLayer.scale.name,this.config.polygonLayer.miscloseRatio.name,this.config.polygonLayer.miscloseDistance.name,this.config.polygonLayer.statedArea.name],
f=this._layerInfosObj.getLayerInfoById(this.config.polygonLayer.id),h=this._createFieldsDetailsObject(f.layerObject.fields);a=this._getFieldInfosFromLayer(f);if(this.config.hasOwnProperty("useFieldInfosFromWebmap")&&this.config.useFieldInfosFromWebmap&&f.controlPopupInfo&&f.controlPopupInfo.enablePopup&&f.controlPopupInfo.infoTemplate)a=d.clone(f.controlPopupInfo.infoTemplate.info.fieldInfos);else if(this.config.polygonLayer.hasOwnProperty("additionalFieldsInfo")&&0<this.config.polygonLayer.additionalFieldsInfo.length){var l=
[];g.forEach(this.config.polygonLayer.additionalFieldsInfo,function(b){var c=this.getFieldInfoByFieldName(a,b.fieldName),c=d.mixin(c,b);!c.nullable&&c.editable&&(c.visible=!0,c.isEditable=!0);l.push(c)},this);a=l}else this.config.polygonLayer.documentType.hasOwnProperty("name")&&c.push(this.config.polygonLayer.documentType.name),this.config.polygonLayer.parcelName.hasOwnProperty("name")&&c.push(this.config.polygonLayer.parcelName.name),this.config.polygonLayer.planName.hasOwnProperty("name")&&c.push(this.config.polygonLayer.planName.name);
b=[];g.forEach(a,d.hitch(this,function(a){c&&0<c.length&&0>c.indexOf(a.fieldName)&&(a.visible=!1);-1<e.indexOf(a.fieldName)&&(a.visible=!1);a.visible&&h[a.fieldName]&&"esriFieldTypeRaster"!==h[a.fieldName]&&"esriFieldTypeBlob"!==h[a.fieldName]&&"esriFieldTypeXML"!==h[a.fieldName]&&(a.format&&a.format.dateFormat&&a.format.dateFormat.toLowerCase()&&0<=a.format.dateFormat.toLowerCase().indexOf("time")&&(a.format.time=!0),b.push(a))}));return this.fieldInfosForPolygonLayer=b},_clearAttributeInspectorData:function(){this._attributeInspector&&
(this._attributeInspector.layerInfos&&g.forEach(this._attributeInspector.layerInfos,function(b){b=b.featureLayer;b.clearSelection();b.refresh()}),this._attributeInspector.destroy())},_add508SupportToATI:function(){var b;this._attributeInspector&&this._attributeInspector.domNode&&(b=w("td.atiLabel",this._attributeInspector.domNode))&&g.forEach(b,d.hitch(this,function(a){var b=this._getAttrInspectorRowInfo(a);b&&(b[0].set("aria-label",b[1]),1<a.parentNode.childNodes[1].childNodes.length&&(a=a.parentNode.childNodes[1].childNodes[1],
a=r.getEnclosingWidget(a),a.set("aria-label",b[1])))}))},_getAttrInspectorRowInfo:function(b){try{if(b&&b.parentNode){var a=b.parentNode.childNodes[1].childNodes[0];return[r.getEnclosingWidget(a),b.childNodes[0].data,a]}return null}catch(c){return console.log(c),null}},_getCurrentFieldDijit:function(b){var a;g.some(this._attributeInspector._currentLInfo.fieldInfos,d.hitch(this,function(c){if(c.name===b||c.field&&c.field.name===b||c.fieldName===b)return a=c.dijit,!0}));return a},_addGraphicToLocalLayer:function(b){var a,
c,e,f,g,k;(k=this._getFieldInfosForPolygonLayer())&&0!=k.length&&(this._clearAttributeInspectorData(),this._removeClonedProjectPolygonLayer(),c=this.map.getLayer(this.config.polygonLayer.id),this._clonedProjectPolygonLayerObject=this._cloneProjectPolygonLayer(c,k),e=this.own(l(this._clonedProjectPolygonLayerObject,"load",d.hitch(this,function(){e&&e[0]&&e[0].remove();a=this._layerInfosObj.getLayerInfoById(this._clonedProjectPolygonLayerObject.originalLayerId);a.featureLayer=this._clonedProjectPolygonLayerObject;
this._createAttributeInspector(k);f=new p(null,null,b?b:{},null);f.preEditAttrs=JSON.parse(JSON.stringify(f.attributes));this._clonedProjectPolygonLayerObject.applyEdits([f],null,null,d.hitch(this,function(a){g=new x;g.objectIds=[a[0].objectId];this._clonedProjectPolygonLayerObject.selectFeatures(g,y.SELECTION_NEW,d.hitch(this,function(){var a=this._attributeInspector.attributeTable.childNodes[0];h.set(a,"cellspacing","5");h.set(a,"cellpadding","5");this._currentFeatureDetails=f;this._add508SupportToATI();
this._attributeInspector.attachmentEditor&&v.set(this._attributeInspector.attachmentEditor,"display","none");this._attributeInspector.editorTrackingInfoDiv&&v.set(this._attributeInspector.editorTrackingInfoDiv,"display","none");if(a=this._clonedProjectPolygonLayerObject.objectIdField){var b=this._getCurrentFieldDijit(a);b&&f.preEditAttrs[a]&&b.set("value",f.preEditAttrs[a])}}),d.hitch(this,function(){}))}),d.hitch(this,function(){}))}),d.hitch(this,function(){}))))},_removeClonedProjectPolygonLayer:function(){this._clonedProjectPolygonLayerObject&&
null!==this._clonedProjectPolygonLayerObject&&(this._clonedProjectPolygonLayerObject.clearSelection(),this._clonedProjectPolygonLayerObject.clear(),this.map.removeLayer(this._clonedProjectPolygonLayerObject),this._clonedProjectPolygonLayerObject=null)},_filterFields:function(b,a){var c=[];g.forEach(a,d.hitch(this,function(a){a.visible&&g.forEach(b.fields,d.hitch(this,function(b){b.hasOwnProperty("name")&&a.hasOwnProperty("fieldName")&&b.name===a.fieldName&&c.push(b)}))}));b.fields=c},_cloneProjectPolygonLayer:function(b,
a){var c;c=q.getFeatureLayerDefinition(b);this._filterFields(c,a);c.id="clonedPolygonLayer"+this.id;c.name=b.name+this.id;a={layerDefinition:c};c=b.fields.map(function(a){return a.name});a=new y(a,{outFields:c});a.visible=!0;a.renderer=b.renderer;a.originalLayerId=b.id;a._wabProperties={isTemporaryLayer:!0};this.map.addLayer(a);return a},_processLayerFields:function(b){g.forEach(b,function(a){void 0!==a.domain&&null!==a.domain&&void 0!==a.domain.type&&null!==a.domain.type&&"range"===a.domain.type&&
!1===a.domain.hasOwnProperty("range")&&(a.domain.range=[a.domain.minValue,a.domain.maxValue])});return b},_createAttributeInspector:function(b){u.empty(this.attributeInspectorContainer);this._attributeInspector=new (t([J],{constructor:function(){this._aiConnects=[];this._selection=[];this._toolTips=[]}}))({layerInfos:[{featureLayer:this._clonedProjectPolygonLayerObject,fieldInfos:b}]},u.create("div",{"class":"esriCTAttributeInspectorWidgetContainer"}));this.own(l(this._attributeInspector,"attribute-change",
d.hitch(this,function(a){this._currentFeatureDetails&&(this._currentFeatureDetails.attributes[a.fieldName]=a.fieldValue)})));this._attributeInspector.startup();this.attributeInspectorContainer.appendChild(this._attributeInspector.domNode)}})});